high-qual consist illumin mobil augment realiti radianc convolut gpu peter kan, johann unterguggenberger, hann kaufmann institut softwar technolog interact systems, vienna univers technology, vienna, austria abstract. consist illumin virtual real object aug- ment realiti (ar) essenti achiev visual coherence. paper present practic method render consist illumin ar steps. step, user scan surround environ- ment rotat motion mobil devic real illumin captured. captur real light high dynam rang (hdr) preserv high contrast. second step, captur environ map precalcul set reflect map mobil gpu real-tim render consist illumination. method achiev high qualiti reflect map con- volut environ map brdf calcul accur pixel output map. moreover, util multipl render target calcul reflect map multipl materi simultaneously. present method consist illumin ar benefici increas visual coher virtual real objects. addition- ally, highli practic mobil ar us commod mobil device. 1 introduct augment realiti technolog superimpos virtual object real world accur spatial visual registr achiev [1]. order achiev accur visual registr visual coherence, consist illumin real virtual object essential. therefore, illumin real world captur illumin virtual objects. however, previou method consist illumin limit light low angular frequenc [2, 3] requir complex hardwar setup [4 6] suitabl mobil ar. paper, propos method render consist illumin mobil ar requir special hardwar util low- frequenc high-frequ illumin angular domain. method overcom limit low-frequ light reconstruct environ map, repres real illumination, imag captur mobil device. overlap imag data accumul high dynam rang (hdr) envi- ronment map reconstruct interactively. map process 2 peter kan, johann unterguggenberger, hann kaufmann fig. 1. process hdr environ map captur render consist illumin ar. left right: multipl input imag differ exposur differ devic orient combin hdr spheric map. envi- ronment map calcul reflect map mobil gpu. finally, reflect map real-tim render consist illumin ar. mobil gpu render virtual objects. order calcul high- qualiti light reflect virtual surfaces, method gener reflect map convolv input map bidirect reflect distribut function (brdfs) materi scene. previou method approxim convolut mip-map gaussian blur lead inaccur light reflections. overcom limit calcul high- qualiti reflect map mobil gpu oper output pixel parallel. reflect map calcul begin render step render high-qual reflect real-time. calcul hdr. method util multipl render target simultan gener reflect map multipl shini factor phong brdf. additionally, us lightmap precalcul ambient occlus simul local visibl occlus high quality. process hdr environ- ment map creation, reflect map calculation, render consist illumin depict figur 1. figur show tonemap environ- ment map exposur gamma correction. result paper demonstr qualiti improv ren- dere method comparison common mip-map approach. moreover, compar result refer solution, render offlin path tracing. method produc result close refer so- lution. both, light captur render site requir commod mobil device. therefore, method highli usabl render high-qual consist illumin mobil ar. main contribut paper are: step method render consist illumin ar us mobil device. method effici calcul high-qual irradi environ map mobil gpu. parallel gener reflect map multipl materials. high-qual consist illumin mobil augment realiti 3 2 relat work render virtual object consist illumin challeng problem ar. order solv problem, illumin real world captur estim render virtual objects. previou method address problem divid categori base real light acquired: method light probe (either passiv reflect sphere activ camera fish ey lens) method estim light main camera image. method estim light real-tim need captur illumin input. light probe methods. method base light probe us special hardwar (usu- alli camera fish ey lens) captur illumin high quality. approach captur illumin real-tim us render ar present [7, 6, 8, 5, 9, 10]. approach calcul global illumin ar scene introduc light reflect vir- tual real objects. advantag method high visual fidel render result. however, need high comput power suitabl mobil devices. method consist near-field illumin run mobil devic present rohmer et al. [11]. method render virtual object lit consist real world calcul global illumination. limit requir multipl exter- nal camera connect send data mobil devic wi-fi. contrast method requir mobil devic need addit hardware. method us captur illumin input render render virtual object natur light. pessoa et al. [12] environ map reconstruct multipl exposur imag reflect sphere. author gener glossy, second glossy, diffus map. interpol approxim specif material. method calcul glossi reflect map specif material. therefore, high accuraci render achieved. meilland et al. [4] propos method dens reconstruct hdr light field real scene regist multipl low dynam rang imag differ exposures, captur rgb-d camera. reconstruct light field gener multipl light probe illumin virtual objects. similar method firstli captur hdr environ map us render consist illumination. approach fast light factor ar render base spheric harmon present [13]. light estim methods. method light sourc estim main camera imag proposed. advantag method requir addit camera light probes. estim real illumin shadow propos sato et al. [14]. author estim distribut illumin analyz relationship imag bright occlus incom light. gruber et al. [3] present 4 peter kan, johann unterguggenberger, hann kaufmann method real-tim estim diffus illumin arbitrari geometry, captur rgb-d camera. method reconstruct real geometri surround illumin render virtual content ar consist illumination. recently, method illumin estim user face, base train set radianc transfer functions, present [2]. limit approach light estim main camera imag reconstruct high-frequ illumination. render natur illumination. real light reconstructed, render- ing natur illumin plai import role achiev consist appear virtual real objects. precalcul reflect map render diffus specular reflect discuss [15, 16]. ramamoor- thi hanrahan [17] propos effici method irradi environ map calcul util spheric harmonics. method suitabl calcul diffus illumination. fast approxim environ map convolut achiev mip-map [1820]. method calcul ac- curat convolut illumin brdf pixel. therefore, diffus glossy, specular materials. method real-tim render natur illumin ar reflect map present [12, 2123]. recently, mehta et al. [24] present method physically-bas render ar base gpu path trace real-tim filtering. method illumin scene captur light probe. produc high-qual render results, method suitabl mobil ar requir high comput power provid high-perform desktop gpu. 3 consist illumin ar propos method render consist illumin ar work main steps. step, user scan environ mobil de- vice. rotat motion mobil devic assum imag camera accumul spheric environ map. hdr reconstruct perform captur wide rang light intens real world. second step, captur map convolv brdf materi virtual scene. convolv reflect map real-tim rendering. achiev consist illumin virtual real object real world light illumin virtual scene. captur environ map contain high low frequenc convolut calcul pixel gpu. therefore, method achiev high qualiti final rendering. detail step reveal sections. 3.1 illumin captur order render virtual object lit consist real world, real illumin need captured. purpose, user scan surround- ing environ mobil devic perform 360 rotat motion yaw high-qual consist illumin mobil augment realiti 5 pitch angl cover sphere directions. hdr environ map reconstruct interact scanning. environ light scan util approach present [25] captur hdr environ map. camera imag project spheric environ map accord- ing orient device, estim inerti measur unit (imu) mobil devic includ gyroscope, acceleromet magne- tometer. us map sphere similar debevec [26]. distinctly, map orient posit z axi (up vector) project im- ag center prefer consist imag deform horizont direction. geometr radiometr calibr perform ac- curat project captur data. high dynam rang reconstruct radianc data essenti accu- rate repres high contrast real light. therefore, low dynam rang data, captur imag sensor, convert hdr radiance. approach hdr reconstruct base work robertson et al. [27]. invers camera respons function reconstruct color channel calibr process. then, us function hdr reconstruct multipl overlap imag known exposur time [27, 25]. mobil camera set auto-exposur mode correctli adapt ex- posur time local portion scene camera pointing. imag overlap, usual slightli differ exposur time adapt auto-exposure. therefore, merg overlap data cal- culat incom radianc hdr. hdr reconstruct run mobil gpu environ map accumul float point framebuff achiev interact speed. additionally, emploi align correct base featur match compens drift imu. 3.2 environ map convolut captur hdr environ map render virtual object lit con- sistent real world lighting. begin render phase, environ map convolv brdf materi creat reflect map allow fast high qualiti lighting. develop new method convolut environ map gpu capa- ble convolv map multipl brdf simultaneously. multipl render target util purpose. high qualiti result reflect map achiev take pixel input map calculation. order enabl precalcul reflect light need reduc number paramet reflect calculation. assum distant light, repres captur environ map. moreover, calcul singl light reflect surfac scene materi assum non-emissive. base assumptions, render equat [28] simplifi to: lo 2 n n i=1 fr(x,i,o)li(x,i) | n | (1) 6 peter kan, johann unterguggenberger, hann kaufmann calcul reflect radianc lo take account incom- ing radianc li environ map brdf function denot fr. brdf function depend direct incom light i, direct reflect right o surfac posit x. n stand number pix- el environ map n local surfac normal. follow loos write = instead refer approxim incom light environ map. equat 1 repres convolut environ map brdf function fr. however, brdf func- tion vari parameters. therefore, split equat 1 diffus specular convolut base assumpt brdf separ diffus specular components. render util phong brdf model [29]. approach, specular compon phong brdf divid | ni |. modif make specular reflect depend reflect view direct (perfect specular reflect direction) shini n. then, term (n+1) normal factor obei energi conserv phong brdf. brdf model describ follow equation: fr = kd 1 + ks (n+ 1) 2 cosn () | n | (2) angl incom light direct reflect view direction. kd ks diffus specular coeffici material. ad phong brdf, split equat 1 diffus specular compon rewritten to: lo = 2 n n i=1 kd li(x,i) | n |+ 2 n n i=1 ks(n+ 1) 2 cosn () | n | li(x,i) | n | (3) fig. 2. calcul reflect map convolut input environ map vari brdf kernel. materi shini 160 (left) 20 (right) shown. high-qual consist illumin mobil augment realiti 7 diffus (kd) specular (ks) coeffici taken sums. then, sum precalcul diffus specular reflect maps. modifi phong brdf, radianc reflect specularli vari mirror view direct shini n. thus, convolut specular brdf compon input environ map precal- culat reflect map specif shini n. order calcul reflect radianc rendering, specular reflect map address reflect rai direction. additionally, precalcul irradi environ map (diffus reflect map) convolv input environ map diffus compon equat 3. map materi access surfac normal depend orient surface. calcul reflect map convolv input map variabl brdf kernel depict figur 2. finally, reflect radianc calcul sum diffus specular reflect radianc (obtain precalcul reflect maps), multipli correspond brdf coeffici kd, ks: lo = kded(n) + kse n s (r) (4) term ed e n s repres calcul diffus specular reflect maps. n shini materi r stand mirror reflect view direction. reflect map calcul mobil gpu increas effi- cienci calculation. us multipl render target calcul map multipl materi simultaneously. effici enhanc high benefit shader code shini factor ex- cept power cosn (). algorithm reflect map calcul goe pixel input map calcul result specif pixel output map. pixel output map calcul parallel opengl raster pipeline. high output resolut requested, method subdivid 2d output space tile process sequen- tially. procedur latenc caus reflect map calcul reduc recalcul render needed. reflect maps, calcul method shown figur 5. 3.3 render natur light reflect map calculated, us consist illumin virtual object real-time. step effici textur lookup color multipl required. result radiance, reflect camera, calcul equat 4. preconvolv diffus reflect radianc obtain diffus irradi environ map ed(n) access surfac normal. radiance, reflect specularli obtain specular reflect map en reflect view direct r . render virtual dragon calcul reflect map shown figur 1. 8 peter kan, johann unterguggenberger, hann kaufmann 3.4 lightmap virtual object simpli superimpos real image, light in- teract virtual real scene missing. order address problem, precalcul visibl offlin high-qual ambient occlus calcul store lightmaps. diffus reflect radianc multipli ambient occlus factor real virtual objects. enabl self-shadow virtual object local proxim shadow real scene cast virtual objects. order render virtual shadow real object need know geometri real scene. currently, us proxi geometri model real world. advantag multipl shadow factor avoid composit differenti render [26] requir render solutions. comparison render ambient occlus seen figur 3. imag ambient occlus correctli indic spatial relationship virtual real object miss contact shadows. contrast that, imag ambient occlus contain contact shadow indic proxim dragon real table. fig. 3. render ar (left) (right) ambient occlusion. imag show virtual dragon, real cup, real cube. 3.5 implement mobil implement method consist illumin ar advantag high usability. implement shader camera imag projection, hdr reconstruction, reflect map calculation, render natur illumin opengl shade languag run opengl es 3.0. vuforia sdk implement track real camera achiev correct spatial registr virtual object real scene. experiments, describ section 4, perform nvidia shield tablet. render virtual object hdr ensur proper re- flection light surfaces. finally, tonemap appli ar imag mobil display. us photograph tone reproduct method, present [30], convert comput hdr radianc low dynam rang intensities. high-qual consist illumin mobil augment realiti 9 4 result result render consist illumin present method shown figur 1, 3, 4. figur high dynam rang captur environ map ensur proper shini light reflect virtual objects. moreover, precalcul lightmap creat consist local proxim shadow increas visual coherence. order evalu qualiti present method compar common calcul reflect map mip-map approach refer solution, calcul offlin path tracing. result comparison seen figur 4. glossi materi shini 60 render teapot lit natur illumination. see, method produc higher qualiti mip-map base calcul reflect map achiev result similar reference. reflect mip-map result sharper reference. method correctli calcul reflect real world virtual content. refer solut featur self-reflect simul method. fig. 4. comparison rend method, render mip-map reflect maps, path-trac reference. row show reflect map gener method gener mip-mapping. materi shini 60. analyz perform method measur computa- tional time particular step. first, measur comput time reflect map calculation. time measur differ size reflect map seen tabl 1. 8 reflect map calcul measur parallel. comput time reflect map lower 10 peter kan, johann unterguggenberger, hann kaufmann resolut ( 512 x 512) accept ar applic captur us real illumin site. additionally, frame rate render differ virtual object ar method measured. result measur shown tabl 2. render achiev high-qual result interact perform essenti ar. tabl 1. comput time reflect map calcul differ output reso- lutions. reflect map calcul simultan evalu reso- lution. comput time state format minutes:seconds:milliseconds. resolut reflect map reflect map calcul time 32 x 32 00:00:040 64 x 64 00:01:450 128 x 128 00:06:360 256 x 256 00:28:090 512 x 512 02:38:370 1024 x 1024 23:01:650 tabl 2. frame rate render consist illumin ar method. render hd resolution. 3d model number triangl frame rate reflect cup 25 600 29 fp teapot 15 704 30 fp dragon 229 236 13 fp evaluation, measur averag time non-skil user abl captur environ map present method. 10 user (5 men 5 women) particip short experi perfor- manc environ map captur measured. particip captur method before. averag captur time 52 second experiment. result demonstr usabl method applic on-sit ar scenarios. 5 limit futur work currently, implement us phong brdf repres materials. future, extend complex brdfs. addit paramet requir brdf convolut (e.g. case brdf fresnel term), 3d textur store convolv reflect map. ambient occlusion, bake lightmaps, limit present method static geometry. limit solv real-tim screen-spac ambient occlus calcul instead pre-calcul one. high-qual consist illumin mobil augment realiti 11 fig. 5. hdr reflect map calcul method. 6 conclus paper present two-step method render consist illumin ar. step, surround illumin captur hdr environ map. second step set reflect map precalcul real-tim render natur light. method us commod mobil devic requir special hardware. therefore, highli usabl mobil ar applications. util lightmap simul local occlus real world object virtual geometry. result present method increas qualiti light ar comparison mip-map reflect map calculation. finally, multipl present ar imag demonstr qualiti light present method. acknowledg dragon model courtesi stanford graphic laboratory. teapot model courtesi martin newell. research fund austrian project ffg-bridg 843484. refer 1. azuma, r.t.: survei augment reality. presence: teleoper virtual environ 6 (1997) 355385 2. knorr, s., kurz, d.: real-tim illumin estim face coher rendering. in: ieee ismar 2014. (2014) 113122 3. gruber, l., richter-trummer, t., schmalstieg, d.: real-tim photometr regis- tration arbitrari geometry. in: ieee ismar. (2012) 119128 4. meilland, m., barat, c., comport, a.: 3d high dynam rang dens visual slam applic real-tim object re-lighting. in: ieee ismar. (2013) 5. kan, p., kaufmann, h.: high-qual reflections, refractions, caustic aug- ment realiti contribut visual coherence. in: ieee ismar, ieee societi (2012) 99108 6. knecht, m., traxler, c., mattausch, o., wimmer, m.: reciproc shade mix reality. comput & graphic 36 (2012) 846856 7. grosch, t., eble, t., mueller, s.: consist interact augment live camera imag correct near-field illumination. in: acm symposium virtual realiti softwar technology, new york, usa, acm (2007) 125132 12 peter kan, johann unterguggenberger, hann kaufmann 8. kan, p., kaufmann, h.: differenti irradi cach fast high-qual light transport virtual real worlds. in: ieee ismar. (2013) 133141 9. franke, t.: delta voxel cone tracing. in: ieee ismar. (2014) 3944 10. franke, t.: delta light propag volum mix reality. in: ieee ismar. (2013) 125132 11. rohmer, k., buschel, w., dachselt, r., grosch, t.: interact near-field illumi- nation photorealist augment realiti mobil devices. in: ieee ismar. (2014) 2938 12. pessoa, s., moura, g., lima, j., teichrieb, v., kelner, j.: photorealist render augment reality: global illumin brdf solution. in: virtual realiti confer (vr), 2010 ieee. (2010) 3 10 13. nowrouzezahrai, d., geiger, s., mitchell, k., sumner, r., jarosz, w., gross, m.: light factor mixed-frequ shadow augment reality. in: ieee ismar. (2011) 173179 14. sato, i., sato, y., ikeuchi, k.: illumin shadows. ieee transact pattern analysi machin intellig 25 (2003) 290300 15. miller, g.s., hoffman, c.r.: illumin reflect maps: simul object simul real environments. in: siggraph 84. (1984) 16. kautz, j., vzquez, p.p., heidrich, w., seidel, h.p.: unifi approach pre- filter environ maps. in: render techniques. springer (2000) 185196 17. ramamoorthi, r., hanrahan, p.: effici represent irradi envi- ronment maps. in: siggraph, new york, ny, usa, acm (2001) 497500 18. mcguire, m., evangelakos, d., wilcox, j., donow, s., mara, m.: plausibl blinn- phong reflect standard cube mip-maps. technic report cstr201301, william colleg depart science, usa (2013) 19. scherzer, d., nguyen, c.h., ritschel, t., seidel, h.p.: pre-convolv radianc caching. graphic forum 4 (2012) 20. kautz, j., daubert, k., seidel, h.p.: advanc environ map vr ap- plications. comput & graphic 28 (2004) 99 104 21. agusanto, k., li, l., chuangui, z., sing, n.w.: photorealist render aug- ment realiti environ illumination. in: ieee ismar. (2003) 208218 22. supan, p., stuppacher, i., haller, m.: imag base shadow real-tim aug- ment reality. ijvr 5 (2006) 17 23. franke, t., jung, y.: real-tim mix realiti gpu techniques. in: grapp. (2008) 249252 24. mehta, s.u., kim, k., pajak, d., pulli, k., kautz, j., ramamoorthi, r.: filter environ illumin interact physically-bas render mix reality. in: eurograph symposium rendering. (2015) 25. kan, p.: interact hdr environ map captur mobil devices. in: eurograph 2015 - short papers, eurograph associ (2015) 2932 26. debevec, p.: render synthet object real scenes: bridg tradit image-bas graphic global illumin high dynam rang photogra- phy. in: siggraph 98, ny, usa, acm (1998) 189198 27. robertson, m., borman, s., stevenson, r.: dynam rang improv multipl exposures. in: icip. volum 3. (1999) 159163 28. kajiya, j.t.: render equation. in: siggraph. (1986) 143150 29. lafortune, e.p., willems, y.d.: modifi phong reflect model physic base rendering. technic report, k.u. leuven (1994) 30. reinhard, e., stark, m., shirley, p., ferwerda, j.: photograph tone reproduct digit images. acm transact graphic 21 (2002) 267276