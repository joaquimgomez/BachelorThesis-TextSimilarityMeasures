eurograph 2009/ d. ebert j. krger area paper hybrid ambient occlus christoph k. reinboth tami boubekeur+ marc alexa tu berlin +telecom paristech & ltci cnr abstract ambient occlus captur subset global illumin effects, comput point surfac incom light direct consid potenti occlus neighbor geometry. introduc approach ambient occlus combin object imag space techniqu defer shade context. compos kei steps: on-the-fli voxel scene, occlus sampl base voxel bilater filter sampl screen space. result smoothli vari ambient term occlud area interact frame rate precomputation. particular, comput perform dynam gpu elimin problem screen-spac methods, ignor geometri raster z-buffer. categori subject descriptor (accord acm ccs): i.3.7 [comput graphics]: three-dimension graphic realism color, shading, shadowing, texture; 1. introduct human visual sensit small error low frequenc light variation. consequence, visu- alli convinc approxim global illumin achiev aggress simplif light transport. particular, indirect light approx- imat sampl geometri vicin point, assum geometri block incom light. techniqu call ambient occlus featur modern realtim 3d engine. basic idea ambient occlus goe ac- cessibl shade [mil94]: surfac point classifi base radiu tangent sphere larger sphere hint light reach surfac point. later, zhukov et al. [zik98] introduc notion ob- scuranc equip local illumin model global defin ambient term. finally, christensen [chr03] intro- duce techniqu obscur product environ- ment (pixar renderman) (more common) ambient occlusion. geometri scene static, ambient occlus precomputed. refer reader recent survei mndez-feliu sbert [mfs09] complet overview ambient occlus history. paper consid case dynam scene ge- ometry, comput real time frame. far, real time perform achiev comput ambient occlus gpu screen space (see section 3 detail references). limit effect ambient occlus geometri actual render z-buffer, ignor part view frustum occlud object outsid view frustum (e.g. imag plane). propos solv problem perform 3d raster region (i.e. ambient oc- clusion comput statically), independ current z-buffer. allow potenti occlud locat out- field view object consid- ered. approach combin screen space ob- ject space computation, techniqu hybrid ambi- ent occlus (hao). hao abl reproduc visual convinc ambient oc- clusion shadow effects: real time; fulli dynam scenes, restrict ani- mation deform undergon geometri cpu precomputation; consid nearbi objects, locat outsid (rasterized) field view. c eurograph associ 2009. c.k.reinboth & t.boubekeur & m.alexa / hybrid ambient occlus hao implement multi-pass algorithm run gpu. produc ao map, com- bine modul defer shade render en- gine. ao map gener steps: 1. 3d raster scene geometri perform region single-pass voxel eisemann dcoret [ed06] (see section 5); 2. pixel screen, ambient occlus estim object space monte-carlo sampl occlus given direct defin rai intersect non-empti cell 3d raster (see section 6); 3. result ao valu filter screen space separ approxim bilater filter ao map (see section 7). result, obtain smoothli vari low frequenc shadow interact rate complex dynam scene standard hardwar (see section 8). 2. background ambient occlus (ao ) captur shadow creat occlud indirect light come equal direct (ambient light) special case obscur techniqu [zik98]. usual approxim surfac take local geometri account: ge- ometri certain distanc point sur- face, darker (less accessible) shade point be. formally, consid point p surface, equip normal vector n, ambient occlus defin follows: (p,n) = 1 v (p,),nd (1) hemispher center p orient n, v (p,) visibl term defin geometri exist direct zero otherwise, . dot product. basic definit usual enhanc weight- ing kernel w restrict analysi geometri locat maximum distanc dmax progress decreas contribut occlud distance: (p,n) = 1 w(v (p,),dmax),nd (2) kernel reproduc input p, smoothli monoton decai zero dmax. wendland [wen95] deriv piecewis polynomi function minim degre desir compact support: w(t,h) = { (1 th ) 4( 4th +1) 0 t h 0 t > h (3) us kernel time approach. 3. relat work techniqu introduc 5 year approxim ao real-time. method rang pure static pure dynam ones. pharr green [pg04] focu static approach precomput- ing ambient occlus valu scene store result textur vertex compon ver- tex base. offlin render pass limit techniqu static scenes. mendez-feliu et al. [mfsc03] precalcul ambient occlus term per-patch basi perform updat region move objects. larg num- ber patch need produc high qualiti shadows. order avoid precomput ambient occlu- sion terms, bunnel [bun05] propos transform mesh surfac disc (surfels) differ sizes, cover origin surfaces. comput visibl informa- tion point mesh, approxim shad- ow disc determin ambient occlusion. however, highli tessel object need high qualiti shadow visibl estim per-vertex only. hoberock jia [hj07] extend algorithm work fragment basis. kontkanen lain [kl05] present techniqu comput inter-object ambient occlusion. occlud- ing object, defin ambient occlus field sur- round space encod approxim oc- clusion caus object. inform defin shadow cast object real time. techniqu work particularli rigid transforma- tion objects, limit arbitrari deform mandatory. kontkanen aila [ka06] address special case charact animation, anim paramet control ao valu parametr surface. techniqu effici produc shadow leg arms, account neighbor geometry. shanmugam arikan [sa07] split comput ambient occlus parts: high-frequ part, evalu near object imag space approach, low frequenc part, approxim distant object spheric occluders. finally, screen-spac ambient occlus (ssao) [mit07, bs08] techniqu dynam ao avail realtim applic consid z-buffer geometr guess scene trace rai per-pixel basi evalu ao. techniqu repres state-of-the-art realtim ao, strong limitation: perform entir screen space, ignor object locat outsid field view object signific influenc ambient occlus resid visibl objects. result, c eurograph associ 2009. c.k.reinboth & t.boubekeur & m.alexa / hybrid ambient occlus figur 1: overview hao work flow. ambient occlus term given visibl point chang point view. 4. overview ambient occlus low frequenc effect as- sume imprecis shape shadow area visual insignificant. exploit properti simplifica- tions. first, exact geometri scene important: captur scene 3d proxi (a regular grid) per- form 3d rasterization, act geometr guess space occup fast rai intersection. second, occlus sampl (on gauss sphere) spars filter retain necessari visual smoothness: us small number rai pixel smooth re- sult fast approxim bilater filter (bl-filter) ao map. filter geometri awar benefit defer shade reus depth map comput prior appear maps, normal map, color map and, case, ao map. basically, render work flow entir support gpu summar follow (illustr figur 1): 1. gener 3d proxi raster region occup grid. 2. render color, normal, [...] z buffers. 3. gener ao map trace rays: sampl hemi- sphere pixel, 3d proxi comput in- tersections. 4. appli bl-filter ao map normal depth inform addit rang spaces. 5. combin color, normal, [...] hao valu out- screen buffer. note static region emb precomput ao maps, hao perform dynam ambi- ent occlus required, arbitrari spatial domain specifi simpl bound volum (which dy- namic, too). 5. 3d raster order creat voxel represent geometry, follow idea eisemann dcoret [ed06]: orthog- onal camera defin bound box (near/far plane) object bit set code color pixel (x,y) binari tabl indic presenc ge- ometri z direction. particular, divid bound box geometri slices; slice repres singl layer 3d texture, hold 32bit unsign integ valu pixel. voxel cell describ singl bit, stat- ing presenc geometri associ sub-volume. 8 output buffer simultaneously, lead max- imum 3d resolut rang 2563 10243 accord pixel format. grid creat singl pass render geom- etri locat insid bound box orthograph voxel camera. stage, unnecessari opera- tion (e.g. texturing, depth-test) disabled. newli ras- teriz fragment logic combin exist on framebuff or-oper (see figur 2). drawback case polygon align (up numer precision) view direc- tion voxel camera. rasterization, poly- gon framebuff footprint size zero store 3d texture. ideally, second voxel camera set raster volum scene local frame correct 3d textur informa- tion. however, addit voxel doubl larg hao cost (voxel sampling). actually, observ typic real-tim scenes, artifact occur geometri design axis- align (standard axis-align view 3d model pack- ages). rotat voxel camera ran- dom angl prior voxel process. practice, observ artifact simpl setup. figur 2: 3d raster stanford dragon differ resolutions. c eurograph associ 2009. c.k.reinboth & t.boubekeur & m.alexa / hybrid ambient occlus 3d nois textur p (p, r) (p, r) figur 3: sampl jitter valu 3d nois textur appli rai (p,r), rai shift new direct (p,r). figur 4: influenc rai spread angle. left right: 0.25, 0.5 0.75. 6. ambient occlus sampl ao map gener monte-carlo integr hemispher pixel evalu equat 2. a(p,n) = 1 n i{1,n} w(v (p,i),dmax)i,n (4) distribut rai {1,n} hemispher regular uniform sampl pattern, dynam jitter space-depend nois function (illustr figur 3). nois function encod small white nois 3d textur till entir space evalu accord posit normal pixel. object space natur jitter procedur avoid flicker camera moves. number sampl (rays) spread (i.e. open angl rai distributed, figur 4) user-defin paramet greatli influenc contrast, smooth frame rate. optimization, exploit fact, ao map filter later on, reduc number step ray. instead march 3d proxi test cell rai intersection, us fix typi- calli small number step test grid occup uni- formli ray. provid benefits: test perform (8 tests), second, need branch perform exactli number intersect test ray, better cur- rent gpu program model. obviously, simplifica- tion produc nois ao map rai pass- ing near corner non cell miss them. nev- ertheless, greatli speed ambient occlus sam- pling produc visual smooth result fil- tere performed. fill voxel cell found, (actual binary) result weight distanc angl pixel nor- mal trace ray. produc progress penumbra. figur 5 show influenc number rai visual quality, filtering. 7. bilater ao map filter ao sampl bottleneck entir process: depend resolut ao map num- ber rai emit pixel. optim strat- egy, gener low resolut ao map (typic time smaller actual screen resolution), us joint bilater upsampl approach inspir kopf et al. [kclu07] resampl hao map screen res- olut filter nois present initi sam- pling. approach base bilater filter background cours pari et al. [pktd08]. extend approach kopf et al. [kclu07] defin bilater kernel over: domain: mm window imag space, weight piecewis polynomi function; range: combin kernel distanc object space, angl normal ao values. note m control smooth effect filter spars sampl ao, defin rang figur 5: influenc number rays. left right: 16, 32, 64 128 rai pixel (top) (bottom) filtering. c eurograph associ 2009. c.k.reinboth & t.boubekeur & m.alexa / hybrid ambient occlus figur 6: influenc perform main parameters: voxel resolution, number rai pixel support size bl filtering. space accord object space entiti avoid ao bleed distant object project close imag space. formally, let x pixel final resolut buffer, defin ao as: hmm(x) = yqwd(x,y)wr(x,y)h(y/k) yqwd(x,y)wr(x,y) (5) q denot set pixel contain squar mm pixel center x, wd weight kernel screen space distances: wd(x,y) := w(||xy||,m) (6) wr weight kernel defin rang influence: wr(x,y) := wn(x,y) wp(x,y) wh(x,y) (7) wn(x,y):=w(1+ n(x),n(y),2) wp(x,y):=w(||p(x)p(y)||,dmax) wh(x,y):=w(||h(x/k)h(y/k)||,1) p(x) object space posit correspond x (extract z map), n(x) normal locat (extract normal map), h low resolut ao map gener- at previou step k scale ratio h h. separable, bilater filter ap- proxim pass [pv05], combin one- dimension filter (one horizont vertical), obtain visual convinc results: hmm(x) := h1m(hm1(x)) (8) improv frame rate significantly. note filter up-sampl step perform gpu. 8. implement result implement hao opengl nvidia cg lan- guage. measur run-tim perform desk- pc equip intel core2quad q6600 run paramet valu screen resolut 800600 hao map resolut 400300 rai sampl pixel 32 step rai 8 voxel grid resolut 2563 bl filter size 16 tabl 1: set test scene 2.4ghz, 4gb ram nvidia 9600gt window vista ultim x64. differ test scene (figur 7) examin differ part algorithm. japanes scene consist 21k triangl axi align boxes. stanford dragon 871k triangles. compar previou one, perform measur show hao map independ scene geometri complexity. note slightli bet- ter frame rate obtain fact region algorithm run defin bound- ing box model, cover pixel screen. cathedr standard test scene ao method contain 80k triangl geometr featur dif- ferent scales. additionally, captur frame toaster ani- mate scene (figur 8), demonstr dynam ao pro- duce method. frame rate measur report figur 6. basic paramet set specifi tabl 1. then, vari singl paramet test influenc frame rate. choos inspect influenc voxel resolution, number rai trace pixel size bilater filter support. c eurograph associ 2009. c.k.reinboth & t.boubekeur & m.alexa / hybrid ambient occlus figur 7: final rendering. top: phong shade alone. bottom: hao mapping. expected, observ number rai critic parameter. confirm choic spars sampl ambient occlus lower res- olut ao map, follow bilater upsampling. sur- prisingly, voxel cost negligible, what- desir grid resolut is. observ higher resolut grid significantli improv imag qualiti narrow rai distribut (small spread), sharper ao desired. last, figur 9, compar hao ssao. illus- trate advantag hybrid natur approach: object locat taken account, indepen- dentli screen-spac projection. 9. conclus hybrid ambient occlus improv screen space ambient occlus preserv influenc geome- try raster z-buffer contribut occlusions. consequence, shadow area consist preserv animation, object (un)occlud enter field view. achiev combin 3d rasterization, lo- cal rai trace imag space filtering. fact, algo- rithm hybrid means: combin raster figur 8: interact anim scene. left: phong shade alone. middle: dynam hao map. right: final rendering. rai trace object space imag space compu- tation. similar approach adopt address render techniqu dynam realtim environments, instanc color bleeding. generally, 3d ras- teriz offer simpl gener medium for- ward backward rendering: futur work focu c eurograph associ 2009. c.k.reinboth & t.boubekeur & m.alexa / hybrid ambient occlus (a) ssao (b) hao figur 9: comparison ssao hao. left: show weak ssao geometri hide potenti oc- cluder back. middl right: occlud outsid viewport influenc visibl geometri anymore. introduc level detail, 3d mipmaps, gener 3d proxi comput intersections. acknowledg like thank julien hadim romain pacanowski earli discuss work. dragon model courtesi stanford. toaster scene courtesi ingo wald. sibenik cathedr scene courtesi marko dabrovic. refer [bs08] bavoil l., sainz m.: screen-spac ambient occlusion. tech. rep., nvidia corporation, august 2008. [bun05] bunnel m.: gpu gem 2 - dynam ambient occlus indirect lighting. addison-wesley, 2005, ch. 14, pp. 223233. [chr03] christensen p. h.: global illumin that. proceed siggraph 2003 cours note nr. 9, renderman: theori practic (2003). [ed06] eisemann e., dcoret x.: fast scene vox- eliz applications. proceed acm sig- graph symposium interact 3d graphic game (2006), acm siggraph, pp. 7178. [hj07] hoberock j., jia y.: gpu gem 3 - high- qualiti ambient occlusion. addison-wesley, 2007, ch. 12, pp. 239274. [ka06] kontkanen j., aila t.: ambient occlus anim characters. render techniqu 2006 (eu- rograph symposium rendering) (jun 2006), wolf- gang heidrich t. a.-m., (ed.), eurographics. [kclu07] kopf j., cohen m. f., lischinski d., uyttendael m.: joint bilater upsampling. sig- graph 07: acm siggraph 2007 paper (new york, ny, usa, 2007), acm, p. 96. [kl05] kontkanen j., lain s.: ambient occlus fields. proceed acm siggraph 2005 sym- posium interact 3d graphic game (2005), acm press, pp. 4148. [mfs09] mndez-feliu a., sbert m.: obscu- ranc ambient occlusion: survey. vis. comput. 25, 2 (2009), 181196. [mfsc03] mndez-feliu a., sbert m., cat j.: real-tim obscur color bleeding. sccg 03: proceed 19th spring confer graphic (new york, ny, usa, 2003), acm, pp. 171 176. [mil94] miller g.: effici algorithm local global access shading. siggraph 94: proceed- ing 21st annual confer graphic interact techniqu (new york, ny, usa, 1994), acm, pp. 319326. [mit07] mittr m.: find gen: cryengin 2. siggraph 07: acm siggraph 2007 cours (new york, ny, usa, 2007), acm, pp. 97121. [pg04] pharr m., green s.: gpu gem - ambient occlusion. addison-wesley, 2004, ch. 17, pp. 279292. [pktd08] pari s., kornprobst p., tumblin j., durand f.: gentl introduct bilater filter- ing applications. siggraph 08: acm sig- graph 2008 class (new york, ny, usa, 2008), acm, pp. 150. [pv05] pham t. q., vliet l. j.: separ bilater fil- tere fast video preprocessing. ieee internat. conf. multimedia expo, cd1u4 (2005), ieee, pp. 14. [sa07] shanmugam p., arikan o.: hardwar accel- erat ambient occlus techniqu gpus. i3d 07: proceed 2007 symposium interact 3d graphic game (new york, ny, usa, 2007), acm, pp. 7380. [wen95] wendland h.: piecewis polynomial, posit definit compactli support radial function min- imal degree. adv. comput. math. 4, 4 (1995), 389396. [zik98] zhukov s., ion a., kronin g.: am- bient light illumin model. render techniqu (1998), pp. 4556. c eurograph associ 2009.