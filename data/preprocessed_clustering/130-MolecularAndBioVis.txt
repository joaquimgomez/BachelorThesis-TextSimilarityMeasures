faradai discuss www.rsc.org/faraday_d manuscript present discuss forthcom faradai discuss meeting. deleg contribut discuss includ final volume. regist attend! detail upcom meetings: accept manuscript, royal societi chemistri peer review process accept publication. accept manuscript publish onlin shortli acceptance, technic editing, format proof reading. free service, author result avail community, citabl form, publish edit article. replac accept manuscript edit format advanc articl soon available. inform accept manuscript inform authors. note technic edit introduc minor chang text and/or graphics, alter content. journal standard term & condit ethic guidelin apply. event shall royal societi chemistri held respons error omiss accept manuscript consequ aris us inform contains. accept manuscript gpu-acceler analysi visual larg structur solv molecular dynam flexibl fit john e. stone,a ryan mcgreevy,a barri isralewitz,a klau schultenb receiv xth xxxxxxxxxx 20xx, accept xth xxxxxxxxx 20xx publish web xth xxxxxxxxxx 200x doi: 10.1039/c000000x hybrid structur fit method combin data cryo-electron microscopi x-rai crystallographi molecular dynam simul determi- nation all-atom structur larg biomolecular complexes. evalu quality-of-fit obtain hybrid fit computation demanding, partic- ularli context multipl structur conform evaluated. exist tool quality-of-fit analysi visual previ- ousli target small structur slow interact larg biomolecular complex particular todai virus long molecular dynam trajectori aris protein folding. present new data-parallel gpu-acceler algorithm rapid interact comput quality-of-fit metric link all-atom structur molecular dynam tra- jectori experimentally-determin densiti map obtain cryo-electron microscopi x-rai crystallography. evalu perform accuraci new quality-of-fit analysi algorithm vis-a-vi exist tools, examin al- gorithm perform gpu-acceler desktop workstat supercom- puters, new visual techniqu result hybrid structur fit methods. 1 introduct molecular dynam simul provid research comput mi- croscope, power tool provid dynam view cellular process atom nanosecond tempor resolut achiev experiment method alone. petascal supercomput extend reach comput microscop larg biomolecular system particular public health, e.g., case virus hiv1. molecular dynam simul depend avail all-atom molec- ular structures, extrem difficult obtain all-atom atom struc- ture larg biomolecular complex tradit approaches. beckman institute, univers illinois, 405 n. mathew ave, urbana, il, usa. b depart physics, univers illinois, 1110 w. green, urbana, il, usa. 120 | 1 page 1 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t wide method acquir structur biomolecul x-rai crystallog- raphy. however, crystal larg biomolecul macromolecular com- plex challenging. instead, cryo-electron microscopi single-particl re- construct central techniqu structur determin larg biolog complexes. cryo-em requir difficult crystal step allow structur imag solution, close reproduc phys- iolog conditions. cryo-em yield sub-nanomet resolut data, approach atom resolution29, crystallograph structur gen- eral interpret cryo-em data. approach requir com- bine data differ imag modal techniqu known hybrid fit methods. hybrid fit method combin x-rai crystallographi structur cryo-em densiti structur determin develop recent years. method us rigid-frag fitting10,11, oth- er rosetta12, direx13, gorgon5, froda14 perform flexibl fit allow conform chang better shape structur density. approach includ us low-frequ normal modes15, deform elast networks13, cross correlation16 least-squar differ experiment simul maps17 drive structur cryo-em den- sity. fit method us mont carlo-bas approach18, us molecular dynamics19. method, molecular dynam flexibl fitting19,20 (mdff), match crystal structur cryo-em densiti potenti energi function md simulation. addit modif potenti energi function defin 3-d grid incorpor md simul gridforc featur namd21,22. forc comput ad potenti ap- pli atom depend posit grid interpol scheme. comput forc push atom area higher densiti em map. restraint impos simul help preserv secondari structure, stereochem correctness23, symmetry24 pro- teins. mdff proven successful, evidenc applic solv structur model ribosome2533, photosynthet proteins34,35, all-atom structur hiv capsid1. import step hybrid fit method evalu quality- of-fit final structur cryo-em density. common scor- ing method cross correl coeffici experiment densiti map simul densiti map. score function exist, laplacian-filt cross correl envelop score determin densiti fill atoms, us differ approxim result vari level accuracy36. approxim us en- abl fast comput necessari interact visual analysi fittings, particularli larg structur (> 1 million atoms) long time-scal (microsecond range) simulations. score functions, includ cross cor- relation, requir calcul simul synthet densiti map atom structur compar experiment map. tradit wai accomplish emploi techniqu creat x-rai crys- tallographi repres densiti contribut atom spheric gaussian function37,38. below, new data-parallel cpu gpu algorithm rapid 2 | 120 page 2 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t comput simul densiti maps, densiti differ maps, cross correla- tion, spatial local cross correl maps. new algorithm serv analyt visual us achiev perform level enabl effect us large-s biomolecular complex viruses, detail analysi fit result case long mdff trajectories. illustr us new analysi featur visual scenario context new mdff quality-of-fit analysi featur run desktop workstat supercomputers. 2 relat work origin sequenti cpu implement densiti simul mdff base method describ earlier39, involv interpol atom weight grid convolv grid gaussian filter standard deviat assum half target resolution. problem im- plement spread atom occur interpol weight grid account appli gaussian filter. situs40 program pdb2vol41 take similar approach creat synthet den- sities, correct lattic smooth subtract lattic project mean-squar deviat gaussian kernel variance. situ allow user select kernel type gaussian, triangular hard sphere. situs-gener densiti map creat comparison report paper, gaussian kernel lattic smooth correct mass-weight atom (situ version 2.7.1 obtain chimera42 produc synthet densiti map molmap command de- scribe atom 3-d gaussian distribut width proport map resolut amplitud proport atom number; command base pdb2mrc program eman package43. chimera calcu- lation report paper emploi measur correl command default parameters, abovethreshold set false. result corre- lation mean valu point comparison (chimera version 1.8.1 obtain method similar us spheric gaussian function repres densiti contribut atom, techniqu creat x- rai crystallography37,38. shortcom approach incorpor blur requir account attenu high resolut signal17. approxim effect truncat deriv x-rai crystallography37, em applications. method overcom limit creat map simul densiti atom calcul resolution-limit fourier transform atom scatter factor44. approach taken direx13 us ad hoc blur method account instrument signal attenu high resolution. program, rsref, implement similar method reli ad hoc assumptions17. compar densiti produc new gpu-bas algorithm chimera gener direx ribos bind protein (1urp). cross correl 3 8 map .938 .966, respec- tively, method, .900 .965 chimera. correl valu 120 | 3 page 3 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t rhdv 1urp 1urp resolut (a) 6.5 8 3 vmd-gpu-cuda cc 0.998 0.999 0.989 vmd-cpu-ss cc 0.996 0.997 0.991 chimera cc 0.784 0.989 0.922 vmd-cpu-seq cc 0.997 0.999 0.950 tabl 1 comparison cross correl result new gpu cpu algorithm vmd, chimera, origin sequenti vmd algorithm, densiti simul situ 40 program pdb2vol41. test agreement densiti gener algorithm account discrep comparison subsequ cross correl experiment data. are, expected, lower correl valu densiti creat situ (ta- ble 1), vmd chimera valu 5% other. differ import fit method which, similar rsref, directli minim least-squar differ simul experiment densiti maps. conversely, mdff deriv forc experi- mental map and, thus, us cross-correl subsequ anal- syi steps. accur densiti synthesi method util fourier transform requir comput gaussian approximations. futur work experi hybrid approach borrow aspect method improv accuraci sacrif speed computation. goal method describ fast comput suit visual analysis, us amen approximation. 3 hybrid fit process hybrid methods, initi structur dock em densiti fit proceed. process gener expe- dient wai rigidli dock entir structure, independ rigid pieces, densiti correctli orient map. achiev mdff, rigid-bodi dock perform situs40 pro- gram colores45. structur dock density, us stage calcul quality-of-fit. particular, independ local correl domain secondari structur us order visual- iz area structur initi poorli fit map. quickli identifi area greatest concern subsequ fit sim- ulation. step fit process determin finer-grain movement larg scale deform requir improv fit refer map. mdff, point molecular dynam simul flexibl guid structur density. vmd46 plugin mdff gener potenti energi function uem defin 4 | 120 page 4 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t 3-d grid deriv cryo-em densiti map uem(r) = j w jvem(r j), (1) vem(r) = { [ 1 (r)thrmaxthr ] (r) thr, (r) < thr. (2) (r) coulomb potential; maximum valu max obtain cryo-em. eq. 2 threshold thr clamp (r) valu lower thr, effect remov solvent contribut map creat flat potenti regions. threshold thr chosen valu histogram em densiti contain larg peak correspond solvent. scale factor uniformli adjust strength influenc cryo-em map molecular system. addi- tion, vem(r) weight w j atom j present posit r j. generally, w j set atom mass follow roughli linear correspond mass atom densiti cryo-em map. forc comput potenti defin eq.1 push structur re- gion high density. push divid multi-stag process where, stages, part atom structur complet de-coupl potential, magnitud forc vari chang scal- ing factor weight w j. case ribosome2533, protein rna fit separ constrained. multi-stag scheme, benefici calcul quality-of-fit step seper compon molecular complex, enabl identif prob- lemat regions. systems, entir structur fit, singl correl valu entir protein published, give coars overal evalu model. valu comparison differ method studies, accurate, reproducible, compar quantiti used. however, us calcul correl finer decom- posit (fig.1), exampl per-residue. analysi resolv part structur fit part requir addit fit investigation. additionally, benefici determin local correl change, hopefulli improve, cours fitting. vi- sualiz fine-grain quality-of-fit entir simul provid research insight progress fit process dy- namic structure. comput simul densiti differ region subsequ correl step fit extrem demand computationally, especi larg structur long fit simulations. practic applic requir effici algorithm per- mit fast analysi turnaround. vmd timelin trajectori analysi plugin47 make us new data- parallel cpu gpu quality-of-fit algorithm provid interact visu- aliz entir fit process. timelin design help identifi assess trajectori event perform analysi calcul compo- nent molecular system, frame simul trajectory. 120 | 5 page 5 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t fig. 1 per-secondary-structure-compon local cross correl adenyl kinase. mdff run initi conform adenyl kinas (pdb 1ake) order fit simul densiti 5 resolut conform (pdb 4ake). panel (a) (b) point simul structur complet fit, color per-secondary-structure-compon local cross correlation. darker blue indic area best fit, red indic poorli fit regions. target densiti drawn transpar grai isosurfac complementari wirefram representation. panel (a) show helix partli density; helix color green indic mediocr cross correl indic rel close, perfect, fit density. panel (b) show beta sheet complet outsid refer density; beta sheet color red indic poor cross correlation. (c) vmd timelin analysi cross correl entir simulation. note region poor fit (red) turn green blue fit improv cours simulation. heatmap-styl 2-d matrix timelin plot provid whole-trajectori whole-structur view calcul property. figur 1c show exam- ple plot: time dimens displai horizontally, structure-compon dimens displai vertically, properti here, densiti map cross correl score present color rectangles. time- line plot connect interact vmd 3-d structur display. user scrub mous cursor featur plot, timelin high- light associ 3-d molecular structur displai configur motion time correspond events. research iden- tifi structur transitions, trends, sequenc trajectori quickli singl zoomable, interact 2-d timelin plot examin complex 3-d structur trajectori frames. calcul densiti map cross correlations, differ type trajectori inform obtain divid analysi compon differ sizes: fine divis individu residu contigu secondari structur (a figur 1c) allow detail structur assessment, coarser divis fraction pro- tein segment entir protein segment provid inform larger structur elements, particularli larger systems. 6 | 120 page 6 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t quality-of-fit analysi perform fast interact updat pace run simulation, correl visual user real time. real-tim analysi enabl user, in- teract molecular dynam (imd)48, monitor fit progress manual manipul part structure. user structur at- tempt improv correl provid immedi feedback result effects, trajectori local trend context provid updat- ing timelin view. techniqu fit difficult structur easier process provid detail analysi step. addition- ally, method help fit small region normal long time fit, structur long converged. interact mdff perform past studi ribosome29, real- time quality-of-fit analysi provid better fit easier simulations. 4 method evalu qualiti fit mdff, simul densiti compar experiment map pear- son correl coefficient, given se = (ss)(ee) se , (3) s e averag voxel valu simul experiment densiti maps, respectively, s e standard deviations49. result normal (se [1,1]) indic quality-of-fit given structur experiment density. cross correl defin eq. 3 tradition global measur includ voxel densiti maps, local correlation11 volum surround molecul considered. global correl affect size volum includ contribut molecule, solvent. global correl report artifici high correl valu consid larg volum arbitrarili padded. accordingly, local correl tend offer us unbias characteristic. mdff, local correl calcul specifi threshold state unit standard deviat mean valu simul density. voxel contain densiti valu lower threshold exclud cross correl calculation. higher densiti valu natur occur closer structure, densiti calcul contain molecular envelope. impedi creation fast algorithm comput cross correl need knowledg mean valu map covari standard deviations. simpl two-pass algorithm iter map comput mean, follow second itera- tion comput covari standard deviation. speed efficiency, single-pass algorithm desirable, it- erat densiti required. single-pass version standard deviat calculation, equat rewritten 2s = 1 n n i=1 (xi x)2 = 1 n n i=1 (x2i 2xxi + x 2) = 1 n n i=1 x2i 2x n n i=1 xi + nx2 n (4) 120 | 7 page 7 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t = ( 1 n n i=1 x2i )2x 2 + x2 2s = ( 1 n n i=1 x2i ) x 2. (5) express permit comput sum sum squar voxel map singl pass, standard deviat calcul afterwards. techniqu extend similarli creat single-pass for- mulat covariance. unfortunately, single-pass equat imple- ment float point arithmetic, suscept float point trunca- tion cancel error, affect accuraci results. float point error minim shift mean refer simul map zero, ensur simul densiti map close approxi- mate standard deviat refer map, reduc magnitud accumul squar quantities. improv float point pre- cision achiev perform summat hierarch fashion, double-precis arithmetic, us precis enhanc techniqu kahan compens summation, native-pair arithmetic, others5052. tests, confirm presenc float error, implement amelior techniqu describ above, conclud error neglig effect final correl result test case run date. believ direct re- sult well-condit input scenario limit dynam rang densiti valu contain experiment simul densiti maps. 5 data-parallel cross-correl algorithm devis high-perform data-parallel algorithm comput sim- ulat densiti maps, compar refer densiti map multi-cor cpu vector instruct massiv parallel gpus. method devis evalu quality-of-fit all- atom structur refer experiment densiti map requir computa- tion simul densiti map all-atom structure. computed, simul densiti map compar experiment refer map voxel-by-voxel subtraction, pearson correlation, sum absolut differ- ences, similar methods. method evalu far, gener simul densiti map far computation demand algorithm step. simul densiti valu given point space comput independ valu points, sim- ulat densiti map comput well-suit data-parallel implement cpu vector instruct intel x86 sse avx instructions, arm neon instructions. similarly, comput advantag gpu-acceler algorithm emploi ten thousand thread run thousand arithmet units. simul densiti map com- puted, compar experiment refer map varieti methods. 8 | 120 page 8 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t nih btrc macromolecular model bioinformat beckman institute, u. illinoi urbana-champaign pad optim global memori performance, guarante coalesc global memori access grid thread block small 8x8x2 cuda thread block afford larg per-thread regist count, share memori 3-d densiti map decompos 3-d grid 8x8x8 tile contain cc partial sum local cc valu 0,0 0,1 1,1 inact threads, region discard output thread comput 4 z-axi densiti map lattic point associ cc partial sum thread produc result used1,0 spatial cc map overal cc valu comput singl pass single-pass cross-correl parallel decomposit fig. 2 parallel decomposit single-pass gpu-acceler cross correl algorithm. simul densiti map decompos 888 tile process individu cuda thread blocks. thread block 882 thread size. thread comput 4 consecut densiti z-axis, enabl reus atom data on-chip regist increas arithmet throughput. cuda thread block perform threshold comput partial sum overal cross correlation, local cross correl valu 888 tile. kei differ differ densiti map comparison techniqu li respect memori capac requir and, case gpu im- plementations, host-gpu memori transfer characterist algorithm. straightforward task implement quality-of-fit algorithm multi- pass approach comput densities, means, covari distinct steps, approach lose perform rel implement combin step single-pass algorithm. combin algorithm step single-pass approach, intermedi valu store fast on-chip registers, share memory, caches, typic order magnitud faster access off-chip dram. possible, emploi single-pass cross correl algorithms, simul densiti valu comput ephemer cpu gpu on-chip regist store comput densiti valu off-chip dram memory. approach avoid perform limit aris roughli factor 40 perform gap peak gpu arithmet throughput (e.g., 2-4.5 tflops) gpu dram mem- ori bandwidth (e.g., 200-300 gb/sec). previous develop fast algorithm calcul visualiz- ing molecular orbit present quantum chemistri calculations53, dis- plai molecular surfaces, biomolecular complexes, cellular structures5456. algorithm requir rapid evalu gaussian radial basi func- tions, necessari comput simul densiti map comput cross correlations. present work, simul densiti map 120 | 9 page 9 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t comput linear combin gaussian radial basi functions, per-atom weight factor base atom radii. simul densiti map comput single-pass, single-coeffici atom weight factors, multipl pass creat tempor averag densiti maps, sup- port us sophist scheme us radial basi function multipl gaussian term basi functions. refer densiti test exclusion, simul densiti compar option user- defin threshold criterium determin contribut cross correlation. refer voxel assign ieee float point special valu nan (not-a-number), exclud consideration. similarly, simul den- siti valu fall option user-defin densiti threshold exclud contribut cross correlation. voxel refer simul densiti pass exclus threshold test contribut partial sum overal cross correlation. densiti processed, parallel reduct perform comput final cross correl partial sum previous computed. new single-pass cross correl algorithm gpu base nvidia cuda program toolkit57, refer vmd- gpu-cuda. gpu cross correl algorithm us parallel decomposi- tion outlin fig. 2. densiti contribut neighbor atom cutoff distanc sum thread-loc registers. cutoff distanc chosen densiti contribut suffici near zero discarded, ensur algorithm achiev linear time complexity. thread produc densiti valu loop consecut densiti z- axis. thread comput local contribut per-til cross cor- relat partial sums, densiti accord voxel exclus threshold criteria describ above. cuda thread block perform local intra-block parallel reduct threads, sum thread- local partial sum singl set cross-correl partial sum associ block 888 tile. intra-block parallel reduct com- plete, thread thread block comput tile-loc cross correlation, store tile-loc cross correl per-til cross corre- lation partial sum gpu global memory, prepar final inter-block global parallel reduct yield overal cross correl result. im- portant performance-crit implement emploi special counter atom memori updat instruct allow singl gpu kernel invoc perform entir cross correl calculation. thread block increment global counter atomic-add machin instruct complet tile-loc work. thread block complet simpli exit finish tile-loc work. thread block complet tile-loc work perform final inter-block parallel reduct partial sum store overal cross correl result gpu global memory. new cross-correl algorithm multi-cor cpu emploi cpu vec- tor instruct multithreading. new cpu algorithm refer vmd-cpu-sse. cpu algorithm decompos densiti map pla- nar slice dynam assign fix pool cpu worker thread dynam load balanc built vmd47. cpu worker thread run loop accumul densiti atom region surround 10 | 120 page 10 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t fig. 3 test system fit experiment density, case 1urp, synthet one. (a) groel pdb 3e76; (b) aquaporin-0 pdb 3m9i; (c) groel-gro complex atp-bound state (pdb 2c7d); (d) mm-cpn close state (pdb 3los); (e) d-ribose-bind protein pdb 1urp; (f) lidless mm-cpn open state; pdb 3lo templat construct homolog model model 58; (g) rabbit hemorrhag diseas viru capsid (rhdv) (pdb 3j1p). atom defin cutoff limit gaussian assum decai zero. mainstream multi-cor cpu lack dedic machin instruc- tion calcul exponentials; result, applic softwar us gener purpos math librari routin incorpor custom function purpose. sign exponenti function input domain al- wai neg densiti map synthesi algorithm developed, us high-perform taylor seri approxim exponenti function. special negative-domain exponenti approxim hand-written assembl languag intrins intel x86 sse 4-wai vector instructions, base similar function origin develop molecular orbit display53. improv perform new exponenti approxim be- yond previous achiev premultipli input valu con- stant convert base-e, elimin condit test check input domain case occur densiti map algorithm, guaran- tee multiple-of-four data alignment. end result optim multi-cor cpu densiti map algorithm competit per- formanc obtain gpus, machin instruct comput exponenti heavi us graphic light algorithms. 120 | 11 page 11 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t rhdv mm-cpn open groel groel- groe mm-cpn close aquaporin resolut (a) 6.5 8 4 7.7 4.3 3 # atom 702k 61k 54k 59k 64k 1.6k # voxel 111m 14m 8m 7m 7m 2.6m vmd-gpu-cuda cc 0.744 0.857 0.769 0.886 0.658 0.754 vmd-cpu-ss cc 0.736 0.866 0.839 0.892 0.712 0.771 chimera cc 0.687 0.837 0.727 0.867 0.635 0.739 vmd-cpu-seq cc 0.743 0.869 0.846 0.898 0.728 0.653 vmd-gpu-cuda 0.458 s 34.6 0.06 s 25.7 0.034 s 36.8 0.038 s 35.0 0.028 s 57.5 0.007 s 55.7 vmd-cpu-ss 0.779 s 20.3 0.085 s 18.1 0.159 s 7.9 0.077 s 17.3 0.179 s 9.0 0.033 s 11.8 chimera 15.86 s 1.0 1.54 s 1.0 1.25 s 1.0 1.33 s 1.0 1.61 s 1.0 0.39 s 1.0 vmd-cpu-seq 62.89 s 0.25 2.9 s 0.53 1.57 s 0.79 2.49 s 0.53 2.13 s 0.75 0.04 s 9.7 tabl 2 comparison cross correl algorithm results, runtimes, speedup new gpu cpu algorithm vmd, chimera, origin sequenti vmd algorithm. speedup normal chimera runtim baseline. 6 test case perform result order test new data-parallel gpu cpu cross correl algorithms, test case chosen structur vari size densiti map resolut 3 8 (fig. 3, tabl 1, tabl 2). struc- ture final result mdff simul correspond experimen- tal cryo-em maps, remain structur simul den- siti map situs40 program pdb2vol41. largest structur rabbit hemorrhag diseas viru (rhdv) capsid solv 6.5 resolut densiti map59. structur aquaporin, groel, groel-gro complex atp- bound state, mm-cpn close state, lidless mm-cpn open state, taken result cryo-em model challenge60. final struc- ture, ribos bind protein (pdb: 1urp) simul densiti map 3 8 situs, mean compar densiti map gener program (tabl 1). size viru capsid difficult-to-fit na- ture model challeng structur pose problem research hybrid fit methods. data-parallel gpu multi-cor cpu cross corre- lation method compar previou sequenti algorithm vmd, chimera42, program wide cryo-em researchers. new vmd cross correl algorithm provid signific speedup old sequenti cpu code vmd chimera. al- gorithm provid correl result agre chimera 5% cases. case greatest diverg (7.92% dif- 12 | 120 page 12 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t ference), viru capsid, method result .998 cross correl simul map produc situs, chimera report correl .7842 (tabl 1). discrep simul data, believ correl result larg capsid report chimera flawed, necessarili directli compar specif case. point possibl error differ vmd chimera handl pdb file 99,999 atoms. origin pdb specif allow us 5 column atom index, restrict maximum offici support number atom 99,999. overcom limitation, vmd us alpha-numer atom indic 99,999 write pdb file, chimera us addit columns. vmd read larg structur pdb file written chimera format vice versa, chimera format pdb case (includ rhdv) required, vmd chimera calculations. chimera format pdb file creat writ- ing structur coordin multipl pdb file 99,999 atom less. pdb file read chimera, follow copy/combin featur combin pdb singl structur save singl pdb file. addit overlook complic differ pdb file format caus discrep correl valu obtain rhdv. new featur calcul spatial cross correl map provid rapid mean visual 3-d correl resolv area poor fit, seen fig. 4. spatial correl map especi us larg com- plexes, exampl viru capsids, singl densiti calcul requir obtain local information. volumeslic representa- tion vmd view 3-d textur slice plane correl map x, y, z axis, map quickli scan region low correlation. structur compon locat region poor correl identifi select color base local cross correl valu (fig. 5). single-nod workstat class test run workstat contain- ing intel xeon e5-2687w processor consist 8 physic proces- sor core 16 hardwar threads, total 32 thread execut hardware. workstat configur 256 gb memory, nvidia quadro k6000 gpu 12 gb on-board memory. softwar run cento linux version 5.9, nvidia driver version 331.22. vmd compil intel c/c++ version 12.0.2, cuda toolkit version 4.0. test involv situ situ version 2.7.1, obtain situ web site. chimera test version 1.8.1 obtain chimera web site. acceler cross correl method make feasibl detail global trajectori assess larg molecular systems. figur 6 show ex- ampl diagnost insight provid timelin view initi mdff simul rhdv capsid: 100 frame sampl initi 10,000- step energi minim mdff forc active, follow 400 frame sam- pled initi 40 ps mdff dynam trajectory. structur divid 180 components: 180 protein segments, ident residu sequence, symmetr viru capsid. figur 6a, pronounc pattern horizont stripe indic period segment-to-seg variat cross correl values, follow differ capsid sym- 120 | 13 page 13 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t fig. 4 planar volumeslic represent spatial cross correl map (a) (b) frame mdff simul rabbit hemorrhhag diseas viru capsid. map visual local cross correl 888 voxel regions, red indic poorest correl dark blue indic best correlation. region poorest correl lie exterior interior face capsid, expected. poor-fit region subunit structur seen red spot mark arrows. panel (c) (d) closer view poor-fit regions, fitting, respectively. structur shown insid experiment densiti map color accord correspond spatial cross correl volum region, visual part structur poor fit. panel (c) clearli show poorli fit region, part structur entir outsid density; poor fit fix mdff evid (d). 14 | 120 page 14 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t fig. 5 subunit rabbit hemorrhhag diseas viru capsid (a) (b) mdff. structur color accord spatial cross correl volum region. vdw represent show structur select atom lie insid voxel spatial cross correl volum valu < 0.1. metric segment arrangement, seen figur 6b. figur 6c show rel chang observ individu capsid segment trajectory: trajectori valu normal subtract initi cross correl valu segment. half cross-correl chang seen figur 6c occur initi minim frame 100, remain improv occur quickli picosecond mdff simu- lation, frame 100 125, minor fluctuat ceas major segment frame 350. segment seen rel sta- ble correl valu mdff minim mdff dynamics; research studi investig segment further. detail analysi larg system long trajectori requir larg number individu calculations, impos heavi i/o burden system. implement parallel timelin cross correl anal- ysi new gpu cross correl algorithm, us cluster su- percomputers. new timelin analysi call vmd parallel script prim- itives47 perform need calculation, synchronization, data reduct operations. 10,000 frame trajectori 1.38 million atom rhdv capsid structur examined. cross correl analysis, capsid divid 720 structur components; capsid 180 525-residu segment divid nearly-equ contigu segments. calcul run nsf blue water petascal supercomputer, xk7 hybdrid gpu-acceler comput nodes. xk7 node contain amd opteron 6276 cpu 32 gb ram nvidia tesla k20x gpu acceler 120 | 15 page 15 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t (a) (b) 0.237 0.3644 (c) -0.0032 0.02 fig. 6 cross correl coeffici rabbit hemmorrhag diseas viru (rhdv) mdff trajectory. panel (a) contain timelin plot 500-frame rhdv trajectori discuss text, displai per-seg cross correl coefficients. panel (b) show rhdv structur color valu frame (left-most column) panel (a). panel (c) contain timelin plot trajectori panel (a), displai chang initi valu per-seg cross correlation, namely, per-seg valu panel (a) subtract valu segment frame. bar graph plot show (in black coral bar height) proport segment timestep chang cross correl greater +0.01. 16 | 120 page 16 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t 6 gb ram. structur trajectori file stripe 160 lustr file object storag target ensur best i/o performance47. analy- si complet averag 19.5 minut 2,048 nodes, show 1,035 speedup project 336 hour (14.0 day) runtim singl node. us- ing tabl 2 perform results, roughli correspond 35,800 speedup estim 485 dai (1.3 year) runtim chimera run singl node 142,100 speedup estim 1,924 dai (5.3 year) run- time origin sequenti vmd cpu algorithm run singl node. 7 conclus present data-parallel cross correl algorithm combin den- siti map synthesis, comput spatial cross correl maps, overal cross correl synthet refer densiti maps, high perform single-pass approach multi-cor cpu sse vector instruc- tions, massiv parallel gpu cuda. new algorithm achiev signific speedup compar exist method maintain adequ numer precision. single-pass algorithm achiev high perform fuse independ algorithm step singl comput kernel, maxim ratio arithmet oper vs. memori references, greatest overal benefit massiv parallel gpu hardware. demon- strate us new algorithm visual analysi context rang problem sizes, incorpor high perform cross correl method timelin multi-nod parallel analysi script en- abl larg system long trajectori analyz rapidli cluster supercomputers. expect algorithm development, perform new cross correl algorithm improv further. simul densiti map algorithm present oper uniform grid encompass bound volum atom selection. us uniform grid decomposi- tion densiti map calcul result unnecessari comput region volum associ select atoms, particip parallel reduct oper yield final correl results. us uniform grid approach provid high perfor- manc common cases, clear cryo-em imag techniqu improv resolut size resolv biomolecular complex in- crease, need densiti map algorithm perform atom select yield spars region computation. sev- eral opportun perform improv case trajectori analyses, perform timeline, elimin host-gpu memori copi associ refer map timestep, elimin comput common multipl atom select analys comput cross correl larg number atom select trajectori frame47. new data-parallel shuffl instruct avail recent nvidia gpu acceler intra-block inter-block parallel reduct place gpu algorithm. recent intel amd processor ad new 8-element avx avx2 vector instructions, offer 2 120 | 17 page 17 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t perform gain sse instructions. greatli increas perform lev- el achiev new algorithm creat new opportun interact analys visual interact molecular dynam simulations48 mdff method. acknowledg research blue water sustained-petascal comput project support nsf award oci 07-25070, comput microscop nsf prac award. blue water joint effort univers illinoi urbana-champaign nation center supercomput applic (ncsa). author thank yanxin liu provid simul trajectories. author wish acknowledg support cuda center excel univers illinoi nih fund grant 9p41gm104601 5r01gm098243-02. refer 1 g. zhao, j. r. perilla, e. l. yufenyuy, x. meng, b. chen, j. ning, j. ahn, a. m. gronenborn, k. schulten, c. aiken p. zhang, nature, 2013, 497, 643646. 2 j. zhang, m. l. baker, g. f. schroder, n. r. douglas, s. reissmann, j. jakana, m. dougherty, c. j. fu, m. levitt, s. j. ludtke, j. frydman w. chiu, nature, 2010, 463, 379383. 3 s. j. ludtke, m. l. baker, d.-h. chen, j.-l. song, d. t. chuang w. chiu, structure, 2008, 16, 441448. 4 x. zhang, e. settembre, c. xu, p. r. dormitzer, r. bellamy, s. c. harrison n. grigorieff, proc. natl. acad. sci. usa, 2008, 105, 18671872. 5 m. l. baker, j. zhang, s. j. ludtk w. chiu, nat. protoc., 2010, 5, 16971708. 6 c. f. hryc, d.-h. chen w. chiu, curr. opin. virol., 2011, 1, 110117. 7 r. zhang, c. f. hryc, y. cong, x. liu, j. jakana, r. gorchakov, m. l. baker, s. c. weaver w. chiu, embo j., 2011, 30, 38543863. 8 s. maki-yonekura, k. yonekura k. namba, nat. struct. mol. biol., 2010, 17, 417422. 9 l. cheng, j. zhu, w. h. hui, z. zhang, b. honig, q. fang z.-h. zhou, j. mol. biol., 2010, 397, 852863. 10 f. fabiola m. s. chapman, structure, 2005, 13, 389400. 11 a. m. roseman, acta cryst. d, 2000, 56, 13321340. 12 r. da d. baker, annu. rev. biochem., 2008, 77, 363382. 13 g. f. schroder, a. t. brunger m. levitt, structure, 2007, 15, 16301641. 14 c. c. jolley, s. a. wells, p. fromm m. f. thorpe, biophys. j., 2008, 94, 16131621. 15 f. tama, o. miyashita c. l. brook iii, j. struct. biol., 2004, 147, 315326. 16 m. orzechowski f. tama, biophys. j., 2008, 95, 56925705. 17 m. s. chapman, a. trzynka b. k. chapman, j. struct. biol., 2013, 182, 1021. 18 m. topf, k. lasker, b. webb, h. wolfson, w. chiu a. sali, structure, 2008, 16, 295307. 19 l. g. trabuco, e. villa, k. mitra, j. frank k. schulten, structure, 2008, 16, 673683. 20 l. g. trabuco, e. villa, e. schreiner, c. b. harrison k. schulten, methods, 2009, 49, 174 180. 21 j. c. phillips, r. braun, w. wang, j. gumbart, e. tajkhorshid, e. villa, c. chipot, r. d. skeel, l. kale k. schulten, j. comp. chem., 2005, 26, 17811802. 22 d. wells, v. abramkina a. aksimentiev, j. chem. phys., 2007, 127, 12510112510110. 23 e. schreiner, l. g. trabuco, p. l. freddolino k. schulten, bmc bioinform, 2011, 12, 190. 24 k.-y. chan, j. gumbart, r. mcgreevy, j. m. watermeyer, b. t. sewel k. schulten, structure, 2011, 19, 12111218. 25 e. villa, j. sengupta, l. g. trabuco, j. lebarron, w. t. baxter, t. r. shaikh, r. a. grassucci, 18 | 120 page 18 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t p. nissen, m. ehrenberg, k. schulten j. frank, proc. natl. acad. sci. usa, 2009, 106, 1063 1068. 26 j. gumbart, l. g. trabuco, e. schreiner, e. villa k. schulten, structure, 2009, 17, 1453 1464. 27 t. becker, s. bhushan, a. jarasch, j.-p. armache, s. funes, f. jossinet, j. gumbart, t. mielke, o. berninghausen, k. schulten, e. westhof, r. gilmore, e. c. mandon r. beckmann, sci- ence, 2009, 326, 13691373. 28 b. seidelt, c. a. innis, d. n. wilson, m. gartmann, j.-p. armache, e. villa, l. g. trabuco, t. becker, t. mielke, k. schulten, t. a. steitz r. beckmann, science, 2009, 326, 1412 1415. 29 l. g. trabuco, e. schreiner, j. eargle, p. cornish, t. ha, z. luthey-schulten k. schulten, j. mol. biol., 2010, 402, 741760. 30 j. gumbart, e. schreiner, l. g. trabuco, k.-y. chan k. schulten, molecular machin biology, cambridg univers press, 2011, ch. 8, pp. 142157. 31 j. frauenfeld, j. gumbart, e. o. van der sluis, s. funes, m. gartmann, b. beatrix, t. mielke, o. berninghausen, t. becker, k. schulten r. beckmann, nat. struct. mol. biol., 2011, 18, 614621. 32 x. agirrezabala, e. schreiner, l. g. trabuco, j. lei, r. f. ortiz-meoz, k. schulten, r. green j. frank, embo j., 2011, 30, 14971507. 33 w. li, l. g. trabuco, k. schulten j. frank, proteins: struct., func., bioinf., 2011, 79, 1478 1486. 34 j. hsin, j. gumbart, l. g. trabuco, e. villa, p. qian, c. n. hunter k. schulten, biophys. j., 2009, 97, 321329. 35 m. k. sener, j. hsin, l. g. trabuco, e. villa, p. qian, c. n. hunter k. schulten, chem. phys., 2009, 357, 188197. 36 d. vasishtan m. topf, j. struct. biol., 2011, 174, 333343. 37 r. diamond, acta cryst. a, 1971, 27, 436452. 38 t. a. jone l. liljas, acta cryst. a, 1984, 40, 5057. 39 p. l. stewart, s. d. fuller r. m. burnett, embo j., 1993, 12, 25892599. 40 w. wriggers, biophys reviews, 2010, 2, 2127. 41 w. wriggers, acta cryst. d, 2012, 68, 344351. 42 e. f. pettersen, t. d. goddard, c. c. huang, g. s. couch, d. m. greenblatt, e. c. meng t. e. ferrin, j. comp. chem., 2004, 25, 16051612. 43 s. j. ludtke, p. r. baldwin w. chiu, j. struct. biol., 1999, 128, 8297. 44 m. s. chapman, acta cryst. a, 1995, 51, 6980. 45 p. chacon w. wriggers, j. mol. biol., 2002, 317, 375384. 46 w. humphrey, a. dalk k. schulten, j. mol. graphics, 1996, 14, 3338. 47 j. e. stone, b. isralewitz k. schulten, proceed xsede extrem scale work- shop, 2013. 48 j. e. stone, j. gullingsrud, p. grayson k. schulten, 2001 acm symposium interact 3d graphics, new york, 2001, pp. 191194. 49 j. frank, three-dimension electron microscopi macromolecular assemblies, oxford univer- siti press, new york, 2006. 50 w. kahan, commun. acm, 1965, 8, 40. 51 y. c. h. q. ding, ic 00: proceed 14th intern confer super- computing, new york, ny, usa, 2000, pp. 225234. 52 d. h. bailey, comput. sci. eng., 2005, 07, 5461. 53 j. e. stone, j. saam, d. j. hardy, k. l. vandivort, w. w. hwu k. schulten, proceed 2nd workshop general-purpos process graphic process units, acm intern confer proceed series, new york, ny, usa, 2009, pp. 918. 54 m. krone, j. e. stone, t. ertl k. schulten, eurovi - short paper 2012, 2012, pp. 6771. 55 e. roberts, j. e. stone z. luthey-schulten, j. comp. chem., 2013, 34, 245255. 56 j. e. stone, k. l. vandivort k. schulten, proceed 8th intern workshop ultrascal visualization, new york, ny, usa, 2013, pp. 6:16:8. 57 j. nickolls, i. buck, m. garland k. skadron, acm queue, 2008, 6, 4053. 58 a. sali t. l. blundell, j. mol. biol., 1993, 234, 779. 59 x. wang, f. xu, j. liu, b. gao, y. liu, y. zhai, j. ma, k. zhang, t. s. baker, k. schulten, 120 | 19 page 19 20 faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t d. zheng, h. pang f. sun, plo pathog., 2013, 9:e1003132,. 60 k.-y. chan, l. g. trabuco, e. schreiner k. schulten, biopolymers, 2012, 97, 678686. 20 | 120 page 20 20faradai discuss f ar ad ay d cu ss io n s cc ep te d m u sc ri p t f ar ad ay d cu ss io n s cc ep te d m u sc ri p t