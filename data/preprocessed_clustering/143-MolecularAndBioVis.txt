brief commun natur method | vol.15 no.5 | may2018 | 351 comprehensive, customizable, easy-to-us set featur tool broadli attract chemists, structur biologists, materi engineers. namd9 wide softwar packag molecular dynam- ic (md) simulations, particularli larg biomolecular systems, supercomputers. namd scalabl larg arrai enhanc sampl free energi methods10, seam- integr vmd11, provid extend setup, visu- alization, analysi capabilities, invalu tool explor complex biolog systems. present compre- hensiv qmmm suit implement namd, provid broad rang qmmm methods, vmd, easi setup, visualiza- tion, analysi graphic user interfac qwikmd12. namd, qmmm interfac support simul independ qm region smooth integr collect enhanc sampl alchem methods, includ com- binat qmmm approach state-of-the-art free energi methods, extend adapt bias forc (eabf)13. namd perform similarli qmmm program term energi conserv (supplementari tabl 1) allow scalabl free energi calcul (supplementari fig. 1). hybrid qmmm simulations, namd offload standard forc energi calcul qm program, nativ interfac mopac14,15 orca16, flexibl gener interface. programs, amber17, addition includ code qm calcula- tions. chose adopt strategi ensur user flexibl easili fine-tun simulations. importantly, file input/output ram, littl time lost commun namd qm program. namd, multipl qmmm coupl scheme implemented, allow mechan electro- static embed qm region (onlin methods). input file classic md, addi- tional option configur file. typically, qm mm atom coval bound treat redistribut mm atom charg nearest mm neighbor cap qm atom hydrogen atom, known link atom method, shown figur 1a supplementari figur 2 calcul namdorca interface. link atom variat describ onlin method supplementari figur 3a,b, 4, 5. test accuracy, stability, perform qmmm interface, carri standard valid simul namd goe quantum: integr suit hybrid simul marcelo c r melo1,2,13 , rafael c bernardi1,13 , till rudack1,3 , maximilian scheurer4,5 , christoph riplinger6, jame c phillips1 , julio d c maia7 , gerd b rocha8 , joo v ribeiro1, john e stone1, frank neese9, klau schulten1,10,12 & zaida luthey-schulten1,2,10,11 hybrid method combin quantum mechan (qm) molecular mechan (mm) appli studi reaction mechan locat rang activ site small enzym multipl site larg bioenerget complexes. combin wide molecular dynam visual program namd vmd quantum chemistri packag orca mopac, creat integrated, comprehensive, customizable, easy-to-us suit ( www.ks.uiuc.edu/research/qmmm). qwikmd interface, setup, execution, visualization, analysi streamlin level expertise. mm forc field base quantum mechan cal- culat experiment observations, qm allow com- plete accur understand biochem processes, particularli involv chemic reaction charg redis- tribution1. however, advanc hardwar technolog avail today, comput cost studi nanosecond- long dynam entir system sole qm methodolog usual prohibitive. common wai circumv cost bar- rier confin qm formal subregion includ effect surround mm simu- lations, approach refer hybrid qmmm simulation2. qmmm calcul broadli enzymology3, drug dis- covery4, bioenerget systems5, combin serial femtosecond crystallography6 materi scienc structur biologi techniques7. deliv accur results, qmmm studi requir carefulli select quantum region5,8. unfortunately, avail qmmm implement lack 1nih center macromolecular model bioinformatics, beckman institut advanc scienc technology, univers illinoi urbanachampaign, urbana, illinois, usa. 2center biophys comput biology, univers illinoi urbanachampaign, urbana, illinois, usa. 3depart biophysics, ruhr-univers bochum, bochum, germany. 4biochemistri center, heidelberg university, heidelberg, germany. 5interdisciplinari center scientif computing, heidelberg, germany. 6facct gmbh, kln, germany. 7center informatics, feder univers paraba, joo pessoa, brazil. 8depart chemistry, feder univers paraba, joo pessoa, brazil. 9max-planck-institut fr kohlenforschung, mlheim der ruhr, germany. 10depart physics, univers illinoi urbanachampaign, urbana, illinois, usa. 11depart chemistry, univers illinoi urbanachampaign, urbana, illinois, usa. 12deceased. 13these author contribut equal work. correspond address z.l.-s. receiv 28 june 2017; accept 7 februari 2018; publish onlin 26 march 2018; doi:10.1038/nmeth.4638 natur trademark regist trademark springer natur limited. 352 | vol.15 no.5 | may2018 | natur method brief commun mopac orca. nve ensemble, namd achiev energi conserv pure qm alanin molecul (fig. 1b), hybrid qmmm trialanin molecul vacuum (fig. 1c) water (fig. 1d), pure qm n-methyl acetamid molecule, show energi conserv 100 ns 0.5-f 2.0-f time step (fig. 1e). observ par- ticl mesh ewald treatment long-rang electrostat con- serv energi (supplementari tabl 2). namd amber16 present equal good qmmm result (supplementari fig. 6). namdmopac perform 10 ns/d qmmm simula- tion singl desktop (supplementari tabl 3). provid simpl wai set qmmm simulations, incorpor wide featur hybrid qmmm md code vmd qwikmd12, enabl creat comprehens qmmm workflow (fig. 2a). qwikmd auto- mate creation input configur file check- ing common mistakes, ensur reproduc result. moreover, qwikmd allow drugs, metabolites, molecul lack mm paramet easili ad qm region. prepared, qmmm simul directli perform real time live-view mode call- ing namd local resourc supercomput center (supplementari fig. 7). trajectori classic hybrid qmmm simul easili read analyz vmd, capabl extend work nativ support mopac orca outputs. introduc new represent scheme vmd allow select visual orbit tra- jectori simulation, dynam updat chemic bond representations. capabl vmd power tool visual analysi output qmmm calculations, output directli orca mopac. molecular orbit render pure qm qmmm simulations, system rang small molecul macromolecular complex environ (fig. 2bd, supplementari tabl 46, supplementari note 1, supplementari video 1). combin new qmmm capabl namd mopac interfac exist tool enhanc sampl free energi calculations, investig aminoacyl reaction mechan thermu thermophilu glutamyl-trna synthetas (glurs) interact cognat trna (trnaglu), pm7 charmm36 forc field. establish genet code, glur read trna anticodon region us inform rearrang catalyt site, facilit transfer amp-bound glutamyl 3 end trna. studi alloster inform process transduct previous conduct classic md18. however, anticodon bind domain catalyt site glur >50 apart, treatment entir pathway, approxim 5,000 atoms, qm feasible. qwikmd prepar independ qm regions, abl investig alloster signal pathwai glurstrnaglu complex accur qm treatment critic region (fig. 3a). analyz commun pathwai lead coordi- nate motion function import qm region cross-correlation-bas network analysis18 (onlin method supplementari fig. 8) notabl degenerate, previous observ classic md18 (fig. 3a). qmmm treatment critic region led increas cor- relat residu activ site anticodon bind site (supplementari fig. 9). suboptim commun pathwai base correl atom motion simul calcul alloster signal force-propag pathways. tightli correl group atom cluster communities, indic function domain biomolecul import interfac multi-molecul charg redistribut scheme (carbon c charg distribut preserv local polarization) namd/orca input: namd qmmm configur file psf (topology) pdb (structur identifi qm atoms) d e e n e rg y (k ca l m o l 1 ) e n e rg y (k ca l m o l 1 ) 30 15 0 15 30 0 10 20 30 40 50 0 10 20 30 40 50 time (ps) time (ps) 30 15 0 15 30 30 15 0 15 30 0 10 20 30 40 50 time (ps) 30 15 0 15 30 30 15 0 15 30 0 1 2 3 4 5 number step (107) 30 15 0 15 30 e n e rg y (k ca l m o l 1 ) e n e rg y (k ca l m o l 1 ) 30 15 0 15 30 30 15 0 15 30 mopac (pm7) orca (hf/3-21g) mopac (pm7) orca (hf/3-21g) 0.5-f time step 2.0-f time step mopac (pm7) orca (hf/3-21g) b c orca namd mm region qm atoms: coordin element mm atoms: coordin point charg qm atoms: gradient partial charg mm atoms: gradient coulomb interact qm (partial charg gradients) point charg (mm partial charges) rmax rmax atom atom topolog pme link atom hc c qm atom + mm partial charg (r < r max ) mm atom qm region qm region mm region figur 1 | hybrid qmmm simul namd. (a) schemat namdorca interconnection. electrostat embedding, point charg modifications, charg redistribut method allow precis smooth qmmm coupling. contribut mm charg rmax calcul namd (via particl mesh ewald (pme) method), orca calcul direct electrostatics. psf, protein structur file; pdb, protein data bank. (bd) energi conserv test perform md simul (b) pure qm alanin molecule, (c) qmmm trialanin molecule, (d) qmmm trialanin molecul water. basi set orca test (3-21g) serv technic test. (e) long-scal energi conserv tests, differ time steps, pure-qm n-methyl acetamid molecul calcul namdmopac pm7 level. energi conserv test nve ensemble. plot show deviat mean energy. black line indic run average, grai shade indic maxim fluctuation. line bd repres n = 1 qmmm md simulation. natur trademark regist trademark springer natur limited. natur method | vol.15 no.5 | may2018 | 353 brief commun complexes. presenc multipl commun qm region occurr commun cover classic quantum atom highlight seamless integr qm mm region (fig. 3b). abl distinguish possibl aminoacyla- tion reaction mechan (supplementari fig. 10), base previous propos concert exchang 3- 2-oh oxygen attack carbonyl carbon glu-amp proton shift phosphat oxygen19. investig reaction amin group adenyl proton deprotonated. carri qmmm steer md simula- tion induc possibl reaction mechanisms, select intermedi state steer md trajectori initi string-method optimization20. method us group bias md simul path smallest barrier describ chemic reaction. optim string achieved, reaction path perform parallel eabf13 calcul determin free energi transform possibl mechan (supplementari figs. 11 12). observ reaction charg 3-hydroxyl group, amin group adenyl deprotonated, favor route, barrier ~20 kcal mol1 final state ~8 kcal mol1 (fig. 3ce). initially, possibl reaction mechan test observ endergon (supplementari fig. 13). however, closer exami- nation final state reveal amp phosphat 3 awai charg trna. dissoci amp-h charg trna open space hydrat phosphat group (supplementari fig. 14), investig adapt bias forc (abf) classic md simulations. product move apart water enter activ site, hydrat phos- phate group amp-h, observ ~22 kcal mol1 decreas free energi entir reaction-solv process exer- gonic, free energi variat approxim 15 kcal mol1 reactant product (fig. 3e,f). final state eabf calculation, distanc glu-amp:carb-c glu-amp:p-o 3 , distanc connect point (red dash line fig. 3e) free energi profil calcul eabf abf. worth note append qmmm eabf mm abf result led small imprecis connect free energi values. build synergi namd vmd, develop robust user-friendli qmmm suit prepare, perform, analyz qmmm simulations. test applic highlight accuraci implementation, studi glurs:trnaglu:glu-amp complex reveal subatom detail reaction mechanism. unit network analysi result complex combin string method, parallel eabf, qmmm simulations, abl provid uniqu view model essenti step establish genet code (supplementari fig. 15). modular namd enabl suit varieti contexts, includ teach tool, research inter- face, platform mix match qmmm free energi enhanc sampl methods, sandbox develop new qm tool qmmm interact schemes. applic suit includ intellig design enzymat inhibitors, effort improv precis gene edit technologies. method methods, includ statement data avail associ- at access code references, avail onlin version paper. note: supplementari inform sourc data file avail onlin version paper. acknowledg author thank m.f. herbst, c. chipot, g. fiorin help discussions. work support nation scienc foundat (nsf) (grant mcb- 1616590, mcb-1244570, phy1430124 z.l.-s.), nation institut health (nih) (grant p41-gm104601 z.l.-s.), keck foundat (grant 206231 m.c.r.m. z.l.-s.), alexand von humboldt foundat (feodor lynen postdoctor fellowship t.r.), brazilian coordin improv higher educ personnel (capes; fellowship j.d.c.m.; grant auxpe1375/2014 g.b.r.), brazilian nation council scientif technolog develop (cnpq 305271/2013-0 g.b.r.). f.n. c.r. acknowledg support develop orca max planck societi (mpg) german scienc foundat (dfg). research us blue water sustained-petascal computing, support state illinoi nsf (oci-0725070 aci-1238993). work b c d point mutat proton state run classic simul live copi file supercomput select qm simul protocol prepar qm simul file select qm region solvat set salt concentr select mm equilibr protocol prepar mm simul file run qmmm simul live copi file supercomput run qmmm simul run classic simul protein data bank structur select chain/molecul structur check visual check live analysi advanc analysi trajectori figur 2 | hybrid qmmm vmd features. (a) qwikmd provid graphic user interfac vmd perform qmmm simulations. workflow illustr prepare, run, analyze, visual hybrid qmmm md simulation. (b) highest occupi molecular orbit alanin molecul vacuum. (c) alanin highest occupi molecular orbit solvat qmmm trialanine. (d) trp-cage protein highest occupi molecular orbit water solution. color-cod bd follows: gray, carbon; red, oxygen; blue, nitrogen; white, hydrogen. orbit glossi red blue clarity. yellow ribbon d repres secondari structure. natur trademark regist trademark springer natur limited. 354 | vol.15 no.5 | may2018 | natur method brief commun petascal comput resourc (prac) grant, support nsf (aci-1713784). author contribut m.c.r.m., r.c.b., t.r., k.s., z.l.-s. conceiv project. m.c.r.m. implement qmmm interface. r.c.b., t.r., m.c.r.m., g.b.r., k.s. discuss qmmm features. j.d.c.m., g.b.r., c.r., f.n. provid guidanc develop qmmm interface. j.c.p. assist adapt namd. m.c.r.m. m.s. prepar python script interfac select qm softwar packages. r.c.b. m.c.r.m. perform namd test simulations. j.d.c.m. g.b.r. perform amber calculations. r.c.b. m.c.r.m. perform free-energi calcul analysis. m.s. j.e.s. implement orbit visual vmd. j.v.r. j.e.s. implement qmmm graphic interfac qwikmd. r.c.b., m.c.r.m., t.r., m.s., g.b.r., f.n., z.l.-s. wrote edit manuscript. k.s. z.l.-s. supervis project. compet interest author declar compet interests. reprint permiss inform avail onlin com/reprints/index.html. publish note: springer natur remain neutral regard jurisdict claim publish map institut affiliations. 1. senn, h.m. & thiel, w. angew. chem. int. edn engl. 48, 11981229 (2009). 2. field, m.j., bash, p.a. & karplus, m. j. comput. chem. 11, 700733 (1990). 3. van der kamp, m.w. & mulholland, a.j. biochemistri 52, 27082728 (2013). 4. bernardi, r.c. & pascutti, p.g. j. chem. theori comput. 8, 21972203 (2012). 5. retegan, m., neese, f. & pantazis, d.a. j. chem. theori comput. 9, 38323842 (2013). 6. coquelle, n. et al. nat. chem. 10, 3137 (2018). 7. lin, h. & truhlar, d.g. theor. chem. acc. 117, 185199 (2007). 8. jindal, g. & warshel, a. j. phys. chem. b 120, 99139921 (2016). 9. phillips, j.c. et al. j. comput. chem. 26, 17811802 (2005). 10. jiang, w. et al. comput. phys. commun. 185, 908916 (2014). 11. humphrey, w., dalke, a. & schulten, k. j. mol. graph. 14, 3338 (1996). 12. ribeiro, j.v. et al. sci. rep. 6, 26536 (2016). 13. fu, h., shao, x., chipot, c. & cai, w. j. chem. theori comput. 12, 35063513 (2016). 14. stewart, j.j. j. comput. aid mol. des. 4, 1105 (1990). 15. maia, j.d.c. et al. j. chem. theori comput. 8, 30723081 (2012). 16. neese, f. wilei interdiscip. rev. comput. mol. sci. 8, e1327 (2018). 17. gtz, a.w., clark, m.a. & walker, r.c. j. comput. chem. 35, 95108 (2014). 18. sethi, a., eargle, j., black, a.a. & luthey-schulten, z. proc. natl. acad. sci. usa 106, 66206625 (2009). 19. black pyrkosz, a., eargle, j., sethi, a. & luthey-schulten, z. j. mol. biol. 397, 13501371 (2010). 20. pan, a.c., sezer, d. & roux, b. j. phys. chem. b 112, 34323440 (2008). b d e n e rg y (k ca l m o l 1 ) e c f reaction coordin 3 4 5 6 7 8 9 10 25 20 15 10 5 0 5 10 15 20 distanc () glu-amp + trna amp-h trna-glu xxxxxxxxxxxxx figur 3 | mechan glutamyl-trna synthetase. (a) glutamyl-trna synthetas alloster pathwai (red). independ qm region highlighted, indic activ site (blue) anticodon bind region (green). yellow white ribbon repres trna synthetase, respectively. (b) cross-correlation-bas commun analysi activ site calcul qmmm trajectories. color-cod a. (c) reaction mechan glutamyl-trna synthetase. (d) intermedi state glutamyl-trna synthetas reaction, show highest occupi molecular orbital. (e) left, free energi profil favor glutamyl-trna synthetas reaction mechanism, calcul eabf string-method path optimization. eabf string method carri qmmm md simul namdmopac pm7. right, free energi profil distanc solvat amp calcul abf classic md simulations. x indic minimum energi state. red dash line indic connect point eabf abf free energi profiles. n = 1 experi eabf abf. (f) snapshot minimum energi state (red x e) releas amp, show solvat phosphat group. color-cod d,f defin figur 2, gold element structur (phosphatase) white yellow ribbon (a a). natur trademark regist trademark springer natur limited. doi:10.1038/nmeth.4638 natur method onlin method method overview. order studi chemistri complex biolog systems, particular md approaches, need combin qm mm method secur subatom reso- lution relev time length scales. however, recent advanc implement qm calcul hardwar improv continu increas capac expand complex comprehens qm results21. hybrid qmmm simul namd divid mm qm regions, classic forc field treat classic atom (mm atoms), pass inform describ quantum atom (qm atoms) quantum chemistri package, expect calcul forc qm atoms, total energi qm region (and option partial charges). bond nonbond interac- tion mm atom handl namd charmm forc field, interact qm atom handl quantum chemistri packag chosen theori level. nonbond interact qm mm atom modifi regul user. lennardjon interac- tion calcul namd, specif paramet provid qm atoms. qm-specif modif propos compens overpolar atom exhibit hybrid qmmm simulations, import modif dis- puted22. simul present work, standard charmm36 lennardjon paramet mm qm atoms. mechan electrostat embedding. long known electrostatics, particularli polarization, plai kei role biochem processes23. electrostat interact qm mm atom deserv detail discuss ow abund divers avail alternatives. mechan embed scheme, electrostat influ- enc mm atom account qm pack- ag comput forces, charg distribution, energi qm region. posit element atom qm region pass qm package, qm mm atom interact namd-calcul lennardjon electrostat potenti (see special treatment qmmm bonds). electrostat embed scheme, contrast, par- tial charg mm atom surround qm atom approxim electrostat environ qm atoms. select classic point charg automat namd, case cutoff valu effect creat shell point charg qm region. type embed- ding frequent biomolecular simulations1. classic point charg provid qm program electrostat embed alter namd varieti ways. first, smooth function appli avoid abrupt chang electrostat forc cutoff selec- tion surround point charges. second, partial charg modifi sum number charg complementari qm region, case sum charg qm atom classic partial charg zero. case, user abl select, atom atom, classic partial charg build electrostat embedding, provid flexibl application. regardless chosen embed method, calcul charg distribut qm atom namd updat partial charg qm atom calcul short- long-rang electrostat interactions. particular, particl mesh ewald (pme)24 used, namd appli newli determin charg qm atom calcul long-rang electrostat qm mm region system. case, necessari correct calcul subtract pme forc interact calcul qm packag qmqm atom pairs, namd qm modul qmpoint charg pairs. pme forc energi calcul namd carri classic charg classic atom user choic classic charg updat charg qm atoms. forc energi deriv pme interact qm atom qm atom surround point charg recalcul qm modul sub- tract direct electrostat calculations, avoid dou- ble-count contributions. test effect implement simulations, carri energy- conserv analysi compar us pme namd qm calcul pm3 (refs. 25,26), hf-3c (hartee-fock-3c)27, dft (densiti function theory) method (supplementari tabl 2). treatment coval bond involv qm mm atoms. hybrid qmmm simul biomolecular system present situat molecul treat quantum-mechanically, usual save comput resources, cost simul qm region increas rap- idli number atoms. deal chemic bond atom quantum mechan region classic (mm) region (hereinaft refer qmmm bonds), namd offer method combin alter molecular order bridg differ simu- lation type (qm versu mm) minim error involv qm/mm divis system. regardless method select treat qmmm bond, bond term (between mm1 qm1 atoms; supplementari fig. 3c) cal- culat namd, proper improp dihedr term angl term cross qmmm barrier involv classic atom. link atoms. wide method cap qm region contain qmmm bond link atom approach28, atom (usual hydrogen atom) place bond qm atom mm atom (supplementari fig. 3c) exist classic simulation. user fine-tun process choos element method link-atom placement used: fix (the default) vari- able. depend user-defin distanc dl-qm, simul (supplementari fig. 3c). latter, user-defin fraction defin cl (equat (2)), fix valu namd calcul dl-qm step function dmm-qm, turn vari cours simul bond vibration. conserv forc energy, total forc act link atom (fl ), calcul qm code, redistribut namd qm1 mm1 atoms29 ad total natur trademark regist trademark springer natur limited. doi:10.1038/nmeth.4638natur method forc calcul atom qm code namd, respectively. equat (1) (3) calcul x compon redistribut forc appli qm1 mm1 atoms, respectively. analog equat axes. here, ix unit vector x-axis, rmm-qm unit vector qmmm bond direction, xmm xqm x compon posit mm1 qm1 atoms, respectively. = + f f c c x x d rx xqm l l l mm-qm mm-qm1 1 1 ( ) ( )mm qm c d dl l-qm mm-qm = ( )2 similarly, = f f c c x x d rx l x lmm1 3 l mm qm mm-qm mm-qm ( ) link atom approach propos method handl qmmm bonds, reli entir classic qmmm simulation, user complet control. therefore, regardless qm pack- ag chosen carri qm calcul simulation, namd qmmm interfac guarante creation proper condit simul qmmm bonds, grant great flexibility. point charg alter redistribution. con- tain qmmm bond, link atom invari place near mm1 atom, creat strong electrostat repuls forc (or attractions) case mm1 partial charg sent qm packag calculations. mechan embed scheme, qm packag receiv atom qm region link atom creat approxim qm mm bonds, manipul partial charg required. contrast, usual electrostat embed scheme requir special treatment nearbi classic partial charges. method propos handl condit classic partial charg surround qmmm bond, qmmm interfac develop offer wide accept on (supplementari fig. 4). method implement here, classic atom particip qmmm bond (mm1 atom) partial charg pass qm pack- age, creat excess repuls (or attraction) link atom. is, fact, entireti z1 method: ignor partial charg mm1 atom30. analogously, z2 ignor mm1 partial charg partial charg atom bound mm1, call mm2 atoms, z3 extend approach ignor- ing partial charg atom bound mm2 atoms, call mm3 atom (supplementari fig. 4bd). charge-shift method31 (supplementari fig. 4e) elaborate, rearrang partial charg mm1 atom (denot qm1) total charg region maintained, approxim dipol moment bond mm1 mm2 atoms. creation virtual point charg pass qm packag repres partial charg classic (1)(1) (2)(2) (3)(3) atoms. case, mm1 partial charg equal distrib- ut mm2 atoms, placement charg q1 posit mm2 atom (where q1 = qm1/2), coeffici equat (4) (5) redistribut forc virtual charg given c1 = dm1-q1/dm1-m2 = 1. moreover, virtual point charg place direct mm1mm2 bond, mm2 atom (q+ = q0) (q = 1q0). implementation, c d dq+ += =m m1-m21 0 94- / . , c d dq = =m1 m1-m2- / .1 06 (supplementari fig. 4e). method total charg region constant try preserv local dipol form mm1mm2 bonds. redistribut charg dipol method30 (supplementari fig. 4f) follow similar arrangement. virtual point charg creat middl mm1mm2 bond (c2 = dm1-q2 /dm1-m2 = 0.5) charg q2 = 2qm1/2, charg q1 = 1qm1/2 place posit mm2 atom (c1 = 1). arrang maintain constant total charg region attempt mimic local dipoles. case virtual charg created, forc cal- culat balanc electrostat interact qm atoms. similarli link atom, total forc act on, example, virtual point charg q+ (fq +) redistribut mm1 mm2 atom defin it. fraction total forc appli mm1 mm2 atom defined, respectively, f c fq mm1 = + +( ) ( )1 4and f c fq mm2 = + + ( )5 implement interact quantum chemistri packages. implement qmmm modul namd entir c/c++, make us charm++ message- driven load-balanc tool simul run par- allel nodes. quantum mechan calcul offload qm package, hard- code interfac orca16 mopac14,15, stand- ardiz interfac us python script (or tool) wrap convert input output format namd arbitrari qm package. standard interfac creat data input/output extern wrapper script called, provid translat layer input output file qm package. provid python script wrap gaussian32, terachem33, q-chem34, serv templat develop new wrapper scripts. general, posit element qm atom pass qm packag posit magnitud partial charg repres local mm environment. return, namd expect forces, total energy, partial charg qm atoms, possibl forc act mm partial charg electrostat interactions. exchang inform namd quantum chemistri packag prefer file written ram, take insignific time (milliseconds) compar time scale qm calcul (second more). embed qm code directli namd, allow user choos prefer quantum chemistri packag level theory. additionally, namd take advantag current advanc state quantum chemistri packages, prepar (4)(4) (5)(5) natur trademark regist trademark springer natur limited. doi:10.1038/nmeth.4638 natur method sequenti call extern software, qm mm context. self-consist field (scf) calcul given set atoms, state-fil contain result scf procedur saved. faster converg achiev subsequ scf calcul qm packag re- initi save state-files, initi close guess scf solut be. occur atom posit vari slightli consecut calculations. multipl qm region simul simultan independ execut chosen qm package, independ qm region defin biomolecular system. md simul test system ttglurs. structur test system t. thermophilu glur (ttglurs) prepar classic qmmm md simula- tion vmds11 qwikmd12 graphic interface. qwikmd assist user select qm region residu residu point-and-click interface, method develop provid autom qm-region selec- tion35. structur pre-transf complex ttglurs: trnaglu:glu-amp previous solv mean x-rai crystallographi 2.1- resolut avail protein data bank (pdb 1n78)36, replac inert analog activ glu-amp19. simul present studi namd md package9, mopac 2016 (refs. 14,15), pm7 (ref. 37), orca 4.0 (ref. 16). charmm36 forc field38 tip3p water model, solvat tests, systems. calcul involv ttglurs:trnaglu:glu-amp npt ensemble. energy-conserv tests, simul pm3 (refs. 25,26) method (use namd orca interface) rm1 (ref. 39) (use namd mopac interface). result amber sqm implement pm3 rm1. solvat systems, simul carri period boundari conditions. simul carri step ensur reason start conform qm- base simulations. (1) first, system explicitli solvated, classic md npt ensembl temperatur main- tain 300 k langevin dynam pressure, kept 1 bar, temperatur coupling. (2) paramet classic npt simulations, carri qm-base npt simul (either pure qm hybrid qmmm). (3) energy- conserv tests, qm-base simul perform nve ensemble. distanc cutoff 12.0 17.0 (eabf calculations) appli short-range, nonbond interactions, long- rang electrostat interact treat pme24 method. equilibr classic mm simulations, equat motion integr r-respa multi- ple-time-step scheme9. product qmmm simulations, van der waal interact electrostat interact updat time step. time step integr 0.5 fs 2.0 fs (detail below). monoalanin compos singl alanin residu vacuum (ga phase). experi describ figur 1b, simul verif energi conserv carri describ 0.5-f time step. polyala compos alanin residues. differ ways, vacuum solut (tip3 water), residu treat quantum- mechanically, central residu treat qm region, lead us link atom (supplementari fig. 3a,b). figur 1c depict vacuum, middl residu treat quantum-mechanically. figur 1e show solution, residu treat quan- tum-mechan water molecul treat classically, shown supplementari figur 2a namdorca interface. simul perform 0.5-f time steps, charge-shift treatment link atoms. reproduc previous report energy-conserv result amber, spc/fw water model (a flexibl variant simpl point charg (spc) model) amber qmmm simulations. analogously, n-methyl acetamid simul vacuum solut (tip3 water), entir treat qm formalism. figur 1d show vacuum (ga phase), entir molecul treat quantum-mechanically. simul perform 0.5-f 2.0-f time steps, shown figur 1d. network analysis. suboptim commun pathwai commun calcul basi pearson cross- correl atom motion, protocol similar describ ref. 18. calcul base qmmm trajectori 2-f time step total 100 ps, total- ing 1 ns qmmm simulations. independ- ent qm region used, anticodon domain approxim 500 qm atoms, catalyt region approxim 200 qm atoms. briefly, network analysi protocol us central atom (-carbon amino acids, n1/n9 nucleic bases, sugar phosphat p) call node proxi motion residues, posit md simul calcul pearson cross-correl motion. node residu non-hydrogen atom 4.5 apart 75% total simul time consid connected40. node meet cutoff cross-correl multipli zero mask appli cross-correl matrix. result set correl connect node form weight matrix floydwarshal algorithm shortest commun path node (suboptim paths), girvannewman algorithm optim commun highli interact nodes. suboptim path repres shortest set connect node transmit informa- tion distant sites, alloster regul site enzym activ site. qmmm simulations. studi reaction mechan ttglurs:trnaglu:glu-amp system, carri 200-p qmmm simul 2-f time step, follow 50-p qmmm simul 0.5-f time step. simula- tion equilibr conform favor reaction mechan investigated. test mechan induc reaction step occur (supplementari fig. 10). bias simul per- form 0.5-f time step 20100 ps. simul carri charge-shift method treat link atoms, natur trademark regist trademark springer natur limited. doi:10.1038/nmeth.4638natur method shift function appli surround classic partial charg electrostat embed scheme. string method eabf. studi transform occur biomolecular system, chemic reaction confor- mation change, defin collect variabl distanc atom center mass group atoms, angl subdomain molecular structure. collect variabl (colvars) track chang undergo transform studied, defin reaction coordinate. string method iter process optim reac- tion coordin order path resist initi final state system. method us discret represent reaction coordin compos images, imag copi entir simul differ stage transformation. iteration, multipl independ md simul initi image, allow system explor energi surfac drift local minima. then, averag valu col- var determined, bias appli consecut imag approxim equidist colvar space smooth reaction coordinate. iter proce consecut calcul produc signific chang mean col- var values, indic converg method. string optimized, imag defin continu path defin transformation, eabf calcul free energi changes. imag optim string method, new path colvar s z created, constrain dynam follow chosen reaction coordinate. s indic progress path, z indic perpendicular distanc path. take advantag namd outstand scalabl ncsa blue water supercomputer, parallel strategi initi multipl walker differ images, abl conduct extens sampl defin path. code availability. report qmmm featur publicli avail namd 2.12 later vmd 1.9.4 later. detail avail sourc code tutorial. orca avail orcaforum.cec.mpg.d life scienc report summary. inform experiment design avail life scienc report summary. data availability. data support find studi avail correspond author reason request. sourc data figur 1 3 supplementari figur 1, 5, 6, 8, 9, 1214 avail online. 21. riplinger, c., pinski, p., becker, u., valeev, e.f. & neese, f. j. chem. phys. 144, 024109 (2016). 22. riccardi, d., li, g. & cui, q. j. phys. chem. b 108, 64676478 (2004). 23. warshel, a. & levitt, m. j. mol. biol. 103, 227249 (1976). 24. darden, t., york, d. & pedersen, l. j. chem. phys. 98, 1008910092 (1993). 25. stewart, j.j.p. j. comput. chem. 10, 209220 (1989). 26. stewart, j.j.p. j. comput. chem. 10, 221264 (1989). 27. sure, r. & grimme, s. j. comput. chem. 34, 16721685 (2013). 28. singh, u.c. & kollman, p.a. j. comput. chem. 7, 718730 (1986). 29. walker, r.c., crowley, m.f. & case, d.a. j. comput. chem. 29, 10191031 (2008). 30. lin, h. & truhlar, d.g. j. phys. chem. 109, 39914004 (2005). 31. sherwood, p. et al. faradai discuss. 106, 7992 (1997). 32. frisch, m.j. et al. gaussian 09, revis a.02. (gaussian, inc., 2016). 33. titov, a.v., ufimtsev, i.s., luehr, n. & martinez, t.j. j. chem. theori comput. 9, 213221 (2013). 34. shao, y. et al. mol. phys. 113, 184215 (2015). 35. kulik, h.j., zhang, j., klinman, j.p. & martnez, t.j. j. phys. chem. b 120, 1138111394 (2016). 36. sekine, s. et al. embo j. 22, 676688 (2003). 37. stewart, j.j.p. j. mol. model. 19, 132 (2013). 38. best, r.b. et al. j. chem. theori comput. 8, 32573273 (2012). 39. dutra, j.d.l., filho, m.a.m., rocha, g.b., simas, a.m. & freire, r.o. plo 10, e0124372 (2015). 40. schoeler, c. et al. nano lett. 15, 73707376 (2015). natur trademark regist trademark springer natur limited. 1 n atur research | life scien ce rep ortin g sum m ari n ovem ber 2017 correspond author(s): zaida luthey-schulten life scienc report summari natur research wish improv reproduc work publish. form intend public accept life scienc paper provid structur consist transpar reporting. life scienc submiss us form; list item appli individu manuscript, field complet clarity. inform point includ form, report life scienc research. inform natur research policies, includ data avail policy, author & refere editori polici checklist. complet field "not applicable" n/a. refer help text text us item relev study. final submission: carefulli check respons accuracy; abl chang later. experiment design 1. sampl size sampl size determined. applicable. signific variabl expect emploi softwar input files. 2. data exclus data exclusions. data excluded. 3. replic measur taken verifi reproduc experiment findings. applicable. signific variabl expect emploi softwar input files. 4. random samples/organisms/particip alloc experiment groups. applicable. experi silico. 5. blind investig blind group alloc data collect and/or analysis. applicable. experi silico. note: vivo studi report sampl size determin blind random used. 6. statist paramet figur tabl us statist methods, confirm follow item present relev figur legend (or method section addit space needed). n/a confirm exact sampl size (n) experiment group/condition, given discret number unit measur (animals, litters, cultures, etc.) descript sampl collected, note measur taken distinct sampl sampl measur repeatedli statement indic time experi replic statist test(s) one- two-sid common test describ sole name; complex techniqu method section. descript assumpt corrections, adjust multipl comparison test valu indic effect present provid confid interv result signific test (e.g. p values) exact valu appropri effect size noted. clear descript statist includ central tendenc (e.g. median, mean) variat (e.g. standard deviation, interquartil range) clearli defin error bar relev figur caption (with explicit mention central tendenc variation) web collect statist biologist resourc guidance. natur methods: doi:10.1038/nmeth.4638th natur trademark regist trademark springer natur limited. 2 n atur research | life scien ce rep ortin g sum m ari n ovem ber 2017 softwar polici inform avail code 7. softwar softwar analyz data study. comput tool emploi analyz data describ text. plot run averag grace r softwar package. manuscript util custom algorithm softwar central paper describ publish literature, softwar avail editor review request. strongli encourag code deposit commun repositori (e.g. github). natur method guidanc provid algorithm softwar public provid inform topic. materi reagent polici inform avail materi 8. materi avail indic restrict avail uniqu materi materi avail distribut party. uniqu materi used. 9. antibodi antibodi valid us studi (i.e. assai species). applicable. experi silico. antibodi study. 10. eukaryot cell line a. state sourc eukaryot cell line used. applicable. experi silico. eukaryot cell study. b. method cell line authent used. applicable. experi silico. eukaryot cell study. c. report cell line test mycoplasma contamination. applicable. experi silico. eukaryot cell study. d. cell line list databas commonli misidentifi cell line maintain iclac, provid scientif rational use. applicable. experi silico. eukaryot cell study. anim human research particip polici inform studi involv animals; report anim research, follow arriv guidelin 11. descript research anim provid relev detail anim and/or animal-deriv materi study. applicable. experi silico. anim study. polici inform studi involv human research particip 12. descript human research particip covariate-relev popul characterist human research participants. applicable. experi silico. studi involv human research participants. natur methods: doi:10.1038/nmeth.4638th natur trademark regist trademark springer natur limited. 1. 2. 3. 4. 5. natur research, brought courtesi springer natur limit (natur research) term condit natur research support reason share content authors, subscrib authoris authent user (users), small-scal personal, non-commerci us provid respect maintain copyright, trade servic mark proprietari notices. accessing, view natur content agre term us (terms). purposes, natur research consid academ us (by research students) non-commercial. term supplementari appli addit applic websit term conditions, relev site licenc person subscription. term prevail conflict ambigu regard terms, site licenc person subscript (to extent conflict ambigu only). sharing, receiv content share source, user agre bound terms. collect us person data provid access natur content. researchg us person data intern researchg share natur research, anonymis way, purpos tracking, analysi reporting. natur research disclos person data permiss detail privaci policy. user recipi natur content not: us natur content purpos provid user access content regular larg scale basi mean circumv access control; us natur content consid crimin statutori offenc jurisdiction, give rise civil liability, unlawful; fals misleadingli impli suggest endorsement, approv , sponsorship, associ explicitli agre natur research researchg writing; us bot autom method access natur content redirect messages; overrid secur featur exclusionari protocol. term us review regularli amend time. oblig publish inform content remov featur function sole discretion, time notice. revok licenc time remov access copi share content saved. share natur content order creat substitut product servic systemat databas content. furthermore, allow creation product servic creat revenue, royalties, rent incom content inclus paid servic commerci gain. natur content inter-librari loan librarian upload natur content larg scale their, other, institut repository. fullest extent permit law natur research make warranties, represent guarante users, express impli respect natur content parti disclaim waiv impli warranti warranti impos law, includ merchant fit particular purpose. note right automat extend content, data materi publish natur research licens parties. intend distribut content wider audienc regular basi manner expressli permit term contact natur trademark regist trademark springer natur limited.