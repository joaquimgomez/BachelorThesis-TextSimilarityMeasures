approxim dynam global illumin imag space tobia ritschel thorsten grosch hans-pet seidel mpi informatik figur 1: gener screen-spac ambient occlus (ssao) direct occlus (ssdo) addit diffus indirect bounc light. scene contain 537k polygon run 20.4 fp 16001200 pixels. geometri light fulli dynamic. abstract physic plausibl illumin real-tim framer achiev approximations. popular exampl ambient occlus (ao), simpl effici implement extens production. recent method approxim ao nearbi geometri screen space (ssao). kei observ describ paper is, screen-spac occlus method comput type effect occlusion, direct shadow indirect color bleeding. propos gener small overhead compar classic ssao, approxim direct one-bounc light transport screen space, combin method simul transport macro structur visual equival ssao worst case introduc new artifacts. method work screen space, depend geometr complex- ity. plausibl direct occlus indirect light effect displai larg fulli dynam scene real-tim frame rates. cr categories: i.3.7 [comput graphics]: three- dimension graphic realism; i.3.3 [comput graph- ics]: color, shading, shadow textur keywords: radiosity, global illumination, constant time 1 introduct real-tim global illumin unsolv problem larg dynam scenes. currently, suffici frame rate achiev approximations. approxim ambi- ent occlus (ao), featur film games, high speed simpl implementation. how- ever, ao decoupl visibl illumination, allow coars approxim actual illumination. ao typic displai darken cavities, direct inform incom light ignored. extend recent develop screen-spac ao realist illumin screen- space direct occlus (ssdo). present work explains, ssdo account direct incom light, includ bounc indirect illumination, complement standard, object-bas global illumin requir minor addit comput time. paper structur follows: first, review exist work section 2. section 3 gener ambient occlus illumin meso-structures. section 4 explain extens improv visual quality. section 5 integr method complet global illumin simul de- scribed. present result section 6, discuss section 7 conclud section 8. 2 previou work approxim physic plausibl illumin real-tim frame- rate recent receiv attention. ambient occlus (ao) [cook torranc 1981][zhukov et al. 1998] product extens [landi 2002] speed, simplic eas implementation. physic correct illumin comput integr product visibl illumin direction, ao comput product individu integrals: visibl illumination. static scenes, ao allow pre-comput visibl store scalar field sur- face (use vertic textures). combin static ao dynam light simpl multipl give perceptu plausibl [langer bulthoff 2000] result high framerates. account dynam scenes, kontkanen et al. [2005] introduc ao fields, allow rigid translat rotat object special solut anim charact exist [kontkanen aila 2006]. deform surfac bounc indirect light address bunnel [2005] set disk approxim geometry. robust version present hoberock jia [2007], extend point-bas ambient occlus interreflect christensen [2008]. mendez et al. [2006] com- pute simpl color bleed effect averag albedo surround geometry. method us discret surfac reli ray-tracing, scale dynam geometri current interact applic like games. there- fore, instead comput occlus surfaces, recent method approxim ao screen space (ssao)[shanmugam arikan 2007; mittr 2007; bavoil et al. 2008; filion mcnaughton 2008]. popular ssao simpl implemen- tation high performance: output-sensitive, appli post-process, requir addit data (e.g. surfac description, spatial acceler structur visibl like bvh, kd-tree shadow maps) work type geometri (e.g. dis- placement / normal maps, vertex / geometri shaders, iso-surfac raycasting). image-spac method effici simul subsurfac scatter [merten et al. 2005]. time, ssao approxim limitations, appli work, follow sections. ao coars approxim gener light transport eg. prt [lehtinen kautz 2003], support direct occlus (do) interreflections. pre-comput requir store high amount data compress form, limit spatial direct resolution. approach allow resolv small surfac detail angular resolutions: ,,no-frequ ao, all-frequ image-bas light sharp shadow point lights. prt work distant light static geometri low moder complexity, adapt real ap- plicat remain involved, ssao uncompromis simplicity. summary, work take advantag inform comput ssao process [shanmugam arikan 2007] approxim signific effect contribut realism results: direct occlus indirect bounces, real-time, previous imposs dynamic, high- resolut geometry. 3 near-field light transport imag space comput light transport imag space, method us frame- buffer posit normal [segovia et al. 2006] input, output framebuff illumin pixel render passes: direct light indirect bounces. direct light standard ssao illumin pixel comput averag visibl valu set neighbor pixels. occlus valu multipli unocclud illumin incom directions. propos remov decoupl occlus illumin follow way: pixel 3d posit p normal n, direct radi- anc ldir comput n sampl direct i, uniformli distribut hemisphere, cover solid angl = 2/n : ldir(p) = n i=1 lin(i)v (i) co i. sampl comput product incom radianc lin, vis- ibil v diffus brdf /. assum lin effici comput point light environ map. avoid us ray-trac comput visibl v , approxi- mate occlud screen space instead. sample, step random length [0 . . . rmax] p direct i, rmax user-defin radius. result set sam- pling point p + ii, locat hemisphere, center p, orient n. gener sampl point 3d posit local frame p, surface. approxim visibl test, sampl point surfac nearbi geometri treat occluders. fig. 2 (left) show exampl 1 b c d p env. map n c p env. map max r b d figur 2: left: direct light direct occlusion, sampl test occluder. example, point p illumin direct c. right: indirect light, small patch place surfac occlud direct light store framebuff sender radiance. n = 4 sampl point a,b,c d: point a, b d surface, classifi occlud p, sampl c surfac classifi visible. test sampl point surface, sampl point back-project image. now, 3d posit read posit buffer point project surfac (red arrows). sampl point classifi surfac distanc viewer decreas project surface. exampl fig. 2, sampl a,b d sur- face viewer, sampl c move awai viewer. contrast ssao, comput illumin samples, visibl direct (sampl c). includ direct inform improv result significantly, especi case incom illumin differ color differ directions. shown fig. 3, correctli displai result color shadows, ssao simpli displai grei shadow location. indirect bounc includ indirect bounc light, direct light store framebuff previou pass used: sampl point treat occlud (a, b, d), correspond pixel color lpixel sender radi- anc small patch, orient surfac (see fig. 2 right). consid sender normal avoid color bleed back- face sender patches. addit radianc surround figur 3: row show differ ao, standard ssao, method direct occlus (ssdo) addit bounce. scene environ map addit point light shadow map illumination. inset row differ detail. ssdo, red blue shadow visible, ao shadow complet grei (bottom left). imag right indirect bounce. note yellow light, bounc box ground. effect dynam light seen best supplement video. geometri approxim lind(p) = n i=1 lpixel(1 v (i)) co si co ri d2i di distanc p occlud (di clamp 1 avoid singular problems), si ri angl sender/receiv normal transmitt direction. area associ sender patch. init valu patch area assum flat surfac insid hemisphere. base circl subdivid n regions, cover area = r 2 max/n . depend slope distribut insid hemisphere, actual valu higher, us paramet control strength color bleed manually. exampl fig. 2, indirect light contribut calcul patch a, back-facing. patch c neg half-spac p, contribute, too. patch b d sender indirect light p. fig. 3 show bounc indirect light. implement detail note, classic ssao [shanmugam arikan 2007] similar step comput costs. method requir comput evalu shade model, similar visibl test. examples, us addit sampl known import light sourc (e.g. sun), appli shadow map captur shadow distant geometri instead screen-spac visibility. us m n -textur store m set n pre-comput low-discrep sampl ii. runtime, pixel us m sets. final pass appli geometry-sensit blur [segovia et al. 2006] remov nois introduc reduct sampl pixel. 4 multipl pixel valu work screen space, blocker sourc indirect light visible. fig. 4 show exampl color bleed smoothli fade sourc indirect illumi- nation occluded. visual disturb artifacts, shown accompani video, result biased. bias solution, present approach overcom limitations: depth peel addit cameras. figur 4: frame animation. frame light bounc yellow surfac floor (see arrow). yellow surfac smaller screen space effect fade smoothly. single-depth limit blocker test describ pre- viou section approximation, depth valu known inform occlud geometri lost sin- gle framebuffer. sampl point misclassified, shown fig. 5 (left). certain situations, miss gap incom light classifi block direct visible. miss blocker (sampl b) correct simpli increas number sampl direction, gap sampl (and indirect light come vicin a) detect singl viewpoint, inform scene depth valu z1. depth peel depth peel [everitt 2001], n depth valu store n render pass pixel framebuffer. allow improv blocker test, inform structur scene. instead test sampl point depth valu z1, addition test sampl point second depth valu z2. two-manifold geometry, second depth valu correspond - backfac solid object, sampl point face insid object (see fig. 5 right). reconstruct shadow scene higher depth complexity, pair consecut depth 1 b p env. map n max r p env. map n max r b 1 z 2 z 1 z figur 5: problem screen-spac visibl (left): visibl sampl classifi occlud project posit closer viewer. sampl b surface, correspond direct blocked, p incorrectli illumin direction. solut (right): depth peel layers, sampl classifi visible, second depth value. sampl direct b, occlud found. valu (third forth depth valu on) evalu wai [lischinski rappoport 1998]. fig. 6 show screen-spac shadow point light. singl point light, sampl uniformli distribut line segment length rmax, direct light source. inform actual width blocker singl depth buffer, shape shadow depend rmax. correct shadow displai depth peel (avg. overhead +30%). addit visibility, color bleed effect backfac occlud geometri displai multipl layers, comput direct light depth layer. figur 6: screen-spac shadow differ valu rmax. addit camera depth peel remov problem re- late ssdo. alternatively, differ camera posit instead differ depth layer view hidden regions. gain inform offscreen blockers, differ camera po- sition especi us polygon view graze angle. polygon faithfulli reproduced, color bleed polygon vanishes. addit camera, sourc indirect light visi- ble. best-poss viewpoint addit camera complet differ viewer camera, e.g. rotat 90 degre object center view grazing-angl polygon front. however, introduc problem occlusion: typic scene polygon visibl viewer camera occlud object addit camera view. course, solv depth peel addit camera well. faster solut larg valu near clip plane, adjust sampl radiu rmax, hard control image. compromise, addit camera standard depth buffer, direct center-of-interest viewer camera. rel posit addit camera viewer camera set manual normal displac vector. adapt scene size, displac vector scale radiu bound sphere scene. figur 7: compar occlus (top) bounc (bottom) singl view (left, 49.2 fps) multipl view (middle, 31.5 fps). multipl view allow surfac occlud framebuff con- tribut shadow bounc unocclud regions. multipl views, occlud object cast shadow miss singl view (top right). occlud pink column white column bounc light miss singl view (lower right). addit camera displai color bleed oc- clude regions, offscreen object grazing-angl polygon (fig. 7 (bottom)). us framebuff lower resolut ad- dition cameras. therefore, memori usag fillrat remain unaffected. drawback extens vertex transfor- mation time grow linearli number cameras. scene simpl geometri (e.g. fig. 7), averag overhead camera +58% larg scene (e.g. fig. 12, 1m polygons) +160%. altern method like iso-surfac raycast point rendering, number rai resp. point view kept constant, give multipl view perform singl view. 5 integr global illumin believ screen-spac approach improv result global illumin simul case complex geometry. avoid time-consum solut origin geometry, basic idea comput global illumin coars rep- resent geometry. then, light detail quickli ad screen space runtime. demonstr idea case 1. environ map illumin 2. instant radios [keller 1997], indirect light comput re- flectiv shadow map [dachsbach stamming 2005], result set virtual point light (vpls). contrast previou applic (sec. 3), comput occlus instead small-scal shadows. therefore, indirect illumin com- pute vpl indirect visibl comput shadow map vpl. shadow mapping, simpli- fied, sampl represent scene (the depth map) creat visibl queries. additionally, depth bia ad depth valu shadow map avoid wrong self-occlusions. remov self-occlus artifacts, shadow small surfac detail contact shadow lost, especi light sourc illumin graze angle. contact shad- ow perceptu important, them, object float ground. instead appli high-resolut shadow map combin sophist method elimin bia problems, us screen-spac approach reconstruct shadow small detail contact shadows. shadow map depth bia shadow map [william 1978] gener depth textur point view light sourc compar depth valu store textur real distanc light sourc decid point shadow not. texel store depth valu pixel center, think texel small patch, locat surfac geometri (see fig. 8). orient patch parallel light source, upper half patch surface. closer light actual surface, self-occlus artifact appear (fig. 9 left). remov artifact, patch move complet surface. standard solut add depth bia b = p 2 tan(), p size patch world coordin angl light direct surfac normal (see fig. 8). patch size p comput distanc light, textur resolut open angl spot. screen space shadow correct fig. 8 show abl displai shadow small details, e.g. point p, shadow map. test framebuff pixel, occlud shadow map, miss shadow screen space. know bia b introduced, basic idea place sampl undefin region. precisely, place user-defin number sampl line segment p p + b l, l unit vector point light source. sampl point perform occlus test describ section 3 4. sampl point classifi occlud p, draw shadow correspond pixel framebuffer. way, adapt shadow precis precis visibl occluders: soon occlud visibl screen space, detect shadow screen space. occlud smaller framebuff resolut throw shadow. fig. 9 show contact shadow fill screen space. global illumin fig. 10 show ssdo natur illumination. here, environ map repres set point light shadow map light. note lost shadow small detail shadow map seamlessli recov screen space. shadow map, 8 sampl detect occlud screen space. multipli simpl ambient occlus term imag recov illumin detail correctli [stewart langer 1997]. fig. 11 show integr method instant radios simulation. again, miss contact shadow ad screen space. relat problem instant radios is, clamp avoid singular artifact receiv close vpl. add bounc light screen space nearbi geometry, shown fig. 12. estim formfactor singular too, local densiti sampl higher 10/22/2008 1 p b p n l figur 8: remov wrong self-occlusion, shadow map texel (shown red) move surfac (black). bia b depend slope incom light direction. coars shadow map resolut bias, shadow small scale geometri lost way, exampl point p . reconstruct shadows, sampl creat line segment length b, start p , direct light source. samples, us image-bas blocker test. figur 9: shadow small occlud (1024 768 framebuffer, 1024 1024 depth map), left right: depth bias, self-shadow artifact visible. classic depth bia remov wrong self-occlusion, shadow contact point disappear (218 fps). screen-spac visibl remov depth bia singl depth buffer (16 samples, 103 fps) depth peel (8 samples, 73 fps). densiti vpls. idea correct screen space extend type illumin repres vpls, e.g. illumin area light approach visibl have limit resolut rmax [lehtinen kautz 2003; ren et al. 2006; ritschel et al. 2008]. 6 result follow present results, render 3 ghz cpu nvidia geforc 8800 gtx. perform method work complet imag space, displai direct occlus indirect bounc larg scene real-tim framerates. tabl 1 show time valu factori scene (fig. 1, 537k polygons) singl camera singl depth layer. depth peel addi- tional cameras, includ direct occlus add modest overhead ssao: +3.6% +31.1% bounce. ad effect incur neglig over- head, addit diffus bounc requir littl comput time. assum shader bound bandwidth computation. figur 10: depth bia natur illumin render (512512, 54.0 fps) remov ssdo combin shadow map (25.2 fps). us 256 vpl 512 512 depth map each. figur 11: instant radios screen-spac shadow correction. shadow small details, like toes, lost depth bias. small shadow restor imag space. time-qu tradeoff includ depth peel addit camera result overhead 30% 160% test scene (2 depth layer 4 cameras). us extens time- qualiti tradeoff. environ map illumination, observ good result them, illumin come direct visibl error hidden. fig. 13 show comparison (unextended) method ground truth path trace image, gener pbrt [pharr humphrei 2004]. anim scene method oper complet im- ag space, anim scene displai restric- tions. accompani video show move color block anim object tempor flickering. 7 discuss 7.1 percept ad bounc improv percept meso-structures, bridg geometri materi consist lit way. prob- lem classic ao is, light complet ignored: ev- eryth occlud vicin darken equally, light isotropic. scenarios, like skylight (fig. 1 3), light smooth strong direct component. classic ao vari illumin introduc objec- tionabl artifact contact shadow remain static underli shade changes. result impress dirt, chang reflect (dust, dirt, patina) perceptu figur 12: instant radios shadow correct addi- tional indirect bounc screen space. note addit contact shadow color bleed effects. indirect light slightli scale addit effect visible. tabl 1: typic frame rates, nvidia geforc 8800 gtx. ssao us singl pre-filt environ map lookup instead environ lookup sampl do. overhead rel ssao alone. frame rate pure render occlus 124 fp 16001200. m set 4 4. resolut sampl time cost ssao ssdo + 1 bounc fp fp +% fp +% 1024768 n = 8 81.0 81.3 0.2 65.8 19.3 n = 16 58.0 56.5 2.6 40.5 30.2 1200960 n = 8 37.7 37.5 0.5 25.5 32.4 n = 16 25.4 23.6 7.1 14.7 22.2 16001200 n = 8 24.8 24.2 2.4 15.9 35.9 n = 16 16.8 15.3 8.9 9.0 46.4 plausibl explan equal darken vari illumination. proper do, detail meso-structur cast appropri miniatur shadow (softness, size, direction, color) relat macro-illumination, illustr fig. 3. 7.2 qualiti screen-spac approach approxim geometri 3d spa- tial proxim pixel p set nearbi pixel p 2d. requir local geometri suffici repres nearbi pixels. adjust radiu rmax hemisphere, shad- ow receiv vari distanc displayed. small radiu result shadow tiny, nearbi caviti larger shadow distant occlud displai larg hemisphere. fig. 14 show effect vari size rmax. us smooth-step function fade shadow blocker close border hemispher avoid crack shadow larg blocker partial insid hemisphere. radiu adjust manual scene, find good valu automat difficult. close polygon model, init valu rmax comput averag distanc local maxima geometry. singl depth layer, wrong shadow appear edg object (an effect similar depth darken [luft et al. 2006]) larg valu chosen rmax. happen frontmost object misclassifi occluder, shown fig. 6 left. effect enhanc appear images, sudden darken edg distract move imag (see accompani video). reduc radius, width darken edg smaller, real shadow disappear, too. depth figur 13: comparison approach one-bounc path trace result pbrt. scene illumin environ map addit point light. light shadow wrong place appear two-dimensional. halo artifact introduced, direct occlus indirect light effect present ground truth render faithfulli reproduc technique. peel solv problem, addit render time. theoret point view, shadow correctli dis- plai screen space depth peel addit camera used, scene structur captur completely. how- ever, larg radiu sampl point n avoid miss small occluders, standard techniqu like shadow map prefer distant blockers, ssdo add miss small-scal details. limit (and solutions) discuss section 4, sam- pling illumin bia affect quality. sampl p get small framebuffer, far awai appear graze angles, ssao effect vanishes. gradual increas distanc angl result smooth, tempor coher fade addit effects. increas distanc increas angl gradually, gradual fade tempor coherent. however, issu distracting: pixel belong surfac pixel size receiv bounc occlus all. still, underli problem origin ssao exampl circumv high-resolut framebuff (e.g. 16001200). bia illumin algorithm gear real- time display, accept bias solut differ physic solution. however, error reduc spend comput time. high-resolut depth buffer combin multipl camera depth peel (adjust depth complex scene), scene captur correct visibl test computed. mean ssdo comput correct illumin point increas number samples, remain error discretiza- tion visibility. bounc indirect light complicated: us project posit uniformli distribut sam- ples. projection, sampl longer follow known distribution. mean region sampl region suffer undersampling. ad depth layer multipl viewpoint sourc indirect light visi- ble, sampl distribut non-uniform. additionally, figur 14: ssdo indirect bounc differ valu rmax. case, illumin comput pointlight shadow map addit environ map. note smaller valu rmax decreas size screen-spac shadow influenc region indirect bounce. us approxim form factor. experiments, observ visibl artifact sourc error. consid unbias solut indirect light screen space futur work. conclude, method introduc addit (temporal) artifacts. worst case approach fade tradi- tional ssao equival ao worst case. expect distant bounc incid radianc suffici smooth, like skylight fig. 1. high-frequ envi- ronment map requir pre-smooth higher sampl rates. observ nois caus high frequenc chang radianc (e.g. direct shadow boundaries). 8 conclus present gener screen-spac ambient occlus add direct occlus diffus indirect bounces. extens consider improv realism best case look like unextend techniqu worst case. incur modest comput overhead introduc addit artifacts, allow real-tim displai complex dynam scenes. futur work, investig unbias comput indirect light possibl screen space. additionally, block informa- tion store pixel reus frame. possibl extens multipl indirect bounces, spec- ular materials, subsurfac scatter import sampling. think omit project step entirely: instead framebuff proxim pixels, accel- erat structur like hash tabl proxim point space. believ optim combin screen-spac object-spac approach interest avenu research bring physic plausibl illumin dynam complex scene real-tim frame rates. acknowledg thank zhao dong, derek nowrouzezahrai, karol myszkowski, tom annen anonym review us comment suggestions. anim anim sequenc courtesi mit csail, factori scene dosch design. volu- metric skull data set 3d scan univers texa austin (utct). tortil column model scan data vcl pisa, buddha model taken aim-at-shap repository. refer bavoil, l., sainz, m., dimitrov, r. 2008. image-spac horizon-bas ambient occlusion. siggraph 08: acm siggraph 2008 talks, acm, new york, ny, usa, 11. bunnell, m. 2005. dynam ambient occlus indirect lighting. gpu gem 2, m. pharr, ed. addison wesley, mar., ch. 2, 223233. christensen, p. h. 2008. point-bas approxim color bleed- ing. pixar technic memo 08-01. cook, r. l., torrance, k. e. 1981. reflect model graphics. siggraph 81: proceed 8th annual confer graphic interact techniques, acm, new york, ny, usa, 307316. dachsbacher, c., stamminger, m. 2005. reflect shadow maps. proceed acm siggraph 2005 symposium interact 3d graphic games, 203213. everitt, c., 2001. introduct interact order-independ transparency. nvidia technic report. filion, d., mcnaughton, r. 2008. effect & techniques. siggraph 08: acm siggraph 2008 classes, acm, new york, ny, usa, 133164. hoberock, j., jia, y. 2007. high-qual ambient occlu- sion. gpu gem 3. addison-wesley, reading, ma, ch. 12. keller, a. 1997. instant radiosity. proceed acm siggraph, 4956. kontkanen, j., aila, t. 2006. ambient occlus anim characters. eurograph symposium rendering. kontkanen, j., laine, s. 2005. ambient occlus fields. proceed acm siggraph 2005 symposium interact 3d graphic games, 4148. landis, h. 2002. renderman production. acm siggraph 2002 cours 16. langer, m. s., bulthoff, h. h. 2000. depth discrimi- nation shade diffus lighting. percept 29, 6, 649 660. lehtinen, j., kautz, j. 2003. matrix radianc transfer. 2003 acm symposium interact 3d graphics, 5964. lischinski, d., rappoport, a. 1998. image-bas ren- dere non-diffus synthet scenes. ninth eurograph workshop rendering, eurographics, 301314. luft, t., colditz, c., deussen, o. 2006. imag enhance- ment unsharp mask depth buffer. acm trans. graph. 25, 3, 12061213. mendez, a., sbert, m., cata, j., sunyer, n., fun- tane, s. 2006. realtim obscur color bleeding. shaderx4: advanc render techniques. charl river media, 121133. mertens, t., kautz, j., bekaert, p., reeth, f. v., seidel, h.-p. 2005. effici render local subsurfac scattering. comput. graph. forum 24, 1, 4149. mittring, m. 2007. find next-gen: cryengin 2. sig- graph 07: acm siggraph 2007 courses, acm, new york, ny, usa, 97121. pharr, m., humphreys, g. 2004. physic base ren- dere : theori implementation. morgan kaufmann. ren, z., wang, r., snyder, j., zhou, k., liu, x., sun, b., sloan, p.-p., bao, h., peng, q., guo, b. 2006. real- time soft shadow dynam scene spheric harmon exponentiation. siggraph 06: acm siggraph 2006 papers, acm, new york, ny, usa, 977986. ritschel, t., grosch, t., kim, m. h., seidel, h.-p., dachs- bacher, c., kautz, j. 2008. imperfect shadow map effici comput indirect illumination. acm trans. graph. (proc. siggraph asia 2008) 27, 5. segovia, b., iehl, j.-c., mitanchey, r., peroche, b. 2006. non-interleav defer shade interleav sampl patterns. siggraph/eurograph graphic hardware. shanmugam, p., arikan, o. 2007. hardwar acceler ambient occlus techniqu gpus. proceed acm symposium interact 3d graphic games, acm, b. gooch p.-p. j. sloan, eds., 7380. stewart, a. j., langer, m. s. 1997. accur recoveri shape shade diffus lighting. ieee transact pattern analysi machin intellig 19, 10201025. williams, l. 1978. cast curv shadow curv surfaces. proceed acm siggraph, 270274. zhukov, s., iones, a., kronin, g. 1998. ambient light illumin model. eurograph render workshop 1998, 4556.