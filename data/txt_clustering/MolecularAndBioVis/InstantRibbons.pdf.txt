






















































Instant visualization of secondary structures of molecular models


Instant visualization of secondary structures of molecular
models

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1

1 – Universitat Politècnica de Catalunya
2 – Barcelona Supercomputing Center

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Motivation

Motivation

Molecular Dynamics simulations: Computer simulations of physical
movements of atoms and molecules

Complex and time consuming process – days or weeks

New technological advances

Reduce calculation time to hours or minutes [?] [?]

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Motivation

Motivation

We intend to handle large molecular structures.

Figure: Molecule 3IYN with 6 Million atoms and 750K residues.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Objectives

Objectives

Secondary structure commonly used in pharmacology simulations.

Develop fast rendering techniques for secondary structures.

Requirements:
No pre-process required
Scalable to big molecular structures

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Outline

Outline

Background

Geometry generation

Ambient occlusion

Conclusions & Future Work

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Background

Biomolecular Background

Protein Chain of aminoacids

Aminoacids Connected by peptide bonds

Backbone Atoms connected by peptide bond

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Background

Secondary structures

Peptide bonds are not rigid and they can fold.
Hydrogen bond between non-consecutive aminoacids.
Secondary structures:

α-Helix
β-Sheet

Figure: Copyright c©Pearson Education, Inc., publishing as Pearson Benjamin Cummings

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation

Our idea

Use a B-Spline to model the backbone [?].

Two patches represent each B-Spline segment.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Overview

CPU: Pack the data and upload it to GPU.

Vertex Shader: Determine the vertex color.

TES Control Shader: Calculate the subdivision level.

TES Evaluation Shader: Move the vertexs to their final position.

Fragment Shader: Calculate the final normal.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Overview

CPU: Pack the data and upload it to GPU.

Vertex Shader: Determine the vertex color.

TES Control Shader: Calculate the subdivision level.

TES Evaluation Shader: Move the vertexs to their final position.

Fragment Shader: Calculate the final normal.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Overview

CPU: Pack the data and upload it to GPU.

Vertex Shader: Determine the vertex color.

TES Control Shader: Calculate the subdivision level.

TES Evaluation Shader: Move the vertexs to their final position.

Fragment Shader: Calculate the final normal.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Overview

CPU: Pack the data and upload it to GPU.

Vertex Shader: Determine the vertex color.

TES Control Shader: Calculate the subdivision level.

TES Evaluation Shader: Move the vertexs to their final position.

Fragment Shader: Calculate the final normal.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Overview

CPU: Pack the data and upload it to GPU.

Vertex Shader: Determine the vertex color.

TES Control Shader: Calculate the subdivision level.

TES Evaluation Shader: Move the vertexs to their final position.

Fragment Shader: Calculate the final normal.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - CPU

Vertex data:
Position of the C-α atom of the residue
Direction between the C-α atom and the O atom
Residue type

Each patch has four indexs Control points of the B-Spline
Inverted patch Same four vertexs in opposite order

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Vertex Shader

Vertex Shader Determine the color of the vertex.

Use the secondary structure type as the index to access a color array.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - TES Control Shader

Tessellation Control Shader Calculate the tessellation factor of the
patch edges, using the distance towards the camera.

Edges a1, a3 and a5 Same maximum tessellation level for all types of
secondary structures
Edges a2, a4 and a6 Different maximum tessellation level

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - TES Evaluation Shader

TES Evaluation Shader Displace vertexs.

Evaluate the B-Spline to determine the position along the segment.
Use the d and n vectors to move the vertex to its final position.
Different displacement distances for each type of secondary structure.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Fragment Shader

Fragment Shader Calculate the normal

Smooth interpolation of the normal in the border of the patch.
Avoid lighting problems with progressive tessellation.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Results

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Results

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Results

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry

Geometry generation - Results

Molecule name 3EXG 3IYJ 3IYN
#residues 10781 171720 749340
VBO update NU U NU U NU U

Our
N 1198.53 1059.86 246.47 198.72 68.98 48.41
F 2375.83 2093.71 290.35 222.94 72.51 50.19

[?]
N 263.57 254.99 14.48 14.31 3.52 3.36
F 287.75 274.18 14.46 14.56 3.54 3.39

Table: Performance measured in frames per second for different molecules (N)ear and (F)ar
from the camera. Framerates have been measured without uploading the buffers to the GPU
(NU) and uploading them (U).

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



AO

Ambient occlusion

Adapt existing ambient occlusion method to Ribbons representation
[?].

1 Build occupancy pyramid of the scene.
2 Use algorithm proposed by Crassin et al. [?] to compute the AO.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



AO

Ambient occlusion - Results

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



AO

Ambient occlusion - Results

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



AO

Ambient occlusion - Results

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



AO

Ambient occlusion - Results

Mol name A 1CWP 3IYJ 3IYN
#residues 249 29220 171720 749340

NoAO 2582.18 726.41 244.17 70.01
AO 436.83 340.64 117.18 35.06

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Conclusions and Future Work

Conclusions & Future Work

Conclusions
Algorithm to generate and render Ribbons

No pre-process required
Full GPU-accelerated pipeline (Tessellation shader)
Adaptive geometry

Adapt existing Ambient Occlusion algorithm to Ribbons

No pre-process required
Full GPU-accelerated pipeline (uses compute shader & atomic
operations)
High quality shading in real-time

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Conclusions and Future Work

Conclusions & Future Work

Conclusions
Algorithm to generate and render Ribbons

No pre-process required
Full GPU-accelerated pipeline (Tessellation shader)
Adaptive geometry

Adapt existing Ambient Occlusion algorithm to Ribbons

No pre-process required
Full GPU-accelerated pipeline (uses compute shader & atomic
operations)
High quality shading in real-time

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Conclusions and Future Work

Conclusions & Future Work

Future Work

Formal user study
Adapt the algorithm to improve the rendering of other data types.

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



References

Armin Madadkar-Sobhani and Victor Guallar (2013)

Pele web server: atomistic study of biomolecular systems at your fingertips

Nucleic Acids Research 41(W1):W322–W328

K. W. Borrelli, A. Vitalis, R. Alcantara, and V. Guallar (2005)

Pele: Protein energy landscape exploration. a novel monte carlo based technique

Journal of Chemical Theory and Computation 1(6):1304–1311

Krone, Michael and Bidmon, Katrin and Ertl, Thomas (2008)

GPU-based Visualisation of Protein Secondary Structure

TPCG 8:115–122

P. Hermosilla and V. Guallar and A. Vinacua and P.P. Vázquez (2015)

High quality illustrative effects for molecular rendering

Computers & Graphics

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



References

C. Crassin, F. Neyret, M. Sainz, S. Green, and E. Eisemann (2011)

Interactive indirect illumination using voxel cone tracing

Computer Graphics Forum (Proceedings of Pacific Graphics 2011)

Carson, Mike (1991)

RIBBONS 2.0

Journal of Applied Crystallography) 24(5): 958-961

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Instant visualization of secondary structures of molecular
models

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1

1 – Universitat Politècnica de Catalunya
2 – Barcelona Supercomputing Center

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Geometry generation - Arrows

Identify arrow segments Float value that increase along the
backbone

Patch distance Triangle function

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models



Ambient occlusion

Approximate the backbone segment by
three boxes.

Execute compute shader to fill the
occupancy pyramid.

Intersection test
Occupancy approximation

P. Hermosilla 1,2 & V. Guallar 2 & A. Vinacua1 & P.P. Vázquez 1 UPC

Instant visualization of secondary structures of molecular models


