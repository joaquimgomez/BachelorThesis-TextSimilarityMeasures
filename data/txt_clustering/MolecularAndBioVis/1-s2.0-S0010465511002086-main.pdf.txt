







































































A modern workflow for force-field development – Bridging quantum mechanics and atomistic computational models


Computer Physics Communications 182 (2011) 2184–2191
Contents lists available at ScienceDirect

Computer Physics Communications

www.elsevier.com/locate/cpc

A modern workflow for force-field development – Bridging quantum mechanics
and atomistic computational models

Dirk Reith, Karl N. Kirschner ∗

Fraunhofer Institute for Algorithms and Scientific Computing (SCAI), Department of Computational Chemistry Engineering, Schloss Birlinghoven, 53754 Sankt Augustin, Germany

a r t i c l e i n f o a b s t r a c t

Article history:
Received 1 March 2011
Received in revised form 26 May 2011
Accepted 28 May 2011
Available online 13 June 2011

Keywords:
Atomistic force fields
Parameter optimization
Scientific workflows
Multiscale modeling

In this article we present our recent efforts in designing a comprehensive consistent scientific workflow,
nicknamed Wolf2 Pack, for force-field optimization in the field of computational chemistry. Atomistic
force fields represent a multiscale bridge that connects high-resolution quantum mechanics knowledge
to coarser molecular mechanics-based models. Force-field optimization has so far been a time-consuming
and error-prone process, and is a topic where the use of a scientific workflow can provide obvious great
benefits. As a case study we generate a gas-phase force field for methanol using Wolf2 Pack, with special
attention given toward deriving partial atomic charges.

© 2011 Elsevier B.V. All rights reserved.
1. Introduction

Multiscale modeling in computational chemistry has existed for
∼50–60 years, arising in part from the development of quantum
mechanics-based atomistic force fields. Through high-resolution
quantum mechanics (QM) methods one can investigate how elec-
trons behave about nuclei. Among the large number of possibili-
ties, such studies provide ground-state information on the poten-
tial energy and geometry of stationary points, molecular electro-
static potentials (MEP), and vibrational frequencies. At a coarser
level, needed to access larger systems, Newtonian physics-based
atomistic models, used in molecular mechanics (MM) and molec-
ular dynamics (MD) simulation, allow one to investigate atomistic
behavior without the need to compute the costly electronic inte-
grals required in QM methods. However, reliable atomistic MM and
MD models require accurate force fields, which are often optimized
using QM data and validated using experimental data. In this way,
force fields serve as a bridge that transfers QM-gained knowledge
to atomistic MM-based models.

Force-field development is a time-consuming process involving
multiple steps and data transferal. It is the basis of any meaningful
application-type study. Therefore, one of the primary goals of our
research is to develop accurate and reliable atomistic force-field
parameters in a reasonable time and as error free as possible. To
accomplish this we have created a scientific Workflow for force-
field optimization package (Wolf2 Pack) that incorporates our be-

* Corresponding author.
E-mail addresses: dirk.reith@scai.fraunhofer.de (D. Reith),

karl.kirschner@scai.fraunhofer.de (K.N. Kirschner).
0010-4655/$ – see front matter © 2011 Elsevier B.V. All rights reserved.
doi:10.1016/j.cpc.2011.05.018
liefs for how QM-gained knowledge should be transferred to MM
models. We define a scientific workflow as a series of independent
steps that are linked together “according to the data flow and de-
pendencies between them” [1], and implemented through the use
of tailor-made scripts and algorithms. The benefits of utilizing sci-
entific workflows is clear for they a) save time by automating cer-
tain tasks, b) make force-field development (almost) deterministic
and reproducible, thereby reducing human error, c) enable tasks
to be executed in a distributed environment, d) can accommodate
ideas, algorithmic changes, and updates that take place within each
step, and finally e) accelerate and transform the scientific-analysis
process [1–3]. From a community service perspective, Wolf2 Pack
can be used to significantly reduce the real time needed for force-
field development and allows nonspecialists access to more stan-
dardized optimization procedures. From a scientific perspective, it
allows researchers to focus more on scientific issues, and due to
its hierarchical organization, errors are better avoided and specific
improvements will be easier to accomplish.

In this contribution, we will introduce how Wolf2 Pack works
by way of optimizing parameters for methanol as a case study, fo-
cusing on partial atomic charges, relative potential energy curves,
and geometries. Importantly, we state the real time needed for
performing the overall task. Furthermore, we will demonstrate the
impact that different partial atomic charges have on the dipole mo-
ment vector and the potential energy curves. Clearly, we do not
present the first ever force field for methanol. Such a well known
small molecule was merely chosen for this case study because it
serves as a specific example that is simple enough to allow a full
disclose of our procedure. In doing so, the emphasis on the sci-
entific workflow should become very clear, as well as the benefits

http://dx.doi.org/10.1016/j.cpc.2011.05.018
http://www.ScienceDirect.com/
http://www.elsevier.com/locate/cpc
mailto:dirk.reith@scai.fraunhofer.de
mailto:karl.kirschner@scai.fraunhofer.de
http://dx.doi.org/10.1016/j.cpc.2011.05.018


D. Reith, K.N. Kirschner / Computer Physics Communications 182 (2011) 2184–2191 2185
Fig. 1. Workflow for an atomistic force-field optimization.

of the collection of tools we need to quickly and reliably develop
high-accuracy force fields.

The creation of tools for optimizing intramolecular force con-
stants has previously been done by other groups. Several research
groups have developed programs that are suited for their inter-
ests, such as TORSFIND [4], Parmscan [5], fit dihedrals [6], and
ForceFit [7]. Our goal in developing Wolf2 Pack is to create a user-
friendly and user-driven package that addresses modern force-field
parameterization issues. Wolf2 Pack is designed to interface with
several existing MD packages (e.g. AMBER, GROMACS), allowing
user to develop balanced parameters that are missing from the
force fields within those packages.

2. Scientific workflow & case study

Part of the difficulty in force-field development arises from the
number of sequential interdependent steps needed to transfer the
QM-gained knowledge to the classical atomistic level. Further dif-
ficulties arise from the pure research aspects (e.g. choice of theory
levels, which training molecules to use, how to validate). Most
importantly, it is time consuming largely due to the manual in-
tervention needed (e.g. editing files, transferring data from one
program to another) and the execution of many computational
jobs. Fortunately, through the creation of a workflow, the difficulty
of executing sequential steps and the time required for file creation
and editing, which is needed to move between these steps, can be
greatly reduced. Through job parallelization, the real time needed
to run the computations is also greatly reduced. Thus, a scientific
workflow enables the researcher to better use his or her time to
address research aspects. Wolf2 Pack, diagrammed in Fig. 1, is an
example of such a workflow that incorporates our philosophy for
force-field development.

Our philosophy’s foundation is that parameter optimization
should be human driven throughout the entire process. One could
view this issue as a purely mathematical problem, where all pa-
rameters are treated as fully adjustable and the optimization pro-
cedure as a numerical problem. In doing so, nearly any molecular
system can have a force field generated whose performance can
be measured with high precision. However, this approach loses the
link between the physical basis behind the behavior of a given
degree of freedom and its parameter value. The parameters are
also less transferable in the sense that their accuracy is dependent
upon what molecules and target observables (e.g. relative energies,
density, diffusion rates) were used in the optimization procedure.
Instead, a scientist can steer the parameter optimization procedure
such that it maintains the link between a given parameter and its
physical origin. Thus, the optimization goal turns from generating
parameters that reproduce molecular behavior to generating pa-
rameters that reproduce the underlying physics, and thus capturing
the molecular behavior in the process. We feel that this approach
results in parameters that are more transferable and best represent
the bridge between the QM-gained knowledge and the coarser MM
models. It also allows for easier parameter refinement for when in-
accuracies are uncovered during a research investigation due to its
more localized approach toward describing each degree of free-
dom.

In the following, we will demonstrate our envisioned proce-
dure using the methanol molecule. It serves as a simple but still
demanding test case to ease the understanding of our meta-level
ideas for the reader.

2.1. Workflow

2.1.1. Workflow Steps 1–3: Foundation setup
In the first step, a structure and its conformation are se-

lected – such as methanol with an H–C–O–H torsion angle of 180◦ .
The structure’s coordinates can come from experimental (e.g. mi-
crowave or X-ray data) or theoretical data (e.g. from a previous
quantum optimization). In this case we used PyMOL [8] to create
methanol with a 180◦ torsion angle, ran a HF/6-31G(d) geometry
optimization, and verified it was a minimum through a frequency
analysis. Generally speaking, using the global minima, or another
low-energy conformation, will help to ensure that the resulting op-
timized force field best reproduces the geometry and energetics of
the highest populated conformations. This is trivial for methanol;
however, for molecules that have multiple minima it may be nec-
essary to computationally search for the global minima if it is
experimentally unknown. The resulting QM-optimized conforma-
tion will be used as the input for generating other conformations
in Step 3.

Step 2, determining the final atomic sequence, is required for
maintaining a consistent atomic ordering throughout the workflow.
This enables the transfer of geometric data easily and reduces the
likelihood of errors. It also allows for root-mean-squared deviation
(RMSd) calculations and structure overlays to be done in a system-
atic manner.

In Step 3, N conformations are generated along the reaction
coordinate of the investigated degree of freedom. For bond and an-
gles the conformations sampled should be along the expansion and
contraction pathways extending from the minimum. The confor-
mations for torsion angles should be systematically made such that
the relevant minima and maxima are sampled during the bond
rotation. For methanol, we chose to sample the bond and angle
potential energy surface every 0.01 Å and 2◦ (e.g. Fig. 2), while the
torsion angle was sampled every 30◦ (Fig. 3).

2.1.2. Workflow Steps 4 and 5: QM-constrained geometries and energies
The conformations generated in Step 3 are individually opti-

mized using quantum mechanics, while constraining the specific
degree of freedom. The goal here is to obtain reliable geome-
tries and energetics along the specified reaction coordinate. Clearly,
a single method can be used to obtain both reliable geometries
and energetics; however, this is typically at the cost of computa-
tional power and calculation time. Thus, it is advantageous to use
an “inexpensive” method for obtaining geometries (Step 4) and a
more “expensive” method for obtaining energies (Step 5). As can
be seen in Fig. 3, the relative potential energy curves can differ
greatly from one theory to another.

For methanol, we have used HF/6-31G(d) to perform the con-
strained optimizations due to its reasonable reproduction of ex-
perimental geometries at a low cost (Table 1). For energetics we
have performed B3LYP/6-311++G(2d,2p) single self-consistent field



2186 D. Reith, K.N. Kirschner / Computer Physics Communications 182 (2011) 2184–2191
Fig. 2. Relative potential energy curves for methanol’s (a) C–O stretching and (b) C–
O–H bending as determined by B3LYP/6-31++G(2d,2p) (black circles), and optimized
force field with RESP

HF/ACCT
C (blue closed squares) and OPLS (red open squares)

charge sets. Energies are reported in kcal mol−1, distances are in Angstrom, and
angles are in degrees.

calculations on the HF/6-31G(d) geometries due to our past use of
this theory in force-field development [9]. Furthermore, it has been
shown by Allinger and coworkers that B3LYP/6-311++G(2d,2p) pro-
vides reliable energetics for systems involving alcohol functionali-
ties [10].

2.1.3. Workflow Steps 6 and 7: Determining partial atomic charges
This is the first instance where we transfer the QM-knowledge,

the molecular electrostatic potential, to a classical representation
of that knowledge, partial atomic charges (Table 2). Partial atomic
charges are not an experimental or QM observable, however one
can obtain the MEP directly from a quantum wavefunction. We
also want the partial atomic charges to be reproducible and consis-
tent across similar chemical environments (e.g. the carbonyl group
in R1–C(=O)–R2, where R1,2=–CnH2–CH3). Thus, we have chosen
to calculate the charges by fitting them to a MEP using the RESP
methodology as implemented in R.E.D. [11–14].

For methanol we have generated several RESP charge sets using
a variety of QM level (Table 2). The RESP

HF/ACCT
C charge set provides

a dipole moment of 1.80 debye and is closest to the experimental
magnitude of 1.69 debye [15,16], while providing charge equiva-
lent methyl hydrogens (see Section 3 for discussion). Conversely,
RESP

HF/STO-3G
C and OPLS charges provide dipole moments of 1.53

and 2.24 debye, which represent the largest deviations from ex-
periment. Ultimately, we chose the RESP

HF/ACCT
C charge set because
Fig. 3. Potential energy curves for methanol’s H–C–O–H torsion rotation as deter-
mined using HF/6-31G(d) (triangles), B3LYP/6-31++G(2d,2p) (circles), and the force
field (square). MM curve generated using a V 3 = 0.00 (a) and a V 3 = 0.17 (b). En-
ergies are reported in kcal mol−1 and angles are measured in degrees.

it best reproduces methanol’s experimental dipole moment while
using equivalently charged methyl hydrogens.

2.1.4. Workflow Steps 8: Generating the classical model
To incorporate the partial atomic charges into our classical

model, we generate mol2 files, one for each constrained QM op-
timization, which will be used in the MM calculations (Step 9).
Atom types are also assigned at this stage. These mol2 files in-
cludes the atom labels, the atomic coordinates, atom types, and
partial atomic charges. In AMBER, mol2 files can be used to cre-
ate the topology files needed for MM minimizations. As such,
the mol2 file and atom type assignment for methanol can be
found in the Supplementary information of the online version at
doi:10.1016/j.cpc.2011.05.018.

2.1.5. Workflow Steps 9: MM-constrained geometries and energies
In Step 9 we perform constrained MM optimizations. The ini-

tial bond and angle force constants are set to reasonable values,
such as a value from closely related parameters or borrowed from
a similar force field, while the natural or equilibrium lengths (req)
and angles (θeq) are set to the QM-optimized value (Eq. (1)). The
torsion force constants are set to zero. Since the QM-optimized co-
ordinates are used as input for the MM calculations, the resulting
geometries and relative energies can be compared directly to one
another.
Table 1
Methanol structure and methyl rotation barrier as determined by experimental, quantum mechanical, and molecular mechanics methods.a

Degree of freedom Exp. 1b Exp. 2c HF/STO-3G HF/6-31G(d) HF/ACCD HF/ACCT

C–Hd 1.0936 ± 0.0032 1.095 ± 0.010 1.094 1.085 1.091 1.084
C–O 1.4246 ± 0.0024 1.428 ± 0.003 1.433 1.400 1.405 1.399
H–O 0.9451 ± 0.0034 0.960 ± 0.015 0.991 0.946 0.942 0.939
C–O–H 108.32 ± 0.29 103.8 109.4 109.9 110.2
H–C–Hd 108.38 ± 0.42 109 ± 3 108.1 108.5 108.7 108.6
H–C–O–H 61.1 61.2 61.2 61.2

Torsion Barrier 1.07 2.013 1.359 1.125

MP2/6-31G(d) MP2/ACCD MP2/ACCT OPLS RESP
HF/STO-3G
C RESP

HF/ACCT
C

C–Hd 1.095 1.100 1.089 1.097 1.096 1.096
C–O 1.424 1.435 1.423 1.432 1.428 1.428
H–O 0.970 0.966 0.961 0.961 0.960 0.960
C–O–H 107.4 107.7 108.0 109.5 109.5 109.5
H–C–Hd 108.6 108.9 108.8 108.8 109.0 109.0
H–C–O–H 61.5 61.5 61.4 60.2 60.0 60.0

Torsion Barrier 1.485 1.132 1.00 1.05 1.02 1.02

a Reported distances, angles, and energetics are in Angstrom, degrees, and kcal mol−1.
b Obtained from a millimeter-wave spectrum [22].
c Obtained from an electron diffraction method [23].
d Average values are reported.

http://dx.doi.org/10.1016/j.cpc.2011.05.018


D. Reith, K.N. Kirschner / Computer Physics Communications 182 (2011) 2184–2191 2187
Table 2
Partial atomic charges and dipole moments (μ, in debye) for methanol as determined by a number of approaches.

OPLSa RESP
HF/6-31G(d)
A RESP

HF/6-31G(d)
B RESP

HF/6-31G(d)
C RESP

HF/6-31G(d)
D Orig.

b RESP
HF/6-31G(d)
D

Htrans 0.040 0.0411 −0.0008 0.0000 0.0072 0.0372
Hgauche 0.040 −0.0218 −0.0008 0.0000 0.0072 0.0372
C 0.145 0.2562 0.2561 0.2434 0.2164 0.1166
O −0.683 −0.6741 −0.6741 −0.6194 0.6141 −0.6498
H 0.418 0.4204 0.4204 0.3760 0.3761 0.4215

RRMSc 0.241 0.135 0.201 0.178 0.179 0.1672

μa 1.268 0.963 0.965 0.977 0.980 0.999
μb 1.852 1.551 1.858 1.667 1.666 1.853
μd 2.24 (32.5%) 1.83 (8.3%) 2.09 (23.7%) 1.93 (14.2%) 1.93 (14.2%) 2.14 (26.6%)

RESP
HF/STO-3G
C RESP

HF/ACCD
A RESP

HF/ACCD
B RESP

HF/ACCD
C RESP

HF/ACCT
A RESP

HF/ACCT
C

Htrans 0.0000 0.0271 −0.0172 0.0000 0.0234 0.0000
Hgauche 0.0000 −0.0394 −0.0172 0.0000 −0.0421 0.0000
C 0.1705 0.3076 0.3075 0.2323 0.3177 0.2309
O −0.4453 −0.6559 −0.6559 −0.5872 −0.6565 −0.5863
H 0.2748 0.4000 0.4000 0.3549 0.3996 0.3554

RRMSc 0.156 0.186 0.226 0.185 0.224

μa 0.791 0.921 0.921 0.936 0.899 0.913
μb 1.315 1.434 1.759 1.563 1.431 1.557
μd 1.53 (−9.5%) 1.70 (0.6%) 1.99 (17.8%) 1.82 (7.7%) 1.70 (0.6%) 1.80 (6.5%)

RESP
MP2/6-31G(d)
A RESP

MP2/6-31G(d)
C RESP

MP2/ACCD
A RESP

MP2/ACCD
C RESP

MP2/ACCT
A RESP

MP2/ACCT
C

Htrans 0.0509 0.0000 0.0407 0.0000 0.0336 0.0000
Hgauche −0.0087 0.0000 −0.0243 0.0000 −0.0303 0.0000
C 0.2135 0.2468 0.2560 0.2368 0.2779 0.2349
O −0.6570 −0.6151 −0.6379 −0.5832 −0.6407 −0.5823
H 0.4101 0.3686 0.3898 0.3464 0.3898 0.3475

RRMSc 0.130 0.168 0.181 0.218 0.180 0.216

μa 1.074 1.085 1.046 1.058 1.012 1.024
μb 1.588 1.700 1.461 1.590 1.459 1.583
μd 1.92 (13.7%) 2.02 (19.5%) 1.80 (6.5%) 1.91 (13.0%) 1.78 (5.3%) 1.89 (11.8%)

a OPLS [24] partial atomic charges used with HF/6-31G(d) geometry.
b Partial atomic charges, RRMS, and μ are reproduced from Table VII in Ref. [11].
c Relative root-means-square value between the QM computed MEP and that defined by the partial atomic charges.
d Experimental dipole is 1.69 debye, with μa and μa components of 0.889 and 1.39 debye [15,16]. Percent error relative to the experimental value is shown in parentheses.
2.1.6. Workflow Steps 10: Parameter optimization
Step 10 is the second instance where we transfer the QM-

gained knowledge (i.e. geometries) to the classical model. It is in
this step that optimization of the bond, angle, and torsion force
constants takes place. At this point all of the QM and initial MM
data has been assembled and generated.

Obtaining properly optimized parameters is critical for bridg-
ing the QM and atomistic resolution levels. One possibility is the
use of an algorithm that adjusts the parameter such that the MM
potential energy curve and geometries come into agreement with
the QM data. For this purpose, we use Gnuplot’s least-squares-fit
solver to obtain an initial sampling of possible dihedral parameter
solutions [17]. Note, that for these degrees of freedom the poten-
tial function was truncated after the V 3 term because we have
found that this sufficiently reproduces nearly all QM data observed
so far. A workflow that allows quick iterations of Step 9’s con-
strained MM optimization allows the researcher the unique ability
to steer the parameters toward values that he or she deem to best
reproduce important regions of the potential energy surface (e.g.
transition state regions, specific minima). Through manual param-
eter adjustments and reiterating Step 9, the researcher uses his
or her chemical intuition in the optimization process, and thus
help ensure all parameters maintain some physically interpretable
meaning.

In total for methanol, 116 QM-constrained optimization and
116 single self-consistent field calculations were used to derived
the parameters reported in Table 3. For illustration, Fig. 3 dis-
plays a pre- and post-force field optimized relative potential en-
ergy curves for the H–C–O–H torsion rotation; both HF/6-31G(d)
and B3LYP/6-311++G(2d,2p) relative energies are included. Fig. 2
displays the relative energy for C–O stretching and C–O–H bending
as computed by B3LYP/6-311++G(2d,2p), and the force field using
RESP

HF/ACCT
C and OPLS charge sets.

Since we know an experimental value for methanol’s methyl
rotation, we used this knowledge during the optimization of the
H–C–O–H parameter. Included with the QM relative potential en-
ergies (Step 4), the constrained QM geometry at each point along
each curve were used in optimizing the parameters by minimizing
the RMSd between the QM and MM optimized structures. Com-
paring the energetic and geometric data between the QM and
MM constrained optimized structures at all 116 computed con-
formational points, an RMSd value of 0.027 Å, using HF/6-31G(d)
geometries, and a 0.30 kcal mol−1 absolute energy difference,1 us-
ing B3LYP/6-311++G(2d,2p) relative energies, is obtained for the
force field (Table 3) using the RESP

HF/ACCT
C charge set (Table 2). If

only the minima are considered, then an absolute energy error of
0.04 kcal mol−1 is obtained.

2.1.7. Workflow Steps 11: Validation
The final step in the workflow is the validation of the optimized

parameters. One validation method is to generate QM potential

1 |Energy Error| = |(QM Relative Energy) − (MM Relative Energy)|.



2188 D. Reith, K.N. Kirschner / Computer Physics Communications 182 (2011) 2184–2191
Table 3
Force-field parameters for methanol.a

Bond Kl lo Angle Kθ θo

C–O 350.0 1.428 C–O–H 55.0 109.5
C–H 410.0 1.096 H–C–O 60.0 110.0
O-H 730.0 0.960 H–C–H 40.0 109.0

Torsion V 1 V 2 V 3

H–C–O–H 0.0 0.0 0.17

OPLS L-Jb σ �

C 1.964 0.066
H (C) 1.403 0.030
H (O) 0.000 0.000
O 1.751 0.170

a Bond length, bond angle, and torsion constants are in kcal mol−1 Å−2,
kcal mol−1 rad−2, and kcal mol−1.

b OPLS [24] Lennard-Jones parameters converted for use in AMBER’s pairwise
combining rules.

energy curves involving the degrees of freedom investigated, but
using molecules that were not part of the training set. If a trans-
ferable force field is desired, then these curves should be repro-
duced by the force field over a wide range of test molecules. How-
ever, the ultimate validation comes from comparing the computa-
tional results to experimental data. The choice of such data should
come from experimental studies that are similar to the study
that the force field will be implemented for – such as gas-phase
or solution-phase data at standard temperature and pressure, or
data from a phase coexistence curve. Among the most popular
experimental data used for validation includes experimental ge-
ometries (e.g. obtained from microwave data, crystallization, NMR),
dipole moments, vibrational frequencies, conformational popula-
tions, densities, enthalpy of vaporizations, and diffusion rates. Each
type of experimental data allows for a unique validation. For ex-
ample, the use of microwave geometries and moments of inertias
will indicate how well the gas-phase minima are reproduced. NMR
data can be used to help validate the intramolecular parameter be-
havior for solvated molecules. The use of density and enthalpy of
vaporization can help validate intermolecular parameter behavior.

For methanol, our illustration goal was to generate a force field
that can reproduce experimental gas-phase geometries, dipole mo-
ment, and energetics. Table 1 provides methanol’s geometry as
determined by two experiments, optimized at seven different QM
levels, and optimized using the force field with three different
charge sets; these charge sets include RESP

HF/ACCT
C , RESP

HF/STO-3G
C ,

and OPLS. A fully optimized MM structure, using the optimized pa-
rameters and the RESP

HF/ACCT
C charge set, yields a structure that is

nearly identical to one determined by electron diffraction and has
an average error of 0.74% with respect to the microwave structure.
Also, the RESP

HF/ACCT
C derived dipole moment has a 1.5

◦ devia-
tion in the vector orientation with regards to the experimental
measurement. For the purpose herein, these values validate the
optimized force field. Note, that we did not investigate intermolec-
ular interaction, which would be the next obvious step. This will
likely require optimization of the Lennard-Jones parameters, and is
a future task that is well suited for our global optimization strate-
gies [18] and for our GROW algorithm [19–21].

3. Highlighting RESP-derived partial atomic charges

There are several approaches for determining partial atomic
charges for MM calculations. Within the AMBER community, the
use of RESP-derived charges has been favored for condensed-phase
biological MD simulations [9,11,12]. RESP can be implemented
with different hyperbolic weights for the fitting process [11]. For
example, both Connolly and CHELPG computed MEPs have been
Fig. 4. Dipole moment vectors as computed using the partial atomic charges from
(a) RESP

HF/6-31G(d)
A (blue), RESP

HF/6-31G(d)
B (green), as well as RESP

HF/6−31G(d)
C and

RESP
HF/6−31G(d)
D (both shown in red due to near equivalent values), and from

(b) OPLS (red), RESP
HF/STO-3G
C (green), RESP

MP2/ACCT
C (blue), and experiment (yellow)

[15,16]. (For interpretation of the references to color in this figure legend, the reader
is referred to the web version of this article.)

used for RESP fitting [9,11,12]. HF/6-31G(d) is a common theory
used to generate MEP for RESP input [25,26], however we have
also used HF/cc-pVTZ theory in the development of Gycam06 [9].
In some cases, a single conformation is used to generate the MEP,
while in other cases multiple conformations are used [27,9]. It is
common to include every atom in the RESP fitting process, how-
ever in our development of Glycam06, we restricted aliphatic hy-
drogens to have partial atomic charges of zero [9].

In this study we have computed several RESP charge sets for
methanol. In one of the original RESP studies, methanol was
used to study how different weighting functions and different
charge averaging methods (i.e. RESP

HF/6-31G(d)
A , RESP

HF/6-31G(d)
B , and

RESP
HF/6-31G(d)
D ) effect the charges and dipole moment magnitude

[11]. Herein, we revisit a portion of this early study by using the
improved RESP approach as implemented in R.E.D. and by using
the CHELPG algorithm to generate the MEP, and we extend the
study by examining how different basis sets and the use of MP2
theory effect the RESP-determined partial atomic charges. For the
first time, to our knowledge, we include an examination how these
different RESP approaches affect the dipole moment orientation.

RESP-derived charges, as determined using several different QM
levels, are provided in Table 2. The RESP-derived dipole moments,
both magnitudes and component vector orientations with respect
to methanol’s center of mass, are also included in this table. The
OPLS charge set and its resulting dipole moment, as computed
using the HF/6-31G(d) optimized geometry, are also included for
comparison. HF/6-31G(d) was used by Jorgensen and coworkers in
developing the OPLS parameters, and as such it is best suited for
determining the OPLS dipole moment and orientation [24]. Fig. 4
provides a graphical representation of selected dipole moments for
illustration of the variation seen by different approaches.

The original methanol charges (Table 2: Orig. RESP
HF/6-31G(d)
D )

are significantly different then the analogous charge set produced
in this study. In the current study the methyl hydrogen charges
are five times smaller and the carbon charge is twice as large as
those computed by Kollman and coworkers in 1993. The difference
in charge distribution is also seen in the dipole moment magni-
tude, where the original study found a value of 2.14 debye [11]
compared to the current value of 1.93 debye. This larger molecu-
lar dipole was seen advantageous for use in hydrophilic solution-
phase simulations since it approximates the effect of polarization
[28,26]. Nevertheless, our current goal is to reproduce gas-phase
observables and as such this RESP approach is undesirable. As seen
in Table 2, the original 1993 charge set provides the second worse
dipole moment in comparison to the experimental value of 1.69
debye [15,16]. The discrepancy between the original RESP-derived
charge set and the one presented here is likely due to the use of a
CHELPG MEP and the use of multiple reorientations in generating
the MEP as implemented in R.E.D.



D. Reith, K.N. Kirschner / Computer Physics Communications 182 (2011) 2184–2191 2189
The relative root mean squared deviation (RRMS) of the fit be-
tween the RESP-derived partial atomic charges and the QM MEP
is an indicator of the overall fit quality [11,29]. Based on this cri-
teria alone, we see from Table 2 that the RESP charges obtained
using the HF/6-31G(d) and MP2/6-31G(d) MEP, and allowing ev-
ery atom to be uniquely assigned a partial atomic charge (i.e.
Method A) provides the lowest RRMS value. Unfortunately, allow-
ing each atom to be uniquely assigned a charge is impractical for
most force fields since they will be used in MD simulations where
conformational sampling occurs. Thus, we examine different ap-
proaches for equivalencing the methyl hydrogen charges. As seen
for the use of HF/6-31G(d) MPE, a posteriori averaging (Method B)
of the hydrogens provides a higher RRMS then averaging done dur-
ing the fitting process (i.e. Method C and D). (We also perform
a a posteriori summation of the hydrogens’ charges into the car-
bon atom, yielding hydrogen charges of 0.0 and a carbon charge
of 0.2537, but this did not alter the results seen in Method B’s av-
eraging.) Furthermore, enforcing the hydrogens to have the same
charge during the fitting process (i.e. Method C or D) produced the
same RRMS values. Therefore, enforcing charge equivalency on the
hydrogens, by any means and regardless of the use of HF, MP2, or
the size of the basis set, increases the RRMS value. This confirms
the trend that was seen in the original methanol study using the
HF/6-31G(d) MEP and Methods A, B, and D [11].

While RRMS values provide an indication of the QM MEP re-
production quality, they do not indicate which charge set best
reproduces experimental observables. Recall that the goal of de-
termining partial atomic charges is to provide a classical model
that best mimics nature. Ideally, the QM wavefunction contains in-
formation that can be observed experimentally. Practically, current
solution to Schrödinger’s equation can only be realized through
approximations (e.g. Born–Oppenheimer, basis sets, treatment of
electrons correlations), resulting in errors in its solutions. There-
fore, one must validate a QM theory (e.g. HF, MP2, DFT), and its
use with a given basis set, with regards to how it reproduces ex-
perimental results. While an RRMS analysis indicates how well the
charges reproduce a given QM MEP, the QM method itself also
requires validation. Toward this end, dipole moments are an excel-
lent gas-phase experimental observable for gauging the suitability
of RESP-generated charges for use in gas-phase MM-based calcula-
tions.

For the theory levels explored in Table 2, the RESP
HF/ACCD
A and

RESP
HF/ACCT
A charge sets best reproduce the experimental dipole

magnitude, with errors of 0.6%, even though these charges sets
have RRMS values that are higher than other approaches using
smaller basis sets (e.g. RESP

HF/6-31G(d)
A and RESP

HF/STO-3G
C ). Further-

more, improved electron correlations treatment worsens the agree-
ment slightly, yielding errors of 6.5% and 5.3%.

An experimental dipole moment and its vector components
have been determined using laser-Stark spectrum and microwave
data, providing a magnitude of 1.69 debye, and μa and μa of 0.885
and 1.44 debye [15,16]. As mentioned above, charge equivalency
worsens the RESP dipole agreement to experimental value; here it
is clear that one should not average the charges a posteriori as it
provides the worst RESP-derived dipole values (RESP

HF/6-31G(d)
B =

2.09 debye and RESP
HF/ACCD
B = 1.99 debye). The use of HF/STO-3G

MEP significantly underestimates the dipole magnitude, which is
the only theory to do so. Interestingly, the OPLS charges provides
a dipole moment magnitude of 2.24 debye, which is the worse
of any charge set studied. This is because the OPLS charges were
empirically derived for the solution phase and not intended for a
gas-phase study. Regardless, these charges provide us an extreme
case that can be used for putting the other values into perspective.

Orientation of the dipole vector also requires some considera-
tion. In considering the RESP-derived dipole moments using HF/6-
31G(d) MEP, using all four Methods, there are three distinguish-
able dipole orientations, as indicated by the μa and μa compo-
nents (Table 2) and shown in Fig. 4(a). Considering the vectors
that are most divergent, those determined by RESP

HF/6-31G(d)
A and

RESP
HF/6-31G(d)
B , an angle of 4.8

◦ is formed between them. With
regards to the experimental dipole orientation, the RESP

HF/6-31G(d)
A

dipole is within a 0.5◦ agreement while the RESPHF/6-31G(d)B dipole
has a 4.4◦ deviation. Fig. 4(b) displays the experimental dipole ori-
entation determined by the OPLS, RESP

HF/STO-3G
C , and RESP

MP2/ACCT
C

charge sets. It is clear from Fig. 4 that the magnitude of the dipole
moment changes significantly with different RESP approach, but
the dipole orientation is effected to a lesser degree. As described
above, the RESP

HF/ACCT
C charge set yields a dipole moment that is

within 6.5% of the experimental magnitude and has an angle de-
viation of 1.5◦ . Considering the requirement to have the methyl
hydrogen equivalent, RESP

HF/ACCT
C represents an optimal charge set

for a gas-phase MM study.
An obvious question is, “How much of an effect does altering

the partial atomic charges have on potential energy surfaces?” To
explore this question, we recomputed all of methanol’s relative po-
tential energy curves using the OPLS charge set and compared the
results to the curves computed using the RESP

HF/ACCT
C charge set.

Fig. 2 displays the C–O stretching and C–O–H bending curves as
computed using both charge sets, as these two curves displayed
the most significant changes. As can be seen, the differences are
only subtle and due to the small differences in atomistic charges
that are involved in 1–4 interactions (i.e. the methyl hydrogens and
the hydroxyl hydrogen). It is likely that larger differences will be
observed for molecule that are more sterically hindered and when
larger changes occur in the partial atomic charges. Fortunately, val-
idation of different charges sets, and subsequent reoptimizing of a
force field if necessary, becomes an easier task with the use of
Wolf2 Pack.

4. Technical details for case study

4.1. Quantum mechanics calculations

All geometry optimizations were performed using the restricted
closed-shell Hartree–Fock (HF) and Møller–Plesset second order
perturbation (MP2) theory levels to a gradient convergence toler-
ance of 0.000001 Hartree Bohr−1. Constrained optimizations were
performed by specifying the internal coordinate that was frozen
while all other degrees of freedom were allowed to relax fully.
Single self-consistent field calculations were also performed us-
ing Becke three parameter Lee–Yang–Parr hybrid density function
(B3LYP). The following four basis sets were used in the study:
STO-3G (14 basis functions), 6-31G(d) (38 basis functions), aug-cc-
pVDZ (86 basis functions, abbreviated as ACCD), 6-311++G(2d,2p)
(98 basis functions), and aug-cc-pVTZ (210 basis functions, abbre-
viated as ACCT). Molecular orbitals were initially assigned through
a Huckel guess. Transition-state optimizations were performed by
specifying a saddle-point computation. Molecular electrostatic po-
tentials (MEP) were computed using the CHELPG methodology
[30] with a 0.3 Å point spacing. An SCF convergence criteria of
1.0 × 10−6 were used for all calculations. Stationary point char-
acterizations were done by performing frequency analyses; pro-
jected Hessian matrices were computed using an analytical method
for HF/STO-3G and HF/6-31G(d) calculations and a seminumeric
method for HF/ACCD, HF/ACCT, and all MP2 calculations. The
GAMESS-US [31,32] software was used to perform all quantum-
mechanical calculations.



2190 D. Reith, K.N. Kirschner / Computer Physics Communications 182 (2011) 2184–2191
4.2. Parameterization

The initial structure was created using PyMOL [8], saved as a
PDB file and converted to the GAMESS-US format using open babel
[33,34]. The potential energy functional form used in all molecular
mechanics optimization is seen in Eq. (1) [35]. Scaling factors for
1–4 nonbonded (i.e. fscnb) and electrostatic (i.e. fscee) interactions
were set to unity. As previously discussed [9], it is possible to have
a molecular typology where one atom has both 1–4 and 1–5 (or
greater) interactions that are equidistant. Through our experiences,
we have found that parameter development without 1–4 scaling
factors leads to values that appear to be more chemically intuitive.
The torsion phase angles (γ ) were constrained to zero, since they
are unnecessary for fitting torsion profiles. The nonbonded cutoff
radius was set to 100 Å, which encompasses methanol’s molecular
diameter.

Etotal =
∑

bonds

Kr(r − req)2 +
∑

angles

Kθ (θ − θeq)2

+
∑

dihedrals

Vn
2

[
1 + cos(nφ − γ )]

+
Natom∑
b>a

(
�ab fscnb

[(
σ ∗ab
rab

)12
− 2

(
σ ∗ab
rab

)6]

+ fscee
(

qaqb
4π�0rab

))
. (1)

RESP-derived partial atomic charges [11,12] were computed by
fitting to the HF/ACCT MEP (Step 6) (i.e. RESP

HF/ACCT
C , as defined be-

low). Multiple molecular orientations were used in compute each
MEP [30,36]. A restraint weight of 0.001 was used in the calcu-
lation, and partial atomic charges on the methyl hydrogens were
constrained to zero during the fitting [9]. All MEP and RESP calcu-
lations were performed with the aid of the R.E.D. III algorithm, to
ensure partial atomic charge reproducibility (Step 7) [13].

A large restraint of 15 000 kcal mol−1 was applied to those
degrees of freedom that were to be frozen, followed by 10 cy-
cles of a steepest descent and then conjugate gradient energy
minimization until the root-mean-square convergence criterion of
0.01 kcal mol−1 Å−1 was obtained (Step 9).

Reliable standard Lennard-Jones parameters were taken from
the OPLS force field [24], enabling Wolf2 Pack users to focus on
optimizing the intramolecular degrees of freedom. However, the
intermolecular degrees of freedom also need to be optimized in
order to obtain the best force field that one can possibly achieve.
For that purpose, we also successfully developed and published
the GROW workflow tool [19]. Bond length, bond angle, and tor-
sion parameters were optimized through manual adjustments and
redoing the MM restrained optimization. Relative energetics and
geometries were assessed each time until an optimal parameter
solution was found that best fits the QM and experimental data
(Step 10). Structural root-mean-square deviations (RMSd) were de-
termined by referencing each restrained molecular-mechanics ge-
ometry to the corresponding quantum geometry using the Ptraj
program [35].

Additional RESP partial atomic charges were developed using
HF/STO-3G, HF/6-31G(d), HF/ACCD, MP2/6-31G(d), MP2/ACCD, and
MP2/ACCT computed MEPs. Four different approaches were im-
plemented, each involving a unique method for how the charges
on the methyl hydrogen were determined for the final charge set.
Each method represents a possible approach for assigning the same
charge on chemically equivalent atoms (e.g. methyl hydrogen). For
Method A, all atoms were considered unique (i.e. chemically distin-
guishable) during the RESP fitting. Method B undergoes the same
RESP fitting done in Method A, followed by a a posteriori aver-
aging of the methyl hydrogen charges. In Method C each methyl
hydrogen was constrained to have a partial atomic charge of zero
during the RESP fitting. Finally, in Method D the methyl hydrogens
were restrained to have the equivalent charges during the RESP fit-
ting procedure. Each of the resulting charges sets are indicated by
a RESPQMMEPMethod nomenclature; for example, RESP

HF/6−31G(d)
C indicates

that the RESP charges were determined using the HF/6-31G(d) MEP
and the methyl hydrogens where force to be zero during the fitting
procedure. If applicable a two-stage RESP calculation was utilized,
with restraints of 0.0005 in the first stage and 0.001 for the second
stage [11,12]; otherwise a single restraint of 0.001 was used.

The AMBER 9 program package was used for all molecular me-
chanics calculations [35]. Gnuplot was used to generate the bond
stretching, angle bending, and torsion rotational curves [17]. Py-
MOL was used to generate the structural figures [8].

5. Conclusion

Force fields represent a multiscale bridge that connects high-
resolution quantum mechanics to coarser molecular mechanics
based models. Serving as a fundamental component of molecu-
lar mechanics and molecular dynamics (MD) simulations, force
fields describes the intra- and intermolecular interactions. As such,
there is a continuous need for improvements in force-field de-
velopment and their resulting performance. We have created an
expert-driven scientific workflow nicknamed Wolf2 Pack, that in-
corporates our beliefs for how QM-gained knowledge should be
transferred to MM models. Wolf2 Pack allow us to more efficiently
optimize force fields, enabling us to focus better on the scien-
tific challenges surrounding force-field development and a given
research problem.

In this article we have outlined Wolf2 Pack and have used
methanol as a case study to exemplify the scientific workflow.
Currently, Wolf2 Pack is written using Java code and shell scripts.
MySQL is used to organize our molecular database. In the future
will intend to include a version of GROW into Wolf2 Pack for opti-
mizing nonbonded parameters.

The optimization of methanol’s gas-phase force field presented
here, from the initial structure building, to the RESP investiga-
tion, and finally to the optimized parameters took approximately
3 working days. This was accomplished on a single desktop com-
puter with an AMD Athlon (tm) 64 X2 Dual Core Processor 6000+
and 4 GB of memory. Based on our past experience with force-field
development, the same work could have easily taken over 2 weeks.
Therefore, a significant speed-up is achieved already for a very
small molecule. However, even greater speed-ups for more com-
plicated molecules that inhabit more potential sources of errors
can be easily envisioned (e.g. for molecules with mixed chemical
functionalities).

As part of the case study, we have preformed a detailed investi-
gation on the determination of RESP-derived partial atomic charges
using HF, MP2, and a variety of basis sets. Through comparison to
the experimental dipole moment magnitude and orientation, the
RESP charges that allow every atom to be fit independently pro-
vides the best results (i.e. Method A). However, charge equivalency
on chemically equivalent atoms has advantages for MD simula-
tions and for creating transferable force fields. Toward this end,
we found that the use of HF/ACCT MEP and restricting the methyl
hydrogens to have zero charges provide the best agreement to ex-
periment.

Acknowledgements

We would like to thank Thomas Brandes for helpful discussions
concerning dipole moment calculations. We also thank Jens Nei-



D. Reith, K.N. Kirschner / Computer Physics Communications 182 (2011) 2184–2191 2191
sius and Niklas Gehlen for assistance in writing the Java code and
improving the scripts used in Wolf2 Pack. Finally, we extend our
thanks to the anonymous reviewer who provided us with informa-
tive and productive feedback on the work and its writeup.

References

[1] Y. Gil, et al., IEEE Computer 40 (2007) 24.
[2] A. Tiwari, A.K. Sekhar, Computational Biology and Chemistry 31 (2007) 305.
[3] D. De Roure, C. Goble, IEEE Software 26 (2009) 88.
[4] J.-H. Lii, Unpublished program, distributed with the MM3 program.
[5] J.M. Wang, P.A. Kollman, Journal of Computational Chemistry 22 (2001) 1219.
[6] O. Guvench, A.D. MacKerell Jr., Journal of Molecular Modelling 14 (2008) 667.
[7] B. Waldher, J. Kuta, S. Chen, N. Henson, A.E. Clark, Journal of Computational

Chemistry 31 (2010) 2307.
[8] DeLano Scientific LLC, The PyMOL molecular graphics system, version 1.2r2,

http://pymol.org.
[9] K.N. Kirschner, et al., Journal of Computational Chemistry 29 (2008) 622.

[10] J.H. Lii, B.Y. Ma, N.L. Allinger, Journal of Computational Chemistry 20 (1999)
1593.

[11] C.I. Bayly, P. Cieplak, W. Cornell, P.A. Kollman, Journal of Physical Chemistry 97
(1993) 10269.

[12] W.D. Cornell, P. Cieplak, C.I. Bayly, P.A. Kollman, Journal of the American Chem-
ical Society 115 (1993) 9620.

[13] A. Pigache, P. Cieplak, F.-Y. Dupradeau, Automatic and highly reproducible RESP
and ESP charge derivation: Application to the development of programs RED
and X RED, in: 227th ACS National Meeting, Anaheim, CA, USA, March 28–April
1, 2004.

[14] F.-Y. Dupradeau, et al., Physical Chemistry Chemical Physics 12 (2010) 7821.
[15] L.H. Johnston, R.P. Srivastava, R.M. Lees, Journal of Molecular Spectroscopy 84

(1980) 1.
[16] T. Amano, Journal of Molecular Spectroscopy 88 (1981) 194.
[17] H.B. Broeker, et al., Gnuplot version 4.2, patchlevel 3, 2007.
[18] A. Maaß, L. Nikitina, T. Clees, K.N. Kirschner, D. Reith, Molecular Simulation 36

(2010) 1208.
[19] M. Hülsmann, T. Köddermann, J. Vrabec, D. Reith, Computer Physics Communi-

cations 181 (2010) 499.
[20] M. Hülsmann, J. Vrabec, A. Maaß, D. Reith, Computer Physics Communica-

tions 181 (2010) 887.
[21] M. Hülsmann, T. Müller, T. Köddermann, D. Reith, Molecular Simulation 36

(2010) 1182.
[22] R. Lees, J. Baker, Journal of Chemical Physics 48 (1968) 5299.
[23] K. Kimura, M. Kubo, Journal of Chemical Physics 30 (1959) 151.
[24] W.L. Jorgensen, D.S. Maxwell, J. Tirado-Rives, Journal of the American Chemical

Society 118 (1996) 11225.
[25] S.J. Weiner, et al., Journal of the American Chemical Society 106 (1984) 765.
[26] W.D. Cornell, et al., Journal of the American Chemical Society 117 (1995) 5179.
[27] P. Cieplak, W. Cornell, C. Bayly, P. Kollman, Journal of Computational Chem-

istry 16 (1995) 1357.
[28] L.F. Kuyper, R.N. Hunter, D. Ashton, K.M. Merz Jr., P.A. Kollman, Journal of Phys-

ical Chemistry 95 (1991) 6661.
[29] D.E. Williams, Journal of Computational Chemistry 15 (1994) 719.
[30] C.M. Breneman, K.B. Wiberg, Journal of Computational Chemistry 11 (1990)

361.
[31] W.M. Schmidt, et al., Journal of Computational Chemistry 14 (1993) 1347.
[32] M.S. Gordon, M.W. Schmidt, Advances in electronic structure theory: GAMESS

a decade later, in: M.S. Gordon, M.W. Schmidt, C.E. Dykstra (Eds.), Theory and
Applications of Computational Chemistry: the First Forty Years, Elsevier, Ams-
terdam, Boston, 2005, pp. 1167–1189.

[33] Rajarshi Guha, M.T. Howard, et al., Journal of Chemical Information and Mod-
eling 46 (2006) 991.

[34] The open babel package, version 2.2.0, http://openbabel.sourceforge.net, 2008.
[35] D.A. Case, et al., AMBER 9, 2006.
[36] J.R. Woods, M. Khalil, W. Pell, H.S. Moffat, H.V. Smith, Journal of Computational

Chemistry 11 (1990) 297.

http://pymol.org
http://openbabel.sourceforge.net

	A modern workﬂow for force-ﬁeld development - Bridging quantum mechanics and atomistic computational models
	1 Introduction
	2 Scientiﬁc workﬂow & case study
	2.1 Workﬂow
	2.1.1 Workﬂow Steps 1-3: Foundation setup
	2.1.2 Workﬂow Steps 4 and 5: QM-constrained geometries and energies
	2.1.3 Workﬂow Steps 6 and 7: Determining partial atomic charges
	2.1.4 Workﬂow Steps 8: Generating the classical model
	2.1.5 Workﬂow Steps 9: MM-constrained geometries and energies
	2.1.6 Workﬂow Steps 10: Parameter optimization
	2.1.7 Workﬂow Steps 11: Validation


	3 Highlighting RESP-derived partial atomic charges
	4 Technical details for case study
	4.1 Quantum mechanics calculations
	4.2 Parameterization

	5 Conclusion
	Acknowledgements
	References


