fempar : object-ori parallel finit element framework origin paper fempar : object-ori parallel finit element framework santiago badia1,2  alberto f. martn1,2  javier principe2,3 receiv : 5 august 2017 /accept : 15 septemb 2017  author ( ) 2017 .
articl open access public abstract fempar open sourc object orient for- tran200x scientif softwar librari high-perfor- manc scalabl simul complex multiphys problem govern partial differenti equat larg scale , exploit state-of-the-art supercomput resourc .
high modular , flexibl , exten- sibl librari , provid set modul combin carri differ step simul pipelin .
fempar includ rich set algorithm discret step , name ( arbitrary-ord ) grad , div , curl-conform finit element method , discontinu galerkin method , b-spline , unfit finit element techniqu cut cell , combin h-adapt .
linear solver modul reli state-of-the-art bulk-asyn- chronous implement multilevel domain decom- posit solver differ discret altern block-precondit techniqu multiphys problem .
fempar framework provid user out-of-the-box state-of-the-art discret techniqu high scalabl solver simul complex applic , hide dramat complex under algorithm .
also framework research want experi new algorithm solver , provid high extens framework .
work , first one seri articl fem- par , provid detail introduct softwar abstract use discret modul relat geometr modul .
also provid ingre- dient assembl linear system aris finit element discret , softwar design complex scalabl multilevel solver postpon subsequ work .
1 introduct even though origin fe method trace back 50s , field drastic evolv last six decad , lead increas complex algorithm improv accuraci , stabil , perform .
use p-version fe method exponenti con- vergenc make high-ord approxim excel option mani applic [ 1 ] .
adapt mesh refin driven posteriori error estim , i.e. , h-adapt , essenti ingredi reduc comput cost automat way [ 2 ] .
smooth solut , p-adapt hybrid hp-adapt reduc comput cost target level accuraci [ 3 ] .
origin , fe method restrict nodal lagrangian base structur problem .
extens fe method applica- tion , like porous media flow electromagnet , moti- vate design complex base requir differ map refer physic space , complic implement & santiago badia sbadia @ cimne.upc.edu alberto f. martn amartin @ cimne.upc.edu javier princip princip @ cimne.upc.edu 1 depart civil environment engin , universitat politecnica de catalunya , jordi girona 1-3 , edifici c1 , 08034 barcelona , spain 2 cimn centr internacion de metod numer en enginyeria , parc mediterrani de la tecnologia , upc , estev terrada 5 , 08860 castelldefel , spain 3 depart fluid mechan , universitat politecnica de catalunya , eduard maristani , 10-14 , 08019 barcelona , spain 123 arch computat method eng doi 10.1007/s11831-017-9244-1 http : //orcid.org/0000-0003-2391-4086 http : //orcid.org/0000-0001-5751-4561 http : //orcid.org/0000-0002-1478-2651 http : //crossmark.crossref.org/dialog/ ? doi=10.1007/s11831-017-9244-1 & amp ; domain=pdf http : //crossmark.crossref.org/dialog/ ? doi=10.1007/s11831-017-9244-1 & amp ; domain=pdf techniqu standard fe code .
saddle-point problem also requir particular mix fe discret stabil purpos [ 4 , 5 ] .
recent , novel fe formul propos within frame exterior calculus , e.g. , mix linear elast problem [ 6 ] .
physics-compati- ble discret also gain attent , e.g. , field incompress fluid mechan .
divergence-fre mix fes satisfi mass conserv machin pre- cision , implement certain challeng [ 7 ] .
last decad , huge part computa- tional mechan communiti embrac isogeometr analysi techniqu [ 8 ] , discret space defin term nurb ( simpli spline ) , lead smoother global space .
opposit direct , dis- continu galerkin ( dg ) method also activ develop , novel approach , like hybridiz dg petrov-galerkin dg method , propos [ 9 , 10 ] .
discret method becom complex , effici implement tech- niqu complic .
also pose challeng design scientif softwar librari , extens provid framework ( easi ) imple- mentat novel techniqu , resili new algorithm trend .
hardwar scientif code run evolv even faster .
40 year , core perform steadili increas , predict moor  law .
year , supercomput reach 1 exaflop/ , dramat improv comput power affect extrem scale machin radic transform whole rang platform , desktop high per- formanc comput ( hpc ) cloud .
abil effi- cientli exploit forthcom 100x boost comput perform tremend impact scientif discoveries/econom benefit base com- putat scienc , reach almost everi field research .
howev , foreseen exascal growth computa- tional power deliv increas hardwar parallel ( distinct form ) , effici exploita- tion resourc simpl task .
hpc architectur combin general-purpos fat core , fine- grain many-cor acceler ( gpus , dsps , fpgas , intel mic , etc .
) , multiple-level disruptive-technolog memori , high non-uniform common denomi- nator [ 11 ] .
( inevit ) trend challeng algo- rithm/softwar design .
tradit bulk-synchron messag pass interfac ( mpi ) approach like face signific perform obstacl .
signific progress alreadi made mpi ? x [ 12 ] ( x=openmp , cuda , opencl , ompss , kokko , etc . )
hybrid execut model .
go step , asynchron many-task execut model ( e.g. , charm ? ?
[ 13 ] , legion [ 14 ] , hpx [ 15 ] ) support run-tim system hold great promis [ 16 ] .
tradit , research field scientif com- pute use develop code reduc number develop , e.g. , univers depart , limit life span .
softwar engin behind scientif code poor .
code rigid non-extens , develop target applic specif numer method .
howev , increas level complex term algorithm hardwar make develop scientif softwar effici run state-of-the-art numer algorithm hpc resourc real challeng .
consid start scratch project kind ever increas level complex .
furthermor , due huge resourc requir carri project , natur develop framework resili new algorithm hardwar trend , order maxim life time , applic broad rang applic .
sens , object-ori ( oo ) program , provid modular code data-hid , key softwar design flexibl scalabl ( term develop ) project .
number open sourc oo fe librari avail internet , e.g. , deal.ii [ 17 , 18 ] , fenic [ 19 ] , grin [ 20 ] , nektar ? ?
[ 21 ] , moos [ 22 ] , mfem [ 23 ] , freefem ? ?
[ 24 ] , dune [ 25 ] .
general , librari aim provid machineri requir simul complex problem govern partial differenti equat ( pde ) use fe techniqu .
case , everi librari main goal distinct featur .
librari , like freefem ? ?
fenic , extrem simpl user interfac .
fenic domain specif languag weak form automat generat correspond fe code ( prevent p-adapt ) includ collect python wrapper provid user- friend access servic librari .
sophist librari like deal.ii dune slight demand learn curv .
general , parallel adapt partial support ; far know , none librari support parallel hp- adapt , unless dg method use .
librari restrict particular cell topolog , e.g. , deal.ii limit hexahedral/quadrilater ( n-cube ) mesh , fenic support simul tri- angular/tetrahedr ( n-simplic ) mesh .
general , librari provid modul differ step simul pipelin , involv set-up mesh , construct fe space , integr assembl weak form , solut result linear system , visual comput solut .
solut linear system clear segreg discret step scientif softwar librari describ ( parallel s. badia et al .
123 comput ) ; linear system transfer general- purpos spars linear algebra librari , main petsc [ 2628 ] , hypr [ 29 ] , trilino [ 30 , 31 ] .
result , coupl discret step linear solver step somehow weak , sinc reli general purpos solver , usual involv simpl interfac .
strong point general purpos numer linear algebra librari problem-independ , also limit perform specif applic , sinc fulli exploit under properti pde oper numer discret .
1 seg- regat clear impact type method use .
black-box approach general-purpos linear solver favour use algebra multigrid meth- od , de facto linear solver [ 29 ] .
hand , geometr multigrid method domain decomposit ( dd ) method , specif mesh-bas pde solver , common , even though superior algebra method mani case .
geometr multigrid method exploit hp-adapt structur fe space includ deal.ii , use serial case .
parallel scenario , dd method cer- tain evolv last decad .
modern dd method ( necessarili ) reli static condens intern variabl , requir spars direct method local subdomain problem .
instead , inexact solver use , e.g. , multigrid method , linear complex dd precondition defin ( see [ 33 , 34 ] ) .
defini- tion two-level dd method resembl one fe method , exchang fe subdomain concept , definit strong relat one mul- tiscal fes [ 35 ] .
furthermor , multilevel extens natur defin .
short , state-of-the-art multilevel dd method understood ( inexact version ) non-conform multigrid method .
even though mathemat theori dd method sound , high perform implement quit recent ( see [ 3638 ] ) .
hand , awar general purpos fe code integr dd algorithm solut workflow .
dd method requir sub-assembl matric use , support major exist advanc oo fe librari .
analog , use block-precondit general poor sup- port , involv discret addit oper defin approxim schur complement , correspond block-bas assembl matric .
hand , base supercomput trend , segreg time discret , linear , space discret , linear system solv , pro- gressiv blur .
exampl , nonlinear precondit parallel-in-tim solver two natur way attain higher level concurr forthcom exas- cale supercomput [ 36 , 39 ] .
fact complic even rigid workflow current advanc fe librari .
sens , current effort petsc provid nonlinear precondit interfac found [ 40 ] , reli call-back function , xbraid solver [ 41 ] aim provid time-parallel non-intrus way .
2 fempar project work , present fempar , oo fe framework solut pdes , design incept high scalabl supercomput easili handl complex multiphys problem .
first public releas fempar almost 300k line code written ( most ) oo fortran make intens use featur defin 2003 2008 standard languag .
sourc code complementari work correspond first public releas fempar , i.e. , version 1.0.0 .
avail git repositori [ 42 ] .
particular , first public releas assign git tag fempar-1.0.0 , accord   semant version   system .
2 fempar rich term fe technolog .
particular , includ lagrangian fes , also curl- div-conform one , e.g. , nedelec ( edg ) raviart-thoma fes .
librari support n-cube n-simplex mesh , arbitrari high-ord base fes includ .
continu discontinu space use , provid machineri integr dg facet ( i.e. , edg 2d face 3d ) term .
recent , beta version code , b-spline also ad , togeth support cut cell method ( use xfem-typ techniqu ) hp-adapt , discuss develop sake breviti .
moreov , fempar develop aim provid framework allow develop imple- ment complex techniqu well-suit tradit segreg workflow comment .
fem- par also provid high scalabl built-in numer linear algebra modul base state-of-the-art domain decomposit solver .
fempar provid partial assembl matric , requir dd solver ; multilevel bddc solver fempar scale almost half million core 1.75 million mpi task ( subdomain ) juqueen supercomput [ 34 , 37 ] .
includ abstract framework construct applic precon- dition base multilevel nonoverlap partit .
1 paradigmat exampl design scalabl solver discret maxwel equat use edg element , involv discret addit oper ( discret gradient ) chang basi refer fe level [ 32 ] .
2 avail http : //semver.org/ .
fempar : object-ori parallel finit element framework 123 http : //semver.org/ even though everi block within librari preserv modular , interfac discret numer linear algebra modul within fempar rich focus pde-bas linear system .
path exascal , fempar design permit asynchron implement multilevel method , term multiphys fes multilevel solver , exploit , e.g. , [ 37 ] .
uniqu featur avail similar librari .
librari also allow user defin block multiphys applica- tion , use easili implement complex block precondition [ 4345 ] .
block cus- tomiz , alreadi use develop scalabl dd solver electromagnet problem block pre- condition multiphys problem , e.g. , magnetohy- drodynam [ 44 ] .
distinct featur fempar , howev , discuss articl forth- come one .
general discuss main ingredi implement discret step use fe- like approxim first necessari , purpos work .
fempar alreadi success use wide set applic author librari : simul turbul flow stabil fe method [ 4649 ] , magnetohydrodynam [ 5054 ] , monoton fes [ 5559 ] , unfit fes embed boundari method [ 60 ] , addit manufactur simul [ 61 ] .
also use high effici implement dd solver [ 34 , 37 , 39 , 6266 ] block precondit techniqu [ 44 ] .
work overview articl main featur librari .
detail descript softwar abstract use within fempar develop effici , modular , extens implemen- tation fe method support modul broad sens .
end , enrich discuss code snippet describ data structur , bind , exampl use .
3 document intend use guid new fempar develop want get familiar softwar abstract .
also use tool develop fe code want learn implement fe method advanc oo framework .
case , due size librari , mani detail expos , keep reason articl length .
articl read differ way , sinc necessari fulli understand pre- cede section grasp main idea section .
instanc , section abstract implement polytop arbitrari dimens relat algorithm quit technic reader particular interest intern design type bind implement skip .
experienc fe research skip short section basic fe method , look one ( need ) refer subsequ section .
articl organ follow .
sect .
3 present concis mathemat descript fe framework .
main mathemat abstract express softwar mean set deriv data type associ tbps , describ subsequ sec- tion .
particular , main softwar abstract fempar role solut problem :  polytop , describ set admiss geometri permit automat , dimension- independ generat refer cell struc- ture domain .
mathemat under poly- tope present sect .
3.14 , softwar implement sect .
4 .
 polynomi abstract relat data type , present sect .
3.4 5 , respect .
section describ shape function base generat arbitrari order n-cube n-simplex topolog .
 refer fe sect .
6 , describ refer cell defin set basi function degre freedom cell .
 triangul sect .
7 , repres discret approxim physic domain x .
 set tool requir perform numer integr ( e.g. , quadratur geometr map ) produc refer fe describ sect .
8 cell integr sect .
9 facet integr .
 fe space describ sect .
10 , built triangul set refer fes , repres global space fe function .
 discret integr , abstract class extend user defin affin fe oper , describ numer integr weak form problem solv , describ sect .
11.2 .
 linear ( affin ) oper sect .
11 , whose root solut problem hand , construct use fe space discret integr .
3 code snippet written advanc oo fortran 200x [ 67 ] .
close relationship languag featur avail c ? ?
languag [ 68 ] establish code style rule emphas .
particular , fortran modul fempar alway name suffix _name , indic analog namespac c ? ? .
deriv type , analog c struct c ? ?
class , alway name _t distinguish instanc .
howev kept mind , wherea struct c ? ?
passiv data contain class use carri also method , fortran deriv data type use case sinc introduct 2003 standard call type-bound procedur ( tbps ) .
s. badia et al .
123  exampl user driver sect .
12 , differ ingredi previous describ use simul problem govern pdes , stoke system .
( simplifi ) graphic overview main soft- ware abstract fempar relation- ship shown fig .
1 .
3 fe framework section , briefli introduc mathemat abstract behind fe method discret problem govern pdes .
detail exposi- tion topic , refer [ 6972 ] .
fes describ ( mani cover herein ) for- mulat analyz use finit element exterior calculus framework [ 6 ] , make use exterior algebra exterior calculus concept .
framework , one defin fes , e.g. , div curl-conform one , arbitrari space dimens , use concept differen- tial k-form .
howev , decid use present fe method simplifi exposit reader familiar abstract .
3.1 boundari valu problem weak form interest problem govern pdes pose physic domain x  rd boundari c : ox .
practic  2 ; 3 also interest [ 3 particular applic ( see sect .
3.14 ) .
let us con- sider differenti oper , e.g. , laplac oper d , forc term f : x !
r. let us also consid partit c dirichlet boundari cd neumann boundari cn , correspond boundari data ud : cd !
r gn : cn !
r. boundari valu problem read follow : find ux aux  f x x ; bdux  udx cd ; bnux  gnx cn : 1 oper bd trace oper bn flux oper .
boundari condit , e.g. , robin ( mix ) condit also consid .
assum unknown ux ( 1 ) scalar , vector , tensor field .
( case multi-field problem consid sect .
3.11 . )
fe analysi , must consid weak form ( 1 ) .
weak formul state abstract set follow .
let us consid abstract problem determin banach space x ( trial space ) , reflex banach space ( test space ) , continu bilinear form : x  !
r , continu linear form  : !
r. abstract problem state : find u 2 x au ; v   v ; v 2 : 2 link two formul follow .
let dx space c1 function compact support x ; dual space dx0 space distribut .
: au ; u : hau ; uix ;  u : hgn ; uicn  hf ; uix ; u 2 dx ; deriv understood distribut sens .
e.g. , laplac oper , bilinear form read au ; v : r x ru  rvdx .
furthermor , homogen dirichlet boundari condit , i.e. , u  0 cd , usu- alli enforc strong way ; function satisfi boundari condit .
extens non-homoge- neous boundari condit straightforward .
one defin arbitrari extens eud dirichlet data , i.e. , eud  ud cd .
next , defin function u0  : u eud zero trace cd solv ( 2 ) u0 right-hand side  v  aeud ; v : 3 fig .
1 main softwar abstract fempar relationship fempar : object-ori parallel finit element framework 123 let us consid two classic exampl .
exampl 3.1 ( heat equat ) let us consid poisson problem r  jru  f u  ud cd onu  gn ; n outward normal .
let us assum j 2 l1xdd , f 2 h1x , gn 2 h 1 2cn , ud 2 h 1 2cd .
let us also consid extens eud 2 h1x eud  ud cd .
weak form problem read : find u0 2 h10x z x jru0  rvdx  z x fvdx z cn gvdc  z x jreud  rvdx ; v 2 h10x : solut u : u0  eud .
exampl 3.2 ( stoke problem ) stoke problem con- sist find veloc field u pressur field p r  lu  rp  f ; r  u  0 ; ( exampl ) u  ud c , u  12 ru rut strain tensor .
weak form problem consist find u0 ; p 2 x  : h10x  dl20x l z x u0 : v  z x r  vp z x qr  u0  z x v  f  l z x eud : v  z x qr  eud ; v ; q 2 x , eud 2 h10x  d extens dirichlet data , i.e. , eud  ud c. solut u : u0  eud .
3.2 space discret fes problem ( 2 ) infinite-dimension problem .
order end comput one , must introduc finite- dimension subspac approxim proper- tie .
restrict fe scheme broad sens involv conform non-conform space .
thus , aim explicit build space x h ( yh ) approxim properti .
discret space sub- space origin one ( conform ) , i.e. , x h  x yh  , discret problem read : find uh 2 x h auh ; vh   vh ; vh 2 yh : petrov-galerkin problem .
particular case x h  yh , galerkin problem .
previous problem ill-pos choic fe space , e.g. , use discret space satisfi inf-sup condit indefinit problem [ 5 ] .
case , judici chosen perturb a ;    , repres ah ;   h respect , stabil problem make stabl optim converg , circumv inf-sup condit restrict .
general case , describ fe space : find uh 2 x h ahuh ; vh   hvh ; vh 2 yh ; 4 replac continu bilinear form general discret bilinear form .
one also defin affin oper f huh  ahuh ;    h 2 y0h ; 5 state ( 4 ) : find uh 2 x h f huh  0 .
statement one use practic imple- mentat fe oper fempar ( see sect .
11 ) .
order defin fe space , requir triangul h domain x set fkg cell .
triangu- lation assum conform , i.e. , two neighbour cell k ; k 2 h , intersect k \ k whole k- face ( k\d ) cell ( note k-face refer geo- metric entiti , e.g .
cell , face , edg vertic  3 , see sect .
3.14 ) .
practic , cell must express particular type map set admiss geometri ( polytop , see sect .
3.14 ) .
thus , everi element k 2 h , assum ref- erenc cell kk diffeomorphismuk : k !
k. follow , usual use notat x : u1k x .
definit function space also reli refer function space follow : ( 1 ) defin function space refer cell k ; ( 2 ) defin set function physic cell k via function map ; ( 3 ) defin global space assembl cell-bas space plus continu constraint cell .
order present process , introduc concept refer fe , fe , fe space , respect .
3.3 fe concept refer physic space use abstract definit ciarlet , fe repres triplet fk ; v ; rg , k compact , connect , lipschitz subset rd , v vector space function , r set linear function form basi dual space v0 .
element r so-cal dof fe .
denot number moment nr .
moment written ra 2 n r  : f1 ; .
.
.
; nrg .
also defin basi f/aga2n r v ra/b  dab ; b 2 n r. function so- call shape function fe , one-to-on map shape function dof .
given s. badia et al .
123 function v , defin local interpol fe hand pkv : x a2n r rav/a : 6 easi check interpol oper fact project .
refer space , build refer fes k ; v ; r follow .
first , consid bound set possibl cell geometri , denot k ; see definit polytop sect .
3.14 .
k , build function space v set dof r .
consid exampl refer fes sect .
3.8 , 3.9 , 3.10 .
physic space , fe triplet k ; v ; r mesh cell k 2 h reli : ( 1 ) refer fe k ; v ; r , ( 2 ) geometr map uk k  : ukk , ( 3 ) linear biject function map wk : v !
v .
func- tional space physic space defin v  : fwkv u1k : v 2 vg ; also use wk : v !
v defin wkv : wkv u1k .
set dof physic space defin r : fr w1k : r 2 rg .
given set shape function f/a : 2 n rg refer fe , easi check f/ak  : wk/a : 2 n rg set shape function fe physic space .
refer fe space v usual polynomi space .
thus , first ingredi defin base polynomi ; see sect .
3.4 .
analyt express basi shape function straightforward complic definit moment ; topic cover sect .
3.5 .
, consid build global ( conform ) fe space sect .
3.6 , integr bilinear form correspond weak formul sect .
3.7 .
final provid three exampl fes sect .
3.8 , 3.9 , 3.10 .
3.4 construct polynomi space local fe space usual polynomi space .
given order k 2 n set n k distinct point ( node ) r ( indistinct repres node index posit xi ) , defin correspond set lagrangian polynomi f  k0 ; .
.
.
;  kkg :  kmx : pn2n knfmgx xs pn2n knfmgxm  xs : 7 also defin lagrangian basi lk  f  ki : 0 i kg .
set polynomi basi k-th order polynomi .
note  kmxl  dml , 0m ; l k. multi-dimension space , defin set node cartesian product 1d node .
given d- tupl order k , defin correspond set node n-cube : n k  : n k1      n kd .
analog , defin multi-dimension lagrang basi lk  f  km : 2 n kg ;  kmx : pdi1  ki mi xi : 8 clear ,  kt xs  dst , ; 2 n k .
cartesian product construct lead basi local fe space usual use n-cube , i.e. , space polynomi degre less equal k respect variabl x1 ; .
.
.
; xd .
defin mono- mial d-tupl pax : pdi1x ai , polynomi space order k qk  spanfpax : 0 ai  ki ;  1 ; .
.
.
; dg .
qk  spanf  :  2 lkg .
definit polynomi space n-simplic slight differ .
requir definit space polynomi degre equal less k variabl x1 ; .
.
.
; xd .
involv full cartesian product 1d lagrang polynomi ( monomi ) truncat space , i.e. , correspond polynomi space order k pk  spanfpax : jaj  kg , jaj  : pd i1 ai .
analo- gousli n-cube , basi dual space pk valu set node ~n k  : fs 2 n k1 : jsj  kg .
generat typic grad-conform fes n-simplic .
3.5 construct shape function basi analyt express shape function becom complic high order fes non-trivi defi- nition dof , e.g. , electromagnet applic .
furthermor , code provid basi arbitrari high order , automat generat shape function must implement .
explicit con- struction shape function obvious , proceed follow .
let us consid fe defin fk ; v ; rg.4 first , generat pre-basi fwbgb2r span local fe space v , e.g. , lagrangian polynomi basi ( see sect .
3.4 ) .
hand , given set local dof , proceed follow .
shape function written /a  p b2n r uabw b , wb element pre- basi .
definit , shape function must satisfi ra/b  dab ; b 2 n r. result , let us defin cab  : rawb .
( use einstein  notat ) : 4 section , make differ refer physic space , e.g. , use  symbol .
case , follow develop usual perform refer fe level .
fempar : object-ori parallel finit element framework 123 ra/b  raubcwc  rawcubc  dab ; compact form , cut  , thus ut  c1 .
result , uab  c1ba .
shape function comput linear combin pre-basi function .
3.6 global fe space conform final , must defin global fe space .
conform fe space defin : x h  : fv 2 x : vjk 2 vg : main complic definit enforc con- formiti fe space , i.e. , x h  x .
fact , con- formiti constraint one motiv choic r andw , consequ , r. practic , conform constraint must re-stat continu constraint fe dof .
general , constraint implicit enforc via global dof number , even though possibl general adapt scheme non-con- form mesh and/or variabl order cell , requir involv constraint .
let us defin mh  : fb ; k : b 2 n rk ; k 2 hg cartesian product local dof cell .
defin global dof quotient space mh equiva- lenc relat  .
use standard notat , given  , equival class 2 mh respect  repre- sent a  : fb 2 mh : a bg , correspond- ing quotient set n h  : fa : 2 mhg .
set n h set global dof  repres local-to-glob dof map .
assum equival relat two element b ; k ; b0 ; k 0 2 mh b ; k b0 ; k 0 , k 6 k 0.5 use one-to-on map moment shape function , oper allow one defin global shape function /a  p b ; k / b k .
assum choic satisfi conform constraint , i.e. , x h  spanf/aga2n h  x .
let us consid infinite-dimension space ~x ( 1 ) x h  ~x  x ( 2 ) everi function v 2 ~x global dof 2 n h , local dof b ; b0 2 a rbv  rb0 v , i.e. , local dof relat global dof continu among cell .
global interpol defin : pxhv : x k2t h pkv  x k2t h x b2n rk rbv/bk ; v 2 ~x : 9 easi check fact projector .
case , use project oper refer projector involv solut global fe system , e.g. , base minim l2 h1 norm .
, provid detail choos local dof r , function map w , equival relat  conform properti satisfi grad , div , curl-conform fe space .
case non- conform method , e.g. , dg method , readili consid .
case , conform constraint requir , lead much flexibl def- init dof .
side , scheme requir numer perturb continu bilinear linear form ( 4 ) involv integr facet fes weak enforc conform .
( facet d  1- face , e.g. , face 3d edg 2d ) .
defin basi fe space x h yh use fe machineri present , everi fe function uh uniqu repres vector u 2 rjn hj uh  p b2n h / bub .
fact , problem ( 4 ) re- state : find u 2 rjn hj ah/b ; waub   hwa ; 2 n h : end finite-dimension linear prob- lem , i.e. , linear system .
note general , trial space moment differ one test space , soon cardin .
matrix form , problem state : solv au f ; aab : ah/b ; wa ; fa :  hwa : 10 assum bilinear form split cell contribut ah ;   p k2t h ak ;  , e.g. , replacingr x p k2t h r k , construct matrix imple- ment cell-wis assembl process , follow : aa b  x k2t h x ; b2n rk akab  : x k2t h x ; b2n rk ak/bk ; w k : 11 fe affin oper ( 5 ) repres f huh : au f , i.e. , repres matrix vector size jn hj .
3.7 numer integr general , local bilinear form state : ak/bk ; w k  z k f xdx ; evalu f x involv evalu shape function deriv .
let us repres jacobian geometr map jk  : ouk ox .
rewrit cell integr refer cell , next consid 5 assumpt fact appli fes kind , sinc local function space alreadi conform requir equival class cell level .
s. badia et al .
123 quadratur rule q defin set points/weight xgp ; wgp , follow : z k f xdx  z k f uxjjk jdx  x xgp2q f uxgpwxgpjjkxgpj : 12 , main complic evalu f uxgp .
construct , evalu func- tional requir evalu oa/ b k uxgp valu multi-index ( idem test func- tion ) .
usual , jaj  2 c0 fes , sinc higher-ord deriv would requir higher inter-cel continu .
second deriv , sens broken cell- wise integr , fact need method base stabil techniqu base pointwis evalu residu interior cell [ 46 ] .
let us consid case zero first deriv , i.e. , evalu /bk ukxgp r/ b k ukxgp .
valu shape function ( time geometr map- ping ) quadratur point determin follow : /bk ukxgp  w/ bxgp ; 13 wherea shape function gradient comput : r/bk ukxgp  rw/ b u1k  ukxgp  rxw/bxgpj1k xgp ; 14 use elementari differenti rule invers function theorem last equal ; rx repres gradient refer space .
thus , one need provid valu jacobian , invers , determin , one side , valu shape function w/b gradient rxw/b refer space , side , quadratur point , comput entri fe matric ; sec- ond order deriv treat analog .
quadratur rule k n-cube readili obtain tensor product 1d quadratur rule , e.g. , gauss-legendr quadratur .
symmetr quadratur rule triangl tetrahedra differ order found , e.g. , [ 69 ] .
case , creat arbitrarili larg quadratur rule n-simplic , one consid so- call duffi transform [ 73 , 74 ] .
well known , consid n-cube topolog k , gauss quadratur n point per direct integr exact 2n 1 order polynomi .
e.g. , lagrangian refer fe order p affin geo- metric map , choos n  p ceiling1=2  p 1 per direct integr exact mass matrix .
n-simplex mesh , use either symmetr quadratur ( avail ) tensor product rule plus duffi transform [ 73 , 74 ] .
latter case base introduc chang variabl transform n-simplex integr domain n-cube , integr n-cube use tensor product quadratur .
worth note chang variabl introduc non-const jacobian .
deter- minant jacobian order  1 respect variabl .
integr mass matrix exact , must abl integr exact polynomi order 2p  1 .
therefor , need take n  p ceilingd=2 exact integr mass matric .
3.8 grad-conform fes : lagrangian ( nodal ) element section , consid one character abstract fe technolog .
first , interest so-cal nodal fes , base lagrang polynomi dof base nodal valu .
let us consid order compon , i.e. , k1 : k ; .
.
.
; k.when refer geometri k n-cube , defin refer fe space vk  : qk1 .
set node n k1 generat , e.g. , equidist lagrangian node .
let us defin biject map i set node n k1 f1 ; .
.
.
; jn k1jg n r , i.e. , local node number .
set local dof n rk nodal valu , i.e. , ris  : vxs , 2 n k .
clear , refer fe shape function relat dof /is  :  k1s .
hand , simpli take wv : v. n-simplic , consid refer fe space pk span pre-basi fpax : 0 ai  k ;  1 ; .
.
.
; dg set node ~n k ( see sect .
3.4 ) .
set local dof n rk nodal valu .
sinc pre-basi ele- ment shape function , proceed sect .
3.5 generat express shape function basi arbitrari order refer fes n-simplic .
global fe space determin follow equival relat .
set local dof n-cube mh  : fs ; k : 2 n k1 ; k 2 hg due one-to-on map dof node ; replac set node ~n k n-simplic .
furthermor , say s ; k s0 ; k 0 iff xs  xs0 .
implement equival relat , thus , global number , reli ownership relat n-face dof ( e.g. , 3d say whether dof belong vertex , edg , face ) permut local node num- bere k one k node f. see sect .
3.14 detail .
global dof defini- tion , easi check global fe space function c0 thus grad-conform .
sinc lagrangian moment involv point-wis evalua- tion function h10x 6 c 0x [ 1 , fempar : object-ori parallel finit element framework 123 interpol ( 9 ) defin space .
instead , consid function interpol belong , e.g. , space ~x  : c0x .
one deal vector tensor field , generat cartesian product scalar space follow .
defin local fe space vk  : qk1 function map wv : v. vector case , local dof set repres mh  : fi ; ; k : 1 i ; 2 n k1 ; k 2 hg , i ; ; k i0 ; s0 ; k 0 iff  i0 xs  xs0 .
analog , shape function comput /a  : p i ; ; k  k1 ei ; ei repres i-th canon basi vector rd .
proceed analog n-simplic .
verif two node posit straightforward .
first , everi node k , assign n-face owner f ( e.g. , vertex , edg , face , cell ) ; cell dof replic .
given node 2 n k1 cell k belong n-face f , determin index sf respect f k. analog , anoth node belong n-face cell k 0 , repres s0f .
hand , one defin permut map pff ; k ; k 0 ;  ; 15 , given local index node within n-face f respect k , provid index n-face f respect k 0 ( see sect .
3.13 3.16 detail ) .
thus , xs  xs0 iff pff ; k ; k 0 ; sf  s0f .
3.9 div-conform fes present so-cal raviart-thoma fes vector field [ 5 ] ; implement brezzi-douglas-marini fes analog .
case , order use differ everi space dimens .
let us start raviart-thoma fes n-cube .
2d , space read vk  : qk1 ; k  qk ; k1 , wherea 3d read vk  : qk1 ; k ; k  qk ; k1 ; k  qk ; k ; k1 ; raviart-tho- mas element fact consid dimens .
basi r 3d compos two type dof , boundari interior dof , defin 1 kf0k z f0 v  n uf qdc ; q 2 pk ; 1 kkk z k v  qdx ; q 2 qk1 ; k ; k  qk ; k1 ; k  qk ; k ; k1 ; 16 respect 6 ; 2d case straightforward , replac space shape function interior moment qk1 ; k  qk ; k1 .
definit boundari facet involv map refer facet f0 facet f fe k , i.e. , uf : f0 !
f .
everi boundari moment associ function lagrangian space , thus , node index .
result , boundari dof index node n k1 (  2 ) corre- spond facet f , i.e. , moh  : ff ; ; k : f facet k ; 2 n k1 ; k 2 hg .
say f ; ; k f0 ; s0 ; k 0 iff f  f0 xs  xs0 .
check whether xs  xs0 hold , proceed similar lagrangian element .
shape function built sect .
3.5 .
consid lagrangian pre-basi v , comput shape func- tion via change-of-basi .
function map read follow : wkv : 1 jjk j jkv ; 17 map wk u1k so-cal contravari piola transform .
one check definit map togeth assembl defin lead global fe space div-conform ; i.e. , function continu normal compon across inter-cel facet .
thus , xh  hdiv ; x [ 5 ] .
n-simplic , refer fe space vk  : pk  xpk , k  0 ; 1 ; 2 ; .
.
. , basi r compos follow boundari interior dof : 1 kf0k z f0 v  n uf qdc ; q 2 pk ; 1 kkk z k v  qdx ; q 2 pk1 : case , generat pre-basi lagrangian fe space function , easili express span vector function compon select subset pk1 .
3.10 curl-conform fes weak formul electromagnet problem involv function space hcurl ; x .
conform fe space hcurl ; x must preserv continu tangenti compon field .
so-cal edg element ( nedelec element ) curl-conform fes [ 72 ] .
raviart-thoma element , edg element pre-basi n-cube involv differ order per dimens per compon .
2d , space read vk  : qk1 ; k qk ; k1 , wherea 3d read vk  : qk1 ; k ; k qk ; k1 ; k  qk ; k ; k1 .
basi r compos three type dof ( 3d ) , name edg , face , interior dof , defin : 6 test function space definit moment alway consid respect correspond domain integr .
s. badia et al .
123 1 ke0k z e0 v  s ueqdk ; 8q2pk1 ; 1 kf0k z f0 jt f vn uf qdc ; 8q2qk2 ; k1 qk1 ; k2 ; 1 kkk z k v qdx ; 8q2qk1 ; k2 ; k2 qk2 ; k1 ; k2 qk2 ; k2 ; k1 ; respect , edg map ue defin one face .
boundari dof index triplet f ; ; k , f edg face 3d , follow idea raviart-thoma element .
case , function map read follow : wkv : jtk v ; 18 map wk u1k so-cal covari piola transform , lead global fe space curl-conform [ 72 ] , i.e. , function continu tangenti compon across inter-cel facet .
n-simplic , space read : vk  : pk  sk ; sk  : fv 2 pk1 : vx  x  0 8 x 2 kg : 19 basi r 3d compos follow boundari interior dof : 7 1 ke0k z e0 v  s ueq dk ; 8q 2 pk1 ; 1 kf0k z f0 jt f v n uf  q dc ; 8q 2 pk2 2 1 kkk z k v  q dx ; 8q 2 pk3 3 : 2d , first two type dof requir , first one relat facet ( edg 2d ) second one interior dof own cell .
raviart-thoma element , pre-basi function lagrangian shape function , express span vector function compon select subset pk1 .
refer [ 75 ] dis- cussion actual generat pre-basi space ( 19 ) fempar .
3.11 cartesian product fes multi-field problem mani problem govern pdes involv one field , e.g. , navier-stok equat multi-phy- sic problem .
let us consid pde involv set unknown field u1 ; .
.
.
; un 2 x 1  .
.
. xn , defin cartesian product function space .
proceed , defin fe space everi field space separ , lead global fe space x 1h  .
.
. x n h defin composit fe space .
defin global number dof multi-field case , consid two dof equival relat field satisfi equival relat fe space field .
cartesian product fe space enough defin volume-coupl multi-phys problem govern physic domain , i.e. , differ physic defin whole domain coupl volum term formul .
howev , mani multi-phys problem interface-bas , i.e. , coupl differ physic defin differ subdomain transmiss condit interfac .
case , e.g. , fluid-structur problem ( see , e.g. , [ 7679 ] ) .
case , differ fe space could defin differ part global mesh , i.e. , one must describ set subdomain x1 ; .
.
.
; xn whole domain x correspond fe space defin .
3.12 non-conform method , consid global fe space conform , i.e. , x h  x .
altern , one consid fe scheme conform .
sinc origin bilinear form sens general non-conform fe space x h , one shall consid stabil bilinear form ah well-pos ( stabl continu ) discret set .
general , scheme replac requir inter-cel continu conform weak imposit continu .
thus , inter-cel continu impos weak penalty-lik term .
dg method scheme type [ 71 ] .
one sens , non-conform fe space simpler conform one , sinc conform requir ; one flexibl definit local dof equival class concept need , sinc dof never belong one element .
howev , bilinear form usual requir integr facet term , i.e. , term type : x f2f h z f f xdx : integr facet term far complic cell term .
let us first briefli illustr simpl applic non- conform method , name fe discret poisson problem use so-cal interior penalti ( ip ) 7 note take jt f v instead jt f v n definit face moment , sinc row jacobian matrix transform axe refer face f0 actual face f refer cell space test function invari rotat .
fempar : object-ori parallel finit element framework 123 famili dg formul [ 71 ] .
dirichlet boundari con- dition constraint , say ux  udx whole bound- ari c domain x , weak impos , natur kind formul .
global discret trial space x h compos function continu within cell , discontinu across cell , i.e. , x h  fuh 2 l2x : uhjk 2 x hjk  h1k ; k 2 hg , discret test space yh  x h. denot fxh f c h set interior boundari facet h , respec- tive , discret weak form under famili method read : find uh 2 xh x k2t h z k ruh  rvh  x f2fx h z f vh  ffruhgg  x f2fx h z f uh  ffrvhgg  x f2fx h cjfj1 z f uh  vh  x f2fc h z f vhruh  n x f2fc h z f uhrvh  n  x f2fc h cjfj1 z f uhvh  x k2t h z k fvh  x f2fc h z f udrvh  n  x f2fc h cjfj1 z f udvh 8vh 2 yh ; 20 fix constant character particular method hand , c facet-wis posit constant refer penalti paramet , jfj denot surfac facet ; c suitabl chosen bilinear form ahuh ; vh left-hand side ( 20 ) well-pos ( stabl continu ) discret set , result fe formul enjoy optim rate converg [ 71 ] .
final , denot k k two cell share given facet , ffwhgg wh denot mean valu jump wh across cell facet : ffwhgg  wh  w  h 2 ; wh  wh n   wh n  ; 21 n , n facet outward unit normal , wh , wh restrict wh facet , either perspect k k , respect .
comput assembl dof relat interior node straightforward .
regard facet term , assum sit interior facet f 2 fxh , four facet-wis matric , name f kk , f kk , afkk , f kk , comput .
( case boundari facet f 2 fch degener case one cor- respond interior facet singl facet-wis matrix afkk comput ; omit sort facet discuss order keep present short . )
hold partial contribut facet correspond global entri coeffici matrix .
entri , e.g. , afkk , defin ( particular problem hand ) : afkk   ab   z f /bk  ffr/ kgg  z f /ak  ffr/ b kgg  cjfj 1 z f /ak  / b k ; 22 indic b rang 1 number shape function n r k k , respect .
3.13 facet integr mention sect .
3.7 case cell integr , facet integr involv comput facet- wise matrix ( 22 ) general comput analyti- calli .
instead comput use quadratur rule .
general , bilinear form contain facet term state af/bk ; w k  z f f xdf : consid refer facet f , map uf : f !
f refer physic space .
let us repres jacobian geometr map jf  : ouf ox , valu rd1d .
rewrit facet integr refer facet , next consid quadratur rule q f defin set points/weight xgp ; wgp , follow : afkk   ab  z f f xdx  z f f ufxjjf jdf  x xgp2q f ufxgpwxgpjjfxgpj : 23 jjf j defin : jjf j  duf dx         2 jjf j  ou1f ox  ou2f ox         2 ; 24  2 ; 3 , respect .
express shape function gradi- ent physic space term one ref- erenc space comput use cell-wis map .
thus , two map uk uk among refer cell k cell k k physic space , respect , involv numer evalu s. badia et al .
123 interior facet integr .
also consid refer facet f map uf refer facet f ( analog uk k one dimens less refer space ) .
defin quadratur rule xgp ; wgp f .
also defin refer facet f  k ukf   f , map uf f f  .
map , defin quadratur xgp  : ufxgp ; wgp respect refer cell k .
howev , facet f ( general ) differ orient depend cell use refer , , differ index might assign facet quadratur point perspect either cell , i.e. , ukxgp 6 ukxgp general .
adopt convent facet quadratur point identifi local number space k , local identifi translat local number space k .
repres permut pgp ukxpgp  ukx  gp  ufxgp : logic under translat equival one discuss sect .
3.16 ; see fig .
2 explanatori illustr .
result , u1k ufxgp  x  gp ; u 1 k ufxgp  x  pgp : let us consid evalu zero first order deriv facet , i.e. , evalu /bka ukaxgp r/bka ukaxgp 2 f ; g , quadra- ture point belong quadratur refer facet f .
note introduct w need non- conform method , sinc continu enforc , consid ident oper simplic .
valu shape function ( time geometr map ) facet quadratur point evalu follow : /bka ufxgp  / b u1ka ufxgp ; wherea shape function gradient comput : r/bka ufxgp  rx/ bxgpj1k u 1 ka ufxgp : without loss general , let us focus first integr ( 22 ) .
replac mean valu jump oper definit ( 21 ) , take account /bk r/ak vanish k k ( construct x h yh ) , respect , end follow inte- gral comput numer :  1 2 z f /bkn   r/akdf : integr first map back refer facet f  rd1 , approxim follow sum quadratur point :  1 2 z f /bkn   r/akdf   1 2 z f /bk u 1 k ufxgpn  ufxgp  rx/bxgpj1k u 1 k ufxgpjjfjdf   1 2 x gp2q /bkx  pgpn xgp  rx/bxgpj 1 k x  q jjfxgpjwgp : 25 use idea , comput term relat facet integr .
furthermor , outward normal facet comput : na  1oa duf dx duf dx     2 na  1oa ou1f ox  ou 2 f ox ou1f ox  ou 2 f ox       2 ; 26  2 ; 3 , respect , 2 f ; g ; 0 1 use enforc normal outward .
tangent vector ( ) given facet easili comput normal vector .
3.14 polytop one motiv fempar develop framework deal arbitrari space dimens .
permit readili implement space-tim formul , pose 4d .
higher-dimension appli- cation includ system pdes pose phase space , e.g. , 7d ( includ time ) vlasov-maxwel equat simul plasma .
section , provid mathemat abstract cell topolog base concept polytop .
fig .
2 map requir facet integr .
( ) quadratur point shown physic space locat x  ufx1  uk x1   uk x2  , , p1  2 case fempar : object-ori parallel finit element framework 123 abstract concept practic import , allow us develop algorithm code appli topolog fit framework .
framework develop herein general includ triangl quadrilater 2d , tetrahedra , hexahe- dra , prysm , pyramid 3d .
furthermor , also extend arbitrari dimens , defin n-cube n-simplic mani topolog .
polytop mathemat defin convex hull finit set point .
consequ , polytop polyhedron .
frame fempar , consid poly- tope express imag composit two oper .
definit topolog refer fes base idea found [ 25 ] .
main topolog inform consum fe code descript d-dim polytop boundari assembl d  1-dim polytop , proceed recur- sive till 0-dim object obtain ( vertic ) ; use contract k-dim object say object dimens k. lower-dimension entiti describ polytop boundari denot herein n-face .
usual , nomenclatur use describ n-face fes restrict 3d problem .
fempar follow exposi- tion , use dimension-independ nomenclatur order accommod higher-dimension problem .
consid space dimens 2 n d-dim poly- tope .
defin d-face polytop .
set d  1-dim polygon compos boundari polytop d  1-face ; d  1-face usual denot facet .
proceed recurs , i.e. , defin- ing k  1-face polytop set facet k-face till reach 0-face .
3d , 3-face call cell , 2-dim face face , 1-dim face edg , 0-dim face vertic .
herein , use term n-face denot object .
work , denot vef set n-face dimens lower space dimens , e.g. , includ vertic , edg , face 3d .
let us introduc notat .
repres set bitmap size bm .
bitmap 1 ; 1 ; .
.
.
; 1 0 ; 0 ; .
.
.
; 0 repres 1 0 , respect .
given domain h  rd use notat ah b , 2 r , b 2 rd denot domain fax b : x 2 hg .
ej repres j-th canon basi vector rd .
let us defin first direct extrus hj ; ; b h respect direct ej type a ; b .
determin topolog extrus , name prysm-typ extrus ( 1 ) pyramid-typ extrus ( 0 ) ( see also [ 25 ] ) .
b determin whether want perform a- extrus ( 1 ) do-noth ( 0 ) .
base , follow definit .
definit 3.3 ( direct extrus ) given domain h  rd , defin hj ; ; b  rd , b ; 2 f0 ; 1g j  1 ; .
.
.
; , hj ; ; 0  : h ; hj ; 0 ; 1  : f1 zh zej : z 2 0 ; 1 g ; hj ; 1 ; 1  : fh zej : z 2 0 ; 1 g : direct extrus use recurs defin polytop n-face .
n-face determin topolog 2 bd , extrus e 2 bd , anchor vertex v 2 rd , use recurs procedur follow .
use direct extrus get differ polytop n-face illustr fig .
3 4 .
one observ lower dimension n-face direct extrus lead one dimens larger n-face differ valu .
definit 3.4 ( n-face ) given ; e 2 bd v 2 rd , defin n-face h recurs way follow .
let h 0  : fvg ; defin h : hd base follow recurs : h 0 !
h1  : h01 ; t0 ; e0 !
.
.
.
!
hi1  : h i1 ; ti ; ei !
.
.
.
!
hd  : hd1d ; td1 ; ed1 : 27 purpos , anchor vertex v 0/1 entri , thus , repres element v bd .
result , n-face uniqu repres t ; e ; v .
base definit , defin set d- dim polytop recurs .
d-dim polytop given , repres n-face t ; 1 ; 0 , i.e. , use origin 0 anchor vertex perform extrus direct .
hand , vertex v ( 0/1 coordin ) n-face t ; 0 ; v .
exampl n-face construct use procedur found fig .
3 4 .
furthermor , figur show n- face 3-cube 3-simplex , e v valu .
implement polytop , use hass diagram base composit extrus anchor vertex bitmap label differ n-face polytop .
code , like fempar , topolog code bitmap ( e.g. , one 32-bit integ ) .
fempar use geometri defin way , arbitrari space dimens .
polytop definit lead follow geometri .
1-dim line segment topolog  0 ( 1 ) ; ambigu 1d inherit higher dimens .
2d , triangl topolog  00 ( ( 01 ) ) quadrilater topolog  10 ( ( 11 ) ) .
3d , cube repres  1 ; 1 ; 0 ( ( 1 , 1 , 1 ) ) , s. badia et al .
123 tetrahedra  0 ; 0 ; 0 ( ( 0,0,1 ) ) , prysm  1 ; 0 ; 0 ( ( 1,1,1 ) ) , pyramid  0 ; 1 ; 0 ( ( 0,1,1 ) ) .
cosserat 4d repres  1 ; 1 ; 1 ; 0 ( ( 1,1,1,1 ) ) .
general , 2k1 type k-dim topolog possibl .
n-cube express  1 n-simplic  0 .
given bitmap bit , defin bit oper modifi j bit : oja .
given chain n-face ( 27 ) , let us assum hi1 repre- sent t ; e0 ; v .
extrusionhi  : hi1i ; ; a defin t ; e0 : oi1a ; v .
thus , chain ( 27 ) repre- sent follow .
given topolog , extrus e , anchor vertex v , start t ; e0 ; v : t ; 0 ; v proceed recurs : t ; e0 ; v !
t ; e0 : o0e0 ; v !
.
.
.
!
t ; e0 : oiei ; v !
.
.
.
!
t ; e0 : od1  1 ; v t ; e ; v : 28 e.g. , 3d , polytop ( 3-face ) determin  1 ; 1 ; 1 e ; v  1 ; 1 ; 1 ; 0 ; 0 ; 0 .
chain ( 28 ) case read follow : ( omit chain sinc element recurs . )
0 ; 0 ; 0 ; 0 ; 0 ; 0 !
0 ; 0 ; 1 ; 0 ; 0 ; 0 !
0 ; 1 ; 1 ; 0 ; 0 ; 0 !
1 ; 1 ; 1 ; 0 ; 0 ; 0 : use definit n-face , everi element chain geometr represent .
start vertex 0 , next obtain line segment fx ; 0 ; 0 : x 2 0 ; 1 g , next squar fx ; ; 0 : x ; 2 0 ; 1 g , final unit cube .
previous definit use repres d-dim object n-face .
see fig .
3 4 .
given n-face h t ; e ; v , want defin set sh n-face h. order , introduc follow concept .
definit 3.5 ( orient set extrus ) given set  fh : h 2 rdg , defin sj ; ; b , b ; 2 f0 ; 1g j  1 ; .
.
.
; : sj ; ; 0  : ; sj ; 0 ; 1  : fh ; 0 ej ; hj ; 0 ; 1 : h 2 sg ; sj ; 1 ; 1  : fh ; h ej ; hj ; 1 ; 1 : h 2 sg : definit 3.6 ( set n-face ) given n-face t ; e ; v , obtain n-face recurs follow .
let s0  : fvg ; defin  : sd base follow recurs : s0 ! s1 : s01 ; t0 ; e0 !
.
.
.
! si1  : sii1 ; ti ; ei !
.
.
.
! sd : sd1d ; td1 ; ed1 : 29 fig .
3 e v valu n-face ( except volum ) 3-cube , topolog  111 fig .
4 e v valu n-face ( except volum ) 3-simplex , topolog  000 fempar : object-ori parallel finit element framework 123 result n-face also written t ; e ; v notat comment .
order defin chain ( 28 ) ( i.e. , base bitmap notat ) , note follow .
given n-face h t ; e ; v , n-face h ej t ; e ; v : oj1 .
ingredi , implement generat n-face n-face use bitmap notat .
also want know facet n-face .
use follow statement .
given n-face h t ; e ; v correspond chain ( 28 ) , i-th element boundari oh  : ohi1i ; ti1 ; ei1 follow : oh  ohi1 ; ei 1  0 ; oh  fhi1 ; ohi1i ; 0 ; 1g ; ti 1  0 ; ei 1  1 ; oh  fhi1 ; hi1  ei ; ohi1i ; 1 ; 1g ti 1  1 ; ei 1  1 ; 30 oh1  fh0 ; h0  e1g .
use definit facet 3d cube , get follow face : ( ( 1 , 1 , 0 ) ; ( 0 , 0 , 0 ) ) ( ( 1 , 1 , 0 ) ; ( 0 , 0 , 1 ) ) face ( x  0 x  1 face ) , ( ( 1 , 0 , 1 ) ; ( 0 , 0 , 0 ) ) ( ( 1 , 0 , 1 ) ; ( 0 , 1 , 0 ) ) face (  0  1 face ) , ( ( 0 , 1 , 1 ) ; ( 0 , 0 , 0 ) ) ( ( 0 , 1 , 1 ) ; ( 1 , 0 , 0 ) ) face ( z  0 z  1 face ) , 6 face total .
everi one face , use definit , obtain d  2-face boundari everi d  1-face .
idea use polytop , n-cube .
dif- ferenc type extrus use everi case .
3.15 node generat index fe space polynomi space , e.g. , lagrangian poly- nomial .
( let us note div- curl-conform fes also reli lagrangian polynomi definit pre-bas definit equival class . )
order express polynomi , one must defin set point ( node ) .
follow , defin node generat given order arbitrari polytop , use lexicograph notat .
8 definit 3.7 ( set node ) let us consid polytop h 2 rd repres t ; 1 ; 0 .
set n k equidist lagrangian node order k , lexicograph notat , generat recurs follow : n k  : n kd , n pm1  fa ; b : 2 n pb1tm ; b 2 n p 1g ; n q1  fa 2 n  : a qg : 31 given node 2 nd lexicograph notat assum equidist distribut node , space coordin xa 2 rd readili obtain , xa  : a=k .
note n-cube recov typic tensor product definit node correspond truncat subset node n-simplic .
node generat also consid , especi high-ord element ( e.g. , feket point ) .
basic fe analysi ownership relat n-face node .
particular , basic enforc continu fes enforc continu nodal valu .
order generat node polytop belong n-face , use follow construct .
first , generat local set node , use def- init , n-face .
given k-face t ; e ; v rd , consid refer k-dim polytop t0 ; 1 ; 0 , t0 restrict compon extru- ded , i.e. , t0  :   g map  g : f1 ; .
.
.
; kg !
fj 2 f1 ; .
.
.
; dg : ej  1g .
next , defin local node n-face node refer polytop .
defin n-face node local coordin .
final , defin linear map refer k-dim polytop k-face .
map defin k  1 independ condit .
defin enforc map map anchor vertex refer polytop one k-face extrus anchor vertex direct : m0  v ; mes  em  gs ; 0s  0 ; mes  v em  gs ; 0s  1 : sinc map linear , written : mx  a0  x1a1  .
.
. xkak : form first constraint get a0  v. constraint , get : mes  vt0s  em  gs  v  !
 vt 0s  1  em  gs : thus , get : mx  v xk s1 xsvt0s  1  xsem  gs  xs ; 32 thus : 8 note fact order k scalar vector k 2 rd .
principl , use vector-valu order sens n-cube .
implement fempar make use vector- valu order , even though entri polytop n-cube .
note use differ order differ direct basic defin high order raviart-thoma nedelec element n-cube .
follow present , consid scalar order case simplic .
s. badia et al .
123 mxi  vi1 x fs  1 ; .
.
.
; k : t0s  0g xs  xm1  g i : could also obtain express invers map analog .
readili use map lexicograph coordin .
result , given k-face , defin node local number base lexicograph label refer k-face .
local- to-glob lexicograph label ( global label d-dim base polytop ) obtain appli map ( 32 ) .
3.16 global dof number conform basic ingredi fe analysi imposit continu among fes order build conform global fe space .
process mathemat defin equival class dof ( see sect .
3.6 ) .
exampl , function lagrangian fe space relat geo- metric node , impos continu function among fes equival impos continu nodal valu spatial posit ( see sect .
3.8 ) .
follow , provid mechan identifi node two differ cell share posit imple- ment requir equival class .
situat slight involv div-conform curl-con- form fe space .
case , one still determin dof node plus n-face ownership ( see sect .
3.9 3.10 , respect ) .
thus , equival class situat formul lagrangian fes ( deter- mine node posit ) everi n-face separ .
follow sect .
3.6 , node within cell trian- gulat repres ( b , k ) , b local cell-wis index node k cell global index .
given n-face f cell , node rep- resent b0 ; f ; k , b0 n-face-bas local index .
exampl , node 8 ( cell-wis local index ) cell fig .
6 also determin node 1 ( facet- wise local index ) n-face 8 ( see fig .
5 ) .
facet- wise local index determin coordin system use n-face .
exampl , node n-face 8 fig .
6 order ( 8 , 12 ) ( i.e. , first 8 12 ) .
hand , node indic repres coordin lexicograph coordin system , present ( 31 ) .
exampl , node b  8 ( b0  1 n-face 8 ) repres coordin  4 ; 1 ( s0  1 n-face ) .
let us consid n-face f triangul , two cell k ( sourc cell ) k ( target cell ) share n- face , node s0 ; f ; k s0 ; f ; k ( n-face- wise local indic ) .
question must answer : node s0 ; f ; k s0 ; f ; k spatial posit ?
question answer map pf ( 15 ) , given posit node coordin system f k , provid one k .
note map trivial use struc- ture ( possibl local adapt ) n-cube mesh , sinc local order node n-face base increas local index lead order cell con- tain n-face ; say mesh proper ori- ent case .
howev , 2d 3d unstructur mesh generat might return proper orient mesh , thus fe code deal explicit construct applic permut .
also note one alway end orient mesh n-simplic simpl cell-wis permut ( see , e.g. , [ 72 , sect .
5.5 ] [ 80 ] ) .
read n-simplex mesh , mesh alway proper orient fempar proceed comput .
also true 2d n-cube mesh , 3d n-cube mesh proper orient general [ 81 ] .
let us consid refer polytop k associ k k .
general , n-face f differ n-face local index respect two cell ; correspond fig .
5 number convent n-face k quadrilater ( left ) status vertices_n_fac facets_n_fac correspond number ( right ) .
n , p ( n ? 1 ) , l ( p ( n ? 1 ) -1 ) privat member variabl type ( list_t ) store number entiti , start posit l ( : ) list associ entiti , identifi associ list gather singl array , respect fempar : object-ori parallel finit element framework 123 refer n-face repres f  f  k k , respect .
general , map node two n-face defin use ( 32 ) , invert ( sinc linear full rank ) .
use approach , map generat arbitrari dimens polytop topolog .
howev , particular case 2d/3d n-cube mesh , implement proce- dure comput effici manner .
par- ticular , requir permut ( map ) express term set tabl , store set ( fill ) so-cal reference_fe_t abstract data type fempar .
refer sect .
6.3 detail implement detail .
( recal n-simplic mesh actual requir procedur alway proper ( ) orient . )
let us consid case 3d n-cube mesh .
vertic trivial one node permu- tation need .
edg face , reli three follow concept :  rotat index : provid local index anchor vertex f respect coordin system f .
fes share two edg , follow situat .
edg anchor vertex seen element , .
face , anchor vertex 4 posit .
call rotat repres map keep invari refer face f  make anchor vertic sourc target cell coincid .
 orient index : given two cell share n-face anchor vertex , orient index code map coordin system n-face respect first cell one respect second one .
9 edg , map alway ident , two cell share edg anchor node provid edge-wis node coordin node .
face , situat complex , involv 2 differ possibl situat .
orient index equal 0 ident permut 1 swap indic .
denot base face face lowest local index ( face [ 011|000 ] fig .
3 ) .
next , consid two cube share face , restrict follow scenario : ( 1 ) face base face least one cube ; ( 2 ) face anchor vertex two cube .
trivial comput orient index case .
orient index general case two cube share face restrict ( 2 ) , i.e. , two arbitrari face anchor vertex , obtain composit follow .
two face orient index base face , orient index equal 1 , 0 otherwis .
 permut index : index obtain composit rotat orient indic ( i.e. , rang 1 2 , 1 8 edg face , respect ) , codifi final map coordin two cell composit rotat orient map .
note composit possibl rotat orient cover possibl relat posit cell conform mesh .
4 implement polytope_t relat data type fempar , refer fe cell geometri defin polytope_t data type ; see list 1 .
input need defin polytop space dimens num_dimens topolog 32-bit integ topolog .
fig .
6 number convent dof ( scalar-valu ) bi-cub lagrangian fe top quadrilater ( left ) status own_dofs_n_fac reference_fe_t cg ( right , top ) dg form ( right , bottom ) 9 follow , one consid two unit cube share face .
sinc concept logic one take account real shape cell physic space .
hand , note orient index invari two cell share face select first second cell .
s. badia et al .
123 use idea ( 27 ) , ( 28 ) , ( 29 ) , creat set n-face polytop t ; e ; v ( privat ) fill_polytope_chain tbp , turn invok ( public ) creat tbp .
n-face polytop topolog , uniqu determin 32-bit integ repres composit e ; v .
note order n-face base e ; v mix n-face differ dimens non-consecut general .
thus , consid order base first n- face dimens , next e ; v .
set n-face generat recurs ( 29 ) store n_- face_array , array size number_n_fac .
array particular provid e ; v associ n- face .
invers map ( e ; v actual number ) store ijk_to_index array .
also possibl iter facet n-face , base ( 30 ) .
create_facet_iter tbp polytope_t creat facet_iterator_t instanc given n-face .
facet_iterator_t defin list 2 .
n-face e ; v store root , topolog extract polytop pointer member variabl .
iter facet describ two integ , compon coordin , use idea ( 30 ) .
complex travers facet code facet_iterator_next facet_iterator_ has_finish .
list 2 .
facet_iterator_t data type .
list 1 .
polytope_t data type .
fempar : object-ori parallel finit element framework 123 regard implement node within fempar , provid node_array_t data type repres set node defin ( 31 ) ; see list 3 .
construct polytop order .
provid creat tbp , perform ( 31 ) fill result node node_array array member vari- abl .
number node use consecut number increas lexicograph index .
node array provid lexicograph label one integ .
invers store ijk_to_index .
total number node store num_nod .
final , space coor- dinat node store coordin .
also provid node_iterator_t object ( see list 4 ) , iter node n-face ( s- tore n_face ) use ( 31 ) ( 32 ) .
pointer node_array base polytop .
intern , goe node n_face ( use ( 31 ) ) ( current node store displac ) , translat base polytop node number use ( 32 ) ( store coordin ) ; coordin comput demand call tbp node_iterator_cur- rent_ijk .
own_boundari logic allow one iter node consid n-face open close set .
note creat tbp node_array_t reli node_iterator_t .
5 polynomial_t abstract fempar , definit shape function hard- code , usual done fe code .
approach sever limit : ( 1 ) practic high order discret , code written arbitrari order ; ( 2 ) involv huge number code line analyt express shape function given set avail order ( see discuss [ 82 ] ) ; ( 3 ) allow dimension-independ code .
instead , consid framework base concept sect .
3.5 , one consid pre-basi , defin moment , perform chang basi .
pre-basi defin use product 1d function ( e.g. , cartesian product ) , 1d function generat written term ( arbitrari ) order .
machineri generat 1d function restrict moment polynomi function one variabl , name lagrangian polynomi , monomi , b-spline , implement extend choic .
product 1d function cartesian product 1d lagrang polynomi ( monomi ) , defin qk space n-cube , reduc combin monomi defin pk space n-simplic .
list 3 .
node_array_t data type .
list 4 .
node_iterator_t data type .
s. badia et al .
123 definit refer fe function space reli polynomial_t data type list 5 , repres polynomi one variabl , i.e. , px  pk i0 aix k. thus , 1d polynomi defin term order k set k  1 coeffici faigki0 , store order coeffici array , respec- tive .
differ type extens polynomial_t consid far , name lagrange_polyno- mial_t monomial_t .
first one generat lagrangian polynomi sect .
3.4 , co- effici array first order entri coordin node last entri coeffici 1 pn2n knfmgxmxs ( 7 ) .
monomial_t extens repre- sent xk k order .
trivial case polynomial_t optim purpos uniqu defin order ( coeffici array need ) .
also consid polynomial_basis_t data type , set ( array ) ( polymorph ) polynomi .
point , defin lagrang polynomi monomi one variabl .
lagrange_polyno- mial_t monomial_t also provid bind generate_basi generat lagrangian monomi basi polynomi , given order k. result subroutin polynomial_basis_t includ mani polynomi polynomi space dimens .
case lagrangian basi , imple- ment basi lk sect .
3.4 , wherea bind monomi simpli implement fxigki0 .
next step generat higher dimension space .
consid two type space .
first one space generat cartesian product 1d space , implement data type tensor_pro- duct_polynomial_space_t .
data type defin number space dimens mani polynomial_basis_t space dimens .
data type appli combin 1d space .
e.g. , case 1d lagrang base ( possibl differ order node per dimens ) , lead list 5 .
polynomial_t data type relat data type .
fempar : object-ori parallel finit element framework 123 multi-dimension basi ( 8 ) .
thus , data type lagrangian 1d base generat lagrangian fe space top n-cube cell , i.e. , qk space polynomi .
10 furthermor , also consid trun- cated_tensor_product_polynomial_space_t extens generat lagrangian fe space n-sim- plice , i.e. , pk space polynomi .
case , generate_basi tbps monomial_t use creat monomi 1d base per direct order also direct .
otherwis , result multi-vari function would sens .
next , combin 1d monomi involv term jaj  k ( see sect .
3.4 ) , generat pre- basi fe space tetrahedra , i.e. , pk space polynomi .
note abstract represent polynomi space one defin refer fe local space .
howev , unless one consid 1d lagrangian basi tensor product polynomi n-cube , result basi shape function basi .
even case lagrangian n-simplic , change-of-basi need , use procedur sect .
3.5 take nodal valu moment .
sect .
9.5 , show defin shape function basi case div-conform fes arbitrari order .
idea appli grad-conform lagrangian fes n-simplic curl-conform fes general , includ sake breviti .
6 reference_fe_t abstract section , introduc reference_fe_t data type .
data type oo represent stan- dard mathemat definit refer fe present sect .
3.3 , name , refer cell geometri k , function space v , set dof r defin top .
reference_fe_t central abstract fe librari must judici design extens reusabl .
particular , must accommod lagrangian fes , also ( involved/gener ) space like raviart-thoma edg fes , dg method , b-spline patch .
extens reusabl design reference_fe_t allow one , e.g. , easili incorpor new local function space origin consid , without rewrit ( thus recompil ) code ground set method provid reference_fe_t .
end , fempar , reference_fe_t abstract data type serv templat equip set member variabl defer bind subclass set implement ( i.e. , overrid ) , respect , order complet descript concret fe space hand .
definit reference_fe_t data type , classif member variabl three differ categori ( correspond three ingredi ciarlet  definit ) , enumer relev regular defer bind , shown list 6 .
10 analog , one could generat serendip element chang generat multi-dimension space term 1d one .
s. badia et al .
123 list 6 .
reference_fe_t abstract type , classif member variabl , enumer relev regular defer bind .
fempar : object-ori parallel finit element framework 123 section structur follow .
member variabl three aforement categori cover detail sect .
6.16.3 , respect .
sect .
6.4 , discuss oo design pattern chosen fempar creation reference_fe_t poly- morphic instanc , describ argument uniqu defin subclass data type ; line mathemat definit .
sect .
6.5 , enumer- ate briefli describ subclass refer- ence_fe_t current avail fempar .
note section self-contain defer bind reference_fe_t cover .
involv interact data type oo design , describ section interact expos .
code comment list 6 serv tabl content articl section defer bind cover .
6.1 refer cell topolog refer cell k polytop .
therefor , follow sect .
3.14 , describ topolog , code set bit , dimens polytop .
refer cell topolog generat use poly- tope_t describ sect .
4 , offer method like composit local number n-face .
polytop topolog includ triangl quadrilater 2d , tetrahedra , hexahedra , prysm , pyramid 3d .
member variabl charg descript ref- erenc cell topolog k shown line 510 list- ing 6 .
user must provid topolog dimens polytop defin k , store member variabl topolog num_dimens , respect .
set getter return basic inform , relat data generat , e.g. , number n-face boundari cell store num_n_fac member variabl .
list vertex identifi per n-face list facet ( dimens n 1 ) per n-face store ver- tices_n_fac facets_n_fac , respect ; see fig .
5 illustr member variabl data type list_t use fempar store tra- vers list .
fempar data type list_t store set ( vari- able-s ) list integ identifi , one per entiti ; particular scenario , entiti n-face .
shown fig .
5 , current implement data type use compress storag layout , e.g. , compress storag format spars graph .
order preserv encapsula- tion data hide , list_t offer rich set tbps let user set ( step step ) new list_t instanc ; type also provid list_iterator_t type let sequenti read/writ integ identifi list associ entiti .
code snippet list 7 illustr iter print identifi vertic belong n-face identifi n_face_lid .
number n-face dimens easili comput ptr_n_faces_x_dim .
note ptr_n_faces_x_dim list_t instanc , sinc adopt convent n-face number lowest highest dimens , thus p array list actual need ( see fig .
5 ) .
exampl fig .
5 , valu array f1 ; 5 ; 9 ; 10g , sinc 4 vertic ( dimens 0 ) , 4 facet edg ( dimens 1 ) , 1 cell ( dimens 2 ) .
6.2 refer fe space given cell topolog , differ definit function space set dof possibl , e.g. , one nodal lagrangian grad-conform refer fe sect .
3.8 , raviart-thoma div-conform refer fe sect .
3.9 , curl-conform nedelec refer fe sect .
3.10 .
member variabl refer- ence_fe_t requir describ function space v support k encompass within line 1316 list 6 .
list 7 .
user-level code illustr print screen ( local within cell ) vertex identifi belong n-face ( local within cell ) identifi n_face_lid .
s. badia et al .
123 local fe space v determin member variabl fe_typ , ( case ) field_typ , order .
fe_typ uniqu identifi concret fe space hand .
possibl valu provid mean public paramet constant fe_type_lagrangian , fe_type_raviart_thoma , fe_type_ned- elec correspond reference_fe_t imple- mentor current support fempar ; see sect .
6.5 addit detail .
field_typ identifi   type   physic field discret , i.e. , whether scalar , vector-valu , etc .
fe space inher vector-valu , e.g. , raviart-thoma edg fes .
howev , lagrangian fes either use discret scalar , vector , tensor-valu field , field_typ must provid .
assum v parameter respect order , store order .
valu , generat addit data , e.g. , number shape function store num_shape_funct .
exampl , ( scalar-val- u ) bi-quadrat ( 2d ) tri-quadrat ( 3d ) lagrangian fes , field_typ scalar , num_compon equal 1 , order equal 2 , num_shape_- function equal 9 27 , respect .
6.3 set local dof addit data requir describ set dof r v .
particular , member variabl encompass within line 1923 list 6 serv purpos .
conform member variabl determin whe- ther global fe space x h conform respect infinite-dimension space x , i.e. , whether xh  x .
use describ n-face own everi dof , requir enforc conform global fe space equival class ( see sect .
3 ) .
e.g. , lagrangian fes , set .true .
result grad- conform global fe space , wherea set .- fals .
result discontinu space dg meth- od .
conceptu possibl set .true .
cell fals other , lead cdg method [ 83 ] .
hand , continu member variabl determin x , tell us whether x admit trace oper .
rough speak , tell us whether must enforc type continu discret level preserv conform , e.g. , full , tangenti , normal trace h1x , hcurl ; x , hdiv ; x , respect .
valu continu .fals .
x  l2x , sinc continu requir .
continu .false. , conform must .true.. continu bare use ( see discuss next paragraph ) .
valu conform use generat own_dofs_n_fac member variabl type list_t .
member variabl store , everi n-face , dof own ; see fig .
6 .
cg method , notion ownership relat geometr locat .
dg fes , although node function still geometr locat boundari cell , nevertheless own cell , consid interior dof , sinc global conform enforc .
array heavili use generat global dof number .
11 hand , dofs_n_fac member variabl , determin , given n-face , set dof respect shape function non-zero n-face .
continu member variabl ( current ) use dg method parallel distributed-memori environ- ment .
particular , order decid whether associ global dof identifi node interfac facet ghost cell ( thus abl defin non- singular sub-assembl matric dd method [ 84 ] dg discret ) .
dofs_n_fac member variabl use continu .true .
global dof number generat , also might use triangul subclass ( see sect .
7 ) order extract coordin node top vertex , edg , face ( use dofs_n_fac member variabl reference_fe_t instanc describ geometri cell ) .
exampl , fig .
6 , list cor- respond n-face identifi 8 dofs_n_fac { 4,8,12,16 } .
reference_fe_t data type play crucial role algorithm charg assign global dof iden- tifier node function distribut interior triangul cell boundari n-face .
( algorithm , cover detail sect .
10 , ground notion equival class introduc sect .
3 . )
particular , function-lik ( regular ) bind refer permute_dof_lid_n_fac ( see line 32 list 6 ) implement map pf ( 15 ) .
function take input so-cal permut index sect .
3.16 , local index node within n-face given dimens ( e.g. , 3d , either 0 vertic , 1 edg , 2 face ) perspect sourc cell , return local index node within n-face perspect target cell .
12 11 consid three level dof number : cell-wis dof number ( refer local dof ) , subdomain-wis dof number ( refer global dof ) , full domain global dof .
latter number never created/requir fempar .
serial environ , latter two match .
12 note respons determin permut index lay reference_fe_t , abstract fempar repres mesh comput domain ; see sect .
7 .
fempar : object-ori parallel finit element framework 123 particular transform appli global dof identifi alreadi assign n-face node sourc cell , want transfer n-face node target cell ; see sect .
10.3 .
bind , implement reference_fe_t , ultim reli own_dof_permut ( : ) member variabl ; see line 23 list 6 .
allocat array index n-face dimens ( i.e. , 1 edg , 2 face ) .
n-face dimens larger 0 , contain rank-2 allocat array ( i.e. , type ( allo- catable_array_ip2_t ) base type array ) , serv lookup tabl implement aforement transform .
particular , row index local index node identifi top n-face perspect sourc cell , column permut index ; see sect .
3.16 .
entri correspond row column tabl provid local index node within n-face perspect target cell .
lookup tabl fill within fill_own_dofs_permuta- tion defer bind reference_fe_t .
note latter bind , permute_dof_lid_n_- face , declar overrid bind list 6 purpos .
let , e.g. , subclass reference_fe_t use conjunct ( proper orient ; see sect .
3.16 ) n-simplex mesh implement former own_dof_permut ( : ) member variabl alloc fill , latter alway return ident transform .
6.4 creat reference_fe_t polymorph instanc central oo softwar system reli abstract data type approach chosen creat polymorph instanc runtim .
simplic , fempar follow so-cal simpl factori design pattern [ 85 ] .
take form singl stand-alon function , call make_reference_f , select dynam type polymorph instanc return runtim base valu dummi argument topolog fe_typ .
( exampl , assum topolog hexahedron fe_type_lagrangian , select dynam type hex_lagrangian_ref- erence_fe_t , i.e. , concret data type implement lagrangian-typ fe space top n-cube . )
return , call defer bind refer- ence_fe_t , call creat , respons leav reference_fe_t fulli function state .
interfac defer bind shown list 8 .
remark field_typ free paramet lagrangian fes ( i.e. , particular refer- ence_fe_t subclass ) .
word , must field_type_vector raviart-thoma edg element .
note despit fix set dummi argu- ment interfac , proven suffici fulli describ subclass current avail fempar ; see sect .
6.5 .
howev , event need , extens mind , singl paramet dictionari \key ; valu [ pair might use instead ; fempar inde reli implement data type key string ( typic denot name paramet ) , valu scalar arbitrari rank array intrins even user-defin type .
13 6.5 enumer reference_fe_t subclass rather complex data type hierarchi root reference_fe_t fempar , judi- ciousli design code re-us main driver .
( exampl , lagrangian fe space top n-cube n-simplic share member variabl code gather common base data type . )
sake breviti , work cover full detail implement data type hierarchi ( except detail given sect .
5 9.5 ) .
howev , 13 data type implement within fpl softwar packag [ 86 ] .
list 8 .
signatur creat bind reference_fe_t .
s. badia et al .
123 complet , conveni enumer ref- erence_fe_t subclass , present , avail hierarchi .
subclass , lay leav hierarchi , follow one :  hex tet_lagrangian_reference_fe_t .
space polynomi arbitrari degre k top n-cube ( i.e. , tensor-product like space qk ) n- simplic ( i.e. , pk ) , respect , discret either scalar-valu , vector-valu tensor-valu field ; see sect .
3.8 .
select ownership relationship among node function n-face appro- priat ( see sect .
6.3 ) , fe space either global continu , entir discontinu across cell boundari .
 hex tet_raviart_thomas_refer- ence_fe_t .
vector-valu raviart-thoma fe arbitrari degre k top n-cube , n-simplic , resp. , suitabl mix laplacian problem fluid flow problem .
global fe function space ( conform variant ) continu normal compon across cell face ; see sect .
3.9 detail .
 hex tet_nedelec_reference_fe_t .
vector-valu curl-conform nedelec fe arbitrari degre k top n-cube , n-simplic , resp. , suitabl electromagnet problem .
global fe function space ( conform variant ) continu tangenti compon across cell face ; see sect .
3.9 detail .
 void_reference_fe_t .
softwar artifact repres fe space dof , neither cell interior , boundari n-face .
sort softwar resourc proven extrem effici : ( 1 ) numer solut pde subdomain origin discret domain ( thus align cell boundari ) ; ( 2 ) numer solut pde use xfem-lik dis- cretize techniqu ( ground fe space assign dof cell exterior embed domain ) ; ( 3 ) simplifi implement discret method pde problem involv coupl interfac level , e.g. , fluid- structur interact .
apart reference_fe_t subclass , alreadi conclud develop within hierarchi beta version code , b-spline [ 8 ] , schedul develop , div-conform fes [ 7 ] .
7 descript physic domain : triangulation_t abstract central abstract fe numer simul code one describ triangulation/mesh h physic domain x  rd problem pose .
( practic , mesh generat x introduc geo- metric error , mesh fact approxim domain xh ) .
fempar , abstract call tri- angulation_t .
flexibl , code reus mind , abstract data type .
sect .
7.1 , introduc triangulation_t , mechan provid subclass order preserv encapsul data hide , still let subclass store access data effici .
complet , sect .
7.2 , intro- duce detail under implement particular concret subclass triangulation_t .
7.1 abstract triangul represent softwar implement section , present abstract ( conceptu ) repre- sentat triangul fempar expos user- level applic librari softwar abstract ground ( see , e.g. , sect .
10 ) .
conceptu represent provid set abstract deriv data type ( method bound ) converg result experi accommod wide rang state-of-the-art fe discret solver techniqu within singl framework , desk- tops/laptop , high-end distributed-memori supercom- puter ( see sect .
2 ) .
sake breviti , work restrict subset represent provid support implement high-ord conform non- conform fe discret ground conform mesh serial comput environ .
stress , howev , actual ( complet ) represent also incorpor concept express mesh distributed- memori environ ( e.g. , set cell subdomain divid local cell layer cell own remot subdomain , denot ghost cell ) .
also provid support implement high-ord hp-adapt ( i.e. , local refin , non-conform mesh ) conform non-conform fes ( use hang node constraint [ 82 ] subfac integr facet cell differ refin level , respect ) implement xfem-typ techniqu ( see [ 60 ] refer therein ) ; provid implicit represent geometri domain , background mesh abl know whether cell interior , exterior cut domain , latter case , fempar : object-ori parallel finit element framework 123 provid coordin intersect point .
extra express come form addit data type extend set method data type cover section .
stress , howev , neither former latter one cover section .
although abstract represent triangul proven high express , claim , howev , triangul represent univer- salli applic implement arbitrari numer discret solver techniqu .
inde design extra extens foreseen satisfi requir .
triangul represent encompass topolog geometr data .
triangul con- ceiv partit x set cell ( d-face ) .
cell uniqu identifi global identifi rang cell gid  1 ; .
.
.
; num cells.14 apart cell , triangul also compos set lower dimen- sional object , i.e. , set k-face , k  0 ; .
.
.
;  1 .
also refer element set   vef   , pro- vide  3 case , compos vertic , edg , face .
object set uniqu identifi global identifi rang vef gid  1 ; .
.
.
; num vefs.15 apart cell vef , triangul also encompass adjac data .
sort data describ n-face mesh relat .
denot f set n-face mesh , fk set k- face , fi f k i-th n-face ( arbitrari dimens ) i-th k-face ( fix dimens k ) , respect .
conform mesh , main two relev type adjac relationship , name compo- sition ( m-face part k-face m\k ) neighbourhood ( m-face around given k-face [ k ) .
follow [ 87 ] , set m-face adjac fki , denot fki hfmi ( i.e. , oper hi select set m-face adjac one left ) .
triangu- lation conform fempar abstract represent abl provid composit data f3i hfi , neighbourship data fihf3i , , n-face compos cell cell around n-face .
triangul also includ geometri data .
cell geometri repres map uk polytop k refer space physic space ( see sect .
3 ) .
map repres function scalar fe space ( e.g. , ground high-ord lagrangian fes b-spline ) , dof valu vector node coordin ( i.e. , point_t instanc ) physic space .
core softwar design charg provid triangulation-rel data cover far abstract data type name triangulation_t .
( rational behind data type abstract made clear cours section . )
data type defin shown list 9. triangulation_t conceiv templat subclass conform .
one hand , compos ( minim ) set member variabl encompass data common triangul .
particular , triangul embed num_dimensions-dimension space , compos total number num_cel ( num_dimensions- dimension ) cell num_vef vef , respect ; see line 35 list 9 , respect .
hand , triangulation_t equip set defer method subclass triangulation_t must implement ; see line 1118 .
rational under method requir elabor , discuss sequel.14 note actual conceptu represent triangu- lation fempar differ among local ( subdomain ) cell identifi global cell identifi ( among whole triangul domain ) distributed-memori context .
second sort identifi code long precis integ , i.e. , inte- ger ( igp ) , order accommod simul 231  1 global cell .
15 mention case cell , actual conceptu represent triangul fempar differ among local ( subdomain ) vef identifi global vef identifi ( among whole triangul domain ) distributed- memori context .
latter one long precis integ .
s. badia et al .
123 order construct conceptu view triangu- lation_t suitabl user ( librari ) code need , fempar reli so-cal iter oo design pat- tern [ 88 ] .
iter data type provid sequenti travers full set object togeth ( conceptu ) compris triangulation_t mesh- like contain .
sever differ iter avail- abl , one relat differ set object travers .
exampl , cell_iterator_t provid travers set compos cell , vef_iterator_t one compos vefs.16 softwar design , iter creat freed set public tbps provid triangulation_t ; see line 1118 list 9 .
thus , exampl , expres- sion call triangul % create_cell_iter- ator ( cell ) creat iter cell client-spac instanc , call triangul % free_- cell_iter ( cell ) free .
iter sequenti travers object increas order global identi- fier .
howev , note triangulation_t sub- class complet free decid intern label object .
17 reader might alreadi note mini- mal set member variabl list 9 ( among other ) , softwar design want provid complet flexibl concret subclass triangu- lation_t respect intern layout ( topolog geometri ) data provid .
end , triangulation_t abstract class defer decis subclass .
clear separ among data handl ( i.e. , store access ) privat data structur ( member variabl ) under- lie triangulation_t subclass , concep- tual/abstract view triangulation_t expos fempar user .
view render triangulation_t easili access understand .
wherea public interfac triangulation_t use client code design stabl time , intern triangulation_t subclass , howev , allow ( subject ) chang time ( e.g. , order accommod optim , addit require- ment , etc . ) .
price dynam run-tim polymor- phism , triangulation_t subclass might design strong strive preserv encap- sulat data hide still store access data effici .
thus , e.g. , triangulation_t sub- class charg handl structured/uniform mesh simpl domain may decid explicit store cell- wise global vef identifi , vertex coordin mesh , instead provid implicit demand function global cell identifi .
apart encompass logic under actual travers object set hand , iter also follow crucial respons .
follow softwar concept   accessor   present [ 17 ] , abl teas data relat current object seat global array rest privat data structur compris intern correspond triangulation_t subclass .
therefor explicit store , e.g. , global vef iden- tifier current cell .
instead , know fetch 16 complet , let us mention triangulation_t also offer travers subset object conveni select acceler purpos .
exampl , triangulation_t provid iter vertic , edg , face lay interfac among subdomain , call itfc_vef_iterator_t ( i.e. , subset set object travers vef_iterator_t ) subclass suitabl parallel distributed-memori environ .
17 thus , e.g. , triangulation_t subclass intern label global identifi vef dimens increas order would result travers order .
howev potenti chang time low-level implement detail user program reli triangulation_t associ iter assum reli .
list 9 .
triangulation_t abstract data type .
fempar : object-ori parallel finit element framework 123 correspond triangulation_t sub- class data structur suitabl user need .
pro- vide respons triangulation_t subclass decid intern layout data , iter abstract data type well , tbps deferred/virtu .
also justifi method line 1118 list 9 defer , corre- spond iter dummi argument , polymorph allo- catabl .
ultim respons concret subclass triangulation_t decid execut time dynam type polymorph variabl creat .
let us next discuss rational under design iter cell vef .
data type defin list 10 , set must actual replac correspond name uniqu identifi set object travers iter hand , i.e. , either cell vef .
fig .
7 , illustr implement partial ( select ) subset bind data type .
creat bind set_iterator_t take input polymorph triangulation_t instanc travers , leav iter posit first object set , i.e. , state readi start sequenti travers object ; see fig .
7 .
method ( like free ) intend direct call user .
instead , triangulation_t client reli defer bind triangulation_t pre- sent list 9 .
init , next , has_fin- ish bind let client posit iter first object set , move next object , check whether object alreadi travers , respect ; see fig .
7 .
actual set ( defer ) tbps triangula- tion_t iter high depend type object point .
briefli discuss tbps set correspond cell vef iter provid support subset triangul conceptu rep- resent focus .
particular enumer list 11 .
fig .
7 implement partial ( select ) subset bind set_iter ( see list 10 ) list 10. triangulation_t   set   ( either cell vef ) iter .
s. badia et al .
123 tbps line 812 list 11 charg provid data relat composit relationship f3i hfi .
particular , get_num_vef bind return number vef boundari mesh ( i.e. , cardin composit relationship ) .
given local index vef cell ( within rang 1 ; .
.
.
; num vef ) , get_vef posit vef_itera- tor_t instanc input point vef , get_vef_gid , return global identifi ; get_vef_lid perform invers translat one get_vef_gid .
final , get_vefs_gid let cli- ent obtain global identifi vef current cell one shot provid user-spac pointer integ array .
semant last tbp subclass cell_iterator_t allow alloc provid pointer , associ exist ( intern ) memori ( increas perform memori leak avoid ) .
tbp line 15 list 11 provid support implement transform procedur describ sect .
3.16 .
particular , bind invok cell_iterator_t instanc posit sourc cell , given cell_iterator_t posi- tion target cell , n-face local identifi within former latter cell , return permut index ; see sect .
3.16 .
stress rotat orient indic alway comput use tbps previous paragraph .
exampl , order deter- mine rotat index , one extract global id anchor vertex n-face target cell ( call list 11 .
subset defer tbps cell_iterator_t vef_iterator_t data type ( follow-up list 10 ) .
fempar : object-ori parallel finit element framework 123 get_vef_gid ) , search global id set vertic compris n-face target cell ( use iter correspond sublist ver- tices_n_fac ; see sect .
6.1 ) .
howev , prefer provid special defer bind purpos order leav room optim triangu- lation_t subclass .
exampl , case subclass work orient mesh , get_permutation_index may implement alway return permut index correspond ident transform .
case subclass triangulation_t intend remain static ( adapt infrequ ) cours simul process ( see , e.g. , sect .
7.2 ) , might benefici perform precalcul possibl permut indic set lookup tabl , re-us way without perform aforement search .
tbps line 1820 charg provid cell geometri related-data .
particular , get_refer- ence_f return polymorph pointer refer- ence_fe_t instanc describ space function map uk belong .
get_num_nod get_nodes_coordin return number node describ geometri cell , associ coordin physic space , respect .
instead pointer user-spac array associ intern storag ( get_vef_gid ) , get_nodes_coordi- nate take user-spac ( pre-alloc ) array type point_t instanc , fill ( reason made clear sect .
8.3 ) .
assum reference_fe_t bi-linear lagrangian fe quadrilater , get_- num_nod would return 4 ( one node per cell-vertex ) , get_nodes_coordin coordin physic space vertic .
triangulation_t subclass let cli- ent classifi cell set .
set global identifi integ number , name set_id .
method get_set_id set_set_id let caller associ set current cell , retriev set cell current associ .
cell set identifi primarili ( although ) use fe_space_t set-up ; see sect .
10 .
particular , instruct latter determin reference_fe_t instan- ces use top cell belong set .
exampl , assum want solv scalar , single- field pde problem subdomain origin domain ( assum align cell boundari ) , would use two differ set .
first cell interior subdomain , second exterior .
could associ e.g. , linear lagrangian refer fe cell first set , void_reference_fe_t cell second set ; see sect .
6.5 .
sit given vef , tbps line 3637 charg provid data relat adjac rela- tionship fihf3i .
particular , get_num_- cells_around return cardin , get_cell_around return cell set .
precis , latter tbp posit instanc cell_iterator_t input point cell set identifi index within rang 1 ; .
.
.
; get num cell around .
order cell around vef list arbitrari , code reli triangulation_t assum , e.g. , order increas global cell identifi .
hand , get_num_nod get_nodes_coordin return number point top vef ( includ top lower- dimension one boundari ) , associ coordin physic space , respect ; see line 4041 .
adopt convent node ( local ) label ( within input/output array point coordin fill ) accord refer coor- dinat system first cell around vef , i.e. , cell obtain vef % get_cell_around ( 1 , cell ) .
tbps line 4448 let client determin whether vef interior domain boundari , vef dimens ( e.g. , 3d , would return 0 , 1 , 2 vertic , edg , face , respect ) retriev set vef current associ , associ new set , respect .
set case vef primarili use codifi boundari condit pde problem hand , discuss sect .
10.4 .
point alreadi posit show user- level code exploit softwar design cover far .
particular , list 12 split whole set triangul cell two disjoint set , contact boundari domain , interior .
s. badia et al .
123 7.2 exampl triangulation_t subclass rational section , discuss particular subclass triangulation_t intern organ order effici provid triangulation-rel data mean softwar abstract present sect .
7.1 .
sub- class static_triangulation_t .
static_- triangulation_t codifi conform mesh , set scratch begin simul , remain unalt whole process .
hand , static_cell_iterator_t static_vef_iterator_t two non-abstract data type extens cell_iterator_t vef_it- erator_t , respect .
overrid set defer method former one , latter one teas data relat current object seat global array rest privat data structur compris intern static_ triangulation_t .
singl approach layout data within given triangul subclass .
seek accept- abl trade-off among memori consumpt , comput time requir set , updat ( appli ) , access triangul data , frequenc oper perform guid intern organi- zation .
exampl , [ 87 ] , two storag layout pre- sent , memori comput cost comput possibl adjac relationship evalu 3d .
first one , call one-level represen- tation , defin f1i hf0i , f2i hf1i , f3i hf2i , f0i hf1i , f1i hf2i , f2i hf3i ( neighbourhood inform ) .
word , store vertic edg , edg face , face cell , togeth edg around vertic , face around edg , cell around face .
second one , call circular represent , defin composit inform f1i hf0i , f2i hf1i , f3i hf2i ( ) , togeth neighbourhood inform f0i hf3i ( cell around vertic ) .
import properti two storag layout complet , i.e. , possibl determin adjac without loop entir mesh .
storag requir uniform mesh cube domain nc cell 48nc ( hexa- hedra ) 24nc ( tetrahedra ) former , 32nc ( hexahedra ) 16nc ( tetrahedra ) latter .
howev , oper count determin adja- cenci , although independ nc , high .
exampl , case one-level represent , obtain cell around vertex requir 48 ( hexahedra ) 140 ( tetrahedra ) oper , wherea one oper need obtain cell around facet .
case circular represent , queri involv one 148 ( hexahedra ) 299 ( tetrahedra ) oper , respec- tive [ 87 ] .
( recal kind adjac requir fempar present sect .
7.1 . )
anoth quit differ storag data layout one follow triangul deal.ii librari [ 17 ] , essenti defin composit data f1i hf0i , f2i hf1i , f3i hf2i ( refer hierarch cell repre- sentat author librari ) , neigh- bourhood data f3i hf2i store cell-wis ( i.e. , given cell store identifi cell neighbour across face within cell ) .
besid , ( potenti non-conform ) triangul librari conceiv ( explicit list 12 .
user-level code illustr usag data type associ tbps support fempar conceptu triangul represent .
fempar : object-ori parallel finit element framework 123 repres ) collect tree , cell coarsest conform mesh ( generat deal.ii simpl domain , read file sever file for- mat ) form root , children branch parent cell , thus form binary-tre , quad-tre oct- tree  1 ; 2 ; 3 spatial dimens , respect [ 17 ] .
ancestor ( i.e. , so-cal   inac- tive   cell ) leaf cell tree ( i.e. , so-cal   activ   cell ) store , latter one actual form partit domain .
apart hierarchi cell , deal.ii triangul also maintain hierarchi k- face k  1 ; .
.
.
;  1 .
quit complex data struc- ture justifi author two reason .
first , allow effici implement adapt mesh adapt ( includ coarsen refin ) .
hierarchi n-face aid process handl so- call hang node constraint requir build con- form fe space top non-conform mesh .
second reason implement ( geometr ) multigrid precondition ground adapt tree .
particular , precondition requir dof also associ inact cell .
thus , also inact n-face explicit exist triangul .
case , structur hard generat maintain , fit well integr parallel octre librari [ 89 ] , like p4est [ 90 ] .
whole hierarchi must gen- erat scratch mesh adapt step .
how- ever , base experi , hierarchi realli need effici implement adapt refin .
second reason , i.e. , implement serial hierarch multigrid solver deal.ii , would prob- abli complic without hierarch represent mesh .
hierarch cell represent deal.ii proven success implement high complex hp-adapt fe discret [ 82 ] reduc memori consumpt f3i hfi , restrict global vef identifi cell ( frequent oper fe code ) , becom signific expens storag layout oper requir permut among refer coordin system cell own vef one restrict ; appli restrict global dof identifi cell dof store n-face-wis .
furthermor , non-complet storag layout .
par- ticular , neighbourship data fihf3i comput user mean loop cell .
besid , prevent librari support loop facet mesh , access neighbour cell , natur oper implement dg method .
experi , facet-loop base integr dg term ( versus cell-loop base ) lead softwar signific easier use , might design complex under facet integr hidden user ( see sect .
9 ) .
final , although effici hierarch local mesh adapt ( within subdomain ) , sever drawback cost set ( scratch ) given initi conform coars mesh ( mitig reduc coars mesh resolut , price potenti lose geometri model accuraci ) , , distributed-memori envi- ronment , even cost regener adapt non-conform forest tree re-distribut step among process dynam load-balanc [ 90 ] .
inde , [ 89 ] , latter report second cost oper simul pipelin , linear solver step .
static_triangulation_t data type explic- it store composit data f3i hfi , neigh- bourship data fihf3i within intern ( privat ) member variabl .
18 memori consumpt complet storag layout 52nc ( hexahedra ) 28nc ( tetrahedra ) , less twice one one-sid cir- cular represent [ 87 ] .
price increas memori consumpt , static_triangulation_t abl provid requir adjac data o1 arithmet complex .
besid , cell-bas storag composit relationship perfect suit migrat parallel distributed-memori environ .
hand , amount perman storag data layout reduc one exploit fact neighbourship data requir specif part code .
exampl , unstructur mesh generat usu- alli provid composit data f3i hf0i .
case , static_triangulation_t requir neigh- bourship data f0i hf3i ( plus refer cell topolog data encompass within reference_fe_t instanc map cell ; see sect .
6.1 ) order set composit data f3i hf1i f3i hf2i .
also need triangulation_t subclass suitabl distributed- memori comput , among other , set data structur requir perform nearest neighbour exchang dof nodal valu among subdomain .
( stress process requir global identifi interfac dof consist among subdomain share dof . )
latter scenario , adjac data requir n-face lay inter-subdomain interfac ( interior ) .
evalu facet integr ( design fempar , see sect .
9 ) also requir least f2i hf3i f1i hf2i , 2d 3d , respect .
use full adjac data need implemen- tation advanc numer discret scheme , e.g. , 18 note f3i hf3i simpli f3i store .
s. badia et al .
123 implement nodal-bas shock detector monoton fes [ 58 , 59 ] .
due aforement rea- son , decid design static_triangula- tion_t perman store data , stress softwar design triangul subclass alway free offer method set destroy data demand reduc amount perman data storag .
static_triangulation_t data type , toge- ther select set bind , defin shown list 13 .
go detail , two main point remark respect type intern layout data .
first , reli way intrins fortran allocat array .
sort data structur perfect suit particular case static_triangulation_t , due static natur .
stress , howev , effici data structur ( i.e. , abl mitig effect frequent/cost allocat- abl array re-alloc ) would conveni also support mesh adapt ( e.g. , link list , even better data local , data structur semant close std : vector c ? ?
standard templat librari , fact alreadi fempar includ breviti ) .
second , increas data local cell vef sequenti travers ( thus effici memori hierarchi modern comput architectur ) data store cell-wis vef- wise local array , global array index either global cell vef identifi .
collect reference_fe_t polymorph instanc store reference_f ( : ) array ( see line 4 list 13 ) .
instanc uniqu iden- tifi ( within local scope static_triangula- tion_t ) posit array .
given cell global identifi cell_gid , fe space func- tion cell map uk belong , describ reference_fe_t instanc identifi cell_to_ref_f ( cell_gid ) collect ; see line 7 .
member variabl use store composi- tion data f3i hfi encompass within line 1011 list 13 .
state , global vef identifi store cell-wis , lst_vefs_gid ( : ) array , turn ( indirect ) address ptr_vefs_x_cel ( : ) array .
particular , one assign vef cell cell_gid start end posit ptr_vefs_x_cel ( cell_id ) ptr_ vefs_x_cel ( cell_id ? 1 ) -1 lst_vefs_ gid ( : ) , respect .
thus , e.g. , implement ( overridden ) get_num_vef tbp static_ cell_accessor ( see list 12 ) , determin list 13 .
intern static_triangulation_t select set bind .
fempar : object-ori parallel finit element framework 123 number vef boundari current cell ptr_vefs_x_cel ( cell_id ? 1 ) -ptr_vefs_x_ cell ( cell_id ) .
hand , member vari- abl use store adjac data fihf3i encom- pass within line 1415 list 13 .
global identifi cell around vef vef_gid start end posit ptr_cells_around ( vef_gid ) ptr_cells_around ( vef_gid ? 1 ) -1 lst_ cells_around ( : ) , respect .
geometry-rel data handl member variabl line 1820 .
particular , set static_triangulation_t global number node global fe space describ geometri mesh intern built .
( process generat number ident one describ sect .
10.3 , omit keep present short . )
particular , global node identifi restrict cell cell_gid start end posit ptr_ nodes_gid ( cell_id ) ptr_nodes_gid ( - cell_id ? 1 ) -1 lst_nodes_gid ( : ) , respec- tive .
global node identifi use ( indirect ) address global array node coordin line 20 .
cells_set_id ( : ) vefs_set_id ( : ) array use store user-provid cell vef set identifi ( see sect .
7.1 ) , respect , vefs_at_boundari ( : ) , whether correspond vef lay boundari domain .
final , static_triangulation_cr bind set new static_triangulation_t instanc .
two option creat static_triangulation_t fempar , depend whether mesh structur unstructur .
first case , fempar provid machineri auto- matic generat triangul simpl domain ( e.g. , unit cube ) , current brick ( quadrilater hexahedr ) cell .
function implement exploit tensor product structur space , number cell vef use lexicograph order .
second way creat static_triangulation_t instanc mesh data file , e.g. , use gid mesh generat [ 91 ] .
8 evalu cell integr section , describ data structur requir perform numer integr local matric .
order comput cell integr ( 12 ) , one need ( among other ) function evalu shape function deriv quadratur point physic cell determin jacobian quadratur point refer cell .
turn , evalu shape function deriv physic cell reli evalu ( possibl evalu jaco- bian ) refer cell ( see , e.g. , ( 13 ) ( 14 ) ) .
note evalu w requir addi- tional inform ; ident lagrangian ele- ment requir jacobian refer cell vector-valu shape function ( see ( 17 ) ( 18 ) ) .
follow , present set data type contain inform .
evalu cell integr involv data type quadrature_t repres quadratur q , in- terpolation_t , store valu shape function first deriv ( either refer physic space ) quadratur point q , cell_map_t describ map refer physic cell uk ( e.g. , jacobian-rel data ) .
addi- tional , data type cell_integrator_t provid machineri comput interpolation_t cor- respond physic space one ref- erenc space cell_map_t everi cell triangul .
follow section , cover detail softwar abstract .
8.1 numer quadratur data type fempar repres arbitrari quadratur rule call quadrature_t defin shown list 14 .
list 14 .
quadrature_t data type .
s. badia et al .
123 list 14 , coordin ( : ,gp ) weight ( gp ) store , respect , xgp 2 rnum dim wgp , gp  1 ; .
.
.
; num quadratur point .
might readili observ interfac creat bind- ing quadrature_t design simpli placehold quadratur point coordin associ weight .
inde , bind essenti alloc coordin ( : , : ) weight ( : ) .
code ultim decid distribut quadratur point k set associ weight actual bound reference_fe_t implementor defer bind interfac shown list 15 .
reference_fe_t subclass current avail fempar select default gaussian quadratur exact integr mass matrix term ( within imple- mentat bind list 15 ) invok fill_*_gauss_legendr method line line 13 14 list 14 .
quadratur sole deter- mine attribut reference_fe_t implementor hand ( topolog order ) .
19 howev , demand situat , e.g. , integr trilinear weak form , user provid desir quadratur degre degre option dummi argument .
general scenario one current cover ( e.g. , non-gaussian quadratur ) address , interfac might modifi option paramet dictionari pass instead .
8.2 evalu refer cell shape function comment introduct section , comput cell integr ( 12 ) , one need evalu shape function deriv physic cell , turn reli evalu refer cell ( see , e.g. , ( 13 ) ( 14 ) ) .
valu shape function first deriv set quadratur point provid quadrature_t instanc store interpolation_t data type present .
data type use store data refer physic space .
let us start evalu shape function refer space .
local fe space top k actual depend particular reference_fe_t implemen- tor hand .
consequ , function offer defer bind abstract type .
interfac bind declar list 16 .
subroutin overrid concret subclass charg comput shape function valu deriv quadratur point refer space store raw-data contain type interpolation_t ( discuss later section ) .
let us remark sever point relat interfac .
first , bind typic call , data pre-comput store within pass interpo- lation_t dummi argument repeat re-us transform valu actual cell ; see sect .
8.4 .
list 15 .
interfac create_quadratur defer bind reference_fe_t .
list 16 .
interfac create_interpol defer bind reference_fe_t .
19 well known , consid n-cube topolog k , lagrangian refer fe order p affin geometr map , need 1d gaussian quadratur p 1 point .
tetrahedr mesh duffi transform , need take n  p ceilingd=2 integr exact mass matric ( see sect .
3.5 detail ) .
fempar : object-ori parallel finit element framework 123 second , bind design function evalu quadratur point within singl call , instead follow ( much ) finer granular approach one function evalu quadratur point per call .
20 third , stress actual implement defer bind fempar comput shape function valu first deriv refer space , wherea let caller select decid whether comput second deriv shape func- tion , provid expens comput requir particular scenario ; see sect .
3.7 .
inde , code implement featur cross-cut natur , reflect sever interfac data type cell ( face ) integr function split .
nevertheless omit ( rest section ) detail regard second deriv ( option comput ) order keep present simpl .
let us discuss rational under in- terpolation_t .
data type expos user fempar .
instead use intern low- level contain let data type involv implement cell integr exchang sort data subject consider .
ultim respons concret reference_fe_t subclass decid data actual laid within member vari- abl interpolation_t .
thus , reference_fe_t data type access modifi inter- polation_t .
current flavour , interpola- tion_t concret ( i.e. , non-abstract ) data type fix set multi-rank allocat array member variabl store shape function valu deriv .
exampl , one store shape function valu 3-rank array , reference_fe_t implementor may choos indic , left right , refer com- ponent shape function , shape function , quadratur point , respect .
reference_fe_t subclass , howev , complet free lay data array , flexibl extensi- biliti softwar design accommod sever fe space realize resid .
, inde proven suffici ( effici ) implement fe space cur- rentli avail fempar , includ scalar , vector , tensor-valu lagrangian fes ( higher-rank space determin tensor product scalar space , shape function one non-zero compon ) , genuin vector-valu fe space ( one compon shape function may non-zero ) .
8.3 geometr map basic build block map uk among refer cell k coordin system one corre- spond actual cell k triangul physic space ; see sect .
3.2 3.3 .
exampl , abl pull back gradient shape function refer physic space ( 14 ) use jaco- bian transform evalu quadratur point , evalu sourc term quadratur point real space .
jacobian also requir transform integr physic refer space ( 12 ) comput piola transform div curl-con- form fe space ( see ( 17 ) ( 18 ) ) .
deriv type cell_map_t fempar design placehold data requir provid sort servic .
declar shown list 17 .
rational under inherit relationship among cell_map_t base_map_t made clear sect .
9 .
20 ( mani place ) tri maxim granular call defer bind effici reason .
reader awar call defer bind granular latter approach would expens , apart prevent number potenti compil optim enabl former .
s. badia et al .
123 creat bind cell_map_t take input quadrature_t instanc set integr point jkxgp , j1k xgp , jjkxgpj evalu ( see list 17 ) .
geometry-rel data store jacobian ( : , : ,gp ) , inv_jacobian ( : , : ,gp ) , det_jacobian ( gp ) allocat array member variabl cell_map_t , respect , alloc call bind .
apart quadrature_t instanc , cell_map_t also requir descript ( discret ) space function uk belong .
fempar support map uk belong abstract fe space ( e.g. , high-ord polynomi fe space spline-bas space ) .
reference_f dummi argument poly- morphic type reference_fe_t serv purpos .
( note dynam run-tim polymorph particular context let us re-us cell_map_t , e.g. , arbitrari cell topolog . )
turn inform reference_fe_t provid cell_map_t shape function , first deriv , ( demand ) sec- ond order deriv quadratur point ( ref- erenc space ) .
interpol member variabl ( see list 17 ) use reference_f exchang sort data cell_map_t via call create_interpol bind former ( see list 16 ) call creat bind latter .
creat tbp cell_map_t design call , updat tbp cell_map_t , howev , design call multipl time , per everi cell k triangul .
pre-condit up- date nodes_coordin ( : ) scratch member variabl ( see list 17 ) load coordin real space node describ geometri k ( store point_t instanc ) .
pre-condit fulfil , uk express linear combin reference_fe_t shape function nodes_coordin ( : ) correspond- ing coeffici expans .
stage , coor- dinates_quadrature_point ( : ) , store coordin quadratur point real space , jacobian ( : , : , : ) , easili comput .
final , inv_jacobian ( : , : , : ) det_jacobian ( : ) comput jacobian ( : , : , : ) use straightforward numer algorithm .
8.4 evalu shape function physic space user code evalu cell integr ( 12 ) , may need valu , gradient , curl , diverg shape function integr point physic space , provid want unburden fempar user complex explicit appli map trans- format .
comment sect .
3 , map transform shape function /ax refer fe space one physic space /ax  wk/a u1k , depend particular fe list 17 .
cell_map_t data type .
fempar : object-ori parallel finit element framework 123 space hand ; see sect .
3.8 , 3.9 , 3.10 detail .
reason , actual code perform transfor- mation actual bound cell_map_t , reference_fe_t , defer bind interfac declar list 18 .
interpolation_reference_cel input dummi argument apply_cell_map ( see list 18 ) must obtain call bind list 16 invok reference_fe_t instanc .
output dummi argument interpola- tion_real_cel hold shape function deriv evalu quadratur point physic space ( see ( 13 ) ( 14 ) ) .
also assum , input , interpolation_real_cel alreadi contain data re-comput mesh cell , e.g. , valu shape function integr point lagrangian fes ; see discuss relat updat bind strategi follow order fulfil requir .
leav room optim implement defer bind ( subclass ) , sinc quantiti re- comput cell .
reference_fe_t subclass use cell_map_t instanc ( pass apply_- cell_map bind , see list 18 ) placehold data requir provid map transform requir .
stress , howev , interpolation_t low level structur design data type fempar user interact , reason made clear sect .
8.2 .
therefor , need introduc addit data type softwar design , call cell_inte- grator_t , , among servic , abl fetch raw data interpolation_t field data type ( i.e. , scalar , vector , tensor ) user easili famil- iariz .
data type declar shown list 19 .
list 18 .
interfac apply_cell_map defer bind reference_fe_t .
list 19 .
cell_integrator_t data type .
s. badia et al .
123 instanc cell_integrator_t creat quadratur rule ( shape function deriv evalu ) polymorph ref- erence_fe_t instanc describ refer fe space hand ; see interfac creat bind list 19 .
stage , reference_f creat interpolation_reference_cel member vari- abl cell_integrator_t via create_inter- polat ; see list 16 .
also clone interpolation_reference_cel inter- polation_real_cel , copi content former latter .
let cell_integrator_t fulfil later pre-condit last dummi argu- ment apply_cell_map .
creat bind also associ polymorph pointer reference_f member variabl reference_fe_t instanc provid input .
pointer requir later updat get_* bind ( see discuss sequel ) .
updat bind cell_integrator_t simpli invok apply_cell_map polymorph reference_f member variabl , use instanc cell_map_t provid input updat , two interpolation_t member variabl actual argu- ment , respect ; see list 18 19 .
leav cell_integrator_t instanc invok state abl provid servic primarili design .
offer get_valu , get_gradi , get_diver- genc , get_curl , etc. , generic bind .
note cell_integrator_t design handl either scalar , vector , tensor-valu refer- ence_fe_t instanc ( see sect .
6.2 ) .
purpos mind , aforement generic bind overload subroutin appropri inter- face three type fes .
exampl , sub- routin overload get_gradi case scalar-valu fes declar implement shown list 20 , vector_field_t repres d-di- mension rank-1 tensor ; interfac one corre- spond vector-valu fes differ one base type gradient allocat array dummi argument , base type tensor_field_t ( i.e. , data type repres d-di- mension rank-2 tensor ) .
let us remark import point respect subroutin overload generic bind cell_integrator_t .
first , note actual argument pass place , e.g. , gradient ( : , : ) dummi argument list 20 , intend actual declar code written user fempar .
provid fempar support variabl degre fes top differ triangul cell ( see sect .
10 ) , allo- catabl attribut gradient ( : , : ) dummi argument unburden user complex ( pre ) alloc array , even one associ variabl degre fes .
exampl , input , size gradient ( : , : ) suffici hold data provid cell_integrator_t instanc correspond reference_fe_t top current triangul cell , re-alloc appropri size .
second , bind design function evalu quadratur point within singl call , justifi dummi argument rank-2 allocat array .
21 point , let us note subroutin subject consider ultim reli ( defer bind ) reference_fe_t ; see , e.g. , line 5 list 20 .
recal refer- ence_fe_t must mediat process requir retriev data interpolation_t ; see sect .
8.2 .
8.5 cell integr user code exampl point discuss , alreadi posit show user code evalu entri ( current cell ) local matrix exampl 3.1 present sect .
3.1 .
code sketch list 21 .
code would bound subclass discrete_integration_t abstract data type present sect .
11.2 suitabl galerkin discret poisson problem .
21 repres anoth design decis seek maxim granular call defer bind code effici reason .
list 20 .
code implement get_gradients_scalar bind cell_integrator_t ultim reli defer bind reference_fe_t name .
fempar : object-ori parallel finit element framework 123 reader may note list 21 fempar also offer express syntax let user code weak form way resembl mathemat expres- sion .
user charg explicit write express numer integr refer cell , i.e. , explicit implement quadratur point summat ( loop ) handl determin jacobian quadratur point weight ( 12 ) .
howev , evalu shape function gradient , curl , etc. , quadratur point phys- ical space ( e.g. , express ( 13 ) ( 14 ) ) complet hidden user .
achiev use featur modern program languag call oper over- load .
( refer [ 67 ] detail exposit mechan fortran2003 . )
common ( contract ) oper- ation among tensor provid mean overload intrins library-defin oper .
exampl , oper ( * ) generic interfac ( correspond * intrins oper ) overload singl contract rank-1 tensor , multipl rank-1 tensor scalar let code compil .
crucial design requir seek code effici dynam memori allocation/dealloc involv partial evalu sub-express proceed ( order dictat oper associ prioriti rule fortran ) .
order fulfil requir , data type repres vector tensor declar entri store array member variabl size known compil time .
size store library-level paramet constant space_dim , defin maximum number space dimens physic space physic problem pose .
default , fempar prepar deal 3d simul , code written 2d simul might also perform space_dim equal 3 , price extra storag comput .
22 higher dimension problem could consid compil fempar larger valu space_dim .
apart avoid dynam memori allocation/dealloc eval- uation weak form , solut follow advantag : ( 1 ) need explicit number dimens member variabl data type repres vector tensor ; ( 2 ) limit loop implement tensor contract oper known compil time , enabl compil optimiza- tion .
final stress prefer solut usag fortran2003 parameter data type [ 67 ] due lack support featur popular compil wide avail high-end comput environ .
9 evalu facet integr section cover data type ( interact ) evalu integr facet triangul ground .
integr facet-wis matric vector ( see , e.g. , ( 23 ) ) involv evalua- tion shape function gradient neighbour cell quadratur point within facet phys- ical space jacobian facet map refer- enc space .
describ sect .
8 , former quantiti comput everi neighbour cell valu refer space jacobian cell map .
evalu interior facet also requir compu- tation permutationpgp ( see ( 25 ) ) provid coordin system cell surround facet might align physic space .
22 fact , 2d problem pdes involv curl oper requir space_dim equal 3 .
list 21 .
user-level code illustr usag cell integr data structur order comput element matrix exampl 3.1 present sect .
3.1 .
s. badia et al .
123 fempar assembl process global linear system under discret weak problem ( 20 ) involv two loop , cell facet , respect .
former loop , cell-wis matrix ak vector fk comput per cell .
hold partial contribu- tion cell correspond entri global coeffici matrix right-hand side vector , respect .
data structur involv effici comput alreadi cover sect .
8 .
latter loop , assum sit interior facet f 2 fxh , four facet-wis matric , name afkk , f kk , f kk , afkk comput ( see sect .
3.12 ) .
fig .
8 uml class diagram data type numer evalu facet integr ground fempar : object-ori parallel finit element framework 123 depict fig .
8 complet uml class diagram data type involv evalu facet integr relationship .
data type user ultim interact quadratur , hold facet quadratur point weight , facet map , handl ( i.e. , store , updat , provid ) geo- metric relat data facet neighbour cell k k , , final , facet integr , store updat shape function valu first deriv , provid shape function valu , gradient , curl , etc. , k k evalu facet quadratur point real space .
rest data type fig .
8 auxiliari data type , expos user , aid latter two implement correspond servic .
reader might readili observ fig .
8 softwar design data type provid support evalu- ation cell integr , i.e. , quadrature_t , cell_- map_t , cell_integrator_t ( see sect .
8 ) , re-us larg extent evalu facet inte- gral .
see rest section , method invok order control respect life cycl context facet integr nevertheless differ one invok context cell integr ; see , e.g. , signatur create_re- stricted_to_facet bind cell_integra- tor_t fig .
8 compar creat bind list 19 .
9.1 numer quadratur data type quadrature_t design placehold facet quadratur point xq associ weight wq .
howev , code ultim decid distribut xq refer facet f coordin system , set wq , bound refer- ence_fe_t , particular defer bind interfac shown list 22 .
refer sect .
8.1 rational under degre option dummi argument defer bind .
9.2 geometr map facet_maps_t data type fig .
8 handl geometr facet map two geometr cell map .
facet map repres facet_map_t , wherea cell map cell_- map_t ; see sect .
9.2.1 9.2.2 , respect .
9.2.1 facet map illustr fig .
8 , facet_maps_t compos , among other , singl instanc type facet_map_t .
member variabl ( associ code ) common facet_map_t cell_map_t fac- tore superclass base_map_t ( see list 17 ) .
facet_map_t handl data relat facet map uf , includ facet outward unit normal ( see fig .
8 ) .
extra 2-rank real allocat array member variabl , outward_unit_norm ( : , : ) , store facet out- ward unit normal ( respect k convent ) evalu facet quadratur point real space , requir ( 25 ) ; nxgp simpli obtain nxgp  nxgp .
let us see facet_maps_t control life cycl facet_map_t instanc .
creat bind- ing facet_map_t take quadrature_t instanc facet quadratur point .
jfxgp jjfxgpj evalu quadratur point store jacobian det_jacobian member variabl , alloc call bind togeth outward_unit_norm ( : , : ) .
apart quadrature_t instanc , facet_map_t also requir descript discret , lower dimension space function top refer facet f uf belong .
ref_fe_geo dummi argument cre- ate , polymorph type reference_fe_t , pro- vide purpos ; particular , facet_maps_t send reference_fe_t top k actual argument ref_fe_geo dummi argument order compli describ convent normal .
interpolation_t member variabl list 22 .
interfac create_facet_quadratur defer bind reference_fe_t .
s. badia et al .
123 facet_map_t ( see list 17 ) use ref_fe_geo exchang facet_map_t shape function val- ue deriv .
end , reference_fe_t equip create_facet_interpola- tion defer bind ( see signatur list 23 ) comput quantiti top refer facet f .
theupdat bind offacet_map_t intend call per facet loop iter , i.e. , per facet triangul .
pre-condit bind nodes_coordin ( : ) scratch member array facet_map_t ( see list 17 ) load coordin real space node lay facet .
23 updat bind take input dummi argu- ment quadrature_t instanc real paramet reorientation_factor order adjust sign facet normal ( see ( 26 ) ) .
within updat , quadra- ture_points_coordin ( : ) jaco- bian ( : , : , : ) easili comput basi shape function first deriv , respect .
hand , det_jacobian ( : ) outward_unit_nor- mal ( : , : ) comput jacobian ( : , : , : ) .
former state ( 24 ) , latter ( 26 ) .
9.2.2 neighbour cell map facet_maps_t data type also compos two instanc type cell_map_facet_restrict _t ; see fig .
8 .
instanc handl data relat touka , either or- .
let us thus refer instanc cell_map_facet_restrictiona , polymorph reference_fe_t instanc top ka ref_fe_geoa .
turn , cell_map_facet_re- strictiona compos mani cell_map_t instanc facet ka .
provid actual facet f potenti local identifi fa ka within rang fa  1 ; .
.
.
; num facetska , mani cell_ map_t instanc facet per surround cell let us hold ( pre ) calcul within instanc result eval- uat k shape function deriv facet quadratur point facet refer system .
end , creat bind cell_map_- facet_restrictiona invok ( one corre- spond facet_maps_t ) facet quadratur q andref_fe_geo input actual argument .
walk possibl local facet identifi correspond cell , local facet identifi , invok special version creat bind correspond cell_map_t instanc , name create_restrict _to_facet ( addit requir local facet identifi ) ; see fig .
8 .
thereference_fe_t ultim respons exchang sort data cell_- map_t .
servic particular provid cre- ate_interpolation_restricted_to_facet defer bind reference_fe_t , signatur defin list 24 .
list 23 .
signatur create_facet_interpol defer bind reference_fe_t .
list 24 .
signatur create_interpolation_restricted_to_facet defer bind reference_fe_t .
23 easili fulfil call get_nodes_coor- dinat bind vef_iterator_t list 11 .
fempar : object-ori parallel finit element framework 123 seen far , thecreat bind offacet_maps_t design call right actual loop tri- angul facet , set scratch data .
cover possibl scenario correspond potenti val- ue local facet identifi within two surround cell ( even scenario actual expos triangul ) .
updat bind facet_maps_t , howev , intend call sit particular facet f triangul , updat two cell_map_t instanc within cell_map_facet_re- strictiona correspond particular scenario hand , i.e. , particular combin local facet identifi f andf facet onwhich updated.to end , updat bind facet_maps_t receiv local identifi facet_lid ( see fig .
8 ) call updat bind cell_map_facet_restrict cell_map_facet_restrict facet_ lid=facet_lid ( 1 ) facet_lid=facet_lid ( 2 ) , respect .
updat bind cell_map_ facet_restriction_t pick cell_map_t correspond facet_lid invok updat bindingof latter.westress specializedversionof bind requir context facet integr , i.e. , version discuss sect .
8.4 cell integr re-us .
24 updat process , cell_map_- facet_restriction_t also regist cur- rent_facet_lid privat member variabl , valu suppli facet_lid dummi argument .
let facet_maps_t extract later cell_map_- facet_restrict updat cell_map_t instanc ; see discuss facet_integrator_t sequel .
9.3 evalu shape function physic space last data type remain cover facet_integrator_t ; see fig .
8 .
data type counterpart cell_integrator_t ( see sect .
8.4 ) case facet integr .
particular , store updat shape function valu deriv , provid valu , gradient , curl , diverg respect field k k evalu facet quadratur point real space .
observ fig .
8 , overal design close one facet_maps_t , cell_integrator_facet_restriction_ cell_integrator_t instanc compos , play role counterpart scope facet_maps_t ( i.e. , cell_map_facet_restric- tion_t cell_map_t , respect ) .
, howev , two major differ among two .
first , facet_integrator_t deal ( e.g. , creat ) two polymorph reference_fe_t instanc ( see ref_fea dummi argument creat bind fig .
8 ) onwhich global fe space functionsx h , yh ground .
exampl , creat bind cell_ integration_facet_restrict invok create_restricted_to_facet bind cell_integrator_t facet f within k .
latter comput given facet /akxgp , r/ kxgp defer bind create_interpola- tion ... to_facet reference_fe_t present list 24 .
second , facet_integrator_t unburden user complex under fact coordin system k k might align real space .
end , equippedwith privat lookup permut tabl , call qpoints_perm ( : , : ) fig .
8 , let translat facet quadratur point iden- tifier local number space k one k .
tabl alloc fill creat bind facet_integrator_t , particular reference_fe_t defer bind call fill_qpoints_permut .
given facet quadratur identifi gp facet permut index pi ( see sect .
3.16 ) , qpoints_perm ( gp , pi ) store valu pgp ( see ( 25 ) ) .
permut index store within current_permutation_index facet_integrator_t , extract permuta- tion_index dummi argument theupdat bind .
turn , paramet extract array facet_permutation_indic ( : ) fe_spa- ce_t list 27 ( see sect .
10 ) .
note n-sim- plice , consid renumb facet orient cell share , comment sect .
3.16 .
case , fill_qpoints_permuta- tion fill tabl ident permut column .
note re-orient n-simplic lead mappingsuk jjk j\0 , problem soon one take absolut valu , e.g. , ( 12 ) .
9.4 facet integr user code exampl order grasp data structur cover far actual use togeth practic , fortran pseudocod snippet list 25 show user  space code charg 24 note , sect .
8.3 , nodes_coordin ( : ) member variabl two cell_map_t instanc load coordin physic space geometri node two cell surround facet .
s. badia et al .
123 evalu first integr ( 22 ) interior facet loop facet .
would bound subclass discrete_integration_t abstract data type present sect .
11.2 suitabl non-conform dg discret poisson problem .
pair worth note remark list- ing 25 .
first , call get_valu ( ) bind facet_integrator_t line 14 alreadi return permut k shape function valu , i.e. , shape_val- ues_ k ( b , gp ) actual store /bkxpgp .
second , so-cal fe_space_t abstract ( cover sect .
10 ) one charg creat facet integr data structur loop initi updat facet loop iter ( see line 9 ) .
therefor , user actual direct deal data type bind interact illustr fig .
8 .
exampl , becom evid facet-loop base inte- gration conveni implement dg method , sinc much resembl blackboard express ( see , e.g. , ( 20 ) ) .
9.5 change-of-basi implement reference_fe_t subclass section , provid detail present change-of-basi requir comput shape func- tion basi implement reference_fe_t sub- class .
particular , show implement raviart-thoma div-conform fe n-cube sect .
3.5 ( see also sect .
3.9 detail ) .
pre-basi , e.g. , qk1 ; k ; k  qk ; k1 ; k  qk ; k ; k1 3d , gener- ate subroutin call ; see , e.g. , evalua- tion pre-basi line 31 list 26 .
list 25 .
user-level pseudocod illustr usag facet integr data structur order comput first integr ( 22 ) interior facet loop facet .
fempar : object-ori parallel finit element framework 123 also present comput boundari moment ( 16 ) list 26 ; interior moment simpler omit sake breviti .
implement boundari moment requir : ( 1 ) creat refer- ence_fe_t implement qk1 d1 line 16 , ( 2 ) facet quadratur refer facet line 24 , ( 3 ) evalu refer fe quadratur point interpolation_t line 25 .
also requir lagrangian ( first order ) fe repres geometri line 20 .
next , loop facet cell comput valu shape function cell facet quadratur , store interpolation_t instanc line 31 .
ingredi , comput boundari moment pre-basi function ( see line 43 ) assembl change-of-basi matrix .
interior moment , need invert change-of-basi matrix line 54 .
point , shape function basi linear combin pre-basi function .
thus , one call fill_interpol bind correspond refer fe , creat pre-basi interpolation_t instanc next appli change-of-basi matrix comput one shape function basi , i.e. , list 26 .
implement change-of-basi requir raviart-thoma divconform fes n-cube , follow procedur present sect .
3.5 .
s. badia et al .
123 placehold evalu shape function deriv ( set quadratur point interpol creat ) store .
note ownership dof also chang process .
boundari moment ( integr function facet ) belong correspond facet , wherea interior moment belong cell .
vertic edg dof case .
definit ownership skip breviti .
10 integr global dof handl : fe_space_t abstract section , introduc softwar abstract , refer- red fe_space_t , repres ( general scenario ) mathemat concept global fe space x h  x1h  .
.
. x n h obtain mean cartesian product global fe space x ih correspond  1 ; .
.
.
; nfield field unknown involv system pdes ; see sect .
3.6 3.11 .
x ih describ combin : ( 1 ) approxim xh physic domain x provid triangulation_t , i.e. , mesh-lik contain cell xh partit , boundari lower-dimension object , adjac relationship ; see sect .
7 ; ( 2 ) descript nfield refer fes associ triangul cell ground reference_fe_t ; see sect .
6 .
two basic build block equip fe_space_t tool requir provid follow two crucial servic .
25 one hand , charg handl ( i.e. , generat , store , fetch ) global enumer dof correspond x ih take account notion conform ; see e.g. , sect .
3.6 6.2 .
hand , handl data structur requir evalu integr cell facet ( see sect .
8 9 , respect ) .
particular , judici set , orchestr respect life cycl interact , unburden user ( larg extent ) complex ( among other ) inher high order fes .
oo design fe_space_t ( one mani data type fempar , e.g. , triangulation_t ) strong strive preserv encapsul data hide still store access data effici ( i.e. , way leverag data local effici exploita- tion modern comput memori architectur ) .
user- friend view fe_space_t implicit ( ) con- struct data type ( associ interfac inter- action ) cover sect .
10.2 .
move approach follow intern fe_space_t .
10.1 intern organ fe_space_t section , sketch intern fe_spa- ce_t organ order effici deliv two servic outlin .
simplic , restrict our- selv simplifi version fe_space_t , larg extent , captur spirit actual counterpart fempar .
declar simplifi data type shown list 27 .
26 25 stress , howev , full set servic provid fe_space_t actual restrict two .
26 note fe_space_t actual fempar .
whole data type hierarchi root base_fe_space_t , includ simplic .
within hierarchi , , e.g. , fe space concret suitabl either serial parallel distributed- memori environ .
one shown list much resembl serial_fe_space_t .
fempar : object-ori parallel finit element framework 123 collect reference_fe_t polymorph instanc store reference_f ( : ) array .
instanc uniqu identifi ( within local scope fe_space_t ) posit array .
global fe space correspond given field , identifi f_id rang 1 ; .
.
.
; num field ( list 27 .
intern fe_space_t select set bind .
s. badia et al .
123 num_field equal nfield ) , describ : ( 1 ) triangul member variabl ( rational under- lie polymorph made clear sect .
10.2 ; ( 2 ) restrict cell provid refer fe space defin reference_fe_t instanc identifi field_cell_to_ref_f ( f_id , c_id ) collect ; c_id assum posit integ 1 ; .
.
.
; triangul % get num cell uniqu identifi cell .
member variabl use handl global dof number encompass within line 1827 list- ing 27 .
global dof identifi store cell-wis , field-wis within cell , lst_dofs_gid ( : ) array , turn ( indirect ) address ptr_dofs_x_f ( : , : ) array .
particular , one assign local node relat field f_id cell c_id start end posit ptr_dofs_x_f ( - f_id , c_id ) ptr_dofs_x_f ( f_id ? 1 , c_id ) -1 lst_dofs_gid ( : ) , respect , f id\num field , posit ptr_dofs_x_- fe ( f_id , c_id ) ptr_dofs_x_f ( 1 , - c_id ? 1 ) , respect , f id  num field .
number dof global fe space correspond field ( exclud subject strong boundari condit ) store num_dofs_x_- field ( : ) array .
member variabl line 15 store refer data type describ block layout current select ( i.e. , chang demand ) global matrix right-hand side vector linear system ( sequenc ) requir solut pde system hand .
role block_layout_t global dof number generat process illus- trate sect .
10.3 .
data structur let fe_space_t handl evalu cell integr declar line 2329 list 27 .
set_up_cell_integr bind set .
method intend call user  program right cell integr loop .
ensur ( scratch ) data comput final form refer cell pre-comput triangul cell minim number integr data structur requir particular scenario hand .
end , fe_space_t equip three array contain quadrature_t , cell_map_t cell_integra- tor_tobject ( seelin 24 , 26 , 28 , respect ) , indirect address hash_table_t member variableswith correspond name .
27 requir fe_space_t support , e.g. , non-conform fe space variabl order per cell .
uniqu identifi ( dynam generat within scope fe_space_t ) assign integr object must creat .
hash_table_t instanc letfe_space_t transform uniqu identifi contain array posit fromwhich integr object fetch .
set_up_cell_integr method loop cell .
sit cell , determin appropri quadratur use cell associ uniqu identifi .
( see discuss next paragraph detail . )
quadratur generat yet ( i.e. , hash tabl lookup fail ) , new quadratur creat next free posit cells_quadra- ture ( : ) array contain , new identifier-posit pair insert hash tabl .
otherwis , quadratur fetch array .
process repeat cell_map_t cell_integrator_t instanc .
former one uniqu determin combin uniqu identifi quadrature_t created/fet- ched reference_fe_t instanc top current cell ( see sect .
7 ) .
hand , cell_integrator_t instanc associ field within current cell ; cell_integra- tor_t instanc correspond field uniqu deter- mine uniqu identifi quadrature_t created/fetch one reference_fe_t associ field ( see sect .
8.4 ) .
therefor , uniqu identifi cell_map_t cell_integra- tor_t instanc requir evalu cell integr current cell easili determin combin one correspond instanc creat .
recal uniqu identifi refer- ence_fe_t instanc top current cell , c_id , given field , f_id , retriev refer- ence_fe_id=field_cell_to_ref_f ( f_id , c_id ) , reference_fe_t instanc reference_f ( reference_fe_id ) .
allocat array member variabl line 23 ( mani entri triangul cell ) use user order ( option ) determin degre quadratur use triangul cell .
member variabl alloc initi ( fe_space_t creation ) reserv flag instruct set_up_cell_integr use automat ( default ) strategi decid degre quadratur use cell .
default strategi reli defer bind reference_fe_t , name get_default_quadrature_degre , typi- calli return quadratur degre mass matrix term integr exact ( see sect .
8.1 ) .
28 strategi , 27 term hash tabl reflect usual mean , i.e. , associ array map key valu .
28 stress , howev , particular reference_fe_t subclass hand freedom implement differ strategi requir .
fempar : object-ori parallel finit element framework 123 particular , walk reference_fe_t instanc top cell , one ( polynomi ) refer cell function space maximum order becom ultim respons creat quadratur via invoc create_quadratur defer bind .
altern , user may explicit select quadratur degre use cell .
case , create_quadratur invok creat quadratur degre given correspond entri cell_quadratures_degre ( : ) ; see sect .
8.1 .
case ( i.e. , default explicit quadratur degre ) , uniqu identifi reference_fe_t instanc top current cell quadratur degre use generat uniqu identifi quadratur created/fetch .
hand , line 3238 list 27 encom- pass data structur requir evalu ( boundari interior ) facet integr ; see sect .
9 .
close rational one under cell coun- terpart follow set data structur .
set_up_facet_integr bind loop facet .
sit facet , determin appropri facet quadrature_t rule .
quadratur degre either default user-defin one ( via allocat array member variabl line 32 ) .
also determin uniqu identifi quadratur rest facet- integr data structur , creat necessari , handl interact .
topolog two cell share facet quadratur degre use generat uniqu identifi facet quadratur .
member variabl line 4142 provid support implement so-cal fe_facet_iter- ator_t data type cover detail sect .
10.2 .
final , member variabl num_- fixed_dof list 27 use fe_space_t count mani dof subject strong boundari condit ; see sect .
10.4 .
10.2 conceptu view fe_space_t follow idea present sect .
7.1 , fe_space_t offer number iter provid travers object , uniform data access intern .
apart iter cell vef , fe_space_t also provid travers facet mean so-cal fe_- facet_iterator_t data type .
iter essen- tialli requir implement evalu jump term , e.g. , error estim dg method user-friend manner .
reason made clear cours sec- tion , design goal fulfil fe_space_t itera- tor abl provid access data counterpart triangulation_t iter ( see sect .
7.1 ) , abl effici avoid duplic code bound latter one .
exampl , fe_cell_iterator_t design also abl provid coordin ( physic space ) node describ geometri cell , apart global dof identifi top .
let us first discuss design iter cell vef ( one follow line ) .
data type defin list 28 , set must actu- alli replac either cell vef .
shown list 28 , fe_set_iterator_t hold polymorph pointer fe_space_t instanc provid data access .
dynam polymor- phism exploit extens code reus mind .
type extens fe_space_t ( e.g. , one suitabl distributed-memori environ ) , also becom target polymorph pointer , thus enabl reus data code bound list 28. fe_space_t   set   ( either cell vef ) iter composit relationship counterpart triangula- tion_t iter ( set_iterator_t ) .
s. badia et al .
123 fe_set_iterator_t extens .
special relev list 28 composit relationship among data type defin set_itera- tor_t , i.e. , triangulation_t iter counterpart ( see sect .
7.1 ) .
let fe_set_iterator_t fulfil aforement design goal , i.e. , provid superset data class compos , still abl access data store within triangul scope .
fe_set_iterator_t also reus set_iterator_t code under sequenti travers object set .
inde , mani tbps fe_set_iterator_t , init , next , has_finish tbps fe_set_iterator_t simpli implement wrapper counterpart set_iterator_t .
( remark possibl provid fe_space_t deliber set share triangulation_t consist global number cell lower-dimension object . )
point import remark set_iterator_t instanc fe_set_itera- tor_t aggreg also polymorph ( see line 3 list- ing 28 ) .
state sect .
10.1 ( particular , see line 12 list 27 ) , fe_space_t instanc creat polymorph triangulation_t instanc .
creat bind fe_set_iterator_t extract latter fe_space_t , call create_cell_iter- ator bind ( see sect .
7.1 ) , becom ultim charg determin dynam type set_it- erator_t member variabl fe_set_iterator_t ( apart leav iter posit first object set ) .
let fe_space_t ( associ iter ) re-us type extens trian- gulation_t ( e.g. , one suitabl distributed-mem- ori comput and/or h-adapt ) .
likewis , free bind fe_set_iterator_t reli free_cell_iter bind triangula- tion_t order safe dealloc dynam memori alloc perform creation.w stress , case triangulation_t iter , creat free tbps intend direct call user .
instead , triangulation_t provid set ( public ) tbps ( mani differ iter ) pur- pose .
exampl , express call fe_spac % create_fe_cell_iter ( fe_- cell_iter ) creat iter polymorph fe_cell_iter client-spac instanc , call fe_spac % free_fe_cell_iter ( fe ... ) charg safe dealloc polymorph instanc .
implement fe_facet_iterator_t base close rational one cell vef iter , subtl differ though ; see list 29 .
provid fe_facet_iterator_t kind fe_vef_iterator_t , provid set data access method latter ( e.g. , cell share facet ) .
howev , restrict travers vef actual facet , abl provid data requir implement jump term facet .
shown list 29 , fe_facet_iterator_t extend fe_vef_iterator_t .
automat equip former data access method latter .
hand , overrid method con- troll sequenti travers item set restrict facet , i.e. , create/free/first/ next/has_finish list 29 .
implement method reli member variabl facet_- gid , facet_gid ( : ) member variabl fe_space_t ; see line 41 list 27 .
given facet global identifi facet gid , facet_gid ( - facet_gid ) hold global vef identifi correspond- ing facet .
list 29 .
fe_facet_iterator_t data type .
fempar : object-ori parallel finit element framework 123 actual set tbps fe_space_t iter high depend type object point .
com- plete , briefli discuss tbps set correspond cell facet iter , provid support implement two servic fe_space_t focus .
particular shown list 30 .
list also includ generic tbps line 35 68 , although discuss sect .
11.1 .
tbps line 1828 , 5061 list 30 let user fetch fe_space_t integr data associ current cell facet point , respect .
hand , update_inte- gration bind line 6 47 perform list 30 .
fe_cell_iterator_t facet counterpart .
s. badia et al .
123 comput requir updat data structur hold shape function valu deriv eval- uat ( current ) cell facet ( quadratur point ) physic space .
former bind implement shown list 31 .
final , get_permuta- tion_index tbp fe_facet_iterator_t let caller obtain permut index ( see sect .
3.16 9.3 detail ) .
implement method reli facet_permutation_indic ( : ) member variabl fe_space_t ; see line 42 list- ing 27 .
given facet global identifi facet gid , facet_permutation_indic ( facet_gid ) hold permut index correspond facet .
decid perman store facet permut indic perform reason .
reus ( e.g. , transient and/or nonlinear pde problem ) without overhead associ comput travers facet triangul .
updat cell_map_t instanc ( associ cell point fe_cell_iterator_t instanc subroutin invok ) perform line 12 list 31 .
follow loop number field pde system hand order updat cell_integrator_t everi field line 17 .
updat former requir nodes_coordin ( : ) scratch member variabl load coordin physic space node describ geometri cell hand ( see sect .
8.3 ) .
particular fulfil line 10 .
coordin fetch call actual store within triangul .
howev , fe_cell_iterator_t satisfi queri provid compos cell_iterator_t instanc ; see list 28 accompani discuss .
point , reader alreadi capabl grasp fe_facet_iter- ator_t counterpart subroutin implement , omit order keep present short .
go back list 30 , bind line 16 let user fetch field-wis global dof identifi fe_space_t associ node function current cell interior vef .
( bind line 913 list 30 , howev , assist fe_space_t generat global dof number usag illustr sect .
10.3 . )
bind implement list 32 .
list 31 .
implement update_integr bind fe_cell_iterator_t .
list 32 .
implement get_fe_dof bind fe_cell_iterator_t .
fempar : object-ori parallel finit element framework 123 list 32 , p_1d_ip_array_t assum data type singl member variabl , call p , declar pointer rank-1 integ ( ip ) array .
field , subroutin locat region within lst_dofs_gid ( : ) member variabl correspond field within current cell , associ correspond pointer fe_dof ( : ) .
expens sacrif type safeti ( fortran mechan declar pointer read-on ) , avoid cost re-alloc user-level allocat array would need case non-conform fe space high vari degre polynomi space among cell .
end , get_vef bind list 30 set fe_vef_iterator_t instanc point corre- spond vef within cell .
consequ , one may navig cell , vef , cell around vef , etc. , use fe_space_t iter way round .
10.3 global dof number generat section , discuss fe_space_t coordin build block cover far order generat global enumer dof describ global fe space x h  : x 1h  .
.
. x n h general multi-field system pdes .
process encompass within gen- erate_global_dof_numb bind fe_s- pace_t ( see list 27 ) .
code method shown list 33 .
block_layout dummi argu- ment let caller custom global dof number- ing generat .
29 one hand , data type specifi mani block user want split ( discret ) pde system hand .
particular , user may select generat dof number suitabl monolith block storag linear algebra data structur , block_layout % get_num_block ( ) return one number larger one , respect .
hand , block_layout_t specifi map field block , block_layout % get_block_id ( - field_id ) return block identifi field identifi field_id map .
provid block linear algebra data structur fempar address use row/column identifi local block , block_layout equip subroutin input necessari generat block-awar global dof number- ing , dof belong field first block number first , follow one second , .
note block_layout_t also hold insid mani dof per block ( see sect .
11.3 ) .
latter quantiti comput within generate_- global_dof_numb ( see discuss sequel ) .
subroutin list 33 start check whether actual generat global dof number .
global dof number avail yet ( see predic line 9 ) , one avail suitabl input block_layout ( see predic line 10 ) .
bulk generate_global_dof_num- bere concentr privat helper tbps fe_space_t call fe_space_count_dof fe_space_list_dof ; see line 14 15 list- ing 33 , respect .
code bind shown list 34 35 , respect .
former comput number dof per field block , latter charg actual generat global dof identifi .
list 33 .
generate_global_dof_numb bind fe_space_t .
29 refer list 43 accompani text sect .
11 full descript member variabl tbps block_lay- out_t .
section , restrict relev global dof number process .
s. badia et al .
123 line 631 list 34 charg comput number dof per field , lines-3438 , per block .
latter line determin number dof per block accumul correspond field map block ( comput former line ) .
former line ground notion owner cell vef ; cell owner vef ( 1 ) latter lay boundari former , ( 2 ) first cell ( 1 ) hold order iter cell present , ( 3 ) vef own least one dof global fe space subject consider .
30 ( logic ) work array owner_cell_per_vef_visit ( : ) keep track whether owner cell vef alreadi visit ( ) travers nest loop cell ( see outer loop line 12 ) , vef within current cell ( see inner loop line 16 ) .
sit cell , algorithm first count dof associ node function logic place interior current cell ( see line 14 ) .
loop vef current cell .
owner cell current vef visit yet , current cell owner , current cell regist owner cell , dof associ node function logic place vef within current cell count line 22 .
provid non-conform fe space dof vef , skip loop vef cell acceler process case ( see claus line 15 list 34 ) .
algorithm shown list 35 charg actual generat global dof identifi .
work array owner_cell_gid_per_vef ( : , : ) use store owner cell global identifi vef .
hand , vef_lid_in_owner_cel ( : , : ) array use acceler lookup tabl store vef local identifi ( i.e. , vef_lid ) within correspond owner cell alreadi visit , -1 otherwis .
array index use vef global iden- tifier ( i.e. , vef_gid ) .
sit cell , algorithm first alloc global dof identifi node function associ interior current cell start fields_current_dof ( field_id ) , i.e. , next freeli avail global identifi ; see line 27 .
loop list 34 .
count_dof bind fe_space_t .
30 last requir introduc includ concept void fes multi-field problem field defin whole domain ( see sect .
6.5 ) .
fempar : object-ori parallel finit element framework 123 vef current cell .
current vef visit yet , current cell becom owner , cell local identifi vef within cell regist correspond work array .
global dof identifi associ node function vef within owner cell alloc line 32 ( start fields_current_dof ( - field_id ) ) .
hand , current vef visit , global dof identifi associ node function vef within current cell fetch correspond one within owner cell line 39 .
bind call line encod per- mutat describ sect .
3.16 .
reader might observ , list 35 ground sever ( privat ) helper bind fe_cell_iterator_t , cell level , aid generat global dof number ; see line 913 list 30 .
bind ultim reli ref- erence_fe_t instanc map cell tri- angul ; see sect .
10.1 .
particular , sit cell , reference_fe_t instruct fe_cell_iterator_t associ node function interior cell , lower-dimension boundari object accord notion conform under fe space hand ; see sect .
3.6 6.2 .
exampl , implement gener- ate_own_dofs_vef_numb bind imple- ment shown list 36 .
code list 36 extract list_iterator_t own_dofs_n_fac member variabl list 35 .
list_dof bind fe_space_t .
s. badia et al .
123 reference_fe_t instanc use current cell field_id .
iter let travers node function own vef local identifi vef_lid ( see sect .
6.2 ) , thus determin ( relat ) posit lst_dofs_gid ( : ) global dof identifi alloc node function .
note logic predic line 16 evalu .true .
dof hand actual free , i.e. , subject boundari condit impos strong form ; see sect .
10.4 .
final , would like stress error check statement major optim appli single-field single-block case shown code list section order keep present simpl possibl .
present fempar .
par- ticular , aforement case , global dof number generat singl loop cell ( instead two ) .
call line 14 list 33 avoid , defer comput number dof per field block call line 15 .
hand , need generat global dof number scratch alreadi one avail , permut old new number could comput appli lst_dofs_gid ( : ) singl sweep cell .
optim , how- ever , present fempar , inde find frequent case applic requir chang on-the-fli block-layout system pdes hand .
10.4 strong imposit boundari condit section , discuss mechan fe_s- pace_t provid order support strong imposit boundari condit .
order grasp mechan need fe_space_t design provid , must first briefli introduc approach chosen fempar order handl type boundari condit .
use term   fix dof   refer dof sit boundari whose valu constrain ( i.e. , subject strong boundari condit ) , term   free dof   refer remain one .
simplic , let us restrict laplacian problem inhomogen dirichlet boundari condit ux  udx cd discret grad-conform fes .
31 discret solut uh 2 x h split two part uh  uh  ehud , : uh  x a2ffre dofsg ua/  x a2ffix dofsg 0/a ehud  x a2ffre dofsg 0/a  x a2ffix dofsg uda / : nodal valu ua actual unknown problem hand .
ehud discret dirichlet data exten- sion , understood project dirichlet data extens eudx introduc sect .
3.1 .
nodal valu uda select ehud becom suitabl boundari fe approxim udx ( e.g. , boundari fe interpol ) .
32 linear system solv order comput nodal valu uh written : list 36 .
implement generate_own_dofs_vef_numb bind fe_cell_iterator_t .
31 stress , howev , approach discuss sequel handl strong imposit boundari condit applic complex problem discret , e.g. , maxwel equat discret curl-conform fe space .
32 assum discret dirichlet data extens zero free dof , general situat also accommod .
fempar : object-ori parallel finit element framework 123 x b2ffree dofsg a/a ; /bub  /a ; f   x c2ffix dofsg a/a ; /cudc 8a 2 ffree dofsg ; 33 coeffici matrix mani row free dof , right-hand side fe discret linear form ( 3 ) ; see sect .
3.1 .
order assembl ( 33 ) , process describ sect .
8 slight modifi .
sweep tri- angul cell still requir .
sit given cell k , element matrix ak vector fk comput usual .
howev , rows/column correspond fix dof ak assembl global matrix .
appli entri fk .
howev , fk updat assembl order reflect contribu- tion strong boundari condit ( see right-hand side ( 33 ) ) .
fortun , user fempar unburden subtleti .
hidden within assembl generic bind fe_cell_iterator_t ; see list 30 39 .
apart ad contribut current cell global coeffici linear system right-hand side , bind charg comput contribut fk strong dirichlet boundari condit .
pose two addit requir fe_space_t .
particular , ( 1 ) handl global enumer free fix dof , abl distinguish among kind dof ; ( 2 ) offer suitabl set bind project/interpol udx boundari get ehud .
order satisfi ( 1 ) , fe_space_t split whole set dof free fix dof , dof within subset label separ f1 ; 2 ; .
.
.
; jffree dofsgjg , f1 ; 2 ; .
.
.
;  jffix dofsgjg , respect .
( nevertheless implement detail never expos fempar user . )
turn , free fix dof valu actual store differ array , address separ use correspond global identifi former latter set , respect ; see sect .
10.5 .
process associ global identifi free dof alreadi cover sect .
10.3 .
one corre- spond fixeddof verymuch resembl one free dof .
, howev , restrict vertic , edg , face triangul lay boundari , equip support user let process becom awar dof sit boundari actual fix .
fix dof global enumer process occur initi set-up fe_space_t ; see creat generic bind list 27 .
process ground two differ ingredi .
one hand , user determinec sub-region set associ vef sit boundari ( see sect .
7.1 ) .
exampl , user may decid use set identifi 1 2 split vef inc belong tocd andcn , respect .
hand , abstract data type , call condi- tions_t , extend fempar user , let user custom strong imposit boundari condit .
particular , regard fix dof global enumer process , data type offer defer bind given set identifi , provid logic compon mask .
compon pde system , mask provid whether dof associ vef mark set identifi fix free .
fe space dof-to-compon associ ( e.g. , raviart-thoma nedelec fes ) , first compon mask taken account , rest neglect .
hand , 2 ) , fe_space_t provid set method let user interpolate/project udx boundari get ehud number suitabl way .
ehud ultim store within instanc fe_function_t data type ; see sect .
10.5 .
boundari projector involv solut boundari mass matrix problem integr boundari facet evalu ; see sect .
9 .
, bind reli conditions_t abstract data type .
particular , given boundari vef set identifi , defer bind data type return user-defin ( scalar- valu ) function impos compon pde system hand .
case raviart-thoma nedelec fes , scalar-valu function correspond compon use reconstruct vector-valu function , whose tan- gential normal compon , respect impos .
10.5 global fe function restrict triangul cells/facet section , introduc conveni softwar abstract oo design , refer fe_func- tion_t , repres global fe function uh 2 x  : x1h  .
.
. x n h. data type subset tbps ( particular , relev present section ) present list 37 .
list 37 , free_dof_valu fixed_dof_valu use store uh ehud , respect ; see sect .
10.4 .
former polymorph member variabl type array_t ; see sect .
11.1 .
rely- ing set defer bind offer array_t , code bound fe_function_t written independ entri within concret implement array_t laid memori , enabl code re-us larg extent .
exampl , scalar_array_t concret realize array_t use monolith storag , block_array_t s. badia et al .
123 store entri organ block ( see sect .
11.1 detail ) .
hand , fixed_dof_valu member variabl static type scalar_array_t ; see sect .
11.1 .
33 fix dof belong differ field might inde assign intermix global identifi , signific simplifi enumer process .
par- ticular , singl sweep boundari object suffic , contrast list 33 , two sweep cell requir order generat block-awar global num- bere .
experi , turn neither block storag data structur suitabl distributed- memori environ strict requir store ehud , prevent overhead associ run-tim polymorph deal fixed_dof_values.34 fe_function_t instanc creat fe_space_t instanc ( belong ) ; see signatur creat bind list 37 .
bind select dynam type free_dof_valu , therefor storag layout , accord one current select pde system hand ; see block_layout member variabl list 27 .
entri free_dof_val- ue determin number way .
might becom unknown problem solv ( e.g. , precondit iter linear solver spars direct solver ) , comput express involv fe_function_t instanc , e.g. , uh  vh , uh  vh  wh , uh ; vh ; wh 2 x h. ( inde , fempar offer express syntax global fe function ground overload oper . )
apart , fe_space_t offer pair generic bind , refer interpol project , comput dof nodal valu uh either interpol ( use express ( 9 ) ) project ( e.g. , global l2 projec- tion ) fe space user-defin function u ( x ) .
35 generic bind overload three differ regular bind suitabl scalar , vector , tensor-valu function , respect .
interpol bind fe_space_t written independ refer fe use tbp associ refer- ence_fe_t comput local interpol ( 6 ) .
apart softwar represent global fe function , fe code typic need mechan , sit cell facet triangul , provid valu , gradient , etc .
global fe function uh  u1h  .
.
. unh evalu quadratur point physic space .
end , fempar offer set data type , refer cell_fe_function_type_t facet_fe_- function_type_t , type=scalar , vec- tor , tensor , repres restrict uih given triangul cell facet , respect .
two code snippet fig .
9 illustr usag data list 37 .
fe_function_t data type .
33 parallel environ , everi processor store fix dof valu belong associ subdomain .
34 algorithm charg comput ehud may requir differ storag layout one scalar_array_t ( e.g. , block storag and/or suitabl distributed-memori comput ) , and/or restrict fix dof ehud correspond given field ( set field ) .
case , ehud scatter place back forth temporari work space appropri layout algorithm hand charg comput entri ( e.g. , serial parallel distributed-memori boundari mass problem iter solver ) .
turn high perform penalti provid algorithm alreadi requir perform sweep boundari facet ( e.g. , order assembl boundari mass matrix ) .
sweep , fix dof question alreadi count identifi .
35 analyt scalar , vector , tensor-valu function also support fempar class scalar_function_t , vector_function_t , tensor_function_t , respec- tive .
implement analyt scalar function f x fempar , user extend scalar_function_t method get_- valu , get_gradi ( use ) , etc. , analyt expres- sion , given point repres x .
proceed analog vector tensor field .
data type simpl omit descript .
fempar : object-ori parallel finit element framework 123 type , assum uih belong global fe space vector-valu function .
three worth note remark two code snippet .
first , updat bind data type reli gather_nodal_valu bind fe_- function_t ; see list 37 .
latter equip cell/facet fe function abil restrict ( gather ) nodal valu uih global local array ( store privat scratch data within cell/facet fe function data type ) , take care strong boundari condit .
second , updat bind requir procedur , given shape function , first deriv , etc. , evalu quadratur point physic space , nodal valu uih restrict current cell , provid shape function valu , gradient , curl , etc. , fe function quadratur point .
servic provid reference_fe_t set evaluate_fe_funct ... defer bind line 6368 list 6 .
note fe_- function_t extract first set data cell_integrator_t facet_integrator_t instanc access fe_cell_iterator_t fe_facet_iterator_t ( provid input updat ) , respect .
third , facet fe function provid uih valu , gradient , etc. , facet quadratur point perspect two surround cell .
make sens function uih belong non-conform fe space , might discontinu across cell bound- ari .
facet fe function also cope fact coordin system surround cell might align physic space , differ local num- bere might assign facet quadratur point perspect either cell ; see sect .
9.3 exposi- tion strategi follow solv issu .
11 build fe affin oper section , introduc softwar abstract construct algebra problem ( 10 ) sect .
3 reli .
softwar abstract , rela- tionship , depict fig .
10 .
main design goal under propos softwar architectur follow .
seek code reusabl extens , fempar user dispos uniqu entri point data type associ bind order build fe linear system , matter whether scalar system pdes , matter whether linear algebra data structur hold linear system entri either scalar ( mono- lithic ) block , matter laid memori ( central , distributed-memori ) .
fempar , uniqu entri point data type refer fe_affine_operator_t .
mathemat , fe_affine_operator_t repres affin oper ( 5 ) , obtain discret weak formul linear ( ize ) problem ( 4 ) .
introduc sect .
3.6 , oper repres ( defin base trial test fe space ) f defin ( 10 ) .
solut fe problem root oper ( soon fe problem nonsingular ) .
order seek aforement goal , fe_affine_operator_t reli abstract data type , refer assembler_t ( see fig .
10 ) .
nutshel , assembler_t offer set fe-assembl tailor , data structur neutral , defer tbps , e.g. , assembl contribut cell facet integr linear system coeffici matrix and/or right-hand side f. subclass assembler_t one ultim respons deal detail under fig .
9 user-level code snippet illustr usag cell_fe_function_type_t ( left ) facet_fe_function_type_t ( right ) data type s. badia et al .
123 particular linear algebra data structur hand .
latter one offer fe-assembl neutral interfac inject new entri add contribut , softwar piec becom reusabl separ , e.g. , use third parti softwar project ( necessarili fe-ori ) standalon softwar subsystem .
fempar offer rich set linear algebra data structur , e.g. , data structur organ block , enabl implement block precondition multiphys problem ( see , e.g. , [ 4345 ] ) .
apart requir handl linear coeffici matrix right-hand side system , fe_affine_operator_t also interact data type requir deliv life cycl ( i.e. , auto-gener- ation ) .
particular , f entri comput accord express ( 10 ) .
express involv fe space ( fe_space_t ) discret ( bi ) - linear form problem hand .
express softwar second ingredi , introduc dis- crete_integration_t abstract ; see fig .
10 .
structur section follow .
sect .
11.1 , first present assembler_t abstract data type , rational under design linear algebra structur ground .
next , sect .
11.2 , intro- duce discrete_integration_t abstract data type ultim charg perform inte- gration ( bi ) linear form assembl discret affin oper .
show particular implement data type ( i.e. , subclass ) galerkin approxi- mation stoke problem .
final , fe_affine_- operator_t data type describ sect .
11.3 .
11.1 linear algebra data structur associ assembl linear algebra fempar reli pair data type hierarchi root mathemat abstract linear algebra oper vector , repres softwar mean linear_operator_t vector_t abstract data type , respect .
abstract data type let number linear algebra algo- rithm within fempar ( e.g. , iter linear solver block precondition pde system ) express independ actual implement con- crete matrix vector data structur use , block layout ( ) , storag ( e.g. , dens spars storag format ) memori layout ( e.g. , local distributed-mem- ori ) , enabl code re-us extens larg extent .
abstract express syntax allow con- struction complex express involv oper among oper and/or vector also provid .
enabl implement new algorithm compact manner .
howev , linear algebra algorithm discuss herein postpon work , descript data type associ method hierarchi restrict necessari describ assembl fe affin oper .
sparse_matrix_t data type found intermedi level hierarchi root linear_- operator_t .
crucial data type fempar , repres scalar , non-distribut , spars matrix .
design follow idea present [ 92 ] .
design fig .
10 uml class diagram fe_affine_operator_t abstract relationship fempar class fempar : object-ori parallel finit element framework 123 ( ) use state oo design pattern [ 88 ] hide actual spars matrix storag format user .
follow pattern , sparse_matrix_t compos polymor- phic member variabl ( declar ) type base_sparse_matrix_t .
dynam type thus chang runtim ( via re-alloc ) .
dynam type repres storag hand use .
current subclass base_sparse_matrix_t includ coo_sparse_matrix_t , csr_sparse_matrix_t , csc_sparse_matrix_t , correspond coordi- nate list ( coo ) , compress spars row ( csr ) , compress spars column ( csc ) spars matrix storag format [ 93 ] , respect .
life cycl sparse_matrix_t instanc follow .
user first invok creat tbp , one sole specifi size matrix , i.e. , number row column .
method , howev , trigger number subsequ action .
particular , alloc dynam type one correspond coo format , leav readi inject addit contri- bution entri matrix .
although com- press , format ideal shape inject addit contribut entri matrix .
simpli push back member array grow dynam integration/assembl loop ( via judici realloc strategi trade cost memori ) .
spars storag format , csr storag implement csr_sparse_matrix_t data type ( also type extens base_sparse_matrix_t ) , although memori effici , requir predefin sparsiti pattern , precomput .
thus well suit dynam build process matrix .
point reader note , inflex storag format , one typic need accur estim maximum number nonzero per row ( column ) memori effici .
estim , howev , quit larg upper bound complex scenario ( e.g. , hp-adapt method 3d , among other ) .
build process finish , user call method special design leav sparse_ma- trix_t instanc readi use ( e.g. , perform oper ) .
involv compress process , duplic entri either sum , filter ( select user ) transform coo storag format storag format user actual requir ( e.g. , csr ) .
simplic , refer stage   compress   matrix .
sparse_matrix_t instanc final state , still possibl insert add contribut entri , far belong sparsiti pattern result first build process .
thus , e.g. , transient and/or nonlinear problem solv triangul domain chang , assembl coo format perform first nonlinear iter first time step .
shown far , softwar architectur sparse_matrix_t sever ( current futur ) storag format possibl within singl framework .
flexibl conveni two main reason .
first , given storag format like uni- form better perform across possibl oper comput architectur .
second , fempar interoper- abil extern softwar dramat increas .
new librari , use storag format , integr , new extens base_sparse_- matrix_t ad , leverag dozen thousand line code alreadi written .
apart sparse_matrix_t , spars matrix data type avail , suitabl handl block and/or dis- tributed-memori comput .
data type essenti compos way anoth sparse_matrix_t instanc .
exampl , block_sparse_matrix_t compos nblocks2 sparse_matrix_t instanc ; see fig .
10 .
, howev , provid set special tbps appli block case , e.g. , get_block tbp let client retriev sparse_matrix_t instanc corre- spond given block matrix .
counterpart sparse_matrix_t vector case refer scalar_array_t .
repres scalar , non-distribut , linear algebra vector , entri store explicit simpl ( fortran intrins ) allocat array .
howev , provid exploit sparsiti , code bound data type signific simpler one bound sparse_- matrix_t .
equip pair generic bind , signatur come differ flavour , order insert add contribut vector .
likewis , vector-lik data type avail suitabl handl block and/or distributed-memori comput .
exampl , block_array_t compos nblock scalar_array_t instanc ; see fig .
10 .
apart linear algebra data structur far , need addit data type assembler_t , offer fe-assembl tailor signatur fe_affine_- operator_t .
interfac defer tbps , extens , e.g. , scalar_assembler_t block ... assembler_t , implement , shown list 38. assembler_t   general enough   handl mani storag layout charg isol fe_affine_operator_t implement detail .
purpos mind , compos ( polymor- phic ) matrix_t ( polymorph ) array_t instanc .
turn abstract data type root matrix array data type seen far , respect .
set s. badia et al .
123 defer tbps two abstract data type design ( purpos ) suffici rich handl whole life cycl concret matrix array instanc .
high heterogen concret subclass ma- trix_t array_t preclud .
set tbps , particular , restrict alloc memori entri , initi entri given valu ( e.g. , initi zero ) , dealloc intern memori .
three oper requir fe_affine_operator_t deploy life cycl .
bulk life cycl concret sub- class matrix_t array_t handl subclass assembler_t .
, provid assembler_t subclass one awar concret detail correspond ma- trix_t array_t subclass .
besid , , overcom overhead associ dynam run- time polymorph , provid bind fine-grain call tbps inject ad contribut matrix array determin compil time .
go back list 38 , observ assem- bly_array ( resp. , assembly_matrix ) take intrins fortran array ( resp. , rank-2 array ) dummi argument element vector ( resp. , matrix ) .
besid , also get global dof identifi top singl cell , correspond cell surround facet ( see line 23 , 35 36 list 38 ) .
case scalar_assembler_t , implement made use tbps provid scalar_array_t order add contribut entri correspond tbps sparse_matrix_t .
case block_assembler_t , implement made loop block , obtain refer current block get_block tbp , use correspond tbps previous case .
assembly_array assembly_matrix tbps use fe_cell_iterator_t fe_ facet_iterator_t data type implement assembl tbps ( see line 35 68 list 30 sect .
10.2 ) .
complet , list 39 show list 38 .
assembler_t abstract data type defer tbps .
fempar : object-ori parallel finit element framework 123 signatur latter tbps .
one actual use user type extens dis- crete_integration_t , describ sect .
11.2 .
final , compress_storag defer tbp assembler_t let fe_affine_operator_t signal build process linear algebra data struc- ture alreadi finish alreadi   compress   final stage .
stress softwar architectur present section provid uniform assembl interfac client complet independ under imple- mentat linear algebra data structur .
subclass assembler_t charg manag block ( ) , wherea sparse_matrix_t charg manag storag scheme .
11.2 discret integr fe oper section , introduc abstract data type discrete_integration_t ( see list 40 ) .
defin generic integr bind , over- load integrate_galerkin inte- grate_petrov_galerkin defer tbps , depend number fe_space_t instanc pass ( see , e.g. , line 8 list 40 interfac cor- respond galerkin case ) .
user want implement fe problem must extend data type overwrit tbp use ( galerkin petrov-galerkin ) user-defin subclass .
overridden method , user must implement evalu entri f numer integr discret bilinear linear form ( 10 ) ( see sect .
3 ) .
base experi , integr part fe code must exhibit huge level flexibl .
everi time one want consid new set pdes new express discret bilinear form , compon must modifi .
must also abil integr general time integr scheme requir function arbitrari number step , deal nonlinear prob- lem involv need evalu fe function integr discret form , includ variabl physic coeffici bodi forc term determin analyt function .
result , rigid level must elimin .
inde , discrete_in- tegration_t abstract data type forc sub- class adher signatur defer tbps overload integr , member variabl subclass forc handl .
use design previous sketch , user absolut flexibl design discrete_integration_t subclass , ad attribut method requir integr assembl discret form , e.g. , ad arbitrari number fe_function_t *_func- tion_t instanc ( correspond setter use driver level ) describ physic properti , previous time step valu , solut previous nonlinear iter , etc .
integr cell-wis term ( bi ) linear form accomplish travers cell use fe_cell_iter instanc ( see sect .
10.2 ) , list 39 .
interfac assembl tbps   set   ( either cell facet ) iter .
s. badia et al .
123 access ( 1 ) cell integr data ( see sect .
8 ) requir comput local cell contribut ( 11 ) ( 2 ) local-to-glob dof number need assembl global linear algebra data structur .
analog , integr facet term , e.g. , one ( 20 ) dg formul , requir use fe_- facet_iterator_t instanc travers facet integr correspond facet term .
method integr call execut numerical_setup tbp fe_affine_opera- tor_t .
fact fe_affine_operator_t one decid whether invok galerkin petrov- galerkin integr , depend whether one two fe space pass actual argument ( second one option ) creat bind ( see line 15 list 42 ) .
analog , fe space ( ) also pass actual argument ( ) integrate_* bind , sinc need integr step ( see line 8 list 40 galerkin case ) .
illustr purpos , present list 41 exampl extens discrete_integration_t .
show implement defer procedur in- tegrate_galerkin approxim stoke problem use galerkin method .
data type use exampl driver present sect .
12 inf-sup stabl taylor-hood mix fe method ( see list 41 ) .
36 comment , integr ( bi ) linear form requir cell integr machineri , provid fe_space_t creation fe_cell_iterator_t line 19 list 41 .
apart control loop cell ( line 24 62 ) , fe_cell_iterator_t provid numer quadra- ture , turn requir get number integr point ( line 31 ) , associ weight ( line 32 ) .
also provid determin jacobian cell map ( line 32 ) , shape function gradient line 28 30 ( see ( 13 ) ( 14 ) ) .
implement ( bi ) linear form close blackboard express , make compact , simpl , intuit .
possibl definit vector_field_t , tensor_- field_t data type , togeth correspond express syntax avail fempar .
care discuss sect .
8.5 , achiev use oper over- load differ vector tensor oper , e.g. , contract scale oper .
symmetric_- part ( use line 35 38 ) , double_contract ( use line 40 ) trace helper stand-alon function ( use line 36 49 ) also offer make tensor oper easy.w also note implement also effici , sinc oper made without dynam memori allocation/dealloc .
final , fe_cell_iterator_t also offer tbp assembl element matrix vector assembl impos strong dirichlet condit ( line 66 ) use perturb ( 3 ) ( see sect .
10.4 ) .
dirichlet data extract fe_function_t repres ehud , must attribut concret discrete_integration_t .
non-conform fe space , formul requir also loop facet integr dg term .
written similar fashion use tool describ sect .
9 .
exampl , stokes_galerkin_integration_t extens attribut forc , use line 56 integr list 40 .
abstract data type discrete_integration_t defer tbps .
36 note stoke subclass discrete_integra- tion_t list 41 implement galerkin approxim problem independ fe space use .
re-us conform inf-sup stabl mix fe method , e.g. , taylor-hood , conform crouzeix-raviart , mini element , etc .
choic mix fe space determin user driver , build cartesian two-field fe space .
fempar : object-ori parallel finit element framework 123 list 41 .
implement bind overrrid integration_galerkin tbp discrete_integration_t galerkin approxim stoke problem .
s. badia et al .
123 right-hand side .
vector field describ instanc vector_function_t data type .
11.3 fe affin oper abstract ( simplifi ) declar fe_affine_opera- tor_t data type shown list 42 .
fe_affine_operator_t creat singl fe_space_t instanc , even two petrov-galerkin formul ; second instanc option , pass , galerkin method use , i.e. , fe space use trial test space .
user ( option ) configur desir block layout .
given cartesian product fe space x1h  .
.
. x nfield h multi- field problem nfield field ( see sect .
3.11 ) , block layout repres partit field subset .
37 describ argument array field_block size num_field equal nfield , indic block field assign ; default , one-block case use .
e.g. , stoke problem exampl 3.2 , one consid monolith block layout one block includ veloc pressur field ( field_blocks= [ 1,1 ] ) , two one-field block ( field_blocks= [ 1,2 ] [ 2,1 ] ) .
addit , user must provid addit inform diagon block , name ( 1 ) whether block symmetr , ( 2 ) whether symmetr storag want use block , ( 3 ) whether block posit definit , semi-posit definit , indefinit .
user option- alli provid array logic field_coupl ( size num_field  num_field ) ; posit i ; j determin whether matrix entri relat trial/test function fe space fe space j alway zero ( case , coupl fals ) .
stoke problem galerkin method , entri fals ( coupl ) pressure-pressur entri .
array provid , case default field coupl .
impli memori con- sumption , e.g. , store zero entri pressure- pressur block stoke problem .
block layout inform store data type block_layout_t , sketch list 43 , store array field_block field_coupl .
creat bind creat fe_affine_op- erator_t .
also store block-wis dof number generat fe_space_t instanc , instruct pass block_layout_t38 call tbp generate_global_dof_num- bere , describ sect .
10.3 .
fe_affine_operator_t also hold polymor- phic pointer assembler_t instanc .
dynam type select creation phase depend number block , storag layout requir , ( parallel serial ) environ .
final , polymorph pointer instanc declar type discrete_in- tegration_t also store ( see line 11 list 42 ) .
creation phase , fe_affine_operator_t readi setup .
thank design linear algebra data structur fempar , requir symbol setup , i.e. , precomput ( potenti ) sparsiti list 42 .
fe_affine_operator_t data type .
37 actual order field cartesian fe space determin user creation multi-field fe space , must consist implement discret weak form .
see , e.g. , creation mix taylor-hood fe space line 1121 list 46 , first field veloc field second one pressur field , integr weak form , e.g. , line 34 , 37 , 42 list 41 , number respect .
38 block-wis number creat independ dof num- bere everi block .
thus , dof differ block block-wis dof label .
fempar : object-ori parallel finit element framework 123 pattern .
numerical_setup tbp line 17 list 42 call integrate_galerkin tbp discrete_integr pointer trial_fe_spac associ inte- grate_petrov_galerkin otherwis , discuss sect .
11.2 .
12 driver exampl stoke problem section , describ softwar architectur driver program approxim solut stoke problem .
end , implement galerkin fe method ground   static   ( i.e. , non-adapt ) conform mesh inf-sup stabl fe space .
particular , con- sider conform fe space vh qh , vh grad- conform lagrangian space order k  1 , qh , grad-conform lagrangian space order k , i.e. , mix taylor-hood fe [ 5 ] .
39 fempar user decid design softwar architectur main driver program .
driver program nevertheless follow typic stage need simul pipelin base fes .
seek uniform , architectur present list 44 45 recommend fempar user .
main pro- gram unit reli number driver-level modul unit , part fempar librari develop user specif problem hand .
modul defin driver-level deriv data type tbps .
central deriv data type , call stokes_- driver_t exampl , design drive necessari step .
particular , offer public tbp , call run_simul , driver program reli perform actual simul .
driver program therefor simpl concis shown list 44 .
main data type driver , stokes_driver_t , shown list 45 .
equip set member variabl type alreadi describ previous section ; see comment right-hand side member variabl .
data type solver_t line 11 exist fempar .
actual complet set data type provid interfac high-end third parti spars direct solver .
besid , develop abstract implement iter linear solver ( in- clude , e.g. , conjug gradient gmres krylov subspac solver ) .
converg solver acceler use advanc precondition ground multilevel balanc domain decomposit con- straint ( mlbddc ) precondition [ 34 , 37 ] .
descrip- tion linear solver softwar subsystem deserv consider space postpon futur work .
exampl , understood data type provid necessari servic requir implement solve_system tbp line 20 list 45 .
data type stokes_conditions_t line 9 extend con- ditions_t sect .
10.4 .
encod strong dirichlet boundari condit data particular oper .
member variabl parameter_list ( see line 4 ) paramet dictionari \key ; valu [ pair .
imple- mentat provid stand-alon extern softwar librari call fpl [ 86 ] .
member variabl stokes_paramet ( see line 3 ) user-defin data type encapsul interact command line parser provid flap softwar packag [ 94 ] .
use implement tbp line 14 , pars argument given user command line , transfer aforement parameter_list member variabl .
run_simul tbp ( call main program line 8 list 44 ) implement help privat tbps line 1721 list 45 .
setup_triangul tbp invok creat tbp static_triangulation_t .
depend command-lin paramet valu , user may select automat generat structured/uniform triangul list 43 .
block_layout_t data type .
39 pressur field belong l2x .
thus , discontinu pressur fe space could also consid well .
would still l2x-conform .
case , e.g. , conform crouzeix-raviart mix fe .
s. badia et al .
123 simpl domain ( e.g. , unit cube ) , current brick ( quadrilater hexahedr ) cell , read mesh data file , e.g. , use gid unstructur mesh generat [ 91 ] .
fe space built setup_fe_spac tbp , sketch list 46 .
array base type p_reference_fe_t , data type wrap polymorph pointer refer- ence_fe_t instanc , alloc line 8 list 46 .
reference_fe_t instanc veloc pressur field creat call make_refer- ence_f line 11 21 , respect ; see sect .
6.4 .
interpol order numer scheme read command-lin line 5 .
select order equal k  1 k line 11 21 , respect .
dummi argument continu determin whether x admit trace oper .
particular exampl , could con- sider continuity=.fals .
want use discontinu pressur space .
creat tbp fe_space_t ( line 35 ) perform composit refer fes build cartesian product space x h. final , call set_up_cell_integr tbp fe_space_t line 38 set data struc- ture requir evalu cell integr list 40 .
implement setup_fe_affine_op- erat bind shown list 47 .
first invok creat tbp fe_affine_operator_t line 6 .
state monolith storag global coeffici matrix ( line 13 ) , symmetr ( line 9 ) , want symmetr storag , i.e. , store upper triangl ( line 8 ) , fact indefinit ( line 10 ) .
definit field_coupl line 14 reflect pressur diagon block null .
also pass instanc fe_space_t line 11 instanc subclass stokes_integration_t line 12 .
set oper line 27 , creat fe_function_t instanc line 18 .
line 19 , mean servic provid fe_space_t , interpol analyt function prescrib boundari veloc field ( retriev stokes_condit ) , fix strong dirichlet dof fe_function_t instanc hand .
result , fe function repres ehud , zero extens free dof ; see sect .
10.4 .
fe function pass stokes_integration_t instanc line 24 .
final , trigger oper auto-construct line 27 .
list 44 .
main program solut stoke problem .
list 45 .
main data type stoke driver .
fempar : object-ori parallel finit element framework 123 solve_system tbp ( see line 20 list 45 ) invok either direct precondit iter solver obtain free dof nodal valu fe function ( see sect .
10.5 ) .
provid % solut input solve_system vanish free dof ( see discuss previous paragraph ) , common practic use fempar driver save space re-us space devot free dof % solut store free dof nodal valu solut problem hand .
stress solver fempar solv free dof .
experi , decis dramat simplifi develop precondition , provid develop without take care strong dirichlet boundari condit .
final , write_solut tbp ( see line 21 list 45 ) charg generat simul result data file later visual use , e.g. , visit [ 95 ] paraview [ 96 ] .
end , write_solu- tion reli format independ , extens abstrac- tion , refer output_handler_t .
let user regist arbitrari number fe function ( togeth correspond fe space function generat ) cell data array ( e.g. , materi prop- erti error estim indic ) , output appropri format later visual .
among respons , ( abstract ) data type generat data written ( potenti parallel-distribut ) file system neutral , cell-ori data structur , deal ( potenti ) non-conform ( discontinu ) , variabl degre fe space among cell .
user may also select appli differenti oper fe function , diverg , gradient curl , involv calcul perform cell , custom cell output ( e.g. , belong interior geometri unfit fe simul ) via implement cell iter .
generat actual data file appropri format charg implement ( extens ) output_handler_t .
fempar current offer two implement output_handler_t ( although mani other could implement well grow communiti fempar develop given extens softwar architectur design ) .
vtk_output_han- dler_t let user generat data standard- open model vtk [ 97 ] .
current reli lib_vt- k_io [ 98 ] , ( ) actual exploit parallel mpi i/o instead use naiv singl file per mpi task scheme .
vtk_output_handler_t list 46 .
implement setup_fe_spac bind stoke problem .
s. badia et al .
123 therefor recommend option serial comput parallel comput moder number pro- cessor .
second one , xh5_output_handler_t , let user generat data xdmf [ 99 ] .
xdmf separ descript raw data , refer   light data   , data , refer   heavi data   .
light data express use set xml- base construct suit repres distributed- memori data structur fempar .
xdmf turn sup- port heavi data store use hdf5 [ 100 ] .
hdf5 , among other , data model file format design parallel i/o data challeng mind .
mean set support open sourc librari , refer par- allel hdf5 librari , fempar take advantag under distribut file system without deal high complex lower-level implemen- tation , raw mpi i/o .
particular , latter ser- vice provid xh5for [ 101 ] , stand-alon softwar librari , develop scratch , let user read/writ parallel partit fem mesh take advantag collective/independ mpi-io provid phdf5 librari effici generat vast amount data typic result large-scal scientif comput simul .
13 conclus work , thorough describ approach follow fempar order abstract softwar numer approxim problem govern pdes use fe method .
mathemat framework fes split number ( mathemat motiv ) deriv data type interact , result well-separ , robust , stabl set customiz softwar abstract develop wide applic fe solver .
tool equip fempar user machineri need perform step simul pipelin , includ mesh import/gener , dof enumer , evaluation/ assembl algebra system linear equat via fe integr , solut linear system , output comput result appropri format later visual .
order achiev goal , softwar architectur fempar thorough design mean advanc oo softwar re-engi- neer techniqu ( includ recurr applic oo design pattern [ 85 , 88 ] ) order increas eas use , extens , flexibl , reusabl .
fempar softwar architectur implement use latest oo featur fortran03/08 standard , name , inform hide data encapsul , inherit via type extens , dynam run-tim polymorph .
version fortran standard alreadi wide ( robust ) support compil typi- calli avail high-end comput environ .
judici set program techniqu let us achiev reason trade-off among extens perfor- manc , avoid case comput overhead frequent associ abstract oo soft- ware librari .
list 47 .
implement setup_fe_affine_oper bind stoke problem .
fempar : object-ori parallel finit element framework 123 softwar abstract cover work includ :  definit refer fes , reli concept polytop defin cell topolog arbitrari dimens , machineri defin multi-dimen- sional polynomi function arbitrari order easi automat way , general procedur generat shape function base local dof .
 global fe space abstract , reli refer fe ( ) triangul physic domain .
respons defin local-to-glob dof number , must respect conform ( need ) .
fe space also provid tool numer integr ( bi ) linear form , e.g. , map- ping refer physic space , etc. , cell facet ( dg method ) .
 fe affin oper generat discret origin problem ( probabl linear step ) .
fe solut root ( soon problem well-pos ) oper .
oper , trial test function discret ( bi ) linear form problem hand defin , repres matrix vector whose entri comput numer integr use fe space .
fempar use 4 year team 10 research differ research institu- tion univers .
initi oo re-design , deriv data type ( attribut bind ) gradual modifi accommod new featur consid , fix express limit even depen- denci knot origin design .
softwar architec- ture converg , although certain subject futur chang , alreadi proven capabl satisfi number user  softwar require- ment , even applic problem involv complex advanc featur ( e.g. , develop grow geometri 3d print technolog ) .
con- sider steadi regim , attain year develop , tremend man-month power effort , proof softwar abstract fempar practic relev prospect user develop , also research want learn oo implement fe method .
motiv decis author promot librari communiti softwar project , open extern user new collabor , publish librari public git repositori [ 42 ] , write articl .
particular , architectur describ correspond first public releas fempar , assign git tag fempar-1.0.0 .
first public releas fempar almost 300k line ( most ) fortran code .
thus , document like one , quit detail descript servic pro- vide librari motiv under softwar design , valuabl resourc com- plement sourc code , becom overwhelm .
paper , restrict construct fe oper body-fit fe space .
howev , major ( uniqu compar fe sci- entif softwar packag avail internet ) cornerston fempar abstract oo framework implement wide applic high scalabl multilevel dd solver .
40 let framework high coupl numer integr data struc- ture applic , one hand , high customiz , , one deriv optim pre- condition particular structur discret oper hand , tackl new problem challeng , leverag distributed-memori implement idea [ 37 ] framework ground .
cus- tomiz build block framework includ fine-grid coarse-grid dof aggreg , constraint matrix under imposit continu coars dof function across coars object , weight oper under inject among continu discontinu space , kind solver use dirichlet , neumann constrain local prob- lem , coarsest-grid global problem [ 103 ] .
how- ever , postpon discuss solver , precondition , data structur suitabl parallel dis- tributed-memori comput , exot dis- cretize techniqu fempar , like b-spline xfem method , subsequ work .
acknowledg author want thank jesus bonilla , oriol colom , eric neiva , hieu nguyen , marc olm , vctor sand , francesc verdugo ( alphabet order ) strong commit fempar project , implement softwar describ work , thorough review preliminari version document .
resourc need develop sci- entif librari librari like fempar would feasibl without excel research fund .
sens , sb sincer thank support european research council start grant .
258443comfus : comput method fusion technolog fp7 program two relat proof concept grant .
640957fexfem : free open sourc extrem scale finit element softwar proof concept grant .
737439nuwasim : nuclear wast deep repositori simul h2020 program .
sb grate acknowledg support receiv catalan govern icrea academia research program .
complianc ethic standard conflict interest author declar conflict interest .
40 inde , multilevel dd solver within fempar sinc 2014 high-q club scalabl european code , maintain julich supercomput center [ 102 ] .
s. badia et al .
123 open access articl distribut term creativ common attribut 4.0 intern licens ( http : //crea tivecommons.org/licenses/by/4.0/ ) , permit unrestrict use , distribut , reproduct medium , provid give appropri credit origin author ( ) sourc , provid link creativ common licens , indic chang made .
refer 1 .
guo b , babuska ( 1986 ) h-p version finit element method .
comput mech 1 ( 1 ) :2141 2 .
ainsworth , oden jt ( 2011 ) posteriori error estim finit element analysi .
wiley , new york 3 .
melenk jm , wohlmuth bi ( 2001 ) residual-bas posteriori error estim hp-fem .
adv comput math 15 ( 14 ) :311331 4 .
nedelec jc ( 1980 ) mix finit element r3 .
numer math 35 ( 3 ) :315341 5 .
brezzi f , fortin ( 1991 ) mix hybrid finit element method .
springer , berlin 6 .
arnold dn , falk rs , winther r ( 2006 ) finit element exterior calculus , homolog techniqu , applic .
acta numer 15:1155 7 .
neilan , sap ( 2016 ) stoke element cubic mesh yield divergence-fre approxim .
calcolo 53 ( 3 ) :263283 8 .
hugh tjr , cottrel ja , bazilev ( 2005 ) isogeometr analysi : cad , finit element , nurb , exact geometri mesh refin .
comput method appl mech eng 194 ( 3941 ) :41354195 9 .
cockburn b , gopalakrishnan j , lazarov r ( 2009 ) unifi hybrid discontinu galerkin , mix , continu galerkin method second order ellipt problem .
siam j numer anal 47 ( 2 ) :13191365 10 .
demkowicz l , gopalakrishnan j ( 2010 ) class discontinu- ous petrov-galerkin method .
part : transport equat .
comput method appl mech eng 199 ( 2324 ) :15581572 11 .
ang j , barrett r , benner r , burk , chan c , cook j , donofrio , hammond , hemmert k , kelli , le h , leung v , resnick , rodrigu , shalf j , stark , unat , wright n ( 2014 ) abstract machin model proxi architectur exascal comput .
: co-hpc  14 proceed 1st intern workshop hardwaresoftwar co-design high perform comput .
ieee , pp 2532 12 .
gropp w ( 2015 ) mpi ? x enough exascal ?
keynot intern high perform comput forum , tianjin , china 13 .
kale lv , krishnan ( 1993 ) charm ? ?
: portabl concurr object orient system base c ? ? .
acm sigplan 28 ( 10 ) :91108 14 .
bauer , treichler , slaughter e , aiken ( 2012 ) legion : express local independ logic region .
: proceed intern confer high perform comput , network , storag analysi , sc  12 , los alamito , ca , usa , ieee comput societi press , pp 66:166:11 15 .
kaiser h , heller , adelstein-lelbach b , serio , fey ( 2014 ) hpx : task base program model global address space .
proceed 8th intern confer partit global address space program model , pgas  14 , new york , ny , usa , acm , pp 6:16:11 16 .
janin bennett pi , robert clay pm , baker g , gamel , hollman , knight , kolla h , sjaardema g , slattengren n , teranishi k et al ( 2015 ) asc atdm level 2 mileston # 5325 : asynchron many-task runtim system analysi assess- ment next generat platform .
technic report sand2015-8312 , sandia nation laboratori 17 .
bangerth w , hartmann r , kanschat g ( 2007 ) deal .
iia general- purpos object-ori finit element librari .
acm tran math softw 33 ( 4 ) :24 18 .
bangerth w , davydov , heister , heltai l , kanschat g , kronbichl , maier , turcksin b , well ( 2016 ) deal .
ii librari , version 8.4 .
j numer math 24:135141 19 .
aln , blechta j , hake j , johansson , kehlet b , logg , richardson c , ring j , rogn , well gn ( 2015 ) fenic project version 1.5 .
arch numer softw 3 ( 100 ) :923 20 .
bauman p , stogner r ( 2016 ) grin : multiphys framework base libmesh finit element librari .
siam j sci comput 38 ( 5 ) : s78s100 21 .
cantwel cd , moxey , comerford , boli , rocco g , mengaldo g , de grazia , yakovlev , lombard je , ekelschot , jordi b , xu h , mohami , eskilsson c , nelson b , vos p , biotto c , kirbi rm , sherwin sj ( 2015 ) nektar ? ?
: open- sourc spectral/el framework .
comput phys commun 192:205219 22 .
moos ( multiphys object-ori simul environ- ment ) framework .
http : //mooseframework.org/ 23 .
mfema free , lightweight , scalabl c ? ?
librari finit element method .
http : //mfem.org/ 24 .
hecht f ( 2012 ) new develop freefem ? ? .
j numer math 20 ( 34 ) :251265 25 .
dedner , nolt ( 2012 ) construct local finit element space use generic refer element .
: dedner , flemisch b , klofkorn r ( ed ) advanc dune .
springer , berlin , pp 316 26 .
balay , abhyankar , adam mf , brown j , brune p , buschelman k , dalcin l , eijkhout v , gropp wd , kaushik , knepley mg , mcinn lc , rupp k , smith bf , zampini , zhang h , zhang h ( 2016a ) petsc web page 27 .
balay , abhyankar , adam mf , brown j , brune p , buschelman k , dalcin l , eijkhout v , gropp wd , kaushik , knepley mg , mcinn lc , rupp k , smith bf , zampini , zhang h , zhang h ( 2016b ) petsc user manual .
technic report anl-95/11revis 3.7 , argonn nation laboratori 28 .
balay , gropp wd , mcinn lc , smith bf ( 1997 ) effici manag parallel object orient numer soft- ware librari .
: arg e , bruaset , langtangen hp ( ed ) modern softwar tool scientif comput .
birkhaus press , berlin , pp 163202 29 .
falgout rd , yang um ( 2002 ) hypr : librari high perfor- manc precondition .
: comput scienceicc 2002 .
springer , berlin , pp 632641 30 .
heroux , bartlett ra , howl , hoekstra rj , hu jj , kolda tg , lehoucq rb , long kr , pawlowski rp , phipp et , saling ag , thornquist hk , tuminaro rs , willenbr jm , william , stanley ks ( 2005 ) overview trilino project .
acm tran math softw 31 ( 3 ) :397423 31 .
trilino project .
https : //trilinos.org 32 .
toselli ( 2006 ) dual-prim feti algorithm edg finite- element approxim 3d .
ima j numer anal 26 ( 1 ) :96130 33 .
dohrmann cr ( 2007 ) approxim bddc precondition .
numer linear algebra appl 14 ( 2 ) :149168 34 .
badia , martn af , princip j ( 2015 ) scalabl inexact balanc domain decomposit constraint overlap coarse/fin correct .
parallel comput 50:124 35 .
efendiev , hou ty ( 2009 ) multiscal finit element method : theori applic .
springer , new york 36 .
klawonn , lanser , rheinbach ( 2015 ) toward extrem scalabl nonlinear domain decomposit method ellipt fempar : object-ori parallel finit element framework 123 http : //creativecommons.org/licenses/by/4.0/ http : //creativecommons.org/licenses/by/4.0/ http : //mooseframework.org/ http : //mfem.org/ https : //trilinos.org partial differenti equat .
siam j sci comput 37 ( 6 ) : c667 c696 37 .
badia , martn , princip j ( 2016 ) multilevel balanc domain decomposit extrem scale .
siam j sci comput , pp c22c52 38 .
zampini ( 2016 ) pcbddc : class robust dual-prim method petsc .
siam j sci comput 38 ( 5 ) : s282s306 39 .
badia , olm ( 2017 ) spacetim balanc domain decom- posit .
siam j sci comput 39 ( 2 ) : c194c213 40 .
brune p , knepley , smith b , tu x ( 2015 ) compos scalabl nonlinear algebra solver .
siam rev 57 ( 4 ) :535565 41 .
falgout r , friedhoff , kolev , maclachlan , schroder j ( 2014 ) parallel time integr multigrid .
siam j sci comput 36 ( 6 ) : c635c661 42 .
fempar : finit element multiphys parallel solver .
https : // gitlab.com/fempar/fempar 43 .
elman hc , silvest dj , wathen aj ( 2005 ) finit element fast iter solver : applic incompress fluid dynam .
oxford univers press , oxford 44 .
badia , martn af , plana r ( 2014 ) block recurs lu pre- condition thermal coupl incompress induc- tionless mhd problem .
j comput phys 274:562591 45 .
cyr e , shadid j , tuminaro r ( 2016 ) teko : block precondi- tion capabl concret exampl applic navier stoke mhd .
siam j sci comput 38 ( 5 ) : s307s331 46 .
colom , badia , codina r , princip j ( 2015 ) assess variat multiscal model larg eddi simul turbul incompress flow .
comput method appl mech eng 285:3263 47 .
colom , badia ( 2016 ) segreg rungekutta method incompress navierstok equat .
int j numer method eng 105 ( 5 ) :372400 48 .
colom , badia , princip j ( 2016 ) mix finit element method convect stabil larg eddi simu- lation incompress turbul flow .
comput method appl mech eng 304:294318 49 .
colom , badia ( 2017 ) segreg rungekutta time integr convection-stabil mix finit element scheme wall-unresolv les incompress flow .
comput method appl mech eng 313:189215 50 .
badia , codina r , plana r ( 2013a ) uncondit converg stabil finit element approxim resist magnetohydrodynam .
j comput phys 234:399416 51 .
badia , plana r , gutierrez-santacreu jv ( 2013b ) uncondi- tional stabl oper split algorithm incom- pressibl magnetohydrodynam system discret stabil finit element formul base project .
int j numer method eng 93 ( 3 ) :302328 52 .
plana r , badia , codina r ( 2011 ) approxim inductionless mhd problem use stabil finit element method .
j comput phys 230 ( 8 ) :29772996 53 .
smolentsev , badia , bhattacharyay r , buhler l , chen l , huang q , jin hg , krasnov , lee dw , de les vall em , mistrangelo c , munip r , ni m-j , pashkevich , patel , pulugundla g , satyamurthi p , snegirev , sviridov v , swain p , zhou , zikanov ( 2015 ) approach verif valid mhd code fusion applic .
fusion eng des 100:6572 54 .
badia , codina r , plana r ( 2015 ) analysi uncondi- tional converg stabil finit element formul incompress magnetohydrodynam .
arch comput method eng 22 ( 4 ) :621636 55 .
badia , hierro ( 2015 ) discret maximum principl discontinu galerkin method .
comput method appl mech eng 286:107122 56 .
badia , hierro ( 2014 ) monotonicity-preserv stabil finit element approxim transport problem .
siam j sci comput 36 ( 6 ) : a2673a2697 57 .
hierro , badia , kus p ( 2016 ) shock captur techniqu adapt finit element .
comput method appl mech eng 309:532553 58 .
badia , bonilla j ( 2017 ) monotonicity-preserv finit ele- ment scheme base differenti nonlinear stabil .
comput method appl mech eng 313:133158 59 .
badia , bonilla j , hierro ( 2017 ) differenti monotonicity- preserv scheme discontinu galerkin method arbi- trari mesh .
comput method appl mech eng 320:582605 60 .
badia , verdugo f ( 2017 ) robust scalabl domain decomposit solver unfit finit element method .
arxiv:1703.06323 [ math ] 61 .
chiumenti , neiva e , salsi e , cervera , badia , davi c , chen z , lee c ( 2017 ) numer model experiment valid select laser melt ( submit ) 62 .
badia , martn af , princip j ( 2013 ) implement scalabl analysi balanc domain decomposit meth- od .
arch comput method eng 20 ( 3 ) :239262 63 .
badia , martn af , prncipe j ( 2013 ) enhanc balanc neumannneumann precondit comput fluid solid mechan .
int j numer meth eng 96 ( 4 ) :203230 64 .
badia , nguyen h ( 2016 ) balanc domain decomposit constraint perturb .
siam j numer anal 54 ( 6 ) :34363464 65 .
badia , martn af , nguyen h ( 2016 ) physics-bas balanc domain decomposit constraint heterogen prob- lem .
work paper preprint 66 .
badia , martn , princip j ( 2014 ) high scalabl parallel implement balanc domain decomposit con- straint .
siam j sci comput 36 ( 2 ) : c190c218 67 .
adam jc , brainerd ws , hendrickson ra , main , martin jt , smith bt ( 2009 ) fortran 2003 handbook .
springer , london , 68 .
rouson , xia j , xu x ( 2011 ) scientif softwar design : object-ori way , 1st edn .
cambridg univers press , new york 69 .
ern , guermond j-l ( 2004 ) theori practic finit element .
springer , berlin 70 .
brenner sc , scott r ( 2010 ) mathemat theori finit element method .
springer , softcov reprint hardcov 3rd ed .
2008 edn 71 .
quarteroni ( 2014 ) numer model differenti prob- lem .
springer milan , milano 72 .
monk p ( 2003 ) finit element method maxwel  equa- tion .
clarendon press , oxford 73 .
duffi ( 1982 ) quadratur pyramid cube inte- grand singular vertex .
siam j numer anal 19 ( 6 ) :12601262 74 .
dunav da ( 1985 ) high degre effici symmetr gaus- sian quadratur rule triangl .
int j numer meth eng 21 ( 6 ) :11291148 75 .
olm , badia , martn af ( 2017 ) simul high tem- peratur superconductor experiment valid .
arxiv : 1707.09783 [ physic ] 76 .
badia , quaini , quarteroni ( 2008a ) modular vs. non- modular precondition fluid-structur system larg added-mass effect .
comput method appl mech eng 197 ( 4950 ) :42164232 77 .
badia , nobil f , vergara c ( 2008b ) fluid-structur partit procedur base robin transmiss condit .
j comput phys 227 ( 14 ) :70277051 s. badia et al .
123 https : //gitlab.com/fempar/fempar https : //gitlab.com/fempar/fempar http : //arxiv.org/abs/1703.06323 http : //arxiv.org/abs/1707.09783 http : //arxiv.org/abs/1707.09783 78 .
badia , quaini , quarteroni ( 2008c ) split method base algebra factor fluidstructur interact .
siam j sci comput 30 ( 4 ) :1778 79 .
badia , nobil f , vergara c ( 2009 ) robinrobin precondi- tion krylov method fluid-structur interact problem .
comput method appl mech eng 198 ( 3336 ) :27682784 80 .
rogn , kirbi r , logg ( 2009 ) effici assembl h ( div ) h ( curl ) conform finit element .
siam j sci comput 31 ( 6 ) :41304151 81 .
agelek r , anderson , bangerth w , barth w ( 2017 ) ori- ent edg unstructur two- three-dimension mesh .
acm tran math softw ( appear ) 82 .
bangerth w , kayser-herold ( 2009 ) data structur requir hp finit element softwar .
acm tran math softw 36 ( 1 ) :131 83 .
badia , baig j ( 2013 ) adapt finit element simul incompress flow hybrid continuousdiscontinu galerkin formul .
siam j sci comput 35 ( 1 ) : a491a516 84 .
dryja , galvi j , sarki ( 2007 ) bddc method dis- continu galerkin discret ellipt problem .
j com- plex 23 ( 46 ) :715739 85 .
freeman e , robson e , sierra k , bate b ( ed ) ( 2004 ) head first design pattern .
 reilli , sebastopol 86 .
fplfortran paramet list .
https : //gitlab.com/fempar/fpl 87 .
beall mw , shephard ms ( 1997 ) general topology-bas mesh data structur .
int j numer meth eng 40 ( 9 ) :15731596 88 .
gamma e , helm r , johnson r , vlissid j ( 1995 ) design pat- tern : element reusabl object-ori softwar .
addison- wesley , boston 89 .
bangerth w , burstedd c , heister , kronbichl ( 2012 ) algorithm data structur massiv parallel generic adapt finit element code .
acm tran math softw 38 ( 2 ) :14:114:28 90 .
burstedd c , wilcox lc , ghatta ( 2011 ) p4est : scalabl algorithm parallel adapt mesh refin forest octre .
siam j sci comput 33 ( 3 ) :11031133 91 .
gidth person pre post processor .
http : //www.gidhom .
com 92 .
filippon , buttari ( 2012 ) object-ori techniqu spars matrix comput fortran 2003 .
acm tran math softw 38 ( 4 ) :23:123:20 93 .
saad ( 2003 ) iter method spars linear system , 2nd edn .
societi industri appli mathemat 94 .
flapfortran command line argument parser poor peopl .
https : //github.com/szaghi/flap 95 .
child h , brugger e , whitlock b , meredith j , ahern , pugmir , biaga k , miller , harrison c , weber gh , krishnan h , fogal , sanderson , garth c , bethel ew , camp , rubel , durant , favr jm , navratil p ( 2012 ) visit : end-us tool visual analyz larg data .
: high perfor- manc visualization-en extreme-scal scientif insight , pp 357372 96 .
ayachit u ( 2015 ) paraview guid : parallel visual applic .
kitwar inc , clifton park 97 .
schroeder w , martin km , lorensen ( 1998 ) visualiza- tion toolkit : object-ori approach 3d graphic , 2nd edn .
prentice-hal , inc. , upper saddl river 98 .
lib_vtk_iopur fortran ( 2003 ? )
librari write read data conform vtk standard .
https : //gitlab.com/fempar/ lib_vtk_io 99 .
xdmfextens data model format .
http : //www.xdmf .
org/index.php/main_pag 100 .
hdf group .
hierarch data format version 5. http : // www.hdfgroup.org/hdf5 , 20002017 101 .
xh5forxdmf parallel partit mesh input/output top hdf5 .
https : //gitlab.com/fempar/xh5for 102 .
brommel , wyli bjn , fring w ( 2015 ) juqueen extrem scale workshop 2015 .
technic report fzj-2015-01645 , julich supercomput center 103 .
dohrmann cr ( 2003 ) precondition substructur base constrain energi minim .
siam j sci comput 25 ( 1 ) :246258 fempar : object-ori parallel finit element framework 123 https : //gitlab.com/fempar/fpl http : //www.gidhome.com http : //www.gidhome.com https : //github.com/szaghi/flap https : //gitlab.com/fempar/lib % 5fvtk % 5fio https : //gitlab.com/fempar/lib % 5fvtk % 5fio http : //www.xdmf.org/index.php/main % 5fpage http : //www.xdmf.org/index.php/main % 5fpage http : //www.hdfgroup.org/hdf5 http : //www.hdfgroup.org/hdf5 https : //gitlab.com/fempar/xh5for fempar : object-ori parallel finit element framework abstract introduct fempar project fe framework boundari valu problem weak form space discret fes fe concept refer physic space construct polynomi space construct shape function basi global fe space conform numer integr grad-conform fes : lagrangian ( nodal ) element div-conform fes curl-conform fes cartesian product fes multi-field problem non-conform method facet integr polytop node generat index global dof number conform implement polytope_t relat data type polynomial_t abstract reference_fe_t abstract refer cell topolog refer fe space set local dof creat reference_fe_t polymorph instanc enumer reference_fe_t subclass descript physic domain : triangulation_t abstract abstract triangul represent softwar implement exampl triangulation_t subclass rational evalu cell integr numer quadratur evalu refer cell shape function geometr map evalu shape function physic space cell integr user code exampl evalu facet integr numer quadratur geometr map facet map neighbour cell map evalu shape function physic space facet integr user code exampl change-of-basi implement reference_fe_t subclass integr global dof handl : fe_space_t abstract intern organ fe_space_t conceptu view fe_space_t global dof number generat strong imposit boundari condit global fe function restrict triangul cells/facet build fe affin oper linear algebra data structur associ assembl discret integr fe oper fe affin oper abstract driver exampl stoke problem conclus acknowledg refer
