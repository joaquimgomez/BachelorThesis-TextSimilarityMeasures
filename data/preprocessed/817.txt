measur traffic lane&#x02010;chang convert video space&#x02013;tim imag doi: 10.1111/mice.12430 o r g n l r t c l e measur traffic lane-chang convert video spacetim imag marcel sala1 francesc soriguera1 kevin huillca2 vernica vilaplana2 1bit barcelona innov transportation, civil environment engin depart- ment, upc-barcelonatech, barcelona, spain 2imag process group, signal theori commun department, upc- barcelonatech, barcelona, spain correspond francesc soriguera, bit barcelona inno- vativ transportation, civil environ- mental engin department, upc- barcelonatech, barcelona 08034, spain. email: fund inform spanish ministri economi compet- itiveness, grant/award number: tra2016- 79019-r/coop; ministerio economa y competitividad abstract empir data need order extend knowledg traffic behavior. video record enrich typic data loop detectors. context, data extract video challeng task. set automat video process- ing system costly, complex, accuraci achiev usual improv traffic flow models. contrast visual data extract watch record requir extens human intervention. semiautomat video process- ing methodolog count lane-chang freewai proposed. method allow count lane chang faster visual procedur fall complex error automation. method base convert video set spacetim images, visual count. methodolog test freewai locat near barcelona (spain) good results. user-friendli implement method avail 1 introduct recent years, lane-chang activ identifi main factor trigger congest dens traf- fic, caus instabl capac drop (coifman, mishalani, wang, & krishnamurthy, 2006; duret, ahn, & buisson, 2011; laval, cassidy, & daganzo, 2007). besides, absenc lane chang associ smooth improv traffic perform (cassidy, jang, & daganzo, 2010; menendez & daganzo, 2007; qu & wang, 2015). find ground empir data. fact, current research freewai lane-chang us laudabl limit inaccur gen- erat simul (ngsim) data set (coifman & li, 2017; feder highwai administration, 2015), us theoret lane- chang model (coifman et al., 2006; duret et al., 2011), us data ad hoc experi (sun & elefteriadou, 2012; open access articl term creativ common attribution-noncommerci license, permit use, distribut reproduct medium, provid origin work properli cite commerci purposes. 2019 author computer-aid civil infrastructur engin publish wilei periodicals, inc. behalf hojjat ad sun & kondyli, 2010). main caus lack free- wai lane-chang data typic freewai sensors, loop detector licens plate recognit devices, unabl measur them. situations, video record appear alternative, imag process requir data extract constitut challenge. automat data extract process video record technic feasible, case cost-effect turn insuffici accu- rate. limit data treat research pilot test justifi implement complex auto- matic imag process systems, gener involv sig- nific invest hardwar software, long learn periods. addition, best autom tool requir extens human intervent obtain data accuraci requir research applic (coifman & li, 2017). context, research usual comput aid civ inf. 2019;118. wileyonlinelibrary.com/journal/mic 1 2 sala et al. avoid autom method opt visual data extrac- tion, impli watch record manual annot relev data. extrem tediou time-consum task. imagin situat lane chang need count differ section three- lane freewai total 63 hr video recordings. precis need gave rise develop fast, simple, reliabl semiautomat video process method present paper. rest paper structur follows: section 2 review differ method video process order extract traffic data; next, section 3 detail descript propos methodolog count freewai lane chang presented. numer assess guidelin correctli us method described. section 4, method appli video record freewai access barcelona (spain). reliabl method assessed, preliminari traffic analysi present show potenti kind data understand- ing real effect lane-changing. finally, section 5, conclus outlined, highlight main contri- bution present method. paper complet appendixes. appendix present analyt deriva- tion perspect deformation, need taken account frame cameras. appendix b present detail propos global qualiti index (gqi) recordings. appendix c describ automat video process techniqu implement order obtain compar scenario. 2 traffic video processing: state art automat semiautomat method extract traffic data video record exist. general, automa- tion, demand method term hard- ware calibr required. semiautomat methods, human intervent needed, flexible, work wider rang configurations, pre- cise fulli autom ones. select meth- od present next. 2.1 fulli autom techniqu author best knowledge, automat video detect tool traffic analysi ngsim softwar (feder highwai administration, 2006, 2015). ngsim project (next gener simulator) includ imag recogni- tion softwar abl automat detect follow tra- jectori singl vehicl studi area. softwar estim size vehicle. technic require- ment us tool includ usag special camera rectification, stabilization, georeferenc video recordings. make usag suitabl specif case equip set budget avail treat larg amount data. type requir limit usag fulli autom techniques, precis limi- tation. best automat method tool over- come difficulti creat occlusions, project distor- tions, shadows, vehicl color similar pavement, etc. (coifman & li, 2017). actually, accuraci reconstruct trajectori video imag techniqu correc- tion hot topic, analyz instanc buisson, villegas, rivoirard (2016), gener (i.e., site-specific) procedur proposed. ngsim data exception, work prove trajectori databas plagu errors. moreover, measur error vehicl later posit larger frequent, significantli affect lane-chang count, shown montanino punzo (2013a) punzo, borzacchiello, ciuffo (2011). error ngsim databas detect filter (montanino & punzo, 2015), later posit difficult correct, replac lane assignment. qualiti ngsim- correct databas (avail montanino & punzo, 2013b) greatli improv filter procedure, signific error lane assign remain. seen realiz that, instances, consecut vehicl lane chang rel order chang lanes. issues, analyz coifman li (2017), deeper evalu ngsim data error performed. error pro- duce motorbikes, travel regular lanes, vehicl assign slow (i.e., rightmost) lane actual travel hard shoul- der. coifman li (2017) unveil reason nois error ngsim database, like down-sampl video record 640 480 pixels, mean dis- tant vehicl 12 12 pixels, small robustli detect automat track tools. end day, conclud later posit report raw ngsim databas reli heavily. apart ngsim project, approach automat vehicl detect track developed. background subtract algorithm identifi move object differ background (stauffer & grimson, 1999). background chang time, algorithm need detect adapt variations. method differ type back- ground model procedur updat model, gener base machin learn techniques. applic traffic data rang complex behav- ioral analysis, kumar, ranganath, weimin, sengupta (2005), record pedestrian-vehicl vehicle-check sala et al. 3 post interact classifi set predefin behav- ioral scenarios, simpl us camera automat vehicl count devic (bhaskar & yong, 2014). actu- ally, idea camera virtual loop detector popular literatur (avery, wang, & zhang, 2007; uk & thool, 2013), case allow selec- tion camera coverag constitut detect zone. monitor traffic intersect tradit applic camera automat imag methods, loop detector neces- sari instead. exampl cheung kamath (2005), trajectori identifi complex intersection, zheng, wang, nihan, hallenbeck (2006), us record detect oversatur traffic signal junction. work us movement detect techniqu convert camera automat vehicl classif scheme (mor- ri & trivedi, 2006a, 2006b), incid detect sys- tem (mak & fan, 2006), incid detect approach base advanc process loop detec- tor data exist (ade & karim, 2005; ghosh-dastidar & adeli, 2003; karim & adeli, 2003). notic increas- ing research attent place applic tech- niqu track cyclist pedestrians, tradit detector unabl provid basic measurements. real-tim implement track pedestrian estim speed video record background subtract approach present masoud papanikolopoulo (2001). off-lin estima- tion suffices, approach malinovskiy, zheng, wang (2009) abl work precis grayscal low-resolut videos. movement detect techniques, like background subtrac- tion, work reason vehicl fast constant speed (i.e., free-flow traffic). contrast, reliabl compromis travel differ vari speeds, stop, hap- pen congest traffic. edg contrast detect method (canny, 1986) alternative, work better situations, long angl vision vehi- cle chang camera coverage. shad- ow light transit repres problem type methods, differ appear vehi- cle differ light conditions. examples, alireza, karami-mollaie, baleghi (2012) us color distribut object real-tim track vehicl shaoqing, zhengguang, jun, chen (2009) us edg detect auto- matic classifi vehicles. general, method abl detect track vehicl reason proxim camera, error appear vehicl track furthest image. occlus import sourc error automat imag techniqu vehicl tracking. occlu- sion appear vehicl hidden, instanc truck, tree, panel traffic information. dens traf- fic, signific number occlusions, error aris autom trajectori estimation. order allevi problem, coifman, beymer, mclauchlan, malik (1998) propos feature-bas track system. track particular featur instead entir vehicl make robust partial occlusion. approach propos nguyen smeulder (2004), track base templat matching. templat tempor smooth appear featur vehicles, resist partial occlus abrupt light changes. work propos usag aerial video order avoid occlu- sion (angel, hickman, mirchandani, & chandnani, 2003; zheng et al., 2013). zenith view elimin occlusions, reduc perspect distort size shape vehicl closer to, farther camera. spite fact proper- ti facilit vehicl track aerial videos, imag vibrat record helicopt drones, challeng technic problem approach. stabi- lizat record need addressed, instanc techniqu propos knoppers, van lint, hoogendoorn (2012). conclusion, author knowledge, research work address specif automat detec- tion traffic lane-chang activ video recordings. lane-chang seen result track vehicl later movement, typic pre- cision trajectori estim method video record (i.e., 5%) (kumar et al., 2005) similar lane width, especi furthest image, mean lane-chang count track method reliabl enough. 2.2 semiautomat video process semiautomat process includ method complet elimin human visual intervent limit specif tasks. lead effi- cienci improv respect complet visual manual processing, higher accuraci respect automation. methodolog develop patir (2010) patir cassidi (2011) specif traffic analysi tomei expresswai access tokyo japan, fall category. methodolog requir cam- era place nearbi (e.g., 100 m apart) in-between on/off ramps. method convert video standstil images, call epochs. epoch imag result pixel line video accumul time; line call scanlin (see figur 1). impli that, pixel video scene, scan- line used. patir (2010) patir cassidi (2011), epoch construct scanlin set perpendicular 4 sala et al. (a) scanlin (b) time scanlin (x) f g u r e 1 video epoch. origin methodolog patir (2010). (a) video frame time. (b) epoch note. traffic direct follow posit direct y axis. traffic stream, resembl virtual traffic detectors, vehicl appear pavement color background, suffer perspect deformation. manual click softwar semiautomat recogn vehicl success camera rough estim vehicl trajectori achieved, make possibl count lane chang precis given densiti camera used. methodolog propos paper measur lane-chang activ base idea epoch. 2.3 visual video process raw option, consid baselin ref- erenc comparison. impli watch entir video length measur traffic variabl interest. case lane-changing, author experi confirm count reliabl plai video maximum doubl speed, entir video need plai pair lanes. option exist enhanc com- plete manual procedure. instance, count auto- matic save user click (x, y) coordin image, similar campbel (2012) campbel skabardoni (2013), author aim clas- sifi driver reaction face stop sign (i.e., stopping, yielding, skip signal). option elimin need note take speed visual video process- ing, entir video need played. undergon visual activ know incred tediou task. 3 semiautomat video process method measur lane-chang activ semiautomat video process method measur freewai lane-chang activ propos paper. methodolog base idea epoch, describ patir (2010). basically, method reduc three- dimension video (, , ), (, ) screen coor- dinat () time, two-dimension subset (, ) call epoch, (,) parametr curv describ scanline. words, epoch standstil imag construct accumul pixel contain scanlin video frame time (see figur 1). however, propos method scanlin longer straight line perpendicular traffic stream, patir (2010), line follow lane divis (see figur 2a). new definit scanline, vehicl cross line (i.e., lane change) appear epoch stain pavement background (see figur 2b,c). despit affect perspect distortion, vehicl keep mov- ing forward lane-chang maneuver, shape vehicl identifi epoch. then, need identifi lane chang epoch. provid count lane changes, precis locat time. method propos paper identifi lane chang epoch: 1. epoch: simpli visual inspect epoch. 2. gui: visual epoch help graphic user interfac (gui). 3. automatic: automat imag recognition. follow section main difficulti applic method deal them. 3.1 construct epoch step order construct epoch (i.e., space time image) video record obtain string pixel compos scanline. recal scanlin defin (,) parametr curv approxim follow lane division, (, ) repres coordin axi video frame. consid axes, video frame seen matrix pixels, dimens video resolution, pixel identifi sala et al. 5 (a) (b) (c) f g u r e 2 new scanlin definit epoch construction. (a) video screenshot new scanline; (b) epoch; (c) epoch (b) perspect correct note. (,) refer arc-length parametr curv (,), defin scanline; (,) refer concept perspect correct applied; appendix details. f g u r e 3 exampl scanlin pixel select method (, ) coordin center. thus, methodolog nec- essari determin pixel cross scanline. method consist of, first, divid scanlin piec accord domin dimension, . split portion scanlin > , wai around. process par- ticularli easi scanlin defin piecewis linear function (a figur 3). coordin domin direct extrem portion defin number pixel assign it. then, need determin orthogon compon pixels. achiev comput intersect scanlin coordin pixel domin direction. intersect fall pixel, select scanline. clarifi concepts, figur 3 show simpl exam- ple. imagin video resolut 10 8 pixels, piecewis scanlin defin follow points: [(1,8); (5,3); (10,1)]. scanlin divid por- tion (i.e., piecewis segments). segment [(1,8); (5,3)], dominant, pixel = 8 = 3, includ them, select (i.e., pixels). then, coor- dinat pixel determin intersect scanlin coordin (i.e., red figur 3). process repeat segment [(5,3); (10,1)], where, case, dominant. 3.2 perspect distort new definit scanlin impli perspect distort problems. record traffic stream finit height affect perspect deformation. part road closer record point appear larger apart. perspect deform affect epoch, long locat scanlin exhibit distanc record point. field view (fov) optic properti defin angl vision camera recording. larg fov low height record point impli larger perspect defor- mation avoided. appendix provid ana- lytic deriv perspect deform effect guidelin setup camera minim them. also, methodolog correct perspect deform 6 sala et al. describ appendix a. correction, pix- el epoch repres fix real-world distance. second, distort appear limit camera intern optics. edg fov appear larger realiti optic distortion. numer- ical assess distort effects, assum simplifi pinhol optics, present appendix a. result small fovs, on recommend application, deform distort small neglected. 3.3 occlus shadow addit problem propos method lane chang appear element differenti pave- ment epochs. vehicl travel adjac lane shadow occlud scanline, lane-chang maneuv take place. occlus scanlin happen vehicl start chang lane abort maneuv reason finishing. time see epoch diffi- cult distinguish lane chang occlusions, shadows, abort maneuvers, practic analyst get familiar method eventu learn distinguish easili cases. occlus shadow differenti lane-chang maneuv epoch appear long shape cover signific scanline. shape posit occlus vari depend camera frame scanlin defini- tion, show vehicl vehicular shape identified. contrast, lane chang appear clear vehicular shapes, cross scanlin limit spacetim region epoch. pos- sibl distinguish headlight windshield practice. dark, long, line figur 2b,c illustr shadow effect, larg patch white figur 4b correspond vehicular occlusion. figur 4 illustr problem occlusions, clarifi method obtain lane chang space time images. figur 4a show frame video sequenc 12 s. lane chang take place = 8 = 12 (i.e., black car). seen video frames. cross scanlin reflect epoch (figur 4b). also, larg white van start occlud scan- line = 2 = 8. again, observ epoch track video frames. abort lane-chang maneuv identifi epochs. figur 5 show epoch light truck start lane chang immedi return origi- nal lane. detect epoch look trajec- tori edg vehicular shape (line highlight figur 5). depend direct lane change. instance, lane chang shoulder middl time = 2 time = 4 time = 6 time = 8 time = 10 time = 12 (a) 0 lane changeocclus time (b) 2 4 6 8 10 12 f g u r e 4 occlus scanline. (a) sampl video frame 2 s. scanlin plot solid black line. (b) correspond epoch note. (,) refer arc-length parametr curv (,), defin scanline; time second start epoch. lane differ edg direct opposit maneu- ver. epoch figur 5 seen tra- jectori edg truck shape differ direct (in red), actual lane chang tra- jectori vehicular shape edg need parallel (in green). sala et al. 7 f g u r e 5 exampl abort lane-chang maneuv note. trajectori edg vehicular shape mark green actual lane chang (i.e., parallel trajectories) red abort maneuv (i.e., differ direct edg trajectories). 3.4 camera set high-qual record analyz applic method differ camera condit (see section 4), conclud camera set critic achiev good perform method. camera focus order obtain best possibl sharpness. furthermore, width scanlin pixel, camera resolut directli affect identif lane chang epoch. higher video resolution, clearer epoch. minimum recommend video resolut 480 360 pixels, lower resolut (e.g., 320 240) used. frame rate second (fps) defin resolut epoch time axis. rate 24 fp higher recommended, possibl start count lane chang 10 fps. camera frame crucial, especi low-resolut camera settings. entir imag need focus freewai pavement, lane-chang take place. pavement pixel useful. open framings, includ sky, example, add nothing, seen wast scarc resourc (i.e., pixel video). visi- ble freewai length longer length taken typic lane-chang maneuver. approxi- mate value, 50 m freewai captured. longer length encourag order eas differenti occlus lane changes. addition, order min- imiz occlusions, scanlin appear camera frame vertic possible. mean straight free- wai segment align camera posit preferred. finally, strongli recommend us highest pos- sibl record point small . that, given fix record height, larger cover road distance, impli larger distort perspect deformation. so, recommend try cover maximum freewai length furthest point possible, order small (see appendix a). given previou recommendations, record fix pole close freeway, correct video frame usual compris stretch start 100 m awai camera posit end 600 m away. technic aspect consid cam- era configur framing. environment factor impact. clear daylight condit necessary. method appli night recordings, vehicl headlight usual dazzl camera. similar effect happen dawn dusk, recommend point camera sun. bad weather, fog rain, lead low-qual video record imag blurri vehicl identified. 3.5 gqi record given previou recommendations, us determine, beforehand, adequaci camera frame video qualiti applic propos method. automat method detect defici video qualiti exist, like propos tsai huang (2010) base machin learn algorithm. however, generalist meth- od lack abil assess specif frame requir epoch-bas methodolog propos here. therefore, order object assess previou recommend imag resolut framing, quantifi qualiti record specif application, ad hoc indic defined. propos index evalu dif- ferent qualiti factor (see tabl 1); qualiti imag (i.e., brightness, clipping, contrast) qualiti frame (i.e., scanlin alignment, coverage, number uniqu pixels). indic return gqi term percentage, 100% maximum possibl qualiti recording. detail methodolog comput indic present appendix b. example, figur 6 show frame seven dif- ferent cameras, monitor lane-changing. them, high-definit (hd) camera show best imag qualiti frame (gqi = 88%). follow cam- era 2305 (52.9%), 2306 (42.7%), 2310 (36.9%), 2304 (19.2%). camera 2309 (0.0%) 2312 (0.0%) ful- minimum requir appli methodolog reliability. import stress fact that, better qualiti recording, shorter visual intervent method. bad configur invalid method, camera 2309 2312. so, camera con- figur test minut assess result epoch. 3.6 gui facilit enhanc visual identif count lane chang epoch gui 8 sala et al. t b l e 1 qualiti factor address propos global qualiti index (gqi) record indic factor address descript video imag 1 bright penal extrem dark videos. 2 clip highlight penal overexposur (i.e., intens certain area fall max. intens represented). 3 contrast penal poor contrast (i.e., poor differ lumin make object indistinguishable). frame 4 scanlin align penal scanlin deviat vertic direct video frame. 5 scanlin coverag penal short scanlines. 6 scanlin resolut penal scanlin pixels. global qualiti index harmon averag normal version previou partial components. camera 2304 camera 2305 camera 2306 hd camera 2309 camera 2310 camera 2312 f g u r e 6 frame scanlin seven differ camera locat note. camera hd show excel frame qualiti (gqi = 88.8%); camera 2304 (19.2%), 2305 (52.9%), 2306 (42.7%), 2310 (36.9%) accept frame quality; camera 2309 (0.0%) 2312 (0.0%) poor contrast sever frame problems. present low later view angl impli higher rate occlusions. code (see figur 7; avail download includ code gener epochs, gui, manual). gui, count lane chang look epoch (bottom window) click lane-chang candidate. then, video (top window) automat set correspond frame. decid maneuv correspond lane change, gui allow plai video instant final decision. us gui, method reliabl epoch. identifi lane chang appear tabl rightmost window. 4 applic b-23 freewai access barcelona methodolog develop paper appli count lane chang particular locat b-23 freewai access barcelona, context dynam speed limit experiment. heavili free- wai daili recurr congest episod peak hours. soriguera sala (2014) complet descript experiment. lane-chang activ extract 63 hr standard camera recordings, obtain differ dai sala et al. 9 f g u r e 7 graphic user interfac note. epoch lane chang mark blue cross. morn rush, order assess effect lane- chang traffic dynamics. context, autom cost-effective, take account report lack precis automat imag tech- niques. raw visual procedur cumbersome, present semiautomat video process select alternative. nevertheless, autom base imag preprocess machin learn implement order test reliabl compar propos method. detail implement appendix c. addition, assess potenti pro- pose semiautomat methodology, 2 hr hd recording, favor condit found, includ analysis. frame camera scanlin creat epoch pair lane shown figur 6. includ origin locat plu hd record- ing. qualiti regular record defin res- olut 536 400 pixel frame rate 29.97 fps. hd record 1080 1920 pixel 50 fps. note hd camera set vertic posit pixel scanline. 4.1 descript differ method differ method count lane changes. them, lane chang count 50% happen scanline. mean lane chang count vehicl start maneuv begin scanline, finish end. method, name ground truth care count obtain plai video scanlin regular speed paus slow necessary. count refin search video nonidentifi lane chang appear methods. detail accur counting, unfeas regular practice, includ order set ground truth value. second method used, watch video typic standard visual methodology. consist watch- ing video scanlin doubl speed. method epoch count, obtain simpli visual inspect epoch help video. fourth method gui count obtain epoch help user interfac describ sec- tion 3.6. method automat count result fulli automat procedur describ appendix c. method automat detect lane chang epoch, given previou learn period. train imag process algorithm sampl count gui measurement. aim replic regular practice, ground truth valu available. 4.2 perform differ count method context inform retriev binari classifica- tion like lane-chang count, error aris lane chang miss method (i.e., fals negative, ) identifi lane chang actual happen real- iti (i.e., fals positive, ). scenario, perform assess term precision, , defin fraction relev identif (i.e., true positives, ) retriev identif recall, , fraction rele- vant identif () identifi total exist lane changes. 1 score integr perform indicator, comput harmon averag precis recall. reach best valu 1 (perfect pre- cision recall) worst 0. is: = posit identif = + , (1) = posit = + , (2) 1 = 2 + . (3) tabl 2 show obtain results. thing realiz watch video (i.e., doubl speed, pair lanes) yield perfect measur think. accuraci measur term 1 rang 0.86 0.98 clear evid sourc variation. unexplain varianc surpris visual intens task, analyst' level attent like fluctuat process time. case epoch, process time drasti- calli reduced. 10% video durat need count lane-chang pair adjac 10 sala et al. t b l e 2 lane-chang count differ method rel error watch videob epochc guid automatic camera time (min) gta count f f savingsg f savingsg f camera gqih hd 31 133 0.94 0.95 0.95 0.90 0.96 0.93 89% 0.98 0.97 0.97 71% 0.83 0.68 0.75 88.8% 2305fi 30 257 0.98 0.85 0.91 0.99 0.79 0.88 87% 1.00 0.98 0.99 56% 0.85 0.75 0.80 52.9% 2305ci 30 437 0.99 0.92 0.95 0.98 0.84 0.91 78% 0.98 0.95 0.97 46% 0.85 0.71 0.77 52.9% 2306 60 241 1.00 0.85 0.91 0.89 0.67 0.76 88% 0.98 0.95 0.96 75% 0.70 0.71 0.70 42.7% 2310 30 187 0.85 0.86 0.86 0.95 0.47 0.62 88% 0.98 0.99 0.99 58% 0.87 0.46 0.60 36.9% 2304 60 165 0.89 0.88 0.88 0.78 0.47 0.58 87% 0.99 0.85 0.91 74% 0.78 0.34 0.48 19.2% 2309 15 88 1.00 0.95 0.98 0.78 0.20 0.32 84% 1.00 0.80 0.89 11% 0.0% 2312 15 91 0.96 0.80 0.87 0.67 0.31 0.42 83% 1.00 0.51 0.67 33% 0.0% agt stand ground truth. bwatch video count watch video doubl speed. cepoch visual count look epoch. dgui graphic user interface. eautomat propos automat imag recognit technique. fsee section 4.2 definit perform indicators: precis , recal , 1 score. gsave refer time save human visual intervent respect watch video (i.e., doubl speed). automatic, save 100%. hgqi stand global qualiti index camera. ifor camera 2305 consecut 30 min interv tested. (i.e., 2305f) free flowing, second (i.e., 2305c) congest strong stop&go waves. lanes. main reason reduct visual time spent activ happen (i.e., spot epoch), avoid wast time energi time window lane-chang activity. analyst activ method, like hold attent video processing. spite this, accuraci achiev method wors watch video, order magnitud (i.e., 1 > 0.8) camera high qualiti recordings. low accuraci mainli difficulti differentiat- ing lane chang small occlus shadows, especi edg epoch. case lead underestim lane-chang activ (i.e., increas fals neg rate, impli especi lower recal values). gui allow better interpret epoch, bring clear benefit term accuracy. camera gui outperform watch video method term accuracy, invest half visual process time. lane chang happen differ locat time, gener detect watch video.1 contrast, gui clearli identified, lead significantli better count lot activ happens. conclusion, gui accur fast method record fulfil minimum qualiti (i.e., gqi > 20%). oth- erwise, qualiti record extrem poor, gui help, reduc visual process time, achiev higher accuraci respect watch- ing video. camera 2309 2312 exampl undesir situation. f g u r e 8 evolut error automat method differ train sampl size fulli automat procedure, lower accu- raci price pai order avoid complet visual intervention. implement machin learn algorithm improv perform human analyst identif lane chang epoch, obtain accuraci gener worse, valu 1 = 0.80, best. addition, accuraci result rapidli deterior reduct qualiti recording, that, qualiti record good (i.e., gqi > 40%), result consid reliabl (i.e., 0.5). effect length train sampl accuraci method analyz (see figur 8). result longer train sampl slightli improv accuraci default accuraci automat method bad, insuffici qualiti recording. contrast, default accuraci higher levels, extend train sampl con- tribut improvements. conclusion, qualiti sala et al. 11 f g u r e 9 evolut error qualiti record note. tendenc line obtain squar regress data. f g u r e 1 0 detail video qualiti indic result 1 accuraci metric note. 1 2 displai 100% cameras. gqi stand global qualiti index. record good, minimum train sampl (e.g., 50 lane changes) suffices. result tabl 2 accuraci meth- od significantli affect differ traffic regim (i.e., free-flow congested). seen com- pare result camera 2305f 2305c. given previou results, interest compar differ sensit analyz method respect qualiti recordings. hand, watch video result accuraci level 1 0.9 average, insensit qualiti recording. hand, accuraci methods, base epoch, strongli depend gqi. meth- ods, accuraci increas qualiti recordings. figur 9 illustr facts, support select video process technique, given gqi record requir accuraci results. provid figur 10, show effect individu factor (i.e., ; = 1 6; tabl 1 appendix b) gqi eventu accuraci level, 1. figur 10 conclud poor perform particular qualiti indic can- compens better result indicators. instance, poor imag qualiti (i.e., bright 1, clip 2, contrast 3) compens better imag frame (scanlin align 4, length 5, resolut 6) vice versa. so, individu qualiti factor need f g u r e 1 1 obliqu cumul count (n), occup (t), lane-chang (l) curv note. lane-chang data camera 2306; flow occup data measur loop detector freewai segment; subtract background flow 95% average. cassidi windov (1995) detail descript obliqu cumul count method. consid set video camera experi- ment. evid support multipl structur gqi (see appendix b) lead recommend camera set provid section 3.4. 4.3 find measur lane-chang data illustr applic lane-chang data obtain propos semiautomat methodolog (gui method), result preliminari traffic analysi present here. instance, data extract video record allow empir prove lane-chang rate peak traffic state transit (i.e., free flow- ing congestion, vice versa). seen figur 11, obliqu cumula- tive count (n-curve), cumul occup (t-curve), cumul lane-chang (l-curve) respect time plotted. curves, transit free flow congest identifi increas occup (slope t-curve) simultan decreas flow (slope n-curve). happen slightli 8:30 figur 11. turn, recoveri free-flow condi- tion identifi occup drop (i.e., 9:00 figur 11). seen situations, lane- chang rate peak (slope l-curve). furthermore, perspect correct method develop paper allow locat lane chang real posi- tion freeway. figur 12 illustr spatial distribu- tion lane-chang data, show solid line, central shoulder lanes, reduc lane-chang rates. also, end solid line, void left vehicl exit off-ramp produc increas lane-chang rate area. 12 sala et al. f g u r e 1 2 locat lane chang note. data camera 2305; traffic goe left right; solid line pavement ban lane-chang middl shoulder lane off-ramp location. lane-chang complex driver decis pro- cess research need model phenomenon, simpl analysi aim inter- est research direct support data obtain propos methodology. addition, applic propos method allow microscop applications. instance, perspect correct method determin durat time space lane-chang maneuver, analyz shape stain epoch. open new research directions. 5 conclus hand, visual extract traffic data video record requir multipl visualizations. task time consum extrem tedious. hand, rel- ativ short applic like on research context, automat method overcomplicated, costly, provid requir accuracy. semiautomat method opportunity. simpl video pro- cess tools, aim eas speed visual pro- cess avoid complex inaccuraci complet automation. propos semiautomat method base trans- format video recordings, obtain fix cam- era, adequ standstil image, call epoch, visual identifi lane changes. method, implement user-friendli gui, speed complet visual procedur concentr human intervent time window activ- iti happens. sake comparison accuraci results, visual identif lane chang epoch autom machin learn- ing algorithm, achiev fulli autom tool case. propos semiautomat method appli 63 hr record seven camera spanish freeway. camera meet minimum record qualiti order appli method reliability. left 45 hr process. typic visual procedure, extract lane-chang data video taken 50 hr labor, video need watch pair lane maximum doubl speed (note section lane analyzed). contrast, took 7 hr gui, result 43 hr labor save (i.e., 86% visual process time saved). addition, achiev increas accuraci lane-chang count provid precis time locat lane changes, common visual methods. accuraci method (in term 1 score), complet visual procedur lead accu- raci level 0.86 0.98 differ cameras, gui semiautomat method accuraci 0.95, provid record meet minimum qual- iti standard (i.e., minimum 35% develop gqi 100% optim recording). also, record poor qualiti (e.g., gqi= 20%), accuraci drop 0.90, result achiev visual proce- dure (i.e., 0.88 qualiti recording). spite this, recommend video qualiti frame crucial order successfulli us method. bet- ter video quality, easier, faster, reliabl counting. note extrem poor qual- iti record (i.e., gqi = 0%) invalid reliabl us semiautomat method, leav visual procedur alternative. fulli autom implement method, conclus obtained. first, accuraci result deteriorates, expected, 1 valu 0.80 best cases. second, accuraci result depend strongli qualiti recordings, that, record gqi < 40%, reliabl count can- obtained. therefore, automat method appli qualiti record high low precis data suffices. finally, both, semiautomat fulli automat methods, perform equal (or equal bad) free-flow congest traffic regimes. remain research applic method stabl aerial footage, benefit reduc perspect issu occlusions. also, method adapt record taken probe vehicle, explod benefit move observ relat lane-chang behavior properti traffic flow. acknowledg author acknowledg collabor servei catal trnsit, catalan traffic administr provis sala et al. 13 requir video recordings. work adri torr count lane chang feedback grate- fulli acknowledged. research partial fund spanish ministri economi competit (tra2016-79019-r/coop). e n d n o t e 1 differ analyst suffer problem, agre intrins watch video method. r e f e r e n c e s adeli, h., & karim, a. (2005). wavelet intellig transport sys- tems. new york, ny: john wilei sons. alireza, a., karami-mollaie, m., & baleghi y. (2012). object track- ing adapt object color modelling. proceed 4th con- ferenc inform knowledg technology, babol, iran, 848852. angel, a., hickman, m., mirchandani, p., & chandnani, d. (2003). method analyz traffic imageri collect aerial platforms. ieee transact intellig transport systems, 4(2), 99 107. avery, r., wang, y., & zhang, g. (2007). video-bas vehicl detec- tion classif real-tim traffic data collect uncalibr video cameras. transport research record, 1993(1), 138147. bhaskar, p. k., & yong, s. p. (2014). imag process base vehicl detect track method. ieee 2014 intern confer inform scienc (iccoins), kuala lumpur, malaysia, 15. buisson, c., villegas, d., & rivoirard, p. (2016). polar coordi- nate filter trajectori data ad extra physic con- straints. proceed 95th annual meet transporta- tion research board, washington, dc. campbell, r. (2012). analysi framework evalu traffic complianc measur (phd thesis). univers california, berke- ley, ca. campbell, r., & skabardonis, a. (2013). analysi framework evalua- tion traffic complianc measures. transport research record, 2364, 7179. canny, j. (1986). comput approach edg detection. ieee transact pattern analysi machin intelligence, 8(6), 679698. cassidy, m. j., jang, k., & daganzo, c. f. (2010). smooth effect carpool lane freewai bottlenecks. transport research a, 44(2), 6575. cassidy, m. j., & windover, j. (1995). methodolog assess dynam freewai traffic flow. transport research record, 1484, 7379. cheung, s. c. s., & kamath, c. (2005). robust background subtract foreground valid urban traffic video. eurasip journal appli signal processing, 2005(14), 23302340. coifman, b., beymer, d., mclauchlan, p., & malik, j. (1998). real-tim vision vehicl track traffic surveillance. transport research c, 6(4), 271 288. coifman, b., & li, l. (2017). critic evalu genera- tion simul (ngsim) vehicl trajectori dataset. transport research b, 105, 362377. coifman, b., mishalani, r., wang, c., & krishnamurthy, s. (2006). impact lane-chang maneuv congest freewai segment delays: pilot study. transport research record, 1965, 152 159. duret, a., ahn, s., & buisson, c. (2011). pass rate measur relax- ation impact lane-chang congestion. computer-aid civil infrastructur engineering, 26(4), 285297. feder highwai administration. (2006). interst 80 freewai dataset factsheet. operations/06137/ feder highwai administration. (2015). gener simu- lation (ngsim). retriev analysistools/ngsim.htm ghosh-dastidar, s., & adeli, h. (2003). wavelet-clust -neural net- work model freewai incid detection. computer-aid civil infrastructur engineering, 18(5), 325338. karim, a., & adeli, h. (2003). fast automat incid detect urban rural freewai wavelet energi algorithm. journal transport engineering, asce, 129(1), 5768. knoppers, p., van lint, h., & hoogendoorn, s. (2012). automat sta- biliz aerial traffic images. proceed transport research board 91st annual meeting, washington, dc. kumar, p., ranganath, s., weimin, h., & sengupta, k. (2005). framework real-tim behavior interpret traffic video. ieee transact intellig transport systems, 6(1), 43 53. laval, j., cassidy, m. j., & daganzo, c. f. (2007). impact lane chang merg bottlenecks: theori strategi maxim capacity. traffic granular flow' 05 (pp. 577589). berlin, hei- delberg, germany: springer. mak, c. l., & fan, h. s. (2006). single-st algorithm video- base data detect expresswai incidents. computer-aid civil infrastructur engineering, 21(2), 120135. malinovskiy, y., zheng, j., & wang, y. (2009). model-fre video detec- tion track pedestrian bicyclists. computer-aid civil infrastructur engineering, 24(3), 157168. masoud, o., & papanikolopoulos, n. p. (2001). novel method track- ing count pedestrian real-tim singl camera. ieee transact vehicular technology, 50(5), 12671278. matas, j., chum, o., urban, m., & pajdla, t. (2002). robust wide base- line stereo maxim stabl extrem regions. 13th british machin vision confer univers cardiff, 2.5 septemb 2002, david marshal & paul l. rosin (editors), 384396. menendez, m., & daganzo, c. f. (2007). effect hov lane freewai bottlenecks. transport research b, 41(8), 809 822. montanino, m., & punzo, v. (2013a). make ngsim data usabl studi traffic flow theory: multistep method vehicl tra- jectori reconstruction. transport research record, 2390, 99 111. 14 sala et al. montanino, m., & punzo, v. (2013b). reconstruct ngsim data. retriev www.multitude-project.eu/exchange/101.html montanino, m., & punzo, v. (2015). trajectori data reconstruct simulation-bas valid macroscop traffic patterns. transport research b, 80, 82106. morris, b., & trivedi, m. (2006a). robust classif track vehicl traffic video streams. ieee intellig transport system conference, toronto, on, canada, 10781083. morris, b., & trivedi, m. (2006b). improv vehicl classif long traffic video cooper tracker classifi modules. pro- ceed ieee intern confer video signal base surveillance, sydney, australia. nguyen, h. t., & smeulders, a. w. (2004). fast occlud object track robust appear filter. ieee transact pattern analysi machin intelligence, 26(8), 10991104. patire, a. (2010). observ lane chang pattern uphil expresswai (phd thesis). univers california, berkeley, ca. patire, a., & cassidy, m. j. (2011). lane chang pattern bane benefit: observ uphil expressway. transport research b, 45(4), 656666. punzo, v., borzacchiello, m., & ciuffo, b. (2011). assess vehicl trajectori data accuraci applic gener- ation simul (ngsim) program data. transport research c, 19(6), 12431262. qu, x., & wang, s. (2015). long-distance-commut (ldc) lane: new concept freewai traffic management. computer-aid civil infrastructur engineering, 30(10), 815823. shaoqing, m., zhengguang, l., jun, z., & chen, w. (2009). real-tim vehicl classif method multi-lan roads. 4th ieee confer- enc industri electron applications, xi'an, china, 960 964 soriguera, f., & sala, m. (2014). experi dynam speed limit freeways. procedia social behavior sciences, 160, 3544. stauffer, c., & grimson, w. e. l. (1999). adapt background mixtur model real-tim tracking. ieee societi confer vision pattern recognition, fort collins, co, 246 252. sun, d. j., & elefteriadou, l. (2012). lane-chang behavior urban streets: in-vehicl field experiment-bas study. computer- aid civil infrastructur engineering, 27(7), 525542. sun, d. j., & kondyli, a. (2010). model vehicl interact lane-chang behavior arteri streets. computer-aid civil infrastructur engineering, 25(8), 557571. tsai, y., & huang, y. (2010). automat detect defici video log imag histogram equiti index adapt gaussian mix- ture model. computer-aid civil infrastructur engineering, 25(7), 479493. uke, n., & thool, r. (2013). move vehicl detect measur- ing traffic count opencv. journal autom control engineering, 1(4), 349352. zheng, j., wang, y., nihan, n. l., & hallenbeck, m. e. (2006). detect cycl failur signal intersect video imag process- ing. computer-aid civil infrastructur engineering, 21(6), 425435. zheng, z., zhou, g., wang, y., liu, y., li, x., wang, x., & jiang, l. (2013). novel vehicl detect method high resolut high- wai aerial image. ieee journal select topic appli earth observ remot sensing, 6(6), 23382343. cite article: sala m, soriguera f, huillca k, vilaplana v. measur traffic lane-chang convert video spacetim images. comput aid civ inf. 2019;118. 10.1111/mice.12430 appendix video record suffer perspect deform dis- tortion. appendix present assess effect distort analyt method correct per- spectiv deformation. tabl a1 summar variabl paramet involved. figur a1 a2 provid graph- ical definition. a1 effect distort flat sensor figur a2 illustr effect distortion, consid camera distanc flat sensor f g u r e 1 graphic definit paramet f g u r e 2 distort effect flat sensor sala et al. 15 focal point. theoret ideal curv sensor, rai width encompass number pixel values. contrast, real flat sensor, number pixel encompass depend , maximum = 2 minimum = 0. effect known imag distortion. figur a2 seen 1 = tan(), 2 = . then, increas 1 2 increas , express deriva- tive 1 = 1 2 = 2 , comput equat (a1) (a2). equat (a2) show ideal sensor magnitud constant depend . 1 = (1 + tan 2 ()) (a1) 2 = (a2) distortion, , express rel differ 1 2 (i.e., differenti error), depend , express equat (a3). averag error given comput integr equat (a3) rang : () = 1 2 2 = tan2 () . (a3) figur a3 show averag maximum distort f g u r e 3 maximum averag distort valu differ s flat sensor note. valu limit 4 wider s littl sens application. function differ s. small s rec- ommend application, effect distort small neglected. case studi present section 4, maximum 0.27 rad, result aver- ag maximum distort 0.08% 1.87% pixel size, respectively. a2 perspective-correct scanlin perspect deform happen increas (i.e., distant view), larger stretch freewai seen constant . order develop simpl correct method t b l e 1 definit variabl paramet perspect correct method var. unit descript (rad) angl rai vision orthogon road. (m) straight distanc base camera point rai vision reach road. (rad) angl bisector field view ( ) rai vision. = (1 + 2)2 (rad) differenti . par. unit value* descript (rad) 0.106 field view (total angl vision camera framing). 1 2 (rad) 1.431 1.537 angl lower (1) upper (2) rai vision orthogon road; 1 2; 2 1 = . (m) 8 camera height base. (m) 179 length scanlin road. (m) 178.2 length scanlin project camera plane. . 1 2 (m) (m) 57 235 straight distanc base camera nearest (1) furthest (2) point reach road. 1 2; 2 1 = (rad) 4.01102 slope road respect horizontal. (rad/pixel) 5.54105 angular valu pixel origin scanline. (m/s) 22.22 traffic free-flow speed. (fps) 50 video frame second. (pixels/frame) 1 perspect correct factor. (pixels) 1226 number vertic pixel origin epoch. (pixels) 403 number vertic pixel perspect correct epoch. *valu stand particular applic hd camera (see figur 2). 16 sala et al. perspect deformation, assumpt made: (i) camera distort (i.e., ideal curv sensor), (ii) constant grade road, . assumpt approxi- mate hold present application, distort neglect small s, road grade smooth rel small distanc scanline. equat (a4) deriv geometri figur a1, allow comput , distanc base camera point seen angl . turn, equat (a5) comput rate chang distanc incre- mental chang : () = tan () , (a4) () = ( () ) = ( 1 + tan2 () ) , (a5) = cos() = sin(). distort effect neglected, assum pixel scanlin repres constant . so, linear interpolation, possibl construct vec- tor identifi s pixel origin scan- line, 1 , number pixel origin scanline. note assumptions, = (2 1). then, equat (a5), distanc corre- spond pixel origin scanlin comput = , correct factor account total distanc scanlin project plane smaller real one. is: 1 . (a6) inequ equat (a6) turn equal case straight scanlin parallel camera align ( ). case < . so, correct factor, , defin equat (a7), need appli order obtain real-world distanc repres pixel: = . (a7) recal object perspect correct pixel correct scanlin cover real-world distance. distanc express , number pixel correct scanline. arbitrarili select integer, order obtain epoch lane chang clearli identifi vehicle-shap stain pavement background, recommend number frame taken vehicl travel scanlin length free-flow speed. is: = fps, (a8) 1 user-defin perspect correct parame- ter. larger , higher epoch, deform vehicular shape epoch. given real-world distanc encompass pixel origin scanlin , function = 1 , constant real-world distanc cover pixel correct version scanline, , perspect correct algorithm work follows: < , densiti pixel unit length origin scanlin high pixel need skip correct epoch. > , densiti pixel unit length origin scanlin low pixel need repli- cated. situation, happen furthest scanlin (especi large) undesir impli lack inform result blurri part epoch. recommend small s, worst pixel origin scanlin largest need replic times. algorithm figur a4 summar method. appendix b ad hoc record global qualiti index (gqi) devel- op appendix b. index includ differ qualiti parameters: video qualiti (i.e., brightness, clipping, contrast) devot epoch frame (i.e., scanlin alignment, coverage, number uniqu pixels). f g u r e 4 algorithm pixel select perspect correct scanlin note. repres distanc pixel correct scanlin cover iteration. sala et al. 17 b1 video imag qualiti index propos qualiti index record base lumin histogram, repres frequenc given lumin valu image. normal cumu- lativ lumin curve, , defin cumul sum histogram divid total value, express equat b1: () = = =1 = =1 , (b1) () frequenc given lumin bin ; [1, ], order darker brighter levels, num- ber differ lumin valu image. note typic 8 bit imag video includ total 256 possibl differ valu (i.e., = 256). note monotoni- calli increas function () [0, 1]. tabl b1 summar formula obtain 1, 2, 3, imag qualiti indexes. bright address 1 comput sum half cumu- lativ lumin curve. darker images, 1 higher. 2 assess highlight clip imag look overexpos areas. 2 smaller larger overex- pose area imag (i.e., higher percentag lumin brightest 16 bins). finally, 3 assess contrast imag comput number bin encompass 80% cumul luminance. larger lumin range, better imag contrast. 1, 2, 3 relat imag quality, video success images, qualiti indic need appli sampl frames. frame minut video considered. qualiti indic comput averag valu obtain sample. t b l e b 1 video qualiti index lower upper bound thresholds: _, _ indic definit _ _ 1 2 = 1 1 () 4 3 2 ( 16) 0.8 0.9 3 = min()() 0, 1 = min()() 0, 9 4 2 4 = 1 () 1 1 30 5 5 2 s 10 s 6 25 250 note. real length scanline; free-flow speed traffic; perspect correct factor. b2 video frame qualiti index tabl b1, 4, 5, 6, qualiti index devot qualiti video framing. align scanlin address 4, comput averag angle, , scanlin plane (i.e., vertic video frame). lower , better alignment. scanlin defin piecewis linear, easili comput weight averag angle, , exhibit part scanline, weight respect length pixels, . addition, correct factor, , includ 4. general, = 1, camera locat freewai median. case, = 1.25 misalign penalizing. light vehicl median lane like occlud scanlines. free-flow travel time requir travel scanlin length denot 5. longer time, better framing, rel effect boundari reduc lane chang counted. finally, 6 take account number uniqu pixel compos perspective-correct scanline. recal that, correct scanline, furthest zone epoch pixel repeated. happen record high and/or small resolution. epoch correct uniqu pixel good indic frame quality, take account scanlin free-flow travel time, number frame second, video resolution, perspect deformation. b3 gqi obtain harmon averag nor- maliz versions, , previou partial compo- nents. (0, 1); = 1 6. order normal- iz partial qualiti indexes, upper lower bound threshold defin (i.e., _; _) linear interpo- lation (see equat (b2)). finally, gqi comput weight harmon aver- ag repres equat (b3). frame qualiti stronger impact imag qualiti global qualiti record specif lane-chang monitor application: = max ( 0,min ( 1, _ _ _ )) ; = 1 6, (b2) gqi = 4 3 1 2 3 4 5 6. (b3) tabl b2 show result applic video qualiti index seven camera present paper (see figur 6). 18 sala et al. t b l e b 2 video qualiti index appli camera pilot test camera hd 73.6% 90.4% 76.3% 100.0% 88.8% 2305 43.9% 28.4% 100.0% 36.2% 52.9% 2306 17.1% 33.3% 45.3% 39.6% 42.7% 2310 62.6% 58.0% 25.6% 14.5% 36.9% 2304 69.8% 42.8% 16.6% 2.1% 19.2% 2309 5.4% 0.0% 11.0% 1.6% 0.0% 2312 0.5% 0.0% 61.3% 34.6% 0.0% note. 1 2 displai 100% cameras. appendix c appendix c describ fulli automat method imple- ment detect lane chang epochs. lane chang appear epoch region shapes, col- ors, geometr characterist differ pavement background. automat method analyz imag distinct area differ background, character region term visual descriptors, decid correspond lane chang binari classifier. c1 imag preprocess candid extract epoch (i.e., color image; figur c1a) convert grayscal imag size ( height, width) unit pixels. next, estim background obtain comput column vector size 1, element median pixel valu correspond row : () = ((, )). imag background (i.e., pavement) elimin subtract vector median valu imag column (, ) = (, ) (), , (see figur c1b). morpholog close filter connect small region correspond compon imag disconnect remov background follow step candid extract process, segment techniqu call maxim stabl extrem region (matas, chum, urban, & pajdla, 2002). object detect imag region correspond lane changes. algorithm find homogen compon high contrast respect surround area. finally, post-process morpholog filter appli holes, remov leakages, filter small regions. figur c1c show result process, white area correspond candid regions. figur c1d present region fill origin imag valu (pixel-wis product epoch c1a binari mask c1c). (a) origin epoch (b) background subtract (c) candid region mask (d)final candid region (e) classif result. true posit true neg region depict red magenta dots, respectively, green dot correspond ground truth lane chang f g u r e c 1 automat epoch process lane-chang detec- tion. (a) origin epoch, (b) background subtract , (c) candid region mask, (d) final candid regions, (e) classif result. c2 classif preprocess stage, set candid region obtained. binari classifi discrimin posit (i.e., lane change) neg (i.e., occlu- sion, shade, artifacts) regions. classif support vector machin (svm) model. classifi hyperparamet (width gaussian kernel regular parameter) select cross-validation, minim 1 measure. featur classifi are: area region, region orienta- tion, mean valu color compon region (use ycbcr color space), histogram color component, horizont vertic project region mask, lower upper limit region bound box. set featur experi (i.e., cameras). classifi train camera. data train svm obtain appli preprocess region extract procedur epoch comput por- tion video annot gui label region posit negative. import note classifi train real ground truth label noisi label provid gui, case real practice. issu neg impact accu- raci metric report fulli automat method. follow- ing example, figur c1e present classif results.