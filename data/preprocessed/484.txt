shock captur techniqu hp-adapt finit element alba hierroa,b, santiago badiaa,b, pavel kusc auniversitat politecnica catalunya, jordi girona 1-3, edifici c1, 08034 barcelona, spain. bcentr internacion metod numer lenginyeria (cimne), parc mediterrani la tecnologia, upc, estev terrada 5, 08860 castelldefels, spain cinstitut mathematics, academi scienc czech republ abstract aim work propos hp-adapt algorithm discontinu galerkin method capabl detect discontinu sharp layer avoid spuriou oscil solut them. order control spuriou oscil- lations, artifici viscos particular appli layer solut chang abruptly. so, novel troubled-cel detector develop order mark element layer impos linear order them. detector take advantag evolut valu gradient adapt process. keywords: hp-adaptivity, discontinu galerkin, shock capturing, troubled-cel detector, nonlinear stabilization, convection-diffusion, convection-domin flow 1. introduct work convection-domin convection-diffus problems, solut contain steep layer solut chang abruptly. pure hyperbol case, diffus zero, solut contain discontinuities. high resolut need discontinu sharp layers, suitabl consid h- adapt mesh lead uniform distribut error. better, hp-adapt finit element (fe) spaces, improv accuraci increas order approxim (p) smooth region reduc element size (h) near discontinu sharp layers. impli extra effort tackl differ wai (see sect. 4.1). order select fe need refined, posteriori error estim used. hp-adaptivity, need kind smooth indic order decid refin mesh element increas order approximation. work adapt mesh continu fe spaces, account adapt mesh preserv regular deal hang- ing node appear process. method avoid hang node adapt mesh expens increas aspect ratio (see, e.g., [34] 2d meshes); implement method gener 3d mesh complicated. hand, simpl local adapt inevit produc hang nodes. enforc continu (if required) impli extra implement work, especi deal preprint submit method appli mechan engin decemb 22, 2016 arbitrary-level hang node [29]. discontinu galerkin (dg) method read- ili us non-conform meshes, i.e., simpl local adapt procedures, involv degre freedom (dofs) continu galerkin on mesh. [2], badia baig propos continuous-discontinu formul allow us local adapt need enforc continu hang nodes. approach combin lower cost continu galerkin method capabl dg method deal non-conform meshes. work, restrict interior penalti dg method local adaptivity. numer approxim problem consid lead spuriou oscil sharp layer discontinuities, violat discret level monoton properti continu operators. numer techniqu avoid oscil denot shock captur techniques. us common notion shock captur paper deal layer (for discuss appropri [25]). monoton linear shock captur order accurate, celebr godunov theorem. order attain better accuracy, perturb depend solut considered. shock captur strategies. limit strategi typic appli explicit time integration; tent solut obtain explicit time- march scheme post-process limit clean oscillations. approach typic fulli explicit finit volum dg code hyperbol conser- vation law [12]. conceptu differ famili method base ad artifici diffus terms. purpos method perturb problem hand wai perturb solut (almost) oscil free. post-process need viscou term ad formulation, type techniqu suitabl implicit (or implicit-explicit) time integr continu fe spaces. artifici diffus term understood nonlinear sta- biliz methods. nonlinear stabil scheme propos literatur prove enjoi variant discret maximum principl (dmp) [3, 4, 8, 11]. schemes, nonlinear stabil activ sharp layer/discontinuity, resort linear stabil smooth regions. knowledge, shock captur method propos far enjoi dmp design work linear (or quadratic) fe [20]. case, us high-ord fe steep layer discontinu wise, smooth exploit region mesh finer width physic layer. hand, refin mesh need effici captur layers, make adapt mesh refin mandatory. base observations, motiv work combin nonlinear stabil scheme satisfi dmp (when appli linear fes) hp-adaptivity. object restrict nonlinear stabil sharp layers, fine mesh order element automat select hp-adapt algorithm. hand, far regions, solut smooth, algorithm increas order reduc element sizes. interest hp-adapt methods, necessari appli artifici viscos troubl cell (some exist method scale viscos wai take valu close 2 zero smooth region [17, 3]). nonlinear stabil smooth regions. troubled-cel indicators; compar [37]. us differ criteria identifi element contain sharp layer, discontinuity, shock. example, cockburn shu [12] compar gradient neighbor elements. extend higher order analysi coeffici associ differ order modal base [28]. local discontinu detector base decai coeffici [6]. troubled-cel detector design limit explicit simulations; solut computed, troubl cell detect properli modifi (most time accord paramet obtain detect troubl cells). herein, interest troubled-cel indic implicit scheme involv nonlinear stabil method (i.e., artifici viscosity). differ setting, vuik ryan success detect non-smooth region take account properti associ multiwavelet coeffici [39]. albeit h-adapt mesh [40], troubled-cel indic men- tion design fix mesh simpli recalcul troubled-cel indic iter instead take advantag solut history. paper aim develop novel troubled-cel indic hp-adapt scheme exploit adapt history. idea simple: discontinu (or steep layer width order smaller characterist length element), gradient greater h-refin elements, propos compar valu gradient parent children element adapt iter order decid element mark suspici neighborhood sharp layer. overal algorithm, linear order impos element troubled-cel flag activated. outlin paper following. sect. 2 introduc problem solv notat interior penalti dg method use. sect. 3 new artifici viscos method introduced; extens propos [4]. sect. 4 deal adapt strategy. next, sect. 5 introduc novel troubled-cel detector allow us artifici viscos present improv hp-adapt process. finally, sect. 6, numer experi report perform propos method. 2. interior penalti method convection-diffus equat follow introduc convection-diffus problem want solv interior penalti discontinu method us so. 2.1. convection-diffus problem consid convection-diffus problem dirichlet boundari conditions:{ lu := (u) + (u) = f , u = g (1) open, bounded, connect subset rd lipschitz boundari , d space dimens (it assum arbitrari sects. 3 5 analysi 3 restrict 2-dimension case), f l2(), g h 1 2 (). assum > 0 constant (h1() c0())d solenoid (i.e., = 0). denot inflow boundari defin = {x |(x) n(x) < 0} n outsid normal . known oper l associ problem (1) enjoi maximum principl (for proof maximum principl ellipt problem [19]). particular, mean interior oscil appear insid domain f = 0. known that, problem convection-dominant, solut sharp interior boundari layers. region discret solut exhibit spuriou oscillations, nonlinear stabil term aim regular problem. note nonlinear stabil scheme work appli pure hyperbol problem [4], i.e., = 0, consid case sect. 6 posteriori error estim sect. 4.1 appli circumstances. 2.2. notat consid total m m adapt iterations. adapt step m need consid partit tm = {ki} nelm i=1 n el m element characterist length hmki . consid quadrilater (hexahedr 3 dimensions) elements. us isotrop refinement, assum length edg element dimens order characterist length element. mesh tm correspond mesh adapt previou partit domain tm1. impli element ki tm equival certain kj tm1 correspond transform element set tm1. transform isotrop refin element (ki children element kj tm1) coarsen set element (ki parent set elements). isotrop refin divid element nc = 2 d ident sub-elements. coarsening, time, perform set nc element come previou refin element. order eas transfer data consecut meshes, establish relat indic element tm immedi previou mesh tm1. end defin function fm : {1, , n elm} {1, , n elm1} follow way: kfm(i) tm1 correspond equival element tm1, parent ki children come (we assum loss gener children element consecut listed). case coarsen element ki tm, correspond element tm1 kfm(i)+c c = 0, , nc 1. given p n, let pp() space polynomi order p domain . given {pjm} nelm j=1 arrai approxim order element tm, defin gm piece-wis polynomi function gm|ki polynomi order pim obtain l 2-project g|ki ppim(ki ) ki tm contain boundari facet. defin discret space consid henceforth discontinu space piece-wis polynomi function vm = {vm | vm|ki ppim(ki) ki tm}. vm vm, notat v ki m ppim(ki) vkim ( ppim1(ki) )d function correspond restrict vm gradient ki. denot v := ( v2 ) 1 2 l2() norm v| 4 function v l2(). similarly, v, := max x v(x) denot l() norm. defin measur |w| := 1. given mesh tm, intersect f = ki kj neighbor element ki, kj tm call interior facet tm set dimens d 1. set interior facet denot e0m. hand, non-empti intersect f = ki element ki tm boundari domain, call boundari facet. set facet denot em. denot em(ki) set face f em contain ki. facet f e0m denot k + f kf neighbor element k + f k f = f . addition, n+f n f unitari normal face f outsid k + f k f , respectively. facet boundari k+f n + f defined. given facet f , defin characterist face length hf = { min{hk+ f , hk f } f e0m hk+ f f . given vm vm, defin common concept averag {{}} jump [[]] interior point x facet f e0m follows: {{vm}}(x) = 1 2 (v k+ f m (x) + v k f m (x)), [[vm]](x) = v k+ f m (x)n + f + v k f m (x)n f . defin harmon averag q x vm(x) = 2v k+ f m (x)v k f m (x) v k+ f m (x) + v k f m (x) . boundari facet point x f , f , defin {{vm}}(x) = v k+ f m (x), [[vm]](x) = v k+ f m (x)n + f (x) q(x) = v k+ f m (x). 2.3. weak form interior penalti discontinu galerkin approxim adapt iter m, weight incomplet interior penalti discontinu galerkin (wipdg) method nonlinear artifici viscos stabil read um vm am(um, vm) = l(vm) vm vm, (2) am(um, vm) = kitm ki ((+ ki(um))umvm um vm) (3) fem f ([[um]]{{vm}}+ {{um}}[[vm]]) + fem f ciph1f + m(um)[[um]][[vm]] + fem\ f {{um}}[[vm]] + cbm fe0m f ||[[um]][[vm]] 5 l(vm) = kitm (fm, vm)k f f ngmvm (4) + f f gm{{vm}} n f f ciph1f + m(um)gmvm, fm (similarli gm) denot piece-wis polynomi approxim tm given l2-project f vm. paramet c ip constant scale diffus interior penalti term cbm constant stabil convect term explain [7]. valu comput specifi sect. 6. valu discuss remark 2. remark 1. function m(um) correspond nonlinear piece-wis artifici viscos introduc extra stabil method. artifici viscos activ valu reli differ paramet problem numer solut um. restrict element ki denot ki(um) comput defin sect. 3. remark 2. choic lead differ interior penalti methods: symmetr ( = 1), incomplet ( = 0), anti-symmetr ( = 1). origin interior penalti method symmetr nice monoton properti shown [4] = 0. approach dynam depend um wai take valu [0, 1] depend properti um element facet. specif implement featur introduc experiment sect. 6. remark 3. main motiv articl accur repres discon- tinuiti sharp layers, aim sharp layer boundari numer experiments, check qualiti approach. result, boundari con- dition enforc strongly, common dg methods. case, test space replac v trialm = {vm vm : vm| = gm} trial space v testm = {vm vm : vm| = 0}. thus, term includ g right-hand eventu disappear. 3. nonlinear stabilization: shock captur artifici viscos shock captur nonlinear stabil scheme basic consist ad extra non consist viscos term origin problem. valu solution-depend and, element ki, usual order hki,ki scale constant shock detector ski . differ featur taken consider comput ski element residu equat [13, 30, 25, 26], entropi energi solut [21], decai high order coeffici [27, 36], others. work, [9, 8], focu variat gradient solut elements. general, techniqu advantag good smooth properti laplacian operator. particular, kei featur avoid oscil inherit 6 (a) wipdg+ngjv, triangl (b) wipdg+ngjv, quad (c) wipdg+dbgjv, quad figur 1: solut discontinu propag problem 6.2 20 20 mesh maximum principl continuum equat numer scheme, lead call discret maximum principl (dmp); [8, 10]. unfortunately, laplacian oper itself, monoton prove acut simplici meshes, hard practice. monotonicity-preserv (for acut meshes) nonlinear stabil continu fe propos [3] multi-dimension case. dg method situat worse, dmp laplacian proved, far know, 1d problem incomplet ipdg scheme [23]. nonlinear stabil dg approxim transport problem enjoi dmp assumpt prove [4]. method be, construction, monotonically-preserv general, defin nonlinear stabil scheme dmp properti underli laplacian oper prove good approach design algorithms. refer [3, 4] test dmp-preserv method non- acut meshes. restrict problem 2d, nodal gradient jump viscos (ngjv) intro- duce [4] design triangular structur meshes. element-wis constant artifici diffus scale shock detector, took account variat direct gradient function node element. interest work adapt mesh quadrilater (or hexahedra), need fit method new paradigm. new properti account gradient bi-linear solut constant element anymore. natu- ral extens valu gradient element solut nodal point. check behavior definit coars mesh 20 20 quad solv discontinu propag problem defin sect. 6.2. result plot fig. 1(a) fig. 1(b) that, dmp attained, regular problem near exponenti layer boundari lost. second hurdl deal hang node appear adapt meshes. clear comput viscos account valu shock detector point and, so, consid parent neighbor. since, fact, dmp prove ngjv dimens greater one, option look altern extens dmp-satisfi artifici viscos 1d allow circumv problems. possibl approach consid extens boundari gradient jump viscos (bgjv) introduc [3] 7 discontinu scheme. constant nonlinear viscos ki read follow: (um)|ki = cgjvhki,ki max fem(ki) s ki (f ) f (um), (5) ki : em(ki) {,+} function ki = k ki (f ) f f em(ki), cgjv set 0.5 sf defin sf (um) = |um(x) n| |um(x)| max xf (sf (x)) q , (6) sf shock detector defin x f sf (x) := ukfm (x) nfhkf +ukfm (x) nf hkf + 2[[um]](x) nf ukfm (x) nfhkf + ukfm (x) nf hkf + [[um]](x) nf + |[[um]](x) nf | . (7) definit stand /+ (therefor opposit sign), x = arg maxxf (sf (x)). denomin (7) vanishes, simpli s f = 0 x f . term |um(x)n||um(x)| (6) correspond correct term avoid excess smearing. practice, comput terms, maximum approxim maximum gauss points. behavior new method test 20 20 quad mesh. need nonlinear iter converg and, shown fig. 3, result obtain smoother previou one. method discontinu boundari gradient jump viscos (dbgjv) us hereinafter. remark 4. restrict definit (6) piece-wis linear continu solut triangular homogen mesh valu new definit orig- inal sf associ boundari gradient jump viscos method [3] equivalent. recal definit given sf (um) = f |um n|d f |um|d ( f |[[um]]|d 2 f {{|um n|}}d )q . (8) case valu um constant element, [[u]] zero continu valu hki nullify, (6) (8) read same. 4. hp-adapt hp-adapt fe method goe classic result published, e.g., [22], author show possibl attain exponenti convergence. then, lot implement method realized, despit larg technic complex (see, e.g., [1, 14, 5, 29, 32], list refer signific work). differ implement differ greatli purpose, generality, type element used, aspects. 8 contribution, us quadrilater element isotrop refinements. choic dg method make us hang node easier, need enforc continu hang nodes. nevertheless, allow first-level hang nodes, mean element neighbor refin level away. experi show restrict lead signific slow-down converg extra refin modern codes. 4.1. posteriori error estim adapt algorithm hp-adapt paradigm, need determin element need refin choos h- p-refinement. big challeng method tackl differ ways. approach us priori knowledg trouble-spot elements, set h-refin [1, 38]. demkowicz co-work [16, 14, 15] project solut differ mesh adapt adapt evolv choos best option accord suitabl posteriori error estimator. approach analyz decai legendr polyno- mial coeffici [24, 31]. techniqu compar survei perform mitchel mcclain [35]. survei win strategi smooth predictor propos melenk wohlmuth [33] us numer experiments. smooth predictor basic consist predict error assum solut smooth. know that, smooth case, order converg l2-error element ki h pim+1 ki , predict evolut error h- p-refin take place. posteriori error estim decai l2-error laplacian problem present [33]. element mark refinement, local posteriori error estim compar predict error (comput adapt step involv element). error greater predicted, solut assum non-smooth element mark h-refinement. mark p-refinement. basic us scheme but, interest enforc linear order (and thus, forc h-refinement) element want appli shock capturing, slightli modifi (see algorithm sect. 5.3 explicit definit hp-adapt algorithm). abl benefit smooth converg hp-adapt technique, posteriori error estim converg l2-norm actual error needed. end, error estim propos [18] implemented. element ki, consist parts: (im) 2 = 2m,ri + 2 m,ei + 2m,ji , (9) ri interior residu term, ei ji correspond edg residu error jump faces, respectively. origin definit term adapt case isotrop refin quadrilater meshes. also, strong dirichlet boundari condit used, remov boundari terms. notic that, boundari condit polynomi (and exactli captur solution), valu approxim error boundari led overestim error boundari lead over-refin 9 boundari element (even solut smooth). so, definit local posteriori error estim term read like 2m,ri = 1(pim) 2h2kifm + um um 2 ki , (10) 2m,ei = 1 2 fem(ki)\ hf pf [[um]]2f , (11) 2m,ji = 1 2 fem(ki)\ ( (cip)2p2f hki + p2f hki + hf pf ) [[um]]2f . (12) valu pf pf := maxkif p m. prove [18] exist norm respect error estim asymptot equivalent.1 norm prove equival l2-error but, practice, numer result agreement posteriori estim weight l2-error approxim defin 1 2u uml2(). follow scheme, predict error arrai em construct begin adapt iterationm. element, defin element predict valu eim base valu posteriori error estim fm(i) m1 correspond element tm1. numer solut um obtained, actual posteriori error estim compar predict valu eim decid h- p-refine. practice, develop variat mesh adaptivit propos melenk wohlmuth [33]. chang comput predict errors: comput size hki element ki ad order better comput predict error p-refined. also, includ case coarsen and, moreover, chang predict refin elements. explicit comput predict error shown alg. 1. notic element modifi (refin coarsened), predict values. coarsen elements, set predict error wai reinforc p-refinement. element ki p-coarsened, predict error set e m = p-refin mesh adaptation. hand, set element h-coarsen error proport greatest error set. fact troubled-cel detector reinforc h-refin want recov order converg method smooth region unnecessarili h-refined. select element refin refin slightli modifi reli troubled-cel detector introduc section. specifi subsect. 5.3. 1almost mean sub-optim respect polynomi degre upper bound and, moreover, bound approxim error forc term convect term explod 0 10 algorithm 1: set predict error arrai em = 1 n elm ki child kfm(i) tm1 eim = 2 pim1 1 2 (pimp fm(i) m1 ) p 1 2 h fm(i) m1 ki correspond kfm(i) tm1 pim > p fm(i) m1 eim = 1 2 p hmax fm(i) m1 pim = p fm(i) m1 eim = ne fm(i) m1 pim < p fm(i) m1 eim = ki parent kfm(i) tm1 eim = maxc=0, ,nc1 { 1 2 h 2 p fm(i)+c m1 h (pimp fm(i)+c m1 ) k fm(i)+c m1 } valu constant paramet h, p, n defin sect. 6. 5. troubled-cel detector 5.1. refinement-depend troubled-cel detector novel troubled-cel detector propos next. us inform given evolut solut mesh adapt process. idea solut discontinu certain region, gradient discret approxim element nearbi invers proport size. assum width sharp layer order smaller characterist length consid width 0, i.e., discontinuity. present method 2d case extens 3d case given remark 5. defin mean element gradient element ki tm adapt step m gim = umki |ki| 1 2 . (13) analyz evolut gradient numer solut 2d assum solut discontinu approxim numer method. particular focu happen element h-refin (see fig. 2). expect method capabl captur discontinu smoothli elements, assum solut nodal exact. moreover, discontinu impli huge chang valu solution, conjectur differ valu solut differ nodal point discontinu negligible. fact, discontinu straight, assum mesh fine topolog element close straight line. lead constant valu solut discontinu and, loss gener (becaus interest valu 11 m m+1 h h/2 (a) k1 m m+1 h h/2 (b) k2 figur 2: element (and refinement) discontinu gradient (13)), consid 0 sides. h valu jump discontinuity. premis obtain possibl set element cross discontinuity: 1 vertex discontinu 3 vertic (fig. 2(a)). 2 vertic discontinu (fig. 2(b)). element subdivid 4 children, on inherit discontinu configurations, shown fig. 2. take situat let h size element, easi comput valu mean element gradient element k adapt step m cases. parent element (case 1 2) easi calcul lead valu (notic that, sake comprehensibility, differ notat superscript g case): gk1m = 2 3 h h gk2m = h h . want know relat valu mean element gradient children element k contain layer. know children element characterist length h 2 assum premis solut before, possibl element mean gradient gk 1 m+1 = 8 3 h h gk 2 m+1 = 2 h h . valu element mean gradient children element contain discontinu increas respect previou step. hand, gradient children discontinu neglig (thei 0 limit case) comparison origin gradient. particular, quotient valu expect follow intervals: gim+1 gfm+1(i)m [ 8 3 , 6 ] ki tm+1 contain discontinu gim+1 gfm+1(i)m 0 ki tm+1 contain discontinu 12 remark 5. 3d case, take similar assumpt approxim dis- continu plane, end have 5 differ configurations. mean element gradient configur vari interv [ h 3h , h h ] . follow previou step expect coeffici gim+1 gfm+1(i)m respect children inherit discon- tinuiti interv [ 2 3 , 2 3 ] . inform us order tackl methods. end, defin troubled-cel indicator, s, element k valu s im {0, 1, 2}. roughli speaking, s im = 0 element region solut smooth, s im = 1 element contain discontinuity, s im = 2 element previou elements. adapt iter m, numer solut um computed, gim valu mean element gradient element ki tm s im > 0 compar valu correspond element/ iter m 1. follow scenarios: ki tm parent kfm(i)+c tm1, c = 0, , nc 1 element kfm(i)+c tm1 s fm(i)+c m1 = 1, contain discontinuity, parent ki contain layer s im = 1. otherwise, s im = 0. ki tm correspond kfm(i) tm1 intuit idea consid element discontinu inside, maintain troubled-cel indicator. but, practice, that, check evolut gradient function consecut adapt iterations, lead troubled-cel mark region smooth solutions. instead, s im = 1, mean element gradient gim compar g j mk, j = fmk+1 fmk+2 fm(i) element refinement. so, sfm(i)m1 = 1 gim > ng j mk, s m = 1, s im = 0. ki tm child kfm(i) tm1 reason state before, us threshold valu n (0, 8 3 ) decid children element discontinu insid inherit troubled-cel indicator. troubled-cel indic valu given by2 s im = { 1 gim > ng fm(i) m1 and fm(i) m1 > 0 0 otherwise. obviou smooth region refin sharp layer error greater size element. mean that, 2see remark 6 justif element ki s fm(i) m1 = 1 checked. 13 solut combin kind regions, troubled-cel detector dynam near non-smooth layers, evolv adapt step, need adapt step complet remov smooth regions. acceler process, set paramet rs = 0.001 element gim < rs maxj gjm automat set non-troubl (s im = 0). element mean element gradient 0.1% mean element gradient element largest valu mark troubled-cel solution. addit values, select troubled-cel previou algorithm, assign flag s im = 2 element k share face troubled-detect element. scheme summar alg. 2. algorithm 2: updat valu sm sm = 0 = 1 n elm ki child kfm(i) tm1 gim > ng fm(i) m1 and fm(i) m1 > 0 s im = 1 ki correspond kfm(i) tm1 sfm(i)m1 = 1 gim > ng fm(i) mk s im = 1 ki parent kfm(i) tm1 c = 1, , nc 1 sfm(i)+cm1 = 1 s im = 1 gim < rs maxj gjm s im = 0 = 1 n elm ki share face kj s.t. sjm = 1 s im = 0 s im = 2 valu paramet n defin sect. 6 remark 6. extra troubled-cel indic (s im = 2) main advantages: hand allow add artifici viscos element discontinu neighbor regions, useful, spuriou oscil appear there. hand, allow introduc second order control. element mark s im = 2, evolut mean gradient check children consid discontinu layer adapt step, lead effect method practice. remark 7. implement issu algorithm perform 2 steps. iter m, comput um, evalu predict gradient gm defin by: 14 h-coarsening: gim = min c=0, ,nc1 gfm(i)+cm1 modification: gim = g fm(i) m1 h-refinement: gim = g fm(i) m1 numer solut computed, actual valu gm comput compar predict ones, necessary. example, element ki h- refin kfm(i) tm1 s fm(i) m1 , check gim > ngim decid assign s im = 1. valu n chosen. big that, solv smooth problem, troubled-cel element detect reason number adap- tive iter (to avoid set element h-refin instead p-refin smooth regions). this, fact, mean reason interv n (1, 8 3 ) sens consid region gradient decays, consid discontinuity. hand n small detect discontinu sharp layers. choic valu introduc experiment sect. 6. numer experi start set s0 = 1 proce h-refin element 2 iterations. 5.2. activ shock captur troubled-cel indic identifi region linear element dif- ferent stabil techniqu benefit. particular, work, previous introduc dbgjv viscos used. valu shock detector sf defin (6) comput face linear order, pf = 1, have, least, neighbor element k s im > 0. impli artifici viscos- iti activ troubled-cel elements. motiv fact troubled-cel usual on steep layer spuriou oscil tend surround layer. proven numer ad artifici viscos surround element improv consider behavior method. 5.3. combin hp-adapt process troubled-cel detector point set paramet process introduced. so, proceed numer results, us summar method order clearer. step, troubled-cel detector set s im = 1 ki adapt process consist h-refin element establish valu predict error em, (introduc alg. 1), predict gradient gm (remark 7 sect. 5.1) troubled-cel detector sm. fact element mesh simpli h-refin adapt steps. numer experi 2 step shown alg. 3. affect converg help detect non-smooth layer beginning. paramet algorithm set wai favor h-coarsen 15 region unnecessarili h-refin (see introduct sect. 6). assum initi mesh coarse, make sens h-refin element beginning. sect. 4.1 introduc smooth predictor propos [32] modifications. last troubled-cel detector affect choic kind refinement. basically, follow smooth predictor scheme adapt element ki set troubled-cel (s im > 0), case avoid p-refinement. ad coarsen possibility. valu associ process: tref , element refined, tcoars,p tcoars,h, element p h refin respectively. defin follows: tref = n nd m brefn nd m c, tcoars,p = dpcoarsenn nd m e, tcoars,h = dhcoarsenn nd m e. paramet ref , p coarsen h coarsen paramet method chosen. notic element h-coarsen children set h-coarsen (which rare happen solut properli refined). instead p-coarsen occur element set p-coarsen ran- domli happen solut correctli refin everywhere. defin differ valu differ coarsen option set paramet pcoarsen hcoarsen minim problem. also, tref approxim valu because, order homogen refin region order error, includ correct factor element 90% error element refin mark refinement; object minim abnorm adapt step symmetri problem, so. element 10% threshold error mark h-coarsening. process specifi alg. 3. summarizing, given tm1 (mesh), gm1 (mean element gradients), m1 (a posteri- ori error estimators), sm1 (troubled-cel flags), pm1 (element polynomi order), adapt flags, um1 (discret solution), follow follow step comput tm, gm, m, sm, pm, um: 1. comput mesh tm order arrai pm tm1 pm1 adapt flag previou iteration. 2. inherit troubled-cel detector values. 3. set predict error em (follow alg. 1) predict gradient gm (in- troduc remark 7 sect. 5.1). 4. comput matrix vector obtain um. shock capturing, non- linear iter relax paramet used. particular imple- ment relax scheme propos [26], paramet valu therein. 5. comput posteriori error estim valu m (see equat (9)) gm (see equat (13)). 16 algorithm 3: comput adapt flag element tm posteriori error estim solut um. m 2 set element tm h-refined; = sort(m) /* kii m kii+1 m = 1, , nndm */ refin elem = nndm tref t = 0.9 refin elemm /* upper threshold error */ b = 0.1 refin elemm /* lower threshold error */ tcoars,p set kii p-coars = 0 tcoars,h iim < b set kii h-coarsen = i+ 1 tcoars,h < nndm tref iim > t refin element= exit loop siim > 0 pim > 1 set kii p-coars linear order refin element < nndm iim < e m s = 0 set kii p-refin set kii h-refin 17 6. set troubled-cel indic valu sm (follow scheme alg. 2 sect. 5.1). comput them, us inform store gm. 7. comput adapt flag alg. 3. 6. numer result follow numer experi want perform troubled-cel detector optimum valu paramet method wai ensur detect correctli layer and, time, deactiv solut smooth. examples, mesh consist squar element chosen length edg element ki characterist length hki . follow [4], set paramet equat (2)-(3)-(4) cip = 10 cbm = 0.5. concern , interest recov dmp featur introduc [4], like incomplet method non-smooth region symmetr method elsewhere. achiev properti us valu us scale ki , ski := maxfem(ki) s ki (f ) f . paramet take valu interv [0, 1]; ski 1 near local extrema function ski = 0 smooth regions. thus, defin = 1 ski attain desir property. know troubled-cel detector activ step solut smooth and, moreover, know (or expect) linear order impos not, choos paramet favor p-refin h-coarsening. follow principle, justifi choic paramet beforehand. start set valu h, p n alg. 1. valu h [33] 4, allow valu h = 10, predict error bigger smooth assumpt fostered. p set p = 10. fact, definit p [33] differ us characterist length hki comput predict error. hand, set predict error eim = ne fm(i) m1 ki ident kfm(i) tm1. element changed, accept predict error remain same, thus, let n = 1. instead, set slightli larger, n = 1.1, that, element refin steps, predict valu rise promot p-refinement. final set percentag element refin ref = 0.75 coarsen percentag hcoarsen = 0.20; mean element correspond 25% error (h- p-) refin 20% element mark h-coarsen (which necessarili mean coarsened, children mark coarsened). option, try compens fact smooth region h-refin erron consid troubl region; want promot coarsen region recov order converg hp-adapt methods. final set pcoarsen = 0 virtual avoid p-coarsen (in fact p-coarsen keep take place near sharp layer element detect troubled-cell). follow numer test set valu n ensur work smooth function. then, method capabl correctli determin 18 cip cbm h p n ref h coarsen p coarsen 10 0.5 1 ski 10 10 1.1 0.75 0.20 0 tabl 1: valu fix paramet method. sharp layer appli h- p-refin accordingly. perform shock captur term diminish oscil non-smooth layer shown. 6.1. smooth solut constant set n. valu paramet crucial defin behavior troubled-cel detector defin threshold consid smooth region not. explain sect. 5.1, n valu interv (1, 8 3 ). closer 1 easiest element consid troubl cell. certainli choos large, want ensur troubled-cel detector activ sharp layers; like n small possible. order set parameter, choos smooth function variabl slope check step take method remov troubled-cel flag differ valu n. concretely, choos solut sinu (not align mesh) solv problem (2) = [0, 1]2 = 1, = 0, f = 2(1+2) sin((x+(y1))) boundari condit g(x, y) = sin((x+(y1))), = 1 tan/3 . look like simpl solution, difficult deal region near maximum minimum discret solut flat element extrema refin children greater slope. good solut check propos formulation. run method n = 1.1, 1.2, 1.3, 1.4, 1.5, 8 3 check evolut activ detector. notic that, case, artifici viscos activ ,ki = 0, ki = 0 i. initi mesh 4 4 element s0 = 1 check evolut rate troubled-cel detect elements. interest know adapt step necessari complet remov troubled-cel flag affect converg problem. rate troubled-cel elements, #{k s.t.sim>0} nelm , plot fig. 3 converg posteriori error estim actual l2 error. observ n 1.2 troubled-cel detector progress remov optim converg recov steps. plot n = 1.1 incap remov troubl cell converg method jeopardized. consequence, chosen n = 1.2 n = 1.4 paramet rest numer test. valu n = 1.2 smallest capabl remov troubled-cel detector flag method n = 1.4 effective. plot verifi order converg posteriori error actual l2-error agree. 19 0 0.2 0.4 0.6 0.8 1 10 100 1000 10000 100000 1e+06 r te o f tr o u b le d -c e ll e le m e n ts dof prob64 s = 0 n=1.1 n=1.2 n=1.3 n=1.4 n=1.5 n=1.63 (a) rate troubled-cel element 1e-10 1e-08 1e-06 0.0001 0.01 1 100 10 100 1000 10000 100000 1e+06 e rr o r dof ,s = 0 ,n=1.1 ,n=1.2 ,n=1.3 ,n=1.4 ,n=1.5 ,n=1.63 l2-error, s=0 l2-error,n=1.1 l2-error,n=1.2 l2-error,n=1.3 l2-error,n=1.4 l2-error,n=1.5 l2-error,n=1.63 (b) converg posteriori error estim weight l2-error 1 2 uuml(). figur 3: smooth solution. troubled-cel activ differ valu n. 20 (a) wipdg. troubled-cel ac- tivat (b) wipdg + dbgjv,n = 1.2 (c) wipdg + dbgjv,n = 1.4 figur 4: solut adapt step m = 12. 6.2. propag discontinu let analyz good method captur proper boundari intern layers. typic steady-st test studi propag boundari discontinu convection-domin equation. so, problem (2) solv = [0, 1]2 = 108, = (cos(/3), sin(/3)), f = 0, boundari condit g = 1 y = 1 {x = 0} {y 0.7} g = 0 rest boundary. solut problem boundari layer (on x = 1 y = 0) interior layer width proport valu . start 4 4 element mesh adapt there. want control spuriou oscil aris sharp layer (see fig. 4(a)). so, correctli identifi layer add adequ artifici viscosity. fig. 5, appreci evolut troubled-cel flag mesh adapt process layer correctli captur method valu n. lead solut plot fig. 4(b) fig. 4(c).to precise, follow evolut oscil adapt process control method. defin oscil point x as: oscm(x) := max{0, um(x) 1,um(x)}. then, defin paramet give idea dmp violated, mean osc defin mean valu oscil degre freedom maximum osc defin maximum valu oscm . fig. 6(a) artifici viscos techniqu capabl control spuriou oscillations, special mesh refined, give mean osc 5 order magnitud lower obtain wipdg method extra stabilization. maximum osc, hand, order magnitud lower, shown fig. 6(b). observ slightli oscillatori behavior mean osc number dof fig. 6(a). happen because, observ fig. 5(e) fig. 5(f) small region layer undetected. reason fact 21 (a) m = 3, n = 1.2 (b) m = 6, n = 1.2 (c) m = 12, n = 1.2 (d) m = 3, n = 1.4 (e) m = 6, n = 1.4 (f) m = 12, n = 1.4 figur 5: troubled-cel differ step valu n. 22 1e-05 0.0001 0.001 0.01 0.1 1 10 100 1000 10000 100000 1e+06 symmetr ipdg stabil wipdg, n=1.2 stabil wipdg, n=1.4 (a) mean osc 0 0.5 1 1.5 2 2.5 3 10 100 1000 10000 100000 1e+06 symmetr ipdg stabil wipdg, n=1.2 stabil wipdg, n=1.4 (b) maximum osc figur 6: mean maximum oscil vs. dofs. real discontinu practice, smear produc artifici viscosity. region over-resolved, fe scale solut start smooth, artifici viscos switch off. special crucial region exponenti boundari layer interior layer meet size element smaller rest interior layer. behavior correct complic adapt strategy. 6.3. propag smooth region hp-adapt complet exploit previou example, solut flat smooth region, thus, perfectli captur low order approxi- mations. now, let evalu perform approach term distribut h p adaptivity. basic took solut but, instead impos g = 1 y = 1 {x = 0}{y 0.7}, impos g = 1+0.1 co ( 6 ( x 1y tan(3 ) )) . result solut sinusoid previous flat region (see fig. 7(a)). order map solut fig. 7(a) differ valu n plot fig. 7(b) fig. 7(c). observ method capabl p-refin smooth region cases. further, smaller valu n impli necessarili mean order smooth region lower. 6.4. parabol boundari layer let check method perform parabol boundari layers. solv problem (2) = [0, 1]2, = 108, = (1, 0), f = 1, homogen boundari condit g = 0 . lead exponenti layer x = 1 parabol layer y = 0 y = 1. fig. 8, adapt step method capabl correctli control oscillations. plot solut fig. 8(b) fig. 8(c) troubled-cel detector activ map appreci activ relat control spuriou oscillations. case defin oscm(x) = max{0, um(x) x} fig. 9 plot approxim maximum valu comput quadratur points. 23 (a) um, n = 1.4 (b) element order map n = 1.2 (c) element order map n = 1.4 figur 7: stabil solut m = 12. order map rang p {1, 4}. (a) wipdg. troubled-cel ac- tivat (b) wipdg + dbgjv,n = 1.2 (c) wipdg + dbgjv,n = 1.4 figur 8: solut adapt step m = 5. how, order oscil order lower origin method, point oscil tend increase. special notic n = 1.4. phenomena fact region troubled-cel detector deactiv suffici refin mesh. hand region parabol layer close x = 0, appreci fig. 10(b), gradient smaller rest layer. hand, saw sect. 6.2, region exponenti parabol layer intersect crucial. case, n = 1.4, troubl cell deactiv region lead peak appreci fig. 8 correspond oscil shown fig. 10(c). 6.5. curv characterist finally, troubled-cel detector work curv characteristics. so, solv problem (2) = [0, 1]2, = 108, = (2y, 2x), f = 0, 24 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 10 100 1000 10000 100000 symmetr ipdg stabil wipdg, n=1.2 stabil wipdg, n=1.4 figur 9: maximum oscil vs dofs. (a) wipdg. troubled-cel ac- tivat (b) wipdg + dbgjv,n = 1.2 (c) wipdg + dbgjv,n = 1.4 figur 10: solut adapt step m = 10. 25 (a) m = 3, n = 1.2 (b) m = 6, n = 1.2 (c) m = 9, n = 1.2 (d) m = 3, n = 1.4 (e) m = 6, n = 1.4 (f) m = 9, n = 1.4 figur 11: troubled-cel differ step valu n. g = 0 boundari y = 0, step function g(x, 0) = { 1 x (0.35, 0.65), 0 elsewhere. problem lead curv step function intern layer boundari layer x = 0. fig. 11 shown troubled-cel detector perform captur kind solution. observ previou examples, method n = 1.2 capabl better captur layer final adapt steps. gap troubled-cel activ layer origin oscil observ fig. 12(c). 7. conclus paper new troubled-cel detector propos work adapt meshes. numer section, shown work differ kind solut parabol exponenti boundari interior layers. general, method capabl correctli detect sharp layer certain level refinement. shown that, smaller valu paramet n (which determin variat gradient admit consid solut smooth) better method performs. solut smooth region sharp layers, method capabl let order solut rise smooth region keep low order nonlinear stabil sharp layer solution. 26 (a) wipdg. troubled-cel ac- tivat (b) wipdg + dbgjv,n = 1.2 (c) wipdg + dbgjv,n = 1.4 figur 12: solut adapt step m = 9. hand extens bgjv method propos [3] shown effect deal spuriou oscil adapt meshes. implement troubled-cel detector ensur condit non-smooth layer crucial blend adapt monotonicity-preserv shock capturing. acknowledg work partial fund european research council fp7 programm idea start grant no. 258443 - comfus: comput method fusion technology. a. hierro gratefulli acknowledg support receiv catalan govern fi fellowship. [1] m. ainsworth b. senior, hp-finit element procedur non-uniform geometr meshes: adapt constrain approximation, grid gener adapt algorithms, m. w. bern, j. e. flaherty, m. luskin, eds., no. 113 ima volum mathemat applications, springer new york, jan. 1999, pp. 127. [2] s. badia j. baiges, adapt finit element simul incompress flow hybrid continuous-discontinu galerkin formulations, siam journal scientif computing, 35 (2013), pp. a491a516. [3] s. badia a. hierro, monotonicity-preserv stabil finit element approxim transport problems, siam journal scientif computing, 36 (2014), pp. a2673a2697. [4] s. badia a. hierro, discret maximum principl discontinu galerkin methods, method appli mechan engineering, 286 (2015), pp. 107122. [5] w. bangerth o. kayser-herold, data structur requir hp finit element software, acm trans. math. softw., 36 (2009), pp. 4:14:31. 27 [6] r. biswas, k. d. devine, j. e. flaherty, parallel, adapt finit element method conserv laws, appli numer mathematics, 14 (1994), pp. 255 283. [7] f. brezzi,l. d. marini, e. suli, discontinu galerkin method first- order hyperbol problems, mathemat model method appli sciences, 12 (2004), pp. 18931903. [8] e. burman, nonlinear artifici viscosity, discret maximum principl hy- perbol conserv laws, bit numer mathematics, 47 (2007), pp. 715733. [9] e. burman a. ern, nonlinear diffus discret maximum principl stabil galerkin approxim convection-diffusion-react equation, method appli mechan engineering, 191 (2002), pp. 3833 3855. [10] , stabil galerkin approxim convection-diffusion-react equations: discret maximum principl convergence, mathemat computation, 74 (2005), pp. 16371652. [11] e. burman p. hansbo, edg stabil galerkin approxim convection-diffusion-react problems, method appli mechan engineering, 193 (2004), pp. 14371453. [12] b. cockburn c.-w. shu, tvb runge-kutta local project discontinu- ou galerkin finit element method conserv laws. ii. gener framework, mathemat computation, 52 (1989), pp. 411435. [13] r. codina, stabil incompress convect orthogon sub-scal finit element methods, method appli mechan engineering, 190 (2000), pp. 15791599. [14] l. demkowicz, comput hp-adapt finit elements. vol 1. dimension ellipt maxwel problems, crc press, oct. 2006. [15] l. demkowicz, j. kurtz, d. pardo, m. paszynski, w. rachowicz, a. zdunek, comput hp-adapt finit elements, vol. 2: frontiers: dimension ellipt maxwel problem applications, chapman hall/crc, boca raton, 1 edit ed., nov. 2007. [16] l. demkowicz, w. rachowicz, p. devloo, fulli automat hp- adaptivity, journal scientif computing, 17 (2002), pp. 117142. [17] a. ern j. guermond, weight edg stabilization, siam journal numer analysis, 51 (2013), pp. 16551677. [18] s. giani, d. schotzau, l. zhu, a-posteriori error estim -adapt dg method convection-diffus problem anisotrop refin meshes, comput & mathemat applications, 67 (2014), pp. 869887. 28 [19] d. gilbarg n. s. trudinger, ellipt partial differenti equat second order, springer, mar. 2015. [20] j. guermond, m. nazarov, b. popov, y. yang, second-ord maxi- mum principl preserv lagrang finit element techniqu nonlinear scalar conserv equations, siam journal numer analysis, 52 (2014), pp. 2163 2182. [21] j.-l. guermond, r. pasquetti, b. popov, entropi viscos method nonlinear conserv laws, journal comput physics, 230 (2011), pp. 42484267. [22] b. guo i. babuska, hp version finit element method, computa- tional mechanics, 1 (1986), pp. 2141. [23] t. l. horvath m. e. mincsovics, discret maximum principl interior penalti discontinu galerkin methods, central european journal mathematics, 11 (2013), pp. 664679. [24] p. houston, b. senior, e. suli, sobolev regular estim hp- adapt finit element methods, numer mathemat advanc appli- cations, f. brezzi, a. buffa, s. corsaro, a. murli, eds., springer milan, jan. 2003, pp. 631656. [25] v. john p. knobloch, spuriou oscil layer diminish (sold) method convectiondiffus equations: review, method appli mechan engineering, 196 (2007), pp. 21972215. [26] , spuriou oscil layer diminish (sold) method convec- tiondiffus equations: ii analysi finit elements, method appli mechan engineering, 197 (2008), pp. 19972014. [27] a. klockner, t. warburton, j. s. hesthaven, viscou shock captur- ing time-explicit discontinu galerkin method, mathemat model natur phenomena, 6 (2011), pp. 5783. [28] l. krivodonova, limit high-ord discontinu galerkin methods, journal comput physics, 226 (2007), pp. 879896. [29] p. kus, p. solin, d. andrs, arbitrary-level hang node adapt hp- fem approxim 3d, journal comput appli mathematics, 270 (2014), pp. 121133. [30] g. lube g. rapin, residual-bas stabil higher-ord fem advection- domin problems, method appli mechan engineering, 195 (2006), pp. 41244138. [31] c. mavriplis, adapt mesh strategi spectral element method, method appli mechan engineering, 116 (1994), pp. 7786. 29 [32] j. m. melenk, hp-finit element method singular perturbations, springer scienc & busi media, oct. 2002. [33] j. m. melenk b. i. wohlmuth, residual-bas posteriori error estima- tion hp-fem, advanc comput mathematics, 15 (2001), pp. 311331. [34] w. f. mitchell, adapt refin arbitrari finite-el space hi- erarch bases, journal comput appli mathematics, 36 (1991), pp. 6578. [35] w. f. mitchel m. a. mcclain, survei hp-adapt strategi ellipt partial differenti equations, recent advanc comput appli mathematics, t. e. simos, ed., springer netherlands, jan. 2011, pp. 227 258. [36] p.-o. persson j. peraire, sub-cel shock captur discontinu galerkin methods, 44th aiaa aerospac scienc meet exhibit, american institut aeronaut astronautics. [37] j. qiu c. shu, comparison troubled-cel indic rungekutta discontinu galerkin method weight essenti nonoscillatori lim- iters, siam journal scientif computing, 27 (2005), pp. 9951013. [38] e. suli, p. houston, c. schwab, hp-finit element method hyperbol problems, mathemat finit element applic x, elsevier, june 2000, p. 432. [39] m. j. vuik j. k. ryan, multiwavelet troubled-cel indic discontinu detect discontinu galerkin schemes, journal comput physics, 270 (2014), pp. 138160. [40] h. zhu j. qiu, h-adapt rkdg method troubled-cel indic two-dimension hyperbol conserv laws, advanc comput mathe- matics, 39 (2012), pp. 445463. 30 introduct interior penalti method convection-diffus equat convection-diffus problem notat weak form interior penalti discontinu galerkin approxim nonlinear stabilization: shock captur hp-adapt posteriori error estim adapt algorithm troubled-cel detector refinement-depend troubled-cel detector activ shock captur combin hp-adapt process troubled-cel detector numer result smooth solut propag discontinu propag smooth region parabol boundari layer curv characterist conclus