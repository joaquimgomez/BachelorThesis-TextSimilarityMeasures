volum render strategi mobil devic jose m. noguera, juan-roberto jimenez, carlo j. ogayar rafael j. segura graphic geomat group jaen, univers jaen, campu la lagunillas, edificio a3, 23071 jaen, spain fjnoguera, rjimenez, cogayar, keywords: volum rendering, mobil devices, gpu, interact frame rates. abstract: paper propos compar method interact volum render mobil devices. kind devic restrict limit perform storag capacity. paper review suitabl exist direct volum render methods, propos novel approach take advantag graphic capabl modern opengl es 2.0 enabl devices. experi carri test behaviour describ method. 1 introduct volum visual classic field graphic dedic render 3d scalar data. es- sential engin scientif applic requir visual three-dimension data sets. recently, volum visual requir us desktop computer. case requir fulfilled, in- stance, teach labs, oper theatres, field trips, inform meetings, etc. cases, us mobil devices, mobil phones, tablet per- sonal digit assist (pdas). however, interact 3d render mobil devic challeng task, mainli fact small power batteries. factor sever limit comput power memori capacity. paper explor limit capabl affect us hand-held devic perform inter- activ visual volumetr data. novel strat- egi proposed, tackl limit special characterist mobil devices, achiev inter- activ frame rate recur extern ren- dere server keep good visual quality. strategi implement systemati- calli compar method order eval- uat perform visual quality, figur 1. paper structur follows. sec- tion 2 describ previou work. section 3 present techniqu volum rendering. section 4 de- scribe implement volum raycast techniqu comparison. section 5 show discuss result differ sce- narios. finally, section 6 conclud paper. (a) (b) figur 1: render skull model a) classic volum rai casting, b) textur slice proposal. propos doubl perform provid similar ren- dere quality. 2 previou work volum repres differ ap- proaches, usual represent set images/s- lice parallel evenli distribut volume. context scientif visual vol- um render transport equat usual neglect illumin comput compos color opac sampl given line, certain wavelength l (levoy, 1988): 447 cl(x) = n k=0 cl(x+ rk)a(x+ rk) n l=k+1 (1a(x+ rl)) (1) cl(x) final color given posit x, cl(x+rk) color k th sampl posit x+ rk insid volum a(x+rk) correspond opacity. method propos imple- ment expression. general, exist method divid categori depend wai volum traversed: object order image- order approaches. deep studi volum ren- dere techniqu refer (weiskopf, 2007). rai casting-bas volum visual clas- sic imag order method (levoy, 1988) defin color pixel imag valu volum taken rai origin pixel. texture-bas volum render techniqu per- form sampl composit step render- ing set 2d geometr primit insid vol- um (ikit et al., 2004). primit usual known proxi geometri slices. vertex primit textur coordin sampl volum texture. blend accu- mulat color valu accord correspond opac- ities. (rezk-salama et al., 2000) present tech- niqu known 2d textur slicing, data set store stack 2d textures. hand, 3d textur slice techniqu (ikit et al., 2004) us 3d textur gener view-align group polygon view direction. (van gelder kim, 1996) avoid geometri recomput viewport align bound cube contain volumetr model. view direct textur coordin updat accordingly. concern hand-held devices, interact direct volum visual larg unexplor field. devices, 3d textur support option opengl es 2.0 extension, avail implementations, e.g., appl mo- bile devices. attempt tri overcom mobil de- vice limit emploi server-bas render- ing approach. approach reli dedic render server carri render volum stream result imag mo- bile client network (lamberti sanna, 2005; jeong kaufman, 2007). follow server- client scheme, (zhou et al., 2006) emploi remot server precomput compress iso-surface, sent mobil devic allow faster render- ing. unfortunately, server-bas solut re- quir persist fast network connection. (moser weiskopf, 2008) introduc inter- activ techniqu volum render mobil de- vice adopt 2d textur slice approach. au- thor claim achiev 1.5 frame second (fps) render basic volumetr model con- sist 633 voxel dell axim x51v devic resolut 640480 pixels. (imagevis3d, 2011) io applic us 2d textur slice approach. user interact number slice drastic reduced. end interact new imag render set slices. render step carri mobil devic itself, remot server case complex models. recently, (congot et al., 2011) imple- ment ray-bas techniqu webgl stan- dard. author test implement samsung galaxi mobil devices, obtain frame rate 2-3 fps. 3 propos todai mobil gpu offer featur rel similar desktop pcs, archi- tectur give prefer energi effici pure performance. therefore, ex- pect run long shader origin written desk- pc mobil devic interact frame rates, low screen resolut (power vr, 2009). therefore, shader mobil devic specifi- calli craft avoid complex comput con- dition branches. techniqu base 3d textur slice (van gelder kim, 1996; ikit et al., 2004) provid better render qualiti 2d textur slice approach. however, opengl es 2.0 implemen- tation avail todai mobil devic sup- port 3d textures, techniqu appli here. also, 3d textur slice techniqu requir us proxi geometri recomput time view angl varies. representa- tion appropri embed devic best perform mobil gpu ob- tain draw long batch index triangl cach gpu memori (power vr, 2009). therefore, goal defin new techniqu overcom limit keep render quality. 3.1 textur mosaic order provid mobil gpu volumet- ric data, set imag repres model combin 2d textur tile grapp 2012 - intern confer graphic theori applic 448 figur 2: bound cube defin volum diagon d. figur 3: slice (shown gray) perpendicu- lar view direction. textur coordin rotat accord desir view angle. imag mosaic configuration. mosaic textur gener preprocess- ing step mean command-lin tool montag includ open-sourc packag imagemagick. shader, correct textur coordin comput describ (congot et al., 2011). 3.2 render volumetr model solut consist textur slice approach set slice project perpendicular view direction. equat 1 implement com- posit slice front-to-back order framebuff alpha-blending. contrarili 3d textur slice approach, solut geometri stack slice comput remain stationari rest process. hence, cach gpu mem- ori mean vertex buffer object (vbo) reus draw frame. vbo prefer method send geometri mobil gpu (power vr, 2009) dramat reduc cpu- gpu bandwidth number draw calls. however, want abl render model angl visual artifact wast memori suffer 2d textur slice approach. order render slice perpendicu- lar view direction, volum enclos cube dimens d3, d diagon volume, figur 2. algorithm base gelder et al. (van gelder kim, 1996). face cube remain perpendicular view di- rection and, consequently, slice defin view-aligned. 3d textur coordin rotat vertic slice are: (s; t;r) = ( 1 2 d x ; 1 2 d y ; 1 2 d z )+( 1 2 ; 1 2 ; 1 2 ) (x ;y;z) dimens textur rep- resent volume. then, textur properli rotat accord desir view angl ap- propriat transform textur coordinates, figur 3. propos implement work follows. first, blend enabl configured. blend factor defin conjunct code shader accomplish equat 1, glblendfuncseparate(gl minu dst alpha, gl one, gl one, gl one). then, gpu provid textur trans- format matrix accord current view vbo proxi geometri activ drawn. vertex processor receiv vertices, transform accord model view matrix usual. 3d textur coordin ro- tate accord textur transform matrix. list 1 show glsl es (khrono group, 2009) code correspond vertex program. fragment shader, mosaic textur contain 3d volum sampl accord 3d textur coordin incom fragment. then, valu obtain volumetr model textur coordin perform look textur repres transfer function. finally, shader issu result color blend framebuffer. note fragment ly outsid vol- ume, is, textur coordin compo- nent lesser 0 greater 1, dis- carded. order avoid draw fragments, (van gelder kim, 1996) propos us user- defin clip plane volume. however, opengl es 2.0 support user clip plane command. cost, behaviour emul fragment shader discard refer frag- ments. unfortunately, discard function in- effici us avoid possibl (power vr, 2011). implementation, avoid assign zero alpha compon outsid fragments. accord blend function us fragment modifi framebuffer. list 2 provid glsl es code fragment program. code, function getdata volum render strategi mobil devic 449 attribut vec4 vpo , vtexcoord; uniform mat4 texcoordrot ,prjmat ,mvmat; vari vec4 texcoord; void main() { gl_posit = prjmat*(mvmat*vpos); texcoord = texcoordrot*vtexcoord; } list 1: glsl es code vertex program. uniform float numslices; uniform sampler2d modeltex , tftex; vari vec4 texcoord; bool discardoutvalues() { vec3 zero = vec3(0,0,0); if(any(lessthan(texcoord.stp, zero))) return true; vec3 = vec3(1,1,1); if(any(lessthan(one, texcoord.stp))) return true; return false; } void main (void) { if(discardoutvalues()){ gl_fragcolor = vec4(0,0,0,0); }else{ float sampl = getdata(texcoord); vec4 color = texture2d(tftex , vec2( sampl ,0)); color.a *= (1.0/ numslices); color.rgb *= color.a; gl_fragcolor = color; } } list 2: glsl es code fragment program. comput posit sampl insid mo- saic texture, perform tri-linear interpol return sample. 4 volum rai cast order test behaviour proposal, implement rai cast solut base (hadwig et al., 2009; congot et al., 2011). textur mosaic encod volumet- ric model describ section 3.1. rai divid certain number steps. loop fragment shader iter sampl 3d model appli transfer function accumu- late color opac accord equat 1. comput stop opac backsid reached. 5 result discuss experiments, select popular devic test platforms, namely, ipad2 4th gener- ation ipod touch. includ dual core powervr sgx543mp2 gpu fea- ture powervr sgx535 gpu. devic run io 4.3.5. softwar develop nativ io application, written c++ glsl es. data set experiments: cthuman obtain visibl human project1 aorta (congot et al., 2011). cthu- man model consist 186 slice 128128 pix- el aorta model 96 slice 102102 pixels. cthuman aorta model repres 2d mosaic 20482048 10241024 pixels, respectively. data set 8 bit sampl textur compression. tabl 1 summar result obtain cthuman data set raycast texture-sl render approaches, respectively, tabl 2 result aorta data set. left right, tabl devic used, screen resolution, frame rate obtain number step slice increases. number step refer number iter perform raycast techniqu (section 4). hand, number slice refer number plane sampl model techniqu (section 3.2). figur 4 show result images. studi result summar tabl 1 2, observ that, expected, perform linearli depend number fragment process number step slices. ipad2 nativ resolut (1024768), number pixel nearli quadrupl ipad2 iphon compat mode (480320). result, obtain fp vari proportion. experiments, ipad2 clearli outper- form ipod. stem fact ipad includ power gpu. good render- ing qualiti (40 slices) decent frame rate (11 fps) achiev device. result prove possibl render volumetr model mobil devic interact frame rate guaranteed. compar techniques, mind differ them. vol- um rai cast approach comput accumul given rai iter insid shader. contrary, approach substitut iter process parallel simpler fragment slices. accord experiments, 1 huma n.html grapp 2012 - intern confer graphic theori applic 450 tabl 1: time render cthuman model differ devices, imag resolut number step slices. rai cast approach devic resolut 10 20 40 80 10 20 40 80 ipad2 480320 23.5 fp 12.1 fp 6.4 fp 3.4 fp 40.1 fp 21.7 fp 11 fp 5.5 fp ipad2 1024768 5.2 fp 2.8 fp 1.4 fp 1.4 fp 10.3 fp 5 fp 2.4 fp 1.3 fp ipod 480320 3.2 fp 1.9 fp 1.6 fp 1 fp 6.6 fp 3.2 fp 1.5 fp 1.4 fp tabl 2: time render aorta model differ devices, imag resolut number step slices. rai cast approach devic resolut 10 20 40 80 10 20 40 80 ipad2 480320 23.2 fp 12.3 fp 6.5 fp 3.2 fp 45.4 fp 22.2 fp 11 fp 5.4 fp ipad2 1024768 5.1 fp 2.8 fp 1.5 fp 1.4 fp 10.3 fp 4.8 fp 2.4 fp 1.2 fp ipod 480320 3.1 fp 1.7 fp 1.6 fp 1.2 fp 6.6 fp 3.2 fp 1.5 fp 1.5 fp 20 steps. 80 steps. 20 steps. 80 steps. 20 slices. 80 slices. 20 slices. 80 slices. figur 4: imag aorta cthead model differ number steps/slices. top: raycast approach. bottom: textur slice approach. tabl 1 2, texture-sl approach nearli doubl perform obtain rai cast technique. result suggest prefer comput larger short fragment complex behaviour. believ that, number process core mobil gpu increases, perform gain techniqu compar ray-bas solu- tion increase, allow truli interact so- lution realiti kind devices. however, ray-bas techniqu provid bet- ter render quality. figur 4 compar ap- proach increas number steps/slices. notic number slice greater number step achiev similar results, fact slice defin bound box model. observ mobil gpu are, general, intuit unpredict perform desktop counterparts. paramount avoid branch shader program mobil gpu. theoret branch fulli supported, includ singl if-els claus slow perform 20 fps. volum render strategi mobil devic 451 finally, want point consider- ation relat mobil gpu architectur experiments. powervr graphic processor heavili reli method call tile base defer render (tbdr) (power vr, 2011) achiev good render perform keep low en- ergi consumption. tbdr allow perform hidden surfac remov fragment process avoid unnecessarili computations. unfortunately, hardwar optim suit vol- um rendering. textur slice techniqu requir blending, forc process fragments. experiments, turn blend boost per- formanc 60 fp regardless number slice rendered. raycast techniqu bene- fit techniqu fragment overlap comput avoided. 6 conclus develop novel volum render algo- rithm perfectli suit modern gpu-en mobil devices. propos address limit devices, mainli lack 3d textur sup- port limit complex imbu shaders. method test differ devic scenarios. compar result volum rai cast method. gen- eral, experi ray-bas method provid slightli higher qualiti image, textur slice method doubl frame rate. work shown mobil devic consti- tute valid platform achiev interact volum visualization, despit fact render ca- pabil reduc comparison desktop solu- tions, inher autonomi limitations. futur work, current research focus improv render perform qualiti base continu search new tech- niqu suit kind devices. plan improv visual appear includ complex illumin models. addition, plan us experi technolog univers teaching, instanc sub- ject like human anatomy, diagnosis, etc. believ interact visual medic data hand- held devic worthi pedagog instrument. acknowledg work partial support ministerio ciencia e innovacion euro- pean union (via erdf funds) research project tin2011-25259 univers jaen project pid441012 uja2010/13/08 sponsor caja rural jaen. refer congote, j., segura, a., kabongo, l., moreno, a., posada, j., ruiz, o. (2011). interact visual volumetr data webgl real-time. proceed- ing web3d 11, page 137146. acm. hadwiger, m., ljung, p., salama, c. r., ropinski, t. (2009). advanc illumin techniqu gpu- base volum raycasting. acm siggraph 2009 courses, page 2:12:166. acm. ikits, m., kniss, j., lefohn, a., hansen, c. (2004). gpu gem ii, chapter volum render techniques, page 667 692. addison wesley. imagevis3d (2011). imagevis3d: real-tim volum ren- dere tool larg data. scientif comput imag institut (sci). jeong, s. kaufman, a. e. (2007). interact wire- virtual colonoscopy. visual computer, 23(8):545557. khrono group (2009). opengl es shade lan- guage, 1.00 edition. lamberti, f. sanna, a. (2005). solut dis- plai medic data model mobil devices. sepads05, page 17, steven point, wisconsin, usa. (wseas). levoy, m. (1988). displai surfac volum data. graphic applications, ieee, 8(3):29 37. moser, m. weiskopf, d. (2008). interact volum render mobil devices. workshop vi- sion, modelling, visual vmv 08, page 217226. power vr (2009). powervr sgx opengl es 2.0 appli- cation develop recommendations. power vr (2011). powervr series5 graphic sgx archi- tectur guid developers. rezk-salama, c., engel, k., bauer, m., greiner, g., ertl, t. (2000). interact volum stan- dard pc graphic hardwar multi-textur multi-stag rasterization. proceed acm siggraph/eurograph workshop graph- ic hardware, hww 00, page 109118. acm. van gelder, a. kim, k. (1996). direct volum ren- dere shade three-dimension textures. proceed 1996 symposium volum visual- ization, vv 96, page 23ff., piscataway, nj, usa. ieee press. weiskopf, d. (2007). gpu-bas interact visual techniques. mathemat visualization. springer. zhou, h., qu, h., wu, y., yuen chan, m. (2006). vol- um visual mobil devices. 14th pacif confer graphic applications, page 7684. grapp 2012 - intern confer graphic theori applic 452