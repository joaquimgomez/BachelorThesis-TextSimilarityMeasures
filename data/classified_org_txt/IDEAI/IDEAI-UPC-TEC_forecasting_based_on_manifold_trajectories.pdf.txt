






















































TEC forecasting based on manifold trajectories


Article

TEC forecasting based on manifold trajectories

Enrique Monte Moreno 1,* ID , Alberto García Rigo 2,3 ID , Manuel Hernández-Pajares 2,3 ID and
Heng Yang 1 ID

1 Department of Signal Theory and Communications, TALP research center, Technical University of Catalonia,
Barcelona, Spain

2 UPC-IonSAT, Technical University of Catalonia, Barcelona, Spain
3 IEEC-CTE-CRAE, Institut d’Estudis Espacials de Catalunya, Barcelona, Spain
* Correspondence: enric.monte@upc.edu; Tel.: +34-934016435

Academic Editor: name
Version June 8, 2018 submitted to Remote Sens.

Abstract: In this paper, we present a method for forecasting the ionospheric Total Electron Content1
(TEC) distribution from the International GNSS Service’s Global Ionospheric Maps. The forecasting2
system gives an estimation of the value of the TEC distribution based on linear combination of3
previous TEC maps (i.e. a set of 2D arrays indexed by time), and the computation of a tangent4
subspace in a manifold associated to each map. The use of the tangent space to each map is justified5
because it allows to model the possible distortions from one observation to the next as a trajectory on6
the tangent manifold of the map. The coefficients of the linear combination of the last observations7
along with the tangent space are estimated at each time stamp in order to minimize the mean square8
forecasting error with a regularization term. The the estimation is made at each time stamp to adapt9
the forecast to short-term variations in solar activity..10

Keywords: Total Electron Content; Ionosphere; Forecasting; Tangent Distance; GNSS11

1. Introduction12

The capability to monitor and forecast Space Weather in the near-Earth environment, in particular13
ionosphere, is becoming more and more critical nowadays. There are a number of applications that can14
benefit from the estimates of the nowcast and forecast ionospheric state. In particular, those relying on15
Global Navigation Satellite Systems (GNSS) and Satellite Based Augmentation Systems (SBAS).16

In fact, a perturbed ionospheric state can affect multiple systems that rely on signals that propagate17
through ionospheric refractive media. Indeed, severe ionospheric disturbances can imply loss of18
lock in GNSS receivers located on Earth’s surface or on-board LEO satellites, EGNOS performance19
degradation events [21], [2], degradation of precise positioning, among others. In addition, monitoring20
the near-Earth environment can also help on taking appropriate decisions by space launch operators21
([4], [20]). In this context, one decade ago the European Space Agency (ESA) already showed their22
interest for two-day ahead predictions for mission planning, in particular, for the Soil Moisture and23
Ocean Salinity mission [3], [5], [1].24

Several methods for the forecasting of ionospheric parameters estimated from GNSS data have25
been developed in the last years. For instance [6], the approach by ESA, based on the extrapolation26
of Spherical Harmonics coefficients, and the UPC approach by [1], based on the Discrete Cosine27
Transform (DCT). One method of estimating the Vertical Total Electron Content (VTEC) maps is to28
combine several predicted VTEC Global Ionospheric Maps (GIM), as it was done in the context of29
International GNSS Service (IGS) Ionosphere Working Group (IGS Iono-WG).30

In addition, methods based on neural networks have also been developed [7], [8], [9], [23],31
autocorrelation and autocovariance procedures [10], [11], [12], linear regression [13], [14], the Grey32

Submitted to Remote Sens., pages 1 – 25 www.mdpi.com/journal/remotesensing

http://www.mdpi.com
https://orcid.org/0000-0002-4907-0494
https://orcid.org/0000-0001-6226-4851
https://orcid.org/0000-0002-9687-5850
https://orcid.org/0000-0002-1583-2307
http://www.mdpi.com/journal/remotesensing


Version June 8, 2018 submitted to Remote Sens. 2 of 25

model by [22]. On the other hand, methods have been developed that depend on physical models,33
such as [24], which is the one considered by the JPL Global Ionosphere Thermosphere Model (GITM).34

The TEC forecasting method relies on time series from the UPC Vertical TEC (VTEC) GIMs35
(labelled UQRG) computed by TOMION v1 software in the frame of the International GNSS Service36
(IGS; [36] and [15]). TOMION is a software mainly developed by one of the authors of this manuscript37
(MHP) consisting on two main versions: TOMION v1, which is focused on the estimation of electron38
content models, mostly based on GNSS dual-frequency measurements with ionospheric tomographic39
and kriging interpolation; and TOMION v2, which consists on a hybrid geodetic and tomographic40
ionospheric model that allows for precise ionospheric determination and precise positioning, among41
GPS radio-occultation data processing, see [15] , [18], [17], [16]. In particular, either UQRG 15-min42
resolution with 1-day latency or the UPC real-time VTEC maps (labelled URTG), which are computed43
continuously at a 30-seconds rate, can be ingested to the forecasting approach. In both cases, the GIMs44
provide bidimensional VTEC values assuming a thin single-layer ionospheric model at a height of45
450 km and considering a world-wide regular grid every 5 ◦/2.5◦ in longitude/latitude range (i.e. 7146
latitudinal and 72 longitudinal points accounting for a total of 5112 VTEC values per map). Note that47
for building the forecasting time series, these maps are transformed to a local-time sun-fixed reference48
frame.49

In brief, the way to calculate VTEC values in TOMION relies on the simultaneous estimation of the50
electron density values of the ionospheric electron content distribution, considering a basis functions51
of a partition in voxels, and the ambiguity of the ionospheric combination of carrier phases. And both52
set of parameters are estimated in a forward Kalman filter. Then, each Slant Total Electron Content53
(STEC) affecting each GNSS receiver-satellite signals can be estimated as LI = L1 − L2 ≈ αISTEC + BI .54

Where αI = α2 − α1 ≈ 1.05 and αi = 40.3/ f 2i . BI is the carrier-phase ionospheric ambiguity,55
which is estimated as part of the TOMION processing chain to derive UPC GIMs. In addition, Kriging56
interpolation technique [16] is used to fill the gaps where there is lack of data, given the inhomogeneous57
sparsity of GNSS receivers [25], [26].58

The results presented in this work have been obtained from UQRG maps, since these have proven59
to have the best performance against independent TEC measurements - JASON test - from altimeter60
data, as well as independent GNSS receivers -dSTEC test- among the different IGS models (for the61
details, see [19]). In particular, the results from this paper have been derived from UQRG data in years62
2014 -coinciding with the mild 24th Solar Cycle maximum-, 2015 and 2016.63

2. Justification of the method64

The method that we propose is an evolution of a forecasting method based on a bi-dimensional65
Discrete Cosine Transform (2D-DCT) by [1] and [20]. Originally it was decided to use the DCT method66
by analogy with the video compression methods based on predictive coding (for instance, see chapter67
8 of [27]).68

The analogy lies in the fact that the time evolution of the TEC maps can be understood as a series69
of images, where each map is indexed by its temporal index. The suitability of the use of a 2D-DCT70
for describing the TEC maps is due to the smoothness of the maps, i.e. its low spacial frequency71
components. In other words, typically most of the energy (> 95%) is concentrated in normalized72
horizontal and vertical frequencies less than 1/10. This property allowed for the forecasting based on a73
small subset of coefficients on the DCT transform domain, from which a given map can reconstructed74
with low distortion. Therefore, instead of dealing with the whole maps, the method only modeled the75
time evolution of the subset of DCT coefficients that accounted for most of the temporal changes of76
the general shape of the ionized zones. That meant that the forecast was done using a basis extracted77
from the low frequency components of the DCT that spans the space of possible TEC global maps (in78
the linear algebra sense). The result is that the prediction is correct throughout the map except at the79
areas corresponding to transitions between different levels of ionization, that is at the borders of these80
high-ionization regions (mainly in the case of the Appleton-Hartree anomaly). Such regions occupied a81



Version June 8, 2018 submitted to Remote Sens. 3 of 25

small area of the whole map, and specifically were the regions that contributed the most to the forecast82
error. Therefore, the temporal distortions of the shape of the areas with the highest ionization were not83
well modeled locally. The new forecasting model is inspired by this fact. That is, although these border84
regions represent a small fraction of the whole area/map being forecasted, they account for most of85
the error.86

As an example, we present the forecasts at two different times of the year with different solar87
activity. We decided to select different dates in order to show that the error at the edges of the high88
ionization zones occurs in different levels of solar activity. Also to show, that the effect occurs to a89
lesser extent in the model we propose in this article. Figures 1 and 2 correspond to the prediction90
with the DCT method and Figure 8 to the tangent plane method presented in this article. Figure 191
corresponds to the month of May (lower solar activity, see Figure 13), the 2 to the month of February.92
Figure 8 was computed at the same dates.93

The improvement due to the use of tangent planes is evident in the fact that the areas with an94
error of more than 20 TECUs (Total Electron Content, which is defined as 1 TECU=1016 el/m2) are95
located in much smaller areas of the error maps.96

Figure 1. Forecasting by means of the DCT method at a horizon of 3 hours. Time stamp, 2016-05-12
15:15:00 (Year-Month-Day Hour:Minute:Second). Current map ( upper left), future map ( upper right),
forecast (lower left), and forecast error ( lower right).

97

98



Version June 8, 2018 submitted to Remote Sens. 4 of 25

Figure 2. Forecasting by means of the DCT method at a horizon of 3 hours. Time stamp, 2016-02-21
13:15:00 (Year-Month-Day Hour:Minute:Second). Current map ( upper left), future map ( upper right),
forecast (lower left), and forecast error ( lower right).

In order to solve the problem of modeling simultaneously the smooth regions of the maps and the99
changes on the borders of the high-ionization regions we decided to use a different basis (in the sense100
of elements of a linear combination that span a subspace) that allowed for modeling the changes on the101
borders due to different distortions of the shape of the high-ionization regions. A set of transformations102
that might allow for modeling the changes at the borders, might be small rotations, small horizontal or103
vertical displacements, thickening or thinning of the borders, and hyperbolic (shear) distortions. The104
interest of these transformations resides in the fact that from one time stamp to the next, the changes105
on the map will be at the border of the ionized region and might be categorized as a mix of the above106
mentioned transformations.107

A technique creating the basis that models the changes at the borders of the ionized regions is108
based on the idea of deformable prototypes. This technique is used in pattern recognition for dealing109
with common distortions in Optical Character Recognition (OCR) (see for instance, [28], [29] and [30]).110
The idea assumes that the image, in our case a map denoted as P, is a point in a high dimensional111
space. Each 71x72 pixel map P is considered as a point in a space of dimension 71x72 = 5112, i.e.112
P ∈ R5112. For modeling the local changes from one map to the next, we will assume a transformation113
s(P, α), that creates another image, parameterized by α. In the exposition of the method, we will follow114
the notation as presented in [29].115

In figure 3, we show a diagram of the method. Note that given a point P, we can create a trajectory116
in the space R5112, by introducing small linear changes along directions in this space. In the example of117



Version June 8, 2018 submitted to Remote Sens. 5 of 25

Figure 3. Tangent space to the Manifold of the map at ’2016-01-19 10:30:00 (Year-Month-Day
Hour:Minute:Second)’

the figure, the distortion, parameterized by α, consists on a rotation of the map. Thus, we will denote118
the set of points x in R5112 for each rotation α as the set SP = {x|∃α for which x = s(P, α)}. In the119
figure, the trajectory followed by x, i.e. new images obtained from small rotations of P, is represented120
by a parabola, which is a one-dimensional curve embedded in the space of possible maps R5112. Note121
that knowing the value of the pixels of the map P, and the structure of the transformation (in this case122
a rotation), we can characterize the trajectory in R5112 as a manifold, and one can compute the tangent123
vector at that point. The tangent vector is represented by a line that intersects the curved manifold at124
P, and is represented by the vector ~T. For small values of α, we can approximate s(P, α) by the Taylor125
expansion around α = 0:126

s(P, α) = s(P, 0) + α
∂s(P, α)

∂α
+ O(α2) ≈ P + α~T (1)

As an example, if we allow for another transformation, such as a vertical translation, we would have a127
different trajectory along a one dimensional manifold with the corresponding tangent vector. Hence,128
two tangent vectors: ~Trot and ~TY−trans, will define a tangent plane, and we can construct a first order129
approximation to a change on the map/point P by both transformations as a new point on the tangent130
plane:131

s(P, α) ≈ P + αrot~Trot + αY−trans~TY−trans (2)

Generalizing with the above example, we denote the estimate of the forecasted map at a future132
time value τ + h as P̂τ+h, which is a function of the current map Pτ at time τ plus a point in the133
tangent plane spanned by the set of tangent vectors ~Tτdist. The tangent space

~Tτdist is defined by the list134
of distortions/transformations Listdist that we define in the following list:135

Listdist = { X/Y-translation, Thickening/Thinning, Rotation, Parallel Hyperbolic, Diagonal136
Hyperbolic }137

The parameter h allows for modeling the fact that the forecasting horizon might be different from138
the sampling rate. The forecast at horizon τ + h can be expressed as follows,139

P̂τ+h = α0P
τ + ∑

d∈Listdist
αd~T

τ
d (3)



Version June 8, 2018 submitted to Remote Sens. 6 of 25

A criterion for determining the value of the weights αd of equation 3 might be the minimization140
of the L2 norm of the error between the observation at τ + h, and the combination of the observation141
at τ, along with a linear combination of the components of the tangent space ~Tτdist, that is:142

{αd|d ∈ Listdist} ← argmin
αd

d∈Listdist

∥∥∥∥∥Pτ+h − α0Pτ + ∑
d∈Listdist

αd~T
τ
d

∥∥∥∥∥
2

(4)

Note that as the dimension of P is much higher than the number of parameters αd, the problem is143
well posed. The initial model of Equation 4 can be extended and improved, taking into account the144
fact that the ionization regions change slowly in time, and therefore we could use a set of previous145
maps {Pτ−1, · · · , Pτ−N} in order to give a better forecast. The tangent spaces of the previous maps146
are also computed, and are combined linearly with the set of previous maps. This gives rise to two147
possible strategies for the estimation of the forecast:148

a) For each past map Pτ−i, estimate the values of αd for each element of the tangent space by means of149
Equation 3, giving the partial estimate at τ + h from map i, P̂τ+hi . Afterwards the final estimation150
is done by a linear regression of each partial estimate.151

b) Compute the tangent spaces of each of the maps {Pτ−1, · · · , Pτ−N}, and do a linear regression152
using the N maps and the tangent space.153

Although a linear combination followed by another a linear combination is equivalent to a single154
linear combination, note that from the estimation point of view, the coefficients obtained by method155
a) are different from the ones obtained by b). In the preliminary experiments (done using data of156
the year 2014), we have found that although the estimation method a) allowed us to interpret the157
forecaster, and use tests of significance in order to asses the number of past maps relevant for the158
forecast. Nevertheless method b) gave a better performance in the RMSE sense. An additional insight159
that we obtained from a) was that the relevance of the previous snapshots for forecasting the future160
was not uniform along time, i.e., sometimes the most relevant snapshots were in the past few minutes,161
and in other cases the relevant snapshots were up to a few hours in the past.162
For methodological reasons, we used the data from year 2014 as training for determining the structure163
and algorithms, and data from year 2015 as an independent validation and contrast dataset, and finally164
data from year 2016 to characterize the performance of the new forecasting model, i.e. the results165
are derived from data not seen when computing the parameters of the model and when deciding166
its structure. This methodology was done in order to diminish the possible effect of overfitting and167
selection bias. In the preliminary experiments we tested different machine learning techniques [32].168
For selecting the forecasting algorithm we evaluated two experimental frameworks,169

a) Use a historical set of values (one year) in order to estimate the parameters of the forecasting170
technique. This method has the advantage that can be used with a large set of machine learning171
algorithms. As a drawback, leads to complicated models that have to take into account all172
possible features of the time evolution of maps. Most of the machine learning algorithms can173
be trained with this approach. In particular we evaluated linear regression, LASSO, clustering174
(k-means), CART and neural networks (MLP).175

b) Use only data from a limited number of maps prior to the current one. A drawback of this method176
is that it can only be used with regularized linear regression . This is because the other methods177
need a much higher number of examples. The advantage of this approach is that one can deal178
with the fact that, although the ionization pattern is similar over large regions, there is high179
variability of both, the shape, and morphology of the ionization regions in the time series of180
maps. The shape of the borders of the ionization regions changed slowly and the rate of change181
at different parts of the borders was not uniform. This justified both the introduction of the182
tangent space, that models the local changes, and the estimation of the coefficients of a linear183
regression with local data in order to select the relevant components.184



Version June 8, 2018 submitted to Remote Sens. 7 of 25

The preliminary experiments showed that the method a) produced a greater error than b). We185
discarded other methods such as: neural networks, SVM, CART, because of the infeasibility of training186
the models with the approach b).187

As the evolution of the region of highest ionization was slow in the TEC forecasting case, and188
the changes between different time epochs were concentrated at the borders of the regions of highest189
ionization, we decided to use a method that took into account the small distortions. This was done by190
computing the tangent vectors (also called the Lie derivatives) for different kinds of locally spatial191
distortions. As each tangent vector in the space of dimension 5112 can be represented as an image of192
71x72, the forecast consisted of a linear combination of past maps and their respective set of tangent193
vectors for a set of distortions (for geometrical and algebraic details see next subsections).194

3. Description of the Tangent Space method195

In this section, following [29], we will define the equations for computing each of the the tangent196
spaces of the list of distortions Listdist defined in section 2. A difference between the implementation197
for forecasting TEC maps and the one proposed in [29] for OCR, is that we did not smooth the finite198
difference approximation of the derivative. In the case of OCR, this smoothing is done by means199
of a 2D low pass filter and it is necessary in order to assure a smooth curvature of borders of the200
new template. In our case, we tested different smoothing techniques, such as linear low pass filters,201
and total variation smoothing, which resulted in a deterioration in the performance. Therefore, we202
approximated the derivative by a finite difference without smoothing: ∂s(P,α)

∂α
≈ δs(P,α)

δα
203

The finite difference is computed using second order central difference in the interior grid points204
of the map. At the boundaries of the map, the derivative was approximated by a first order difference205
between each border point (i.e TEC value) and the corresponding nearest inner grid point.206

That is, for the interior grid points of the map, the discrete approximation was computed as207
follows:208

∂ f (x, y)
∂x

≈
f (x + 1, y)− f (x− 1, y)

2
(5)

and209

∂ f (x, y)
∂y

≈
f (x, y + 1)− f (x, y− 1)

2
(6)

For the border points of the map, the discrete approximation was computed as:210

∂ f (x, y)
∂x

≈
f (x, y)− f (x− 1, y)

2
(7)

and211

∂ f (x, y)
∂y

≈
f (x, y)− f (x, y− 1)

2
(8)

We construct the tangent vector for each of the possible seven transformations:212
ListTrans f orms = { X-translation, Y-translation, Rotation, Parallel Hyperbolic transform, Diagonal213

Hyperbolic transform, Thickening and Thinning transform }214
We define all operations with reference the origin of coordinates at the center of the map, which215

in our case is: (71/2, 72/2), and the local perturbation for each distortion is denoted by α. In figure 4,216
we show the tangent spaces for a given map (upper left) observed at time stamp ’2016-02-21 13:30:00’217
(Year-Month-Day Hour:Minute:Second). The equations that define each of the directions that span the218
tangent space are the following:219

1. X/Y-translation:220



Version June 8, 2018 submitted to Remote Sens. 8 of 25

Figure 4. Components of the Tangent Space corresponding to a map observed at ’2016-02-21 13:30:00’

txα :

[
x
y

]
→
[

x + α
y

]
tyα :

[
x
y

]
→
[

x
y + α

]
(9)

The corresponding Lie operators are defined as: LX =
∂

∂x and LY =
∂

∂y221

2. Rotation by a small angle α:222

tRα :

[
x
y

]
→
[

x cos(α)− y sin(α)
x sin(α) + y cos(α)

]
(10)

The corresponding Lie operator is defined as: LR = y
∂

∂x − x
∂

∂y223

3. Parallel/Diagonal Hyperbolic transformation:224
The parallel hyperbolic transformation defines a shear transform (left), and the diagonal225
hyperbolic transformation (right) defines a squeeze mapping.226

tPα :

[
x
y

]
→
[

x + αx
y− αy

]
tDα :

[
x
y

]
→
[

x + αy
y + αx

]
(11)

The corresponding Lie operators are defined as:227

LP = x
∂

∂x − y
∂

∂y (parallel) and LD = y
∂

∂x + x
∂

∂y (diagonal)228
4. Thickening and Thinning transformation:229

tTα :

[
x
y

]
→
[

x + αrx
y + αry

]
where (rx, ry) =

∇ f (X)
‖∇ f (X)‖

(12)

The corresponding Lie operator is defined as: LT = ‖∇ f (X)‖ =
√
( ∂

∂x )
2 + ( ∂

∂y )
2230

5. Scaling transformation:231



Version June 8, 2018 submitted to Remote Sens. 9 of 25

tSα :

[
x
y

]
→
[

x + αx
y + αy

]
(13)

The corresponding Lie operator is defined as: LP = x
∂

∂x + y
∂

∂y232

3.1. Transformation of a map along the tangent directions233

The effect on a map of a small perturbation α in the direction of each of the components of234
the tangent space is summarized in figures 5, 6 and 7. Each figure presents two groups of maps,235
corresponding to two different directions in the tangent space. In Figure 5, we show the effect of236
moving the map, along the ’rotation’ direction (left group), and along the ’Thickening’ direction (right237
group). The left group of four maps show the original map (upper left), the tangent map for a small238
rotation of the map, and (lower) two reconstructed maps for opposite directions. The effect is moving239
the map either along the positive direction of the tangent space, i.e. P + 0.1~T rotates slightly the240
map clockwise, or along the negative direction anticlockwise. Note that a shift of value α = 0.1 in241
this case not only implies a noticeable rotation, but also increases the background level of ionization.242
Analogously, the tangent direction related with a thickening/thinning transformation (right), increases243
the area of the ionized region when added (thickening) P + 0.1~T, and reduces the area (thinning), when244
subtracted, i.e. P− 0.1~T. In Figure 6, we show the effect of a Scaling transform (left group), and a shift

Figure 5. Rotation Manifold (left group) and Thickening Manifold (right group) at ’2016-01-19 10:30:00’

245

in the vertical direction (right group). The effect of the scaling transform is a diagonal displacement of246
the ionized region, while the effect of the vertical shift is barely noticeable. This highlights that the247
size of the factor α can have different scales. In practice, as it can be seen for instance in Figure 9, the248
value of the weight of each dimension of the tangent space has different size, that is the value of α249
can take values in a wide range. While the terms related to rotation are small, the term related to the250
Y-translation is much higher. A value α = 0.1 gives rise to a clear rotation of the ionized area in Figure251
5, but the same value barely changes the map, as shown in Figure 6 (right). The case of a horizontal252
shift is analogous to the case of the vertical shift.253

In Figure 7, we show the effect of the hyperbolic (shear) transforms of the map, which accounts254
for diagonal deformations of the map. Note that in this case, the scale of the factor α, increases the255
background ionization level, while it models reasonably well the changes in the highly ionized region.256
This effect of changing the background ionized level will be taken into account in the forecasting model257
by introducing a bias term in the forecast, αIntercept.258



Version June 8, 2018 submitted to Remote Sens. 10 of 25

Figure 6. Scale transform (left group) and Y-translation (right group) at ’2016-01-19 10:30:00’

Figure 7. Diagonal Hyperbolic transform (left group) and Parallel Hyperbolic transform (right group)
at ’2016-01-19 10:30:00’

4. Model of the Forecaster259

4.1. Structure260

In this section, we present the model for the forecasting of the maps at a given horizon. This261
model is based on the ideas presented in section 2.262

In univariate time series (see, for instance, [33]), the forecast model sometimes consists in a linear263
combination of the past samples. In our case, the analogy will consist in a linear combination of264
the time series of the last N maps {Pτ−1,· · · , Pτ−N}, with the corresponding tangent spaces. In the265
selection of the past lags, we took into account the fact that the general patterns of ionization have a266
main periodicity of about one day. Thus, along with the maps inside a time window near the current267
observation, we selected a time window at approximately a time lag of about 24 hours prior to the268
current map. The problem of model selection and model estimation is well known in machine learning269



Version June 8, 2018 submitted to Remote Sens. 11 of 25

(see for instance [32], chapters 7 and 8). In the case of time series, it is a specially difficult problem, due270
to the correlation between samples and the presence of cyclical patterns of different origins and scales.271

For methodological reasons, we divided the data into three sets in order to decouple the process272
of selecting the structure and the parameters of the model. For each potential configuration of the273
forecasting model (i.e. set of lags for previous maps and tangent spaces), we defined the optimal set of274
delays and estimation algorithm during the training year, i.e. 2014, and validated the performance for275
the different configurations with the RMSE evaluated on data in year 2015. Finally, independent data276
from year 2016 was left for reporting the performance. The list of time horizons we use in this work is277
the following: τHorizon = {1/2h, 1h, 2h, 3h, 6h, 24h}278

The structures for the forecasting that were evaluated included different time lags prior to Pτ0 ,279
and time lags centered at multiples of 24 hours before Pτ0 . In addition, there was the possible inclusion280
of the tangent maps, with their possible combinations.281

An interesting result is that the best performance was obtained when using as delay lags multiples282
of the forecast horizon, and the inclusion of a neighborhood of Pτ0−24h.283

The general structure of the models for forecast at horizon h included the use of the list of delay284
lags τi summarized at Table 1.285

Table 1. List of time lags τi and weights α in the forecasting model. Note that the subindex ’d’, runs
along all the tangent spaces listed in Listdist

State Output Input 0 Input 1 Input 2 Input 3 Input 4 Input 5
Training τ0 τ0 − τh τ0 − 2τh τ0 − 3τh τ0 − 24h τ0 − τh − 24h τ0 − 2τh − 24h
Forecasting τ0 + τh τ0 τ0 − τh τ0 − 2τh τ0 + τh − 24h τ0 − 24h τ0 − τh − 24h
Weights α0, αd,0 α1, αd,1 α2, αd,2 α3, αd,3 α4, αd,4 α5, αd,5

In Figure 9, we plot the values of the estimated parameters α, for a forecasting horizon of
h = 1hour. This plot shows that the terms corresponding to the delay in the neighbourhood of Pτ0−24h

(i.e. one day) had a significant contribution. This effect was much lower when the delay lag was 48
hours, which we decided not to include because the use of this delay did not improve the performance
on the validation database (i.e. year 2015), and increased significantly the complexity of the model.
Another effect that consistently appeared in most of the experiments was that most of the contribution
to the forecast came from the current map, along with its tangent space, and the forecasting power
of greater lags diminished quickly. Thus, the context for forecast is limited to τ0 − 2τh. Also in order
to model the fact that there might be a global change of the ionization, we introduced an intercept
αIntercept. The forecasting was done by means of the following formula,

P̂τ+h = αIntercept + ∑
L∈ListLags

αLP
L + ∑

d∈Listdist
∑

L∈ListLags

αd,L~T
L
d (14)

The set of elements of the tangent space are summarized in Listdist, and explained in detail at the286
subsection 3.287

4.2. Parameter Estimation288

In this subsection we will argue the criteria to select of the estimation algorithm for the model289
presented in equation 14. The model consists of a linear combination of maps, weighted by the290
coefficients αL and αd,L, which can be estimated with different criteria. That is we will set a structure of291
delays, and the values of the coefficients α, will be determined at each forecasting step by minimizing a292
cost function, and therefore making the forecast robust with respect to the solar maximum/minimum293
conditions. In analogy to equation 4, we will minimize the forecast error with some restrictions on294
the possible weights. Note that the estimation of the parameters is done using only the near past295
of the map Pτ0 at time τ0. Specifically, in order to estimate the parameters of the model we used as296



Version June 8, 2018 submitted to Remote Sens. 12 of 25

time indices the row ’Training’ at Table 1, and the forecast was done using the time indices at the297
’Forecasting’ row. Note that in the same table, in the lower row, we define the notation of the weights298
associated with each delay.299

The use of only the last few samples (i.e. just the samples in the row ’Training’ of Table 1) for300
the estimation of the weights is justified by the empirical fact that the performance of the forecaster,301
exhibited a better RMSE. When the estimation of the parameters (i.e. the training) is done using the302
whole year the resulting performance was significantly worse. The explanation is that the local (in the303
temporal sense) variation of the maps, has a greater contribution to the relative weighting of the past304
samples and tangent space than a fixed set of weight computed from a long time series.305

A drawback of using a small set of samples for the estimation of the parameters is that the system306
of equations might be underdetermined and will suffer of problems of collinearity. Therefore in order307
to deal with this problem, the criterion for the estimation of the parameters will have a regularization308
term. This regularization term consists on a penalization of the norm of the weights. In case of using309
norm L2 the method is known as Ridge Regression, and the case of using norm L1 the method is310
known as LASSO (see for instance [32] chapter 3). The difference between both norms is that the Ridge311
Regression introduces a constant λ in the diagonal of the covariance matrix which results in a uniform312
decrease in the value of the estimated parameters, while in the LASSO algorithm the parameter λ313
determines the level of sparsity, i.e. the number of parameters with a value equal to zero.314

The optimization criterion is presented in equation 15, where the regularization term
∥∥αd, αd,L∥∥Li315

corresponds to Ridge Regression when Li = L2, and LASSO when Li = L1. We also considered316
the use of norm L1 in the error term, i.e.

∥∥∥Pτ+h − P̂τ+hi ∥∥∥L1. This norm penalizes small values of317
the error, and the influence of the outliers on the estimated weights is small. In our problem at318
hand, the use of this norm on the error term, gave a much higher proportion of maps with at least319
a negative values of TEC. Therefore we selected L2 as norm for the error term, giving the following320
cost function. In the implementation done in this work, the results are presented using the Ridge321
Regression regularization, and the λ was selected by cross-validation on the data from the year 2014.322
The difference in performance obtained from using Ridge Regression or LASSO was negligible, and323
the Ridge Regression was selected because the running time was faster.324

{αd, αd,L} ← argmin
αd ,αd,L

∥∥∥Pτ+h − P̂τ+hi ∥∥∥L2 + λ ∥∥αd, αd,L∥∥Li (15)
A typical example is shown in Figure 8 we present the forecast at a horizon of 3 hours, at two different325
time stamps, i.e. at 2016-05-12 15:15:00 (left) and 2016-02-21 13:15:00 (right). For comparison purposes326
in Figures 1 and 2 we show an example of the performance when using a DCT forecast in the same327
conditions. The benchmark that we will follow for determining the performance of the system will328
be the use frozen maps, which we define as the prediction made with the current map keeping its329
VTEC values constant in a Sun-fixed reference frame, i.e. considering local-time / latitude coordinates.330
The RMSE ratio between the forecast, and using a frozen map as forecast was of 76%, which as can be331
seen in Figure 12 is about the mode of the histogram of ratios of the RMSE. The weights associated332
with the estimate are shown in Figure 9. Note the presence of a positive intercept or bias αIntercept,333
which models both, the contribution of the background ionization of the different elements that are334
combined linearly, and that the possible increase of the background ionization. In addition note that335
the main contribution to the forecast, come from the current map, with a strong negative component336
of a vertical deviation. The third most important contribution to the forecast is related to the map at337
τ0 + τh − 24h, with it’s tangent space long the vertical direction. On the other hand the contribution of338
the maps at 1 and 2 hours in this case is marginal.339

The forecast map VectPred (lower right) is much smoother than either the current map Pnow or the340
target map PFuture. In addition the distribution of the error reproduces the observation that the borders341
of the ionized region accumulate most of the error, in this case in part of the border the error reaches a342
maximum of 9.5 TECUs.343



Version June 8, 2018 submitted to Remote Sens. 13 of 25

Figure 8. Forecasting at a horizon of 3 hours (Tangent space method), at time stamps, 2016-05-12
15:15:00(left group) and 2016-02-21 13:15:00 (right group). For each group we plot, current map (Pnow
upper left), target map (PFuture, upper right), Prediction error (lower left), and Forecast (VectPred lower
right).

The forecasted TEC values were always positive (in the train and validation years), except for344
a small fraction of cases in the 30 minutes and 1 hour forecast. In the case of the forecast at 1hour,345
there were only 123 maps that had at least one negative pixel, of a total of 34536 (i.e a whole year).346
In this case, the negative values, can be substituted by the values of the Frozen prediction at the347
latitude/longitude where the forecast was negative.348

5. Results349

In this section we will summarize the performance of the forecast system based on the tangent350
spaces. The first results consist in the comparison of the error in the sense of total TEC RMSE (i.e. the351
mean value for all the pixels of the map). We compare the forecast by using tangent spaces (which352
we denote as tangent space method) with a forecast created considering no changes in the map in a353
mostly Sun-fixed reference frame (local-time vs latitude),which we denote as frozen map method.354

Given a time series of Nτ maps, for the map at time τ consisting of the TECU value xτlon,lat and355
the estimated values x̂τlon,lat the RMSE was computed as:356

RMSE =

√√√√ 1
Nlat × Nlon

Nlat

∑
lat=1

Nlon

∑
lon=1

(xτlon,lat − x̂
τ
lon,lat)

2 (16)

In Figure 10 we shown a comparison of the forecast RMSE time series for the tangent space357
method with the frozen map method during an interval of 10 days during the month of March 2016.358
In the figure the comparison between methods has been done for horizons of 30 minutes, 1 hour, 3359
hours and 1 day. The RMSE time series for the tangent space method (red), is systematically below360
the frozen method (blue) for the cases of 30 min, 1 hour and 3 hours, with periodicity of the error of361
about a day. In the case of the horizon at 1 day, the forecasting error is the same for both methods.362
The RMSE results are computed as a mean over all the map, and as mentioned in section 2, the main363
contribution to the error originates from the borders of highly ionized regions. Therefore the TEC364
values presented in this subsection are an average between low error regions and these borders. The365



Version June 8, 2018 submitted to Remote Sens. 14 of 25

Figure 9. Weights for a one hour forecast at time ’2016-02-21 13:15:00’. The term dPdistTime, indicates
the tangent space ∂s(P,αdist)

∂αdist
= ~Tτdist and the corresponding time lag.



Version June 8, 2018 submitted to Remote Sens. 15 of 25

result is representative of the general behaviour of the algorithm, and is compatible with the results366
averaged over an entire year, as shown in Table 2.367

Figure 10. Time evolution of the TEC RMSE, for the case of forecast with the tangent space method
(red), and frozen map method (blue) for different horizons (see annotation on the upper part of the
figures )

In Figure 11 we present the boxplots (see [34]) of the forecast errors for different horizons,368
computed for a whole year. One can see that in all cases, except for 1 day, the forecasting error in369
terms of forecast RMSE obtained by tangent space method was better than using a frozen map. The370
proportion between of improvement is summarized in Table 2. The improvement not only refers to the371
median value, but also to the range of the errors between the external whiskers (defined as the range372
between the quartile Q1 (i.e. the percentile 25%) less 1.5 times the interquartile range, i.e. the difference373
between Q3 (i.e. the percentile 25%) and Q1, that is, the first datum greater than Q1− 1.5 ∗ (Q3−Q1)374
and the other extreme is given by the last datum less than Q3 + 1.5 ∗ IQR). As can be seen in the375
figures, the dispersion around the mean corresponding to the tangent space method is lower, in the376
senses that encloses a smaller margin, and a also in the sense that systematically has a lower value.377
Another feature is the lower prevalence of high values of the outliers in the case of the tangent space378
method.379

Figure 11. Box plot of the TEC RMSE, for the case of forecast with frozen value (left) and the tangent
space (right), for each horizon (see the tick labels of each figure )



Version June 8, 2018 submitted to Remote Sens. 16 of 25

Table 2. Ratio of the RMSE between tangent space forecast and frozen maps wrt actual maps for
different horizons.

Horizon 1/2h 1h 2h 3h 6h 24h
Ratio 84.99 % 77.65% 71.35% 69.34 % 87.23 % 95.76%

In Table 2, we show the ratio of the root mean square error (RMSE), of the tangent space method vs380
the frozen map method. The RMSE in this case is computed as a mean over the Nτ , maps corresponding381
to a year, where each forecast is made every 15 minutes. The RMSE was computed as follows:382

RMSE =

√√√√ 1
Nτ × Nlat × Nlon

Nτ

∑
τ=1

Nlat

∑
lat=1

Nlon

∑
lon=1

(xτlon,lat − x̂
τ
lon,lat)

2 (17)

From the table it can be seen that in all cases the ratio of forecast RMSE is below 100%, that is the383
tangent space method gives a lower RMSE forecast in mean. In Figure 12 we show the histograms of384
the ratio for a time interval of 42 days. Note that the maxima of the histograms coincide approximately385
with the mean values shown in Table 2, which is due to the low variance and skewness of the386
histograms. Note also that as the coefficients of the tangent space forecaster are computed for each387
forecast, the results performance of the method does is not biased by the solar cycle, that is, we have388
seen empirically that the total RMSE is proportional to the underlying mean TEC. Thus although the389
tangent space method is better than freezing, the RMSE will also depend on the solar cycle conditions.390

391

The results for different horizons show a performance that follows a convex shape, with a392
minimum error at a 3 hours horizon. In particular the performance at 1/2 hour and at 6 hours, has393
a mean value of about 85%, which worse than at horizons of {1, 2, 3}hours. In the case of 1/2 hour394
this is due to the fact that the rate of change of the state of the ionosphere is slow, and at this horizon395
there is small room for improvement in the forecast. This small change of the state of the ionosphere396
is reflected in the fact that the RMSE due to freezing is in mean about 2 TEC, which is lower than at397
other forecasting horizons as seen in Figure 10. Interestingly in the histogram shown in Figure 12,398
the number of samples with error greater than 100% is much higher than in the other cases and also399
the upper values are much higher, this is accounted by the fact that the histogram is a ratio between400
numbers that can be small.401

A trend that can be seen in Figure 12 and in the boxplots, is that the spread of the forecast errors402
errors increases as a function of the horizon. Nevertheless note that as reflected in Figure 12, the403
tangent space forecast for intermediate horizons gives a lower limit of the % of error, and the number404
of samples for an error greater than 100% is much lower. Which indicates that the quality of the tangent405
space forecaster in the sense of total RMSE is better than in the case of freezing, in all the horizons406
except 24 hours.407

On the other hand, at a horizon of 6 hours the performance degrades, being comparable to the408
performance at 1/2 hour, which indicates that the hypothesis of small changes in the tangent space409
(see section 3.1), begins to not be entirely valid. And Finally at a horizon of 24 hours, the performance410
does not differ much from freezing the maps, which indicates both, that the hypothesis underlying411
the model of tangent spaces does not hold, and that also that a simple linear combination of past412
observations is not enough for modeling a TEC map at a day’s horizon. The forecast by means of413
the tangent space is slightly better than just freezing the last observation, Figure 12 shows that the414
ratio between the performances of the two systems has a shape similar to a Gaussian, with a mean at415
95%, with a standard deviation nearly 10%. On the other hand the boxplots in Figure 11 (left), show a416
median RMSE of 5 TECUs, which might not be acceptable. Note that although we have found that the417
component at 24 hours is relevant for the forecast at short term horizons, it does not seem adequate418



Version June 8, 2018 submitted to Remote Sens. 17 of 25

Figure 12. Histogram of the forecast RMSE ratio between the tangent space method, and a frozen map
method. Upper left horizon at 30 min, upper right horizon at 1h lower left horizon at 3h and lower
right horizon at 24h. From 2016-01-10 to 2016-02-21, a total of 4080 maps.

for a forecasting at such a long horizon. That is, for short-term predictions, the maps at 24 hours in419
advance complements the information from the last observation and helps to improve the forecast by420
making use of the periodicity of the ionization patters. On the other hand, when the horizon is directly421
24 hours, the information yielded by the last observation is not enough for a good forecast.422

For comparison purposes, in Figure 13, we show the time evolution of the RMSE in TECUs for a423
whole year and a different forecast horizon (3 hours). The figure consists on the superposition of the424
instantaneous RMSE and the low pass filtered (zero phase, moving average with a cut off frequency425
of 1/(0.5month)) time series. The shape of the temporal evolution of the RMSE over a whole year is426
similar for the other forecast horizons. The first feature that we notice is a seasonal component with427
a maximum activity at spring and autumn and a superposed a cyclic component with a period of428
28 days. In the case of the forecast by means of the tangent space model, the difference between the429
maximum and minimum of the low pass filtered version is of 1.5 TECUs, with a mean value in spring430
of about 3.5 TECUs, in summer of 2 and in winter of 2.5 TECUs. The variability of the error is much431



Version June 8, 2018 submitted to Remote Sens. 18 of 25

lower in summer. The variability is much higher than would be expected in the case of a Gaussian432
distribution (see Section 5.4), with local peaks over 6 TECUs occurring only certain moments in 14433
days of the time series. A test was done with the years 2014− 2015, where the activity was higher, and434
the results were analogous, with a systematic increase of the low pass filtered RMSE of 1 TECUs. Note435
that, from a methodological point of view (of machine learning), this analogy is merely indicative,436
because these years were used for determining the structure of the forecaster.

Figure 13. Time evolution during a whole year of the total RMSE in TECUs for a horizon of 3 hours.
Left, the frozen forecast, in red the time series low pass filtered. Right the forcast by means of the
tangent space method.

437

5.1. Improvement on the forecast due to the use of the tangent space and comparison with the DCT forecasting438
method439

In this section, we compare the proposed approach with a forecasting system that does not use440
tangent spaces but just the original VTEC maps (labelled Maps Only) and with one based on the DCT441
(DCT method). In both cases, the number of free parameters of these models is lower than that in the442
tangent model, which means that the comparison is not in equal terms. On the other hand, a possibility443
of doing this comparison with an equal number of degrees of freedom would be to use a number of444
maps equal to the number of elements in the tangent map. In this case, either if we took maps further445
in the past, which are increasingly different from the map to be forecasted, or if we increased the446
number of recent maps, highly correlated inputs are given and therefore we have a badly conditioned447
problem. The improvement due to the use of the tangent spaces, is shown in Table 3. The result is448
that the use of the tangent space coefficients improves the forecast result in all horizons, except for449
24h. In all cases (except for the horizon of 24h) the use of tangent space improves the results to the450
DCT method. The 24h case is explained by the fact that the tangent spaces model local distortions,451
which do not account for the changes at such a long range. Note that the confidence margins (standard452
deviations) are not shown, because using 34626 maps for computing the mean values of the RMSE453
gave extremely small values.454

455

5.2. Performance as a function of the latitude456

Next we analyze the performance of the algorithm as a function of the latitude. We analyzed the457
whole year 2016 and we set a horizon of 1 hour, with a total of 34626 maps. Note that the test year458
is different from the years used for determining and validating the structure of the forecaster. For459



Version June 8, 2018 submitted to Remote Sens. 19 of 25

Table 3. Improvement Ratio of the RMSE between tangent space forecast and frozen maps when using
the tangent space forecaster vs the case of not using the tangent space of each of the maps.

Horizon 1/2h 1h 2h 3h 6h 24h
Ratio Tang Space method 84.99 % 77.65 % 71.35% 69.34 % 87.23 % 95.76%
Ratio using Maps only 89.08 % 80.90 % 76.95 % 73.07 % 91.45 % 94.08%
Ratio DCT Method 87.75 % 78.25 % 74.38 % 71.21 % 88.94 % 89.11%

presenting the results we have selected a horizon of 1 hour, in order to show the performance in a460
situation between the best and the worst case.461

The RMSE as a function of the latitude is defined as;

RMSE(lat) =

√√√√ 1
Nτ × Nlon

Nτ

∑
τ=1

Nlon

∑
lon=1

(xτlon,lat − x̂
τ
lon,lat)

2 (18)

where xτlon,lat at the begining of Section 5. In Figure 14, we can compare, for each latitude the mean462
value of the RMSE in TECUs of the tangent space method vs. the frozen map method. The results of463
the tangent space method (left) systematically give a lower value of RMS compared with the frozen464
map method (right) for all the latitudes, with the most significant improvement between 30 degrees465
north and 30 degrees south. With a maximum difference of about 1 TECU for the both maxima, i.e. 8466
degrees north, and 20 degrees south. On the other hand for latitudes over 50 degrees (north or south),467
the performance of both methods is similar, due to the fact that ionization activity at these latitudes is468
much lower than near the equator, and in both cases the RMSE is about 1 TECU. At the equator there469
is a dip in the RMSE profile. Here the tangent distance forecast is better by 0.5 TECUs. The fact that470
most of the forecast error is located around ±30 degrees and the shape of the profile, can be explained471
from the spacial distribution of the forecast error, that tends to be located at the margins of the ionized472
zone as was shown in Figure 8. The distribution of the error on the map also explains the dip on the473
forecasting error at the equator. In Figure 15 we show the profiles of the Root Mean Square of the474
values in TECUs, for the whole year 2016 (left) and the ratio of RMSE the tangent space method to the475
frozen map method (right) also for the year 2016. In both cases we present the results as a function of476
the latitude. In In Figure 15 (left), the mean TECU values are concentrated around the equator, with477
a mean value of for the case of latitudes near the equator of about 25 TECUs, and decreasing as the478
latitudes get near the poles. Note that a first comparison with Figure 14, tells us that the forecasting479
error in mean is about 10%. This last fact, should be nuanced with the fact that the forecast error is480
not uniform on the map, but distributed on the borders of the ionized part of the map. In Figure481
15 (right) the ratio of the tangent distance forecast to the frozen map, shows two minima, located at482
(9-20) degrees north and (13-25) degrees south, which is about 75%, which indicates that the use of the483
tangent distance forecast produces a reduction of a 25% in mean on the forecast error, in the regions484
of higher ionization. That is the best improvement, is given at two crests of the Appleton-Hartree485
anomaly, side by side of the equator. Therefore the tangent distance method is capable of modelling486
regions with high TEC gradients. Note that as the coefficients α of the forecaster are re-estimated for487
each prediction, which means that the movements of the anomaly can be tracked on real time. The488
forecast improvement at the regions near the pole is lower, but this can be explained because these489
are regions of lower activity and show a smaller rate of change. This figure hints at the possibility of490
designing a performance index that might assign a different penalization to the errors depending on491
the level of activity of related to the latitude.492

5.3. Bias Variance decomposition of the forecast error493

Next we analyze the Bias Variance decomposition of the forecast error, which we define as follows:494
For given a map P and the forecasted map P̂, the error can be decomposed as:495



Version June 8, 2018 submitted to Remote Sens. 20 of 25

Figure 14. RMSE of tangent space method (left) vs. RMSE of frozen map method (right) as a function
of the latitude.

E
[(

P− P̂
)2]

= Bias[P̂]2 + Var[P̂] (19)

where each term is defined as:496

Bias[P̂] = E
[
P− P̂

]
(20)

and497

Var[P̂] = E
[
P̂2
]
− E

[
P̂− P

]2
(21)



Version June 8, 2018 submitted to Remote Sens. 21 of 25

Figure 15. Root Mean Square in TECUs as function of the latitude (left). Ratio of RMSE the Tangent
Distance Forecast Error to the Frozen forecast error (right).

Figure 16, shows the analysis of the contribution to the error of the Var[P̂] (left in TECUs2) and the498
Bias[P̂]2 (right in TECUs2) as a function of the latitude. The variance of the forecast near the equator is499
of about 12 TECUs, which can be explained by the fact that the main contribution to the error appear500
concentrated at the borders of the ionized regions, and the variation of this moves in this regions. As it501
can be seen for instance in Figure 8, the high error values occupy a small part of the map, localized at502
the edges of the high ionization region. The value of these peaks can reach the order of 9 TECUS, while503
the error in the inner parts is much lower, of the order of 1 TECU. Therefore, the observed variance504
should not be understood as the variance of a Gaussian distribution, but as the variance of a bimodal505
distribution.506



Version June 8, 2018 submitted to Remote Sens. 22 of 25

On the other hand, the forecast system is almost unbiased (see Figure 16 right), the contribution507
of the bias to the total error is always less than 0.1%. Note that the figures have a different scale.508
The explanation of the low bias of the tangent distance forecast error is associated with the most509
effective set of parameters describing the degrees of freedom of the system. Note that in Section 4.2, we510
comment how we dealt with the fact that the estimation of the parameters α might be undetermined.511

Figure 16. Decomposition of the forecast error variance ’Var[ f̂ (x)] (left) vs Bias Bias[ f̂ (x)]2 (right).
Note that the units are TECUs2

5.4. Histogram of the forecast error512

The histogram of the forecast error in TECUs is shown in Figure 17. The histogram is computed513
for all the pixels of the 34626 maps, which gives a number of samples greater than 166 million, that is514
the size of the map times the number of maps,i.e. 72x72x34626. In particular, the high error values are515



Version June 8, 2018 submitted to Remote Sens. 23 of 25

Table 4. Empirical fraction of values greater than a TECU value .

TECU 2 4 6 8 10 12
Prob (τ > TECU ) 1.95× 10−01 1.48× 10−02 9.84× 10−04 1.21× 10−04 2.81× 10−05 8.16× 10−06

located at the borders of the highly ionized regions, and account for the tails of the error histogram. In516
the log frequency histogram we can see that the distribution follows approximately a line, and can be517
described by :518

log10(TECU = t) = −1.27t + 1.04, with a p-value less than 1.e−87. This empirical distribution can
be approximated by a Laplace distribution (with λ = 0.78):

fTECU(TECU = t) ∝ e
−1.27t (22)

The linear law fails for values of RMSE greater than 10 TECUs, which is explained by the fact that519
there are extremely few examples of errors greater than this value. The linear approximation also fails520
values of RMSE at lower end, that is < 0.75 TEC values. The empirical cumulative fraction of errors

Figure 17. Normalized Log frequency histogram of the forecasting RMSE.

521

greater than a given TECU value are presented in Table 4. Interestingly, the accumulated probability522
diminishes very fast, and Prob(τ > 4TECUs) is lower than 1 in 65 pixels, and Prob(τ > 8TECUs) is523
lower than 1 in 8000 pixels. However, as explained in Section 5.3, the extreme values of the errors are524
isolated in the borders of the highly ionized regions.525

526

6. Conclusions527

In this paper, we have presented a forecasting method for TEC maps, based on local information528
that model possible local distortions. In addition to using several previous maps to make the prediction,529
we make a decomposition in the space spanned by the components in tangent manifold to each maps.530
The physical justification, is that the change at horizons less than 6 hours will consist of small changes531
along the trajectory that is followed by the sequence. The performance has been acceptable for forecast532
horizons up to 6 hours. For a horizon at 24 hours, the performance does not differ much from freezing533
the maps, which indicates both, that the hypothesis underlying the model of tangent spaces does not534
hold up to this time horizon, and that also that a simple linear combination of past observations is535
not enough for modeling a TEC map at a day’s horizon. This is explained because at this horizon, the536
changes in ionization have external origins that cannot be derived from the time series.537



Version June 8, 2018 submitted to Remote Sens. 24 of 25

Author Contributions: Methodology, E.M.M., A.G.R, M.H.P. and H.Y.; Software, E.M.M. and A.G.R; Validation,538
E.M.M., A.G.R, M.H.P. and H.Y.; Formal Analysis, E.M.M., A.G.R, M.H.P. and H.Y.; Data Curation, A.G.R;539
Writing—Review & Editing, E.M.M. and A.G.R.540

Funding: This research was funded by the project TEC2015-69266-P (MINECO/FEDER, UE).541

Acknowledgments: The authors are also grateful to the International GNSS Service (IGS; [36]) for providing542
GNSS open-data and ionospheric open-products.543

Conflicts of Interest: The authors declare no conflict of interest.544

References545

1. García Rigo, A., Monte Moreno,E., Hernández Pajares,M., Juan,J. M., Sanz,J., Aragón Angel,A. and Salazar,D.546
Global prediction of the vertical total electron content of the ionosphere based on GPS data. Radio science 46,547
no. 6. 2011548

2. Béniguel, Yannick, Iurii Cherniak, Alberto Garcia-Rigo, Pierrick Hamel, Manuel Hernández-Pajares, Roland549
Kameni, Anton Kashcheyev et al. MONITOR Ionospheric Network: two case studies on scintillation and550
electron content variability. Annales Geophysicae, vol. 35, no. 3, p. 377. Copernicus GmbH, 2017.551

3. Silvestrin, Pierluiggi, Michael Berger, Yann Kerr, and Jordi Font. ESAs second earth explorer opportunity552
mission: The soil moisture and ocean salinity mission-SMOS. IEEE Geoscience and Remote Sensing Newsletter553
118 (2001): 11-14.554

4. García-Rigo, A., D. Roma-Dollase, M. Hernández-Pajares, H. Lyu, Z. Li, N. Wang, M. Terkildsen et al.555
Contributions to real time and near real time Ionosphere Monitoring by IAGs RTIM-WG. IAG-IASPEI Joint556
Scientific Assembly. 2017.557

5. Status of the IGS ionosphere products and future developments. In IGS Analysis Center Workshop (2008)558
6. Schaer, S., and Société helvétique des sciences naturelles. Commission géodésique. Mapping and predicting559

the Earth’s ionosphere using the Global Positioning System. Institut fur Geodesie und Photogrammetrie, Eidg.560
Technische Hochschule Zürich. (Vol. 59)561

7. Cander, Lj R., M. M. Milosavljevic, S. S. Stankovic, and S. Tomasevic. Ionospheric forecasting technique by562
artificial neural network. Electronics Letters 34, no. 16 (1998): 1573-1574.563

8. Francis, N. M., P. S. Cannon, A. G. Brown, and D. S. Broomhead. Nonlinear prediction of the ionospheric564
parameter foF2 on hourly, daily, and monthly timescales. Journal of Geophysical Research: Space Physics 105,565
no. A6 (2000): 12839-12849.566

9. Tulunay, Ersin, Erdem Turker Senalp, Sandro Maria Radicella, and Yurdanur Tulunay. Forecasting total567
electron content maps by neural network technique. Radio science 41, no. 4 (2006).568

10. Muhtarov, Plamen, and Ivan Kutiev. Autocorrelation method for temporal interpolation and short term569
prediction of ionospheric data. Radio Science 34, no. 2 (1999): 459-464.570

11. Dick, M. I., M. F. Levy, L. R. Cander, I. Kutiev, and P. Muhtarov. Short-term ionospheric forecasting over571
Europe. IEE National Conference on Antennas and Propagation, 1999. pp. 105-107. IET, 1999.572

12. Stanislawska, Iwona, and Zbigniew Zbyszynski. Forecasting of the ionospheric quiet and disturbed foF2573
values at a single location. Radio Science 36, no. 5 (2001): 1065-1071.574

13. Muhtarov, P., I. Kutiev, Lj R. Cander, B. Zolesi, G. de Franceschi, M. Levy, and M. Dick. European ionospheric575
forecast and mapping. Physics and Chemistry of the Earth, Part C: Solar, Terrestrial and Planetary Science 26, no.576
5 (2001): 347-351.577

14. Krankowski, Andrzej, Nadegda P. Sergeenko, Lubomir W. Baran, Irk I. Shagimuratov, and Marina V. Rogova.578
The short-term forecasting of the total electron content.Artificial Satellites 40 (2005): 137-146.579

15. Hernández-Pajares, M., Juan, J. M., and Sanz, J. New approaches in global ionospheric determination using580
ground GPS data. Journal of Atmospheric and Solar-Terrestrial Physics, 61(16), 1237-1247.581

16. Orús, R., Hernández-Pajares, M., Juan, J. M., and Sanz, J. Improvement of global ionospheric VTEC maps by582
using kriging interpolation technique. Journal of Atmospheric and Solar-Terrestrial Physics, 67(16), 1598-1609.583

17. Orús, R., Hernández-Pajares, M., Juan, J. M., Sanz, J., and García-Fernández, M. Performance of different584
TEC models to provide GPS ionospheric corrections. Journal of Atmospheric and Solar-Terrestrial Physics, 64(18),585
2055-2062586



Version June 8, 2018 submitted to Remote Sens. 25 of 25

18. Hernández Pajares, M., Juan, J. M., Sanz, J., and Colombo, O. L. Application of ionospheric tomography to587
real time GPS carrier phase ambiguities resolution, at scales of 400 - 1000 km and with high geomagnetic588
activity. Geophysical Research Letters, 27(13), 2009-2012.589

19. Roma-Dollase, David, Manuel Hernández-Pajares, Andrzej Krankowski, Kacper Kotulak, Reza590
Ghoddousi-Fard, Yunbin Yuan, Zishen Li et al. Consistency of seven different GNSS globl ionospheric591
mpping techniques during one solr cycle. Journal of Geodesy (2017): 1-16.592

20. García Rigo, A. (2012). Contributions to ionospheric determination with global positioning system: solar593
flare detection and prediction of global maps of total electron content. PhD Thesis, UPC594

21. Hernández−Pajares, M., J. M. Juan Zornoza, J. Sanz Subirana, R. Farnworth, and S. Soley.(2011) EGNOS Test595
Bed Ionospheric Corrections Under the October and November 2003 Storms, IEEE Transactions On Geoscience596
And Remote Sensing, VOL. 43,NO. 10, OCTOBER 2005."597

22. Venkateswarlu, G., and Sarma, A. D. (2017). A New Technique Based on Grey Model for Forecasting of598
Ionospheric GPS Signal Delay Using GAGAN Data. Progress In Electromagnetics Research, 59, 33-43.599

23. Huang, Z., Li, Q. B., and Yuan, H. (2015). Forecasting of ionospheric vertical TEC 1-h ahead using a genetic600
algorithm and neural network. Advances in Space Research, 55(7), 1775-1783.601

24. Meng, X., Mannucci, A. J., Verkhoglyadova, O. P., and Tsurutani, B. T. (2016). On forecasting ionospheric602
total electron content responses to high-speed solar wind streams. Journal of Space Weather and Space Climate,603
6, A19.604

25. Feltens, J., M. Angling, N. Jackson-Booth, N. Jakowski, M. Hoque, M. Hernández Pajares, A. Aragón Angel, R.605
Orús, and R. Zandbergen. Comparative testing of four ionospheric models driven with GPS measurements.606
Radio Science 46, no. 6 (2011).607

26. Hernández-Pajarez, Manuel, David Roma Dollase, Andrzej Krankowski, Alberto García Rigo, and Raul608
Orús Pérez Comparing performances of seven different global VTEC ionospheric models in the IGS context.609
International GNSS Service Workshop (IGS 2016): Sydney, Australia february 8-12, 2016, pp. 1-13. International610
GNSS Service (IGS), 2016.611

27. Gonzalez, R. C., and Woods, R. E (2008). Digital image processing. Addison-Welsley612
28. Simard, P., LeCun, Y. and Denker, J.S., (1993). Efficient pattern recognition using a new transformation613

distance. Advances in neural information processing systems, pp. 50-58.614
29. Simard, P., LeCun, Y., Denker, J., and Victorri, B. (1998). Transformation invariance in pattern recognition615

tangent distance and tangent propagation. Neural networks: tricks of the trade, pp. 549-550.616
30. Hastie, T. and Simard, P (1995). Learning prototype models for tangent distance. Advances in neural617

information processing systems , pp. 999-1006.618
31. Goodfellow, I., Bengio, Y., and Courville, A. (2016). Deep learning (adaptive computation and machine619

learning series). Adaptive Computation and Machine Learning series, 800.620
32. Friedman, J., Hastie, T. and Tibshirani, R. (2001). The elements of statistical learning. Springer series in621

statistics., 800.622
33. Mills, Terence C (1991). Time series techniques for economists. Cambridge University Press623
34. (2018), Matplotlib documentation, Available from: https://matplotlib.org/api/_as_gen/matplotlib.pyplot.624

boxplot.html (Accessed 1 Februrary 2018)625
35. Lyu, Haixia, Manuel Hernández-Pajares, Metin Nohutcu, Alberto Garcá-Rigo, Hongping Zhang, and Jingnan626

Liu. The Barcelona Ionospheric Mapping Function (BIMF) and its application to northern mid-latitudes.627
GPS Solutions 22 (2018): 1-13.628

36. Dow, J. M., Neilan, R., and Rizos, C.: The international GNSS service in a changing landscape of global629
navigation satellite systems, Journal of Geodesy, 83, 191–198, 2009.630

c© 2018 by the authors. Submitted to Remote Sens. for possible open access publication631
under the terms and conditions of the Creative Commons Attribution (CC BY) license632
(http://creativecommons.org/licenses/by/4.0/).633

https://matplotlib.org/api/_as_gen/matplotlib.pyplot.boxplot.html
https://matplotlib.org/api/_as_gen/matplotlib.pyplot.boxplot.html
https://matplotlib.org/api/_as_gen/matplotlib.pyplot.boxplot.html
http://creativecommons.org/licenses/by/4.0/.

	Introduction
	Justification of the method
	Description of the Tangent Space method
	Transformation of a map along the tangent directions

	Model of the Forecaster
	Structure
	Parameter Estimation

	Results
	Improvement on the forecast due to the use of the tangent space and comparison with the DCT forecasting method
	Performance as a function of the latitude
	Bias Variance decomposition of the forecast error
	Histogram of the forecast error

	Conclusions
	References

