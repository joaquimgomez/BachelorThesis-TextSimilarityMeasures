


























































On the use of binary partition trees for the tree crown

segmentation of tropical rainforest hyperspectral images

G. Tochona,b,, J.B. Féretb,c,, S. Valeroc, R.E. Martinb, D.E. Knappb,
P. Salembierd, J. Chanussota,e, G.P. Asnerb

aGIPSA-Lab, 11 rue des Mathématiques, 38400 Saint Martin d’Hères, France.
bDepartment of Global Ecology, Carnegie Institution for Science, 260 Panama Street,

Stanford, CA 94305, USA.
cCESBIO, 18 avenue Edouard Belin, 31400 Toulouse, France.

dTechnical University of Catalonia (UPC), Jordi Girona 1-3, edifici D5, 08034 Barcelona,
Spain.

eFaculty of Electrical and Computer Engineering, University of Iceland, Reykjav́ık, Iceland.

Abstract

The segmentation of remotely sensed images acquired over tropical forests

is of great interest for numerous ecological applications, such as forest in-

ventories or conservation and management of ecosystems, for which species

classification techniques and estimation of the number of individuals are

highly valuable inputs. In this paper, we propose a method for hyperspectral

image segmentation, based on the Binary Partition Tree (BPT) algorithm,

and we apply it to two sites located in Hawaiian and Panamean tropical

rainforests. Different strategies combining spatial and spectral dimensionality

reduction are compared prior to the construction of the BPT. Various su-

perpixel generation methods including watershed transformation and mean

shift clustering are applied to decrease spatial dimensionality and provide an

initial partition map. Principal component analysis is performed to reduce

Email addresses: guillaume.tochon@gipsa-lab.grenoble-inp.fr (G. Tochon),
feretjb@cesbio.cnes.fr (J.B. Féret)

Preprint submitted to Remote Sensing of Environment December 5, 2014



the spectral dimensionality and different combinations of principal compo-

nents are compared. A non-parametric region model based on histograms,

combined with the diffusion distance to merge regions, is used to build the

BPT. An adapted pruning strategy based on the size discontinuity of the

merging regions is proposed and compared with an already existing pruning

strategy. Finally, a set of criteria to assess the quality of the tree segmentation

is introduced. The proposed method correctly segmented up to 68% of the

tree crowns and produced reasonable patterns of the segmented landscapes.

Keywords: Binary partition tree, Carnegie Airborne Observatory,

hyperspectral imagery, segmentation, tree crown delineation, tropical forest

1. Introduction1

There is a growing need for large-scale assessment of biodiversity and2

species richness in ecosystems, as a means to improve forest conservation3

and management decisions. Tropical rainforest ecosystems are of critical4

interest since they are hotspots of biodiversity, greatly contributing to the5

worlds biotic variety while covering only a small percentage of the terrestrial6

surface. Moreover, they are particularly vulnerable to multiple factor pres-7

sures such as exploitation of natural resources and climate change (Asner8

et al., 2009; Thomas et al., 2004; Whitmore et al., 1990). In this context,9

information about the forest structure, the number, spatial distribution and10

identification of individual trees, the species richness and its evolution, and11

the dynamics of invasive species across landscapes are highly sought after12

for efficient management decisions applied to forest conservation. Related13

field data collection is extremely expensive, time-consuming and requires very14

2



skilled field workers. Such constraints call for supporting technologies and15

methods for the accurate and regular monitoring of the evolution of biological16

diversity over large spatial scales. Remote sensing appears as a particularly17

efficient tool for such applications (Rasi et al., 2013; Reiche et al., 2013).18

However, monitoring tropical forest ecosystems using remote sensing remains19

extremely challenging due to the complexity of the canopy in terms of density,20

structure and species richness (Papes et al., 2013; Pouteau & Stoll, 2012;21

Somers & Asner, 2013).22

Among the various information that can be derived from remotely sensed data,23

individual tree crown (ITC) delineation is a particularly important product24

assisting in fine-scale analysis ecological processes linked to vegetation struc-25

ture and gap dynamics (Phinn et al., 2008), as well as improved tree species26

identification (Clark et al., 2005). Indeed, region properties (texture, size,27

shape, radiometric variability) can be derived from each ITC delineated on28

an image, resulting in the combination of spatial and radiometric information.29

Such object-oriented approaches usually outperform traditional pixel-based30

methods for classification and other image processing applications such as31

spectral unmixing and object detection, and dramatically enriches contextual32

information delivered by remote sensing products. In practice, high spatial33

resolution ITC delineation can be useful to help monitor species of interest,34

such as dominant trees, rare or invasive species that are key indicators for35

environmental processes (Asner et al., 2008). It can also be used to detect36

illegal logging, as logging practices are nowadays very selective and assisted by37

moderate resolution satellite images to detect large scale deforestation (Asner38

et al., 2005).39

3



Several segmentation methods have been developed for ITC delineation based40

on high spatial resolution imagery derived from various sensors, from satellite41

very high resolution imagery to airborne Light Detection and Ranging (Li-42

DAR) data. However, the selection of a segmentation algorithm is critical as43

the performances of these methods are usually strongly ecosystem-dependent.44

ITCs that are typically encountered in temperate forests offer several appeal-45

ing characteristics for the development of segmentation algorithms. In fact,46

those trees have a regular shape and elongated silhouette, and the canopy is47

rather sparse. Existing segmentation algorithms devoted to the segmentation48

of temperate forests are taking advantage of those properties. For instance, it49

is often assumed in forested area high resolution digital imagery that an ITC50

is represented by bright pixels (the top of the crown, well illuminated by the51

sun) surrounded by darker pixels (either shaded portions of the crown or the52

ground) (Wulder et al., 2000). Using a topographical analogy, an ITC can be53

viewed as a peak and the valleys circling around it are its physical boundaries.54

The valley following approach exploits this idea by encircling bright pixels55

with darker boundaries, and was used by Gougeon (1995); Leckie et al. (2005,56

2003) for the segmentation of coniferous plantations, and by Warner et al.57

(1998) for deciduous forests. Also relying on the topographical representation,58

region growing approaches implement seeds in local maxima of the image,59

each seed being therefore potentially located at the top of an ITC. Regions60

are gradually expanded from the seeds until a stopping criterion, based on61

the presence of valleys, is reached. Region growing methods were validated62

on Australian eucalypt forests by Culvenor (2002); Whiteside & Ahmadb63

(2008) and on coniferous forests by Erikson (2004); Pouliot et al. (2002).64

4



The marker-controlled watershed methods is analogous to region growing65

when grey tones are inverted in the topographical representation, that is,66

when local maxima corresponding to ITCs become local minima. Instead of67

expanding regions from bright values to dark ones, the watershed floods up68

the topographical map and creates regions corresponding to catchment basins.69

Markers play the same role as seeds in the region growing approach, and70

temper the algorithm’s sensibility to noise in order to avoid over-segmentation.71

This approach was validated by Wang et al. (2004) for the segmentation of72

Canadian coniferous forests. A comparison between valley following, region73

growing and marker-controlled watershed methods for coniferous and decidu-74

ous tree stands is drawn by Ke & Quackenbush (2011). Template matching75

can also be applied when all ITCs have a regular and elongated shape. It76

consists of synthetically modelling the tree shapes by a collection of templates77

being generalized ellipses with various physically possible parameter values.78

Each template is cross-correlated against any potential tree position in the79

digital image, and the location of the highest correlations are considered to80

be ITC positions while the corresponding templates are assumed to be the81

tree shapes. Template matching was used by Olofsson (2002); Pollock (1996,82

1998) for coniferous and mixed forests, and a comparison between template83

matching and region growing approaches applied to the delineation of Swedish84

spruce stands can be found in Erikson & Olofsson (2005). Finally, stochastic85

point process methods model the image as a realization of a marked point86

process of ellipses. The process, being the digital image, contains an unknown87

number of objects (trees), each of them being in an unknown configuration88

(the elliptic shape and orientation). An energy term corresponding to the fit89

5



between the model and the real image is defined, and the model is iteratively90

adjusted in order to decrease the energy term at each iteration. Prior knowl-91

edge about the general distribution of shapes and sizes is needed to operate92

the method, and those parameters can be easily derived when all trees have93

similar structures. Point processes were investigated by Perrin et al. (2005)94

for poplar plantations and by Andersen (2003) for coniferous forests.95

These methods, based on strong hypotheses about crown size and shape96

(existence of one unique maximum for each individual and limited overlapping97

between individuals) show good results for high resolution digital images of98

temperate forests. However, they perform poorly when applied to tropical99

dense forest ecosystems, where tree size and shape are highly variable, and100

individuals usually overlap. Varekamp & Hoekman (2001) proposed a method101

based on Fourier parameterized deformable models for Interferometric Syn-102

thetic Aperture Radar (InSAR) data. Using the intensity, the interferometric103

height-coordinate and the coherence magnitude measures proper to the In-104

SAR imaging system, they match ITCs with deformable ellipses, and applied105

their method to a tropical forest located in Kalimantant, Indonesia. Note106

that Zhou et al. (2010) also applied marked point processes to high resolution107

imagery and LiDAR-derived canopy height in order to detect individuals in108

high biomass mangroves, including only one to two canopy species. Results109

were encouraging; however they may not be replicable when applied to dense110

tropical forests given the relatively low heterogeneity of mangroves.111

Over the last decade, several studies explored the potential of spectroscopic112

imagery for the tree species identification in dense tropical forests (Clark113

et al., 2005; Feret & Asner, 2013), as well as tree crown delineation (Bunting114

6



& Lucas, 2006) in open mixed forests. The differentiation between species is115

based on their spectral signature, which is related to leaf chemistry and indi-116

vidual tree structure. Detailed spectral information may then be a valuable117

input to detect boundaries between neighboring trees in dense tropical forests.118

However, it comes with a major challenge related to the high dimensionality119

of the data and the need of adapted algorithms for automated tree crown120

segmentation. To the best of our knowledge, there is no reference study for the121

segmentation of tree crowns in hyperspectral images of tropical rainforests.122

Image segmentation applied to dense tropical forests is an ill-posed task: a123

given image can often be segmented at several levels of details, due to the124

complex architecture of the top of the canopy. For this reason, it is better125

to have a consistent hierarchy of segmentations rather than a collection of126

minimally related segmentations. This allows the user to tune the exploration127

level within the hierarchy to the precise goal (Jung et al., 2014; Tarabalka128

et al., 2012). Mathematical tree structures are well suited for a hierarchical129

region-based representation of an image. In such structure, each node of130

the tree represents a given region in the corresponding image, and links131

between nodes illustrate a particular relationship between regions, such as132

inclusion or adjacency. Among all tree representations, the binary partition133

tree (BPT) has received much attention lately. Initially proposed by Garrido134

(2002); Salembier & Garrido (2000) for grayscale and RGB images, BPTs135

have then been further extended to hyperspectral imagery by Valero et al.136

(2013a) and are now used for classical hyperspectral remote sensing tasks137

such as segmentation (Valero et al., 2011a; Veganzones et al., 2014), classifi-138

cation (Alonso-Gonzalez et al., 2013), unmixing (Drumetz et al., 2014) and139

7



object detection (Valero et al., 2013b, 2011b) notably. The efficiency of the140

BPT to achieve a given task is greatly impacted by both the pre-processing141

applied to the image prior to the construction of the BPT and the post-142

processing of the BPT representation itself, called pruning.143

Consequently, we propose in the following study to adapt the BPT repre-144

sentation to the segmentation of hyperspectral images of tropical rainforests,145

through an adapted pre-processing of the data and pruning of the BPT. The146

pre-processing stage consists of spectrally and spatially reducing the data147

by extracting discriminant information using Principal Component Analysis148

(PCA) and spatial pre-segmentation, respectively. Different configurations149

for the PCA reduction as well as several pre-segmentation algorithms are150

investigated. A novel BPT pruning strategy, dedicated to the segmentation151

of tree crowns is proposed and compared against an already existing pruning152

strategy. A method to assess the quality of the resulting segmentation is also153

introduced, allowing to state which is the most efficient spectral reduction154

configuration and pre-segmentation algorithm in a given context. The pro-155

posed method is tested on two data sets with different characteristics.156

The paper is organized as follows: Section 2 introduces the data used to157

test our algorithm. Section 3 presents the methodology, namely the pre-158

processing operations, the construction and pruning of the BPT, and the159

method developed to assess the performance of the segmentation. The results160

are introduced and discussed in Section 4. Finally, some conclusions and161

perspectives for the application of our method are given in Section 5.162

8



2. Materials163

Two sites were selected to conduct this study. The first site, hereafter164

named Hawaii, is located at the Nanawale Forest Reserve, Hawaii (USA).165

The Nanawale forest is classified as lowland humid tropical forest, with an166

average elevation of 150 m above sea level. Mean annual precipitation and167

temperature are 3200 mm.yr−1 and 23◦C, respectively. The forest canopy168

is comprised of about 17 species, mostly invasive non-native trees, with a169

few native species remaining. The remote sensing data used in this study170

were acquired with the Carnegie Airborne Observatory (CAO) Alpha sensor171

package in September 2007 (Asner et al., 2007). The CAO-Alpha is equipped172

with a spectroscopic imager measuring up to 72 bands in the visible and173

near infrared (VNIR) domain, as well as a small footprint Light Detection174

and Ranging sensor (LiDAR) working simultaneously. This first study site175

corresponds to a 1980 by 1420 pixel image with 0.56 m ground sampling176

distance, covering an area of about 70 hectares on the ground. The spectral177

resolution used for this campaign results in the acquisition of 24 spectral178

bands of 28 nm in width and evenly spaced between 390 nm and 1044 nm.179

The LiDAR acquisitions were performed in discrete return mode (4 returns)180

and both digital elevation model (DEM) and canopy height model (CHM)181

coregistered with hyperspectral data were produced.182

The second site, hereafter named Panama, is situated in the Panama forest.183

The data were collected over the Parque Nacional San Lorenzo in the Republic184

of Panama. The site is humid tropical forest with a mean annual precipitation185

of 3300 mm.yr−1. Mean annual temperature is 26◦C. The canopy is considered186

old growth forest populated by trees of 200-300 years of age. Canopy height187

9



ranges from about 20 m to a maximum of 45 m. The data was collected using188

the Carnegie Airborne Observatory Airborne Taxonomic Mapping System189

(CAO-AToMS) (Asner et al., 2012), launched in June 2011. The CAO-AToMS190

integrates three sensors in the same platform, including a new High Fidelity191

Visible-Shortwave Imaging Spectrometer (VSWIR) measuring the 380-2510192

nm wavelength range at up to 5 nm spectral resolution, a dual-laser, waveform193

LiDAR system, and a high-resolution Visible-to-Near Infrared (VNIR) imaging194

spectrometer. The data acquired over the study site corresponds to a 600195

by 600 pixels VSWIR image with a spatial resolution of 2 m and including196

224 spectral bands (12 nm FWHM) evenly spaced between 378 nm and 2510197

nm and co-registered DEM and CHM. 175 bands were retained from the198

VSWIR image after the elimination of unwanted spectral bands such as those199

corresponding to atmospheric water absorption.200

A total of 160 ITCs for Hawaii and 100 ITCs for Panama were manually201

delineated by a trained operator, using the ENVI software, after visual202

interpretation of the hyperspectral imagery, in order to assess segmentation203

accuracy. Particular care was taken to include individuals of various shape,204

size and species. Some examples of manually delineated ITCs can be observed205

in Figures 1 and 2.206

3. Proposed segmentation strategy207

3.1. Principle of the Binary Partition Tree208

A remotely sensed image of the Earth surface is typically composed of209

several semantic regions of interest, such as buildings, trees, crop fields, . . .210

Those regions often follow a hierarchical organization (for instance, a building211

10



(a) (b)

Figure 1: (a) RGB colored composition of a hyperspectral sub-image of Hawaii

site (R=646 nm, G=561 nm, B=447 nm, stretched colors) with some ITCs

manually delineated (in white) and (b) corresponding canopy height model

derived from LiDAR with ITCs (in red).

is enclosed in a neighborhood, which is itself enclosed in a city), and the212

place of a particular region in a hierarchy is directly related to the scale of213

exploration (the scale of exploration of a building is finer than the one of a214

neighborhood). When analyzing an image, one has to choose a scale based215

on the intended level of details, and this operation is application-dependent.216

As a result, it can be valuable to represent the image in a task-independent217

hierarchy of regions, and set the exploration level in this hierarchy afterwards218

based on the application. The binary partition tree (BPT) is a solution to219

achieve such hierarchical region-based representation of an image. Starting220

from an initial partition of the image (corresponding to individual pixels221

or regions defined by a preliminary segmentation), neighboring regions are222

iteratively merged together until there is only one region remaining, and223

11



(a) (b)

Figure 2: (a) RGB colored composition of a hyperspectral sub-image of

Panama site (R=634 nm, G=549 nm, B=463 nm, stretched colors) with some

ITCs manually delineated (in white) and (b) corresponding canopy height

model derived from LiDAR.

those merging are stored in a tree structure. Thus, in the corresponding tree224

representation, the leaf nodes correspond to the regions in the initial partition225

of the image, the root of the tree represents the whole image support, and each226

node in between corresponds to the region resulting from the merging of two227

children regions. Following this definition, the tree structure corresponding228

to an initial partition of N leaves contains a total of 2N − 1 nodes. Figure 3a229

shows the different steps of the construction of a BPT, which is determined230

by two notions:231

- The region model MR, which specifies how a regionR is mathematically232

handled, and how to model the union of two regions. This region233

descriptor (for instance the mean grayscale value in figure 3a) is used234

12



to compare neighboring regions.235

- The merging criterion O (Ri,Rj), which quantifies the similarity be-236

tween neighboring regions Ri and Rj by measuring a distance between237

their region models. Thus, the merging criterion determines in which238

order the regions are merged.239

The pruning step takes place once the BPT construction is completed.240

The pruning aims at cutting off branches in the BPT so the new leaves241

of the pruned tree achieve the most relevant segmentation regarding the242

application. If the construction of the tree is generic up to the definition of243

a region model and a merging criterion, the pruning strategy is application244

dependent. Therefore, the level of exploration is defined through the pruning245

operation, and two different pruning strategies applied on the same BPT are246

likely to produce different segmentations. A pruning operation is illustrated247

in figure 3b.248

(a) (b)

Figure 3: (a) construction of a BPT, and (b) an example of pruning of it.

13



3.2. Methodology249

The proposed method is summarized by the flowchart displayed in figure 4.250

It is composed of 4 different steps, namely the pre-processing stage, the251

construction of the BPT, the pruning of the BPT and the quality evaluation252

of the produced segmentation map. The pre-processing stage comprises data253

dimensionality reduction and pre-segmentation, producing inputs for the254

BPT construction stage. By varying these input configurations, we study255

their influence on the whole segmentation and quality evaluation processes.256

Moreover, we introduce a BPT pruning strategy based on the evolution of257

the region size along branches of the BPT. We compare this new pruning258

strategy with an already existing one which relies on spectral graph parti-259

tioning (Alonso-Gonzalez et al., 2013; Valero, 2011). Finally, we present the260

metrics used for the quality assessment of segmentation maps.261

3.3. Pre-processing step262

The construction of the BPT is computationally very intensive and may263

become problematic for applications on large datasets. Here, we pre-processed264

the data in order to reduce both spectral and spatial dimensions of the data.265

3.3.1. Spectral reduction266

The detailed spectral properties of an element (pixel or object) extracted267

from spectroscopic imagery are particularly interesting for classification pur-268

poses. However, strong correlations exist between most of the contiguous269

bands, leading to redundant information (Thenkabail et al., 2004) and com-270

putationally intensive processes. Therefore, a spectral reduction is required271

to extract relevant information and eliminate these redundancies. Principal272

14



component analysis (PCA) performs an orthogonal transformation from the273

initial spectral space to another space of equal dimension showing no linear274

correlation between latent features. These latent features (named hereafter275

principal components, or PCs) are then ranked, following a decreasing amount276

of variance explained, which is a criterion commonly used to perform com-277

ponent selection. Indeed, PCs explaining a low amount of variance usually278

contain only noise. However, the choice of selecting PCs explaining the most279

variance may lead to suboptimal selection for a given application, as the280

signal may be influenced by several factors, and those being of interest for281

the considered application may not lead to high variance values (contrarily,282

those leading to high variance values may not be of interest). It is known for283

instance that the influence of brightness is particularly strong on radiometric284

signals measured from vegetation when using high spatial resolution imagery285

with pixels smaller than ITCs (Fung & LeDrew, 1987; Horler & Ahern, 1986).286

Indeed, the angle of view, the illumination and the surface geometry are287

responsible for directional effects and shade. Even though brightness accounts288

for most of the total variance, this factor is not a relevant criterion to differ-289

entiate individuals since spectral variations due to brightness are particularly290

strong within individuals and may not evidence dissimilarities between ITCs.291

On the other hand, relevant factors for the delineation of ITCs are related292

to individual- or species-specific traits such as leaf chemistry (for instance,293

photosynthetic pigments or water content) and vegetation structure (foliage294

density, leaf angle distribution, tree shape, etc). These factors are known295

to also significantly influence spectral properties measured from individual296

trees (Conese et al., 1988; Morton, 1986), and this influence should be fea-297

15



tured by some PCs. On the opposite, the selection of PCs showing irrelevant298

information for ITC segmentation is in the best case responsible for lower299

computational performances, and in the worst case a source of nuisance for300

the accurate delineation of ITCs.301

Therefore we studied the influence of the identity of the retained PCs on302

the quality of tree crown segmentation. The selection or exclusion of a PC303

is related to the user ability to visually assess the presence of information304

allowing species discrimination in the PC. This information, called discrimi-305

nant information, is contained in a PC whenever there are some individuals306

or groups of individuals clearly distinguishable from the background in the307

component. The following four spectral configurations were investigated:308

- the initial and unprocessed hyperspectral data, showing strong correla-309

tions between bands,310

- the output of the PCA transformation, without PC selection,311

- a selection of PCs, visually selected to contain useful information for312

species discrimination. This discriminant information was visually313

assessed by the user, based on the presence of patterns highlighting314

differences between individuals, and in our case, PC #1 was not selected315

due to the reason explained earlier.316

- the previously mentioned selection of PCs, plus PC #1.317

A permissive strategy was adopted during the visual examination: components318

showing a few individuals were retained even if the component looked noisy319

overall. Even if the amount of variance was not appropriate to select compo-320

nents, we noticed that the interesting information was contained in the first321

16



half of all components. Figure 5 exhibits a subset of the image corresponding322

to the Hawaii site and its first five PCs. Discriminant information can be seen323

in figures 5c to 5f, where some individuals are clearly distinguishable within324

the components. Table 1 specifies the number of bands and the identity of325

the PCs used in each case for the two different sites.

Table 1: Number of bands used to perform BPT segmentation on the two

study sites and identity of the component selected.

Hawaii Panama

Hyperspectral image 24 175

PCA transformation 24 175

Visual PC selection + PC#1 8 22

Visual PC selection 7 21

Component selected through
2-8

2,3,5,9,10,12,13,15,17-21

visual inspection 23,25,28,29,33,34,42,46

326

3.3.2. Spatial reduction327

The partition used to initialize the construction of the BPT can be com-328

posed of individual pixels (the finest partition scale) (Valero et al., 2013a),329

or regions obtained from a preliminary segmentation. The former is recom-330

mended when no prior information is known about the size of final regions,331

but the latter option is computationally more efficient as it significantly332

decreases the number of nodes within the BPT. In our application, the di-333

mension of emerging ITCs ranged between tens of pixels and thousands of334

17



pixels for the largest individuals. Therefore, a preliminary segmentation of335

the original image was investigated for the construction of the BPT. The336

main constraint of this pre-segmentation was to produce regions smaller than337

individual trees in order to avoid grouping several ITCs in one region, as the338

algorithm does not include region splitting. The boundaries of the regions339

obtained from the pre-segmentation should also respect as much as possible340

the actual boundaries between ITCs in order to recompose them with a good341

accuracy. We investigated three different approaches to produce the initial342

segmentation map, and compared them with an initialization at the pixel343

level. Each approach used to derive the initial segmentation map was based344

on different initial data and different segmentation methods:345

- The first approach used the LiDAR-derived CHM, as presented in346

figures 1b and 2b. A preliminary smoothing was first applied to the347

initial CHM, including the application of a 5 by 5 median filter followed348

by a discretization using steps of 0.5 m. This discretized CHM was349

then segmented using the Watershed algorithm (Beucher & Lantuejoul,350

1979; Meyer & Beucher, 1990), which tends to produce strongly-over-351

segmented regions.352

- The second approach was based on hyperspectral Watershed segmenta-353

tion, as exposed in Noyel et al. (2007); Tarabalka et al. (2010). First, the354

gradient map of the original hyperspectral data was computed, using a355

Robust Color Morphological gradient (Tarabalka et al., 2010). Then, a356

classical Watershed algorithm was applied onto this gradient map, once357

again resulting in a strongly over-segmented partition.358

18



- The third approach was based on the mean shift clustering (Comaniciu359

& Meer, 2002) of a RGB representation of the hyperspectral data. Bands360

centered at 646.0 nm (R), 560.7 nm (G) and 447.0 nm (B) were used for361

Hawaii, and bands centered at 638.83 nm (R), 548.77 nm (G) and 458.71362

nm (B) were used for Panama. The mean shift clustering was performed363

with the freeware Edge Detection and Image SegmentatiON (EDISON,364

http://coewww.rutgers.edu/riul/research/code/EDISON/).365

In all cases, the resulting initial segmentation maps were satisfying after366

visual examination, as the obtained regions were small enough to prevent367

several individuals to be merged in one region. Figure 6 shows the initial368

segmentation maps corresponding to the three methods.369

3.4. Construction of the binary partition tree370

The construction of the BPT starts once the pre-processing step is com-371

pleted, and depends on the definition of a region model and a merging372

criterion. There are two commonly used region models when dealing with373

hyperspectral images (Valero, 2011; Valero et al., 2010a). One can choose to374

model a hyperspectral region by its mean spectrum (also called first order375

parametric region model), which allows the use of simple merging criteria mea-376

suring the discrepancy between two spectra. However, such merging criteria377

proved to perform poorly when used to discriminate tree species in tropical378

forests (Clark et al., 2005), as they assume spectral homogeneity within each379

region and do not preserve their spectral distribution and variability. The380

non-parametric statistical region model is more satisfying for our application,381

as it accounts for spectral variability within a region. In that case, the region382

19

http://coewww.rutgers.edu/riul/research/code/EDISON/


is modeled by its set of histograms as follows:383

HR =
(
Hλ1R , . . . ,H

λM
R

)
(1)

where HλiR is the empirical distribution of reflectance values for the region384

R in the band λi and M is the number of spectral bands in the image.385

Each of these M histograms can then be converted in a probability density386

function (pdf) after normalization (so that the sum of its bins equals 1). This387

allows the use of metrics which measure the discrepancy between pdfs. In388

particular, we decided to use the diffusion distance, proposed by Ling & Okada389

(2006), and successfully used as a merging criterion for the BPT construction390

by Valero et al. (2010a). This distance, detailed in 5, is particularly robust to391

illumination change and allows to handle the case where a tree crown is half-lit,392

half shaded. The construction of the BPT is initiated by the computation of393

the merging criterion between each pair of neighboring regions. Each merging394

iteration then involves the search of the two neighboring regions that achieve395

the lowest pair-wise similarity among all pairs of neighboring regions in the396

current segmentation map. Those two regions are consequently merged. It is397

noteworthy that the method was programmed to favor the merging of very398

small regions (Calderero & Marques, 2010), in order to decrease the risk399

of over-segmentation and smooth the final segmentation. In practice, the400

average region size in the segmentation map is computed at each merging401

iteration, and all regions of size less than 15% of this average size are given402

the merging priority.403

20



3.5. Pruning of the binary partition tree404

After the construction of the BPT, the pruning aims at cutting off branches405

so the leaves of the pruned tree correspond to meaningful regions regarding406

the desired application. Therefore, this step is critical to achieve a proper407

segmentation, and our goal is to design a generic pruning strategy giving408

optimal ITC delineation for various forest types and image characteristics409

(spatial and spectral resolutions), with minimal expert parametrization. Many410

pruning strategies have already been investigated in the literature for clas-411

sical (Salembier & Garrido, 2000) and hyperspectral BPTs (Valero et al.,412

2010a,b). Among the attempts made to design a generic pruning strategy, one413

can cite the minimization of an energy or cost function, or recursive spectral414

graph partitioning (Alonso-Gonzalez et al., 2013; Valero, 2011). The former415

associates a pruning cost to each node in the BPT and looks for partition416

minimizing the overall cost, subject to a given number of region in the parti-417

tion, through the use of Lagrangian multipliers. This strategy requires the418

knowledge of the final number of regions in the image to be operated. It is419

inapplicable in our study as this parameter is not known a priori. Therefore,420

we propose a new pruning strategy devoted to the segmentation of tree crowns421

in hyperspectral images and compare its results with those obtained using422

the recursive spectral graph partitioning.423

3.5.1. Recursive spectral graph partitioning pruning strategy424

The recursive pruning strategy that we use as reference and compare to our425

method is based on two techniques: spectral graph partitioning (Von Luxburg,426

2007) and normalized cuts (Shi & Malik, 2000). This pruning strategy analyzes427

each branch of the BPT, seeking the best level to partition it in two sets,428

21



where the similarity among all the nodes of a given set is high, and the429

similarity across the two sets is low. Given that, each leaf of the BPT votes430

for the ancestor in the branch it wishes to be represented by. For each branch,431

the cut is then made under the node which has the highest ratio of votes with432

respect to the number of leaves hanging under it, in order not to favor nodes433

close to the root which have a greater number of leaves and potentially a434

great number of votes. The partitioning process only relies on dissimilarities435

among nodes of the BPT, and thus does not assume any particular knowledge436

about the currently processed image.437

3.5.2. The evolution of the region size pruning strategy438

The above-presented pruning strategy is based on spectral properties of439

graphs constructed from the BPT and depends neither on the scene depicted440

by the hyperspectral image nor on the application. However, it may not441

be optimal for such specific applications as the segmentation of tree crowns442

in a tropical rain forest hyperspectral images. Moreover, the solving of the443

graph partitioning problem can become computationally intensive for large444

images and potentially huge BPTs. To overcome this limitation, we propose445

a novel pruning strategy by adapting the aforementioned voting process to446

the tree crown segmentation in tropical forests. Since the initial segmentation447

map is over-segmented, each ITC is initially split up into several regions.448

Two neighboring regions belonging to the same ITC are theoretically closer449

spectrally than two neighboring regions belonging to two ITCs of different450

species. As a result, all the regions defining an ITC should have low pair-wise451

distances and therefore be merged in the early iterations of the merging452

algorithm. Those early iterations lead all regions to reach some critical size453

22



at which point their neighboring regions are spectrally dissimilar because454

containing one or several ITCs belonging to different species. Final iterations455

of the merging process usually involve regions comprising one or several456

individuals. As a result, the evolution of the region size from a leaf of the457

BPT to its root shows a clear discontinuity at the step where the region is no458

longer agglomerating leaves around it, but is merging instead by default with459

another grown up region in its neighborhood. We observed in practice that460

the most accurate delineation of the ITC corresponds to the region defined461

right before the discontinuity, as it can be observed in figure 7.462

Our novel pruning strategy is derived from this observation: each leaf votes463

for the node prior to the first discontinuity in the branch. The introduction464

of a size thresholding parameter allows the detection of a discontinuity: a465

discontinuity is flagged when the size difference between two consecutive nodes466

exceeds the threshold. The pruning is decided after all leaves have voted:467

each non-leaf node in the BPT has its number of votes divided by its number468

of leaves, and each BPT branch is cut under the node whose ratio number469

of nodes/number of leaves is the highest in the branch. If two nodes have470

the same ratio in a branch, then the cut is made under the one which is the471

farthest apart from the root, to decrease the chance of under-segmentation.472

By setting the size threshold and thus controlling the discontinuity height, it473

is possible to influence the characteristic size of the final regions: the setting of474

a low threshold value tends to generate small regions since the voting process475

is more sensitive to leaps in the evolution of the region size. Contrarily, a476

high value leads to large regions in the corresponding segmentation. For477

Hawaii site, threshold values from 200 to 2000 with a 200 step wide have478

23



Table 2: Basic statistics about the delineated ITCs for both test sites.

Hawaii Panama

Number of ITCs 160 100

Mean size (in pixels) 843 205

Standard deviation 648 158

Minimal ITC size 36 39

Maximal ITC size 3846 778

been tested, whereas for Panama site, where the average crown size is smaller,479

values ranging from 150 to 1500 with a 150 step wide have been tried.480

3.6. Assessing the segmentation accuracy481

Assessing a segmentation quality is a difficult task in general, since it482

requires the definition of meaningful evaluation criteria, and those criteria are483

often to be defined with respect to a given goal and available ground truth484

data. Most criteria found in the literature, such as symmetric and asymmetric485

distances (Cardoso & Corte-Real, 2005), ask for a reference segmentation to486

be used. However, only some manually delineated ITCs are available in our487

case. Table 2 displays some basic statistics regarding those ITCs.488

Once the tree has been pruned, an ITC can be described in the corre-489

sponding segmentation by one of the following four different states: detected,490

over-segmented, under-segmented, or missed. We propose to evaluate the491

segmentation accuracy by using the percentage of ITCs which were classified492

as correctly detected regarding the total number of ITCs tested. It is very493

unlikely that an automatically delineated crown exactly matches a manually494

24



delineated one. This inaccuracy between the two regions, which can be495

evaluated by the number of missegmented pixels, also depends on the size of496

the region manually delineated. Therefore, we define in the following some497

criteria integrating a margin of error between the manually delineated ITCs498

and the one obtained from the segmentation process. For a given manually499

delineated ITC, the first step is the retrieval of segments that represent the500

ITC the best in the final segmentation map. In practice, every segment that501

shares at least 50% of its pixels with the ITC is considered an element of the502

ITC. In the case where no segment has at least 50% of its pixels belonging503

to the ITC, then the ITC is represented by the segment having the highest504

percentage of pixels in it. Consequently, an ITC can be composed of one505

segment or several segments. In the following, c denotes the set of pixels506

corresponding to the ITC, and s = {s1, . . . , sITC} is the set of segments in507

the final segmentation map that were retrieved to compose the ITC. Figure 8508

presents the process to determine how c has to be classified regarding its509

corresponding set of segments s:510

- The first test concerns the over-segmentation. The ITC crown appears511

to be over-segmented if several segments were found to compose it, and512

that case is treated aside. If s contains only one segment, the overlap513

degree between s and c is computed. It is defined by514

overlap =
|c ∩ s|
|c|

(2)

where |c ∩ s| denotes the number of pixels in the intersection of c and515

s, and |c| is the number of pixels composing the ITC. It represents516

how much of the ITC was captured by the segment representing it.517

25



Consequently, if this overlap degree does not exceed at least 0.7 (the518

segment representing the ITC contains less than 70% of the ITC), the519

ITC is classified as missed.520

- If the ITC is not missed, the ratio degree between s and c is computed,521

ratio =
|s|
|c|

(3)

If this ratio is greater than 1.5 (the segment is at least 50% bigger than522

the ITC it represents), then the ITC is classified as under-segmented.523

- If the ITC is neither missed nor under-segmented, then it is classified524

as detected.525

- In the case were the ITC was found to be over-segmented, an additional526

test examines how severe is the over-segmentation. If there is one527

segment s? ∈ {s1, . . . , sITC} such that s? accounts for at least 85% of the528

area covered by s, and the overlap and ratio degrees of s? alone are such529

that they makes the ITC being detected, then the over-segmentation530

is discarded and the ITC is classified as detected. Otherwise, the ITC531

remains over-segmented.532

All the previous cases can be observed in figure 9. Threshold values for overal533

and ratio degrees and to discard over-segmentation were set empirically. The534

influence on the final segmentation quality of each input parameter (the initial535

segmentation map and the PCA configuration) and of the pruning strategy536

can be assessed by the percentage of correctly delineated ITCs.537

26



4. Results and discussion538

4.1. Results539

Table 3: Percentage of correctly segmented ITCs for Hawaii test site, according

to the chosen setting. A setting is defined by a spectral reduction configuration

(No PCA, all PCs, Selection of PCs), an initial segmentation (pixel scale,

mean shift clustering, hyperspectral watershed, watershed on LiDAR) and a

pruning strategy (graph cut, region size discontinuity). For the region size

discontinuity pruning strategy, several threshold values were investigated: is

reported the maximum percentage along with the corresponding threshold

value (in parentheses).

HAWAII No PCA All PCs
Selection of PCs

with 1st PC without 1st PC

Graph

cut

Pixel Scale 15.0 24.4 28.1 33.8

Mean Shift 32.5 38.8 40.0 42.5

Region size

discontinuity

Hyperspectral 6.9 (600) 30.6 (1400) 29.4 (1200) 40.0 (1600)

LiDAR 36.9 (600) 47.5 (600) 47.5 (600) 48.8 (600)

Mean Shift 28.1 (1000) 47.5 (1000) 45.6 (1600) 54.4 (1200)

Table 3 and 4 display the percentages of ITCs correctly delineated for540

the Hawaii and Panama test sites, respectively, with respect to varying541

input parameters and pruning strategies. The two investigated pruning542

strategies are denoted graph cut for the recursive spectral graph partitioning543

strategy, and region size discontinuity for the proposed evolution of the544

region size strategy. The initial segmentation maps are denoted as follows:545

27



Table 4: Percentage of correctly segmented ITCs for Panama test site, ac-

cording to the chosen setting. A setting is defined by a spectral reduction

configuration (No PCA, all PCs, Selection of PCs), an initial segmentation

(pixel scale, mean shift clustering, hyperspectral watershed, watershed on

LiDAR) and a pruning strategy (graph cut, region size discontinuity). For the

region size discontinuity pruning strategy, several threshold values were inves-

tigated: is reported the maximum percentage along with the corresponding

threshold value (in parentheses).

PANAMA No PCA All PCs
Selection of PCs

with 1st PC without 1st PC

Graph

cut

Pixel Scale 44.0 54.0 51.0 63.0

Mean Shift 54.0 54.0 59.0 61.0

Region size

discontinuity

Hyperspectral 26.0 (150) 33.0 (150) 42.0 (150) 43.0 (450)

LiDAR 39.0 (150) 55.0 (150) 51.0 (150) 49.0 (150)

Mean Shift 45.0 (150) 63.0 (150) 66.0 (150) 68.0 (150)

pixel scale when the initialization is done at pixel level, hyperspectral for the546

hyperspectral Watershed segmentation, LiDAR for the classical Watershed547

algorithm applied on LiDAR data, and mean shift for the mean shift clustering.548

The input images on which the BPT is built are denoted as No PCA, All549

PCs, Selection of PCs with 1st PC and Selection of PCs without 1st PC for550

the raw hyperspectral data, the PCA transformation with all PCs retained,551

the PCA transformation with only a selection of PCs, with and without552

PC#1 retained, respectively. Several threshold values were tested for the553

proposed pruning strategy, ranging from 200 to 2000 with gaps of 200 for554

28



Hawaii, and from 150 to 1500 with gaps of 150 for Panama. The maximum555

percentage along with its corresponding threshold value is reported. The556

highest percentage among all configurations is highlighted in red. For both557

sites, this configuration involves a spectral reduction performed by PCA with558

a selection of PCs excluding PC #1, an initial segmentation resulting from559

the mean shift clustering and the proposed region size discontinuity strategy560

for the pruning of the BPT. Rationales of this conclusion are discussed in the561

next subsection 4.2. Figure 10 displays some segmentation results obtained562

for both sites.563

4.2. Discussion564

4.2.1. About the PCA configuration565

For both test sites, all initial partitions and both pruning strategies, results566

show significant improvements when a PCA transformation is performed with567

respect to the case where the BPT is directly built on the raw hyperspectral568

data. We conclude that the discriminant information extracted by the PCA569

eases the species discrimination and improves the region model for the BPT.570

Regarding the most efficient PCA configuration, there is no clear conclusion571

about the best strategy between using all PCs and using only the selection of572

PCs including PC #1. There is in fact very little variations in terms of amount573

of discriminant information between those two configurations, since all bands574

exluded in the latter configuration contained only and no useful information575

for species discrimination. On the other hand, discarding the first PC improves576

the results. As explained in section 3.3.1, the first PC contains brightness577

variations measured in the NIR domain, which is a highly non-discriminative578

feature. Including this first PC can be prejudicial for instance when a tree579

29



crown is half-lit, half-shaded. In that case, the distance between the two580

halves increases during the construction of the BPT as their histograms581

corresponding to the first PC show significant differences. The two halves582

may even not be merged together, preventing the tree crown to be correctly583

segmented during the pruning step. As a result, the selection of PCs without584

PC #1 included is the configuration which gives the highest percentage of585

detected ITCs among all studied spectral reduction configurations.586

4.2.2. About the initial segmentation map587

Among the three pre-segmentation methods investigated, the hyperspectral588

Watershed systematically gives the lowest percentage of correctly segmented589

ITCs. This is counter-intuitive since the hyperspectral Watershed produces590

smaller regions than the two other segmentation methods (see figure 6),591

hence should decrease the risk that its regions already group several ITCs592

together. However, when precisely analyzing those initial regions, one can593

see that they all have the same square-like shape. On the opposite, initial594

regions derived from LiDAR Watershed and mean shift clustering are more595

heterogeneous in shape and size and have more pertinent boundaries (some596

ITCs are directly recognizable in the initial segmentation map). This is597

plausibly due to the fact that the hyperspectral Watershed involves the598

computation of a multidimensional gradient on the raw hyperspectral data.599

The noise present in this data, along with a low ground sampling resolution,600

leads to an imprecise gradient map. The following Watershed on this gradient601

map therefore produces regions not only following the real edges of the image602

(high value areas in the gradient map), but also fake edges introduced by the603

noise, thus initial regions lacking consistency. In contrast, mean shift clustering604

30



and LiDAR Watershed are based on three bands of the raw hyperspectral data605

and on a smoothed version of the CHM, respectively. They are consequently606

less sensitive to noise and generate more accurate regions. This emphasizes607

the necessity for the initial segmentation map to have regions relevant enough608

to recompose accurately the real boundaries between ITCs. Additionally,609

the LiDAR Watershed method tends to produce larger initial regions than610

the mean shift clustering method (if several neighboring trees have the same611

height, they will likely be grouped in the same region for instance), increasing612

the risk of final under-segmentation. For the Panama site, ITCs have a613

rather small size (205 pixels in average for the 100 delineated ITCs) and614

are consequently more sensible to under-segmentation, explaining why the615

LiDAR Watershed is slightly outperformed by the mean shift clustering. This616

is less true for Hawaii test site where ITCs have a larger size and where both617

segmentation methods produce comparable results.618

Conversely, there are many more possible merging combinations when the BPT619

is initialized on the pixel level, therefore more chances to miss or over-segment620

a region. It is in fact easier to reconstruct a real region when its borders621

are already partially known, as it is the case if the initial segmentation was622

correctly performed. This is particularly true when the expected regions have623

a rather large size, explaining why mean shift clustering leads to better results624

than the pixel scale for Hawaii site. However, both mean shift clustering625

and pixel scale initialization give similar results for Panama, due to smaller626

regions. Nevertheless, the number of nodes in the BPT is proportional to627

the number of regions in the initial partition. That is why the use of mean628

shift clustering as an initial pre-segmentation should still be preferred as629

31



it drastically decreases the number of regions in the initial partition (thus630

reducing the computational load) without degrading the results.631

4.2.3. About the pruning strategy632

It is more challenging to compare the performances of the two investigated633

pruning strategies. As said in section 3.5, the pruning strategy strongly634

depends on the application. The recursive spectral graph partitioning strategy635

tries to be as generic as possible, only exploiting dissimilarities along each636

branch of the BPT, for every type of images. Our pruning strategy, presented637

in section 3.5.2 relies on a property holding when a BPT is built on an638

image which contains regions with a limited size range. This is indeed the639

case for forested areas since real regions correspond to tree crowns, which640

have an upper and lower bound in size for physical reasons, ensuring a clear641

discontinuity in the evolution of the region size along the corresponding642

BPT branch. When analyzing detection percentages, it can be seen that our643

proposed pruning strategy leads to slightly better results than the recursive644

spectral graph cut pruning strategy, confirming that it is more appropriate645

for the segmentation of tree crowns.646

4.2.4. About the threshold value for the proposed pruning strategy647

The tuning of the threshold value for the proposed pruning strategy is also648

an important point. As said in section 3.5.2, the threshold value impacts the649

average region size in the final segmentation map. Indeed, a high threshold650

value is permissive in terms of discontinuity in the evolution of the region size651

along a branch since larger discontinuities are allowed. Consequently, leaves652

vote for nodes closer to the root, hence large final regions and a potential653

32



under-segmentation of the image. On the other hand, a low threshold value654

is sensitive in terms of discontinuity, and favors small regions in the final655

segmentation while increasing the chances of over-segmentation. Naturally,656

the percentage of over-segmented (under-segmented) ITCs is a decreasing (an657

increasing) function of the threshold value, as it can be observed in figure 11.658

On the other hand, the percentage of missed ITC remains relatively constant659

(an ITC is declared missed when there is no region matching it). It is then660

clear that a threshold value can be considered optimal when it achieves a661

trade-off between over-segmentation and under-segmentation phenomena.662

There is no explicit rule to find the best value achieving such compromise,663

but one can remark that it should be close to the average size of expected664

regions. As a matter of fact, figure 11a shows that threshold values achieving665

the best trade-off between over- and under-segmentation for Hawaii, PC666

selection without PC #1 and mean shift clustering are 1000 and 1200 whereas667

table 2 exhibits a mean ITC size of 843 pixels. For Panama, figure 11b gives668

optima threshold values of 150 and 300 while the average ITC size is 205.669

The difference regarding the average ITC size between the two sites can be670

explained by i) the difference in spatial resolution between the two images671

(0.56 m for Hawaii and 2 m for Panama), and ii) the structural differences of672

individual trees between these two sites, explained by physical, environmental673

and anthropic factors. Therefore, one can roughly estimate a threshold value674

based on the average size of the expected regions (regarding the characteristics675

of the image to segment), and then adapt this value depending on the result,676

if needed. A means to locally and automatically adjust the threshold value677

would overcome the supervised nature of the method as well as ensuring678

33



robustness regarding a highly variable ITC size.679

4.2.5. About the general performances of the proposed method680

Tropical rainforests are among the richest and most complex ecosystems in681

the world. Given the density of the canopy in terms of individuals and species,682

as well of the complexity of its structure, achieving a perfect delineation683

of each tree crown is highly unrealistic. However, even partial information684

allowing a better delimitation, identification and enumeration of certain685

species of interest (such that dominant, rare or invasive species that are686

key indicators for environmental processes) can help ecologists to better687

understand these complex ecosystems. Despite several studies about tree688

crown classification of tropical rainforests (see for example Feret & Asner689

(2013) or Clark et al. (2005)), there is, to best of our knowledge, no reference690

study for the segmentation of tropical rainforests. Bunting & Lucas (2006)691

developed a segmentation method for hyperspectral images, and applied it on692

Compact Airborne Spectrographic Imager (CASI) data acquired over mixed693

Australian forests. They reported over 70% of success for the segmentation of694

trees or clusters of trees belonging to the same species, for relatively sparse695

vegetation covers. However, they noted a significant drop in this segmentation696

accuracy for dense and complex canopies. Results obtained by our proposed697

method (up to 54.4 % for Hawaii and 68% for Panama in the best cases) for698

the delineation of tree crowns with various characteristics (such as size, shape699

or species) are therefore very promising. Moreover, segmentation results are700

visually consistent, as can be seen in figure 10. This motivates us to pursue701

additional measures to improve the proposed method, in order to better702

identify and segment tree crowns in tropical rainforests.703

34



5. Conclusion704

The accurate and automatic delineation of tree crowns in tropical rain-705

forests allows application of various object-oriented methods, for example706

the estimation of leaf chemistry, and tree species identification which proved707

to perform better than pixel-oriented counterparts. However this task is708

extremely challenging in these complex ecosystems. Here, we presented a709

method for the segmentation of hyperspectral images of tropical rainforests,710

based on binary partition trees. The evaluation of our method was conducted711

on two test sites presenting different image properties (ground sampling712

distance and number of spectral bands) and forestry characteristics. The713

contributions of the present study are the following:714

- The adaptation of the generic BPT algorithm to a specific application,715

being the segmentation of tree crowns in hyperspectral images of tropical716

rainforests. This was done through the selection of pertinent region717

model and merging criterion.718

- The introduction of a pre-processing step including spectral and spatial719

dimensionality reduction. The former, achieved using a PCA transfor-720

mation, demonstrated how the PCA extracts and highlights discriminant721

information when applied on images acquired over forested covers. It also722

illustrated the low discriminant capacity of the first PC by comparing723

several PC combinations as the input image for the BPT construction.724

The latter showed the interest of initializing the BPT on an initial725

over-segmentation of the image with respect to the pixel level. We726

showed how this pre-segmentation has to meet strict requirements in727

35



terms of size and borders of the generated regions. The results of three728

different segmentation algorithms were compared. Mean shift clustering729

proved to be the most efficient method among the three investigated.730

- The introduction of a new BPT pruning strategy, based on a voting731

process where each leaf of the BPT elects its favorite ancestor. The732

vote depends on the evolution of the region size along a branch, as733

we remarked a clear discontinuity in terms of region size for the node734

whose corresponding region represents a tree crown the best. Not only735

this pruning strategy is adapted for the segmentation of forested areas,736

but also for images featuring a patchwork of homogeneous regions. We737

compared this novel pruning strategy with an already existing one,738

based on spectral graph partitioning. Results showed that the proposed739

pruning strategy was more adapted to this precise task.740

- The introduction of a method assessing the segmentation quality, based741

on the knowledge of some reference regions only. Indeed, due to the742

high complexity of the canopy, it is unrealistic to generate a reference743

segmentation manually. To overcome this issue, ITCs were manually744

delineated and accounted for ground-truth. A particular care was745

taken to select ITCs of various sizes and shapes, and representing the746

species diversity. We proposed to classify these ITCs into four categories747

depending on their segmentation state, namely correctly detected, over-748

segmented, under-segmented and missed. The segmentation quality was749

then defined as the percentage of ITCs correctly segmented.750

36



We are now working on using LiDAR data in a more optimal way. As for now,751

LiDAR was only used to provide an initial segmentation map, the BPT being752

built on the raw or transformed hyperspectral data, thus relying only on753

spectral properties of the scene. However, by incorporating the LiDAR during754

the BPT construction, physical properties such as the height or diameter755

of the crown could be taken into consideration. In particular, the use of756

LiDAR could overcome the case where several trees of the same species are757

aggregated together and are likely to appear as only one region if using only758

spectral properties. The automated selection of PCs containing discriminant759

information as well as the automated tuning of the threshold value for the760

BPT pruning will also be investigated in order to make the proposed method761

fully unsupervised.762

Acknowledgements763

The presented work has been done in a joint collaboration between the764

GIPSA-Lab laboratory at Grenoble (France) and the Department of Global765

Ecology, Carnegie Institution for Science at Stanford (USA). Within the766

GIPSA-Lab, this work has been supported by project XIMRI, ANR 2010767

INTB 0208 01. The Carnegie Airborne Observatory is made possible by the768

Gordon and Betty Moore Foundation; the Grantham Foundation for the769

Protection of the Environment; the John D. and Catherine T. MacArthur770

Foundation; the Avatar Alliance Foundation; the W. M. Keck Foundation; the771

Margaret A. Cargill Foundation; Mary Anne Nyburg Baker and G. Leonard772

Baker Jr.; and William R. Hearst III.773

774

37



Appendix A. About the diffusion distance as a BPT merging cri-775

terion776

Detailed below is the expression of the diffusion distance when used as777

a merging criterion for the construction of a BPT with a non-parametric778

statistical region model. This distance was proposed by Ling & Okada (2006)779

as a measure of discrepancy between histograms. The underlying idea is780

to view the difference between two histograms as a temperature field. The781

distance between the two histograms is based on the time needed for the782

temperature distribution to reach stability via a heat diffusion process, or783

equivalently, on the state of the temperature field after a given time. Opposed784

to bin-to-bin distances which assume that histograms are already aligned and785

compare a bin in one histogram only to the corresponding bin in the other786

histogram, the diffusion distance is a cross-bin distance and is usable even787

when histograms are not aligned. More specifically, for two histograms H1788

and H2 whose P bins are denoted by789

ap ∀p ∈ [1 : P ], (A.1)

the diffusion distance first defines the difference histogram:790

d0(ap) = H1(ap)−H2(ap), (A.2)

and then simulate the temperature diffusion process by convolving the current791

temperature field with a Gaussian kernel792

dm(ap) = [dm−1(ap) ∗ gσ(ap)]↓2 ∀m ∈ [1 : L] (A.3)

where gσ(x) stands for a Gaussian kernel with variance σ, L is the number793

of layers in the convolution process (the time after which the diffusion is794

38



stopped), and ↓2 denotes a downsampling by factor 2. The distance between795

the two histograms is then obtained by summing up the L1 norm of each796

layer:797

O (H1,H2) =
L∑

m=0

‖dm‖1 (A.4)

with798

‖dm‖1 =
P∑
p=1

|dm(ap)| (A.5)

The diffusion distance was successfully adapted to the construction of BPTs799

by Valero et al. (2010a). Being Ri and Rj two neighboring regions during the800

BPT construction, and HRi =
(
Hλ1Ri , . . . ,H

λM
Ri

)
and HRj =

(
Hλ1Rj , . . . ,H

λM
Rj

)
801

their respective region models, the diffusion distance measures for each spec-802

tral band λk the similarity between the pair of histograms HλkRi and H
λk
Rj ,803

O
(
HλkRi ,H

λk
Rj

)
. The merging criterion between the two regions Ri and Rj804

immediately follows on by adding up the contribution of the M spectral805

bands:806

O (Ri,Rj) =
M∑
k=1

O
(
HλkRi ,H

λk
Rj

)
(A.6)

807

References808

Alonso-Gonzalez, A., Valero, S., Chanussot, J., Lopez-Martinez, C., & Salem-809

bier, P. (2013). Processing multidimensional sar and hyperspectral images810

with binary partition tree. Proceedings of the IEEE , 101 , 723–747.811

Andersen, H.-E. (2003). Estimation of critical forest structure metrics through812

the spatial analysis of airborne laser scanner data. Ph.D. thesis University813

of Washington.814

39



Asner, G. P., Jones, M. O., Martin, R. E., Knapp, D. E., & Hughes, R. F.815

(2008). Remote sensing of native and invasive species in hawaiian forests.816

Remote Sensing of Environment , 112 , 1912–1926.817

Asner, G. P., Knapp, D. E., Boardman, J., Green, R. O., Kennedy-Bowdoin,818

T., Eastwood, M., Martin, R. E., Anderson, C., & Field, C. B. (2012).819

Carnegie airborne observatory-2: Increasing science data dimensionality820

via high-fidelity multi-sensor fusion. Remote Sensing of Environment , 124 ,821

454–465.822

Asner, G. P., Knapp, D. E., Broadbent, E. N., Oliveira, P. J., Keller, M., &823

Silva, J. N. (2005). Selective logging in the brazilian amazon. Science, 310 ,824

480–482.825

Asner, G. P., Knapp, D. E., Kennedy-Bowdoin, T., Jones, M. O., Martin,826

R. E., Boardman, J., & Field, C. B. (2007). Carnegie airborne observatory:827

in-flight fusion of hyperspectral imaging and waveform light detection and828

ranging for three-dimensional studies of ecosystems. Journal of Applied829

Remote Sensing , 1 , 013536–013536.830

Asner, G. P., Rudel, T. K., Aide, T. M., Defries, R., & Emerson, R. (2009). A831

contemporary assessment of change in humid tropical forests. Conservation832

Biology , 23 , 1386–1395.833

Beucher, S., & Lantuejoul, C. (1979). Use of watersheds in contour detec-834

tion. In International Workshop on Image Processing: Real-time Edge and835

Motion Detection/Estimation, Rennes, France..836

40



Bunting, P., & Lucas, R. (2006). The delineation of tree crowns in australian837

mixed species forests using hyperspectral compact airborne spectrographic838

imager (casi) data. Remote Sensing of Environment , 101 , 230–248.839

Calderero, F., & Marques, F. (2010). Region merging techniques using infor-840

mation theory statistical measures. Image Processing, IEEE Transactions841

on, 19 , 1567–1586.842

Cardoso, J. S., & Corte-Real, L. (2005). Toward a generic evaluation of image843

segmentation. Image Processing, IEEE Transactions on, 14 , 1773–1782.844

Clark, M. L., Roberts, D. A., & Clark, D. B. (2005). Hyperspectral discrimi-845

nation of tropical rain forest tree species at leaf to crown scales. Remote846

sensing of environment , 96 , 375–398.847

Comaniciu, D., & Meer, P. (2002). Mean shift: A robust approach toward848

feature space analysis. Pattern Analysis and Machine Intelligence, IEEE849

Transactions on, 24 , 603–619.850

Conese, C., Maracchi, G., Miglietta, F., Maselli, F., & Sacco, V. (1988). Forest851

classification by principal component analyses of tm data. International852

Journal of Remote Sensing , 9 , 1597–1612.853

Culvenor, D. S. (2002). Tida: an algorithm for the delineation of tree crowns in854

high spatial resolution remotely sensed imagery. Computers & Geosciences ,855

28 , 33–44.856

Drumetz, L., Veganzones, M. A., Marrero, R., Tochon, G., Dalla Mura, M.,857

Plaza, A., Chanussot, J. et al. (2014). Binary partition tree-based local858

41



spectral unmixing. In Hyperspectral Image and Signal Processing: Evolution859

in Remote Sensing (WHISPERS), 7th International IEEE Workshop on.860

Erikson, M. (2004). Species classification of individually segmented tree861

crowns in high-resolution aerial images using radiometric and morphologic862

image measures. Remote Sensing of Environment , 91 , 469–477.863

Erikson, M., & Olofsson, K. (2005). Comparison of three individual tree864

crown detection methods. Machine Vision and Applications , 16 , 258–265.865

Feret, J., & Asner, G. (2013). Tree species discrimination in tropical forests866

using airborne imaging spectroscopy. Geoscience and Remote Sensing,867

IEEE Transactions on, 51 , 73–84.868

Fung, T., & LeDrew, E. (1987). Application of principal components analysis869

to change detection. Photogrammetric engineering and remote sensing , 53 ,870

1649–1658.871

Garrido, L. (2002). Hierarchical region based processing of images and video872

sequences: application to filtering, segmentation and information retrieval .873

Ph.D. thesis Universitat Politnica de Catalunya-Department of Signal874

theory and Communications, Barcelona, Spain (April 2002).875

Gougeon, F. A. (1995). A crown-following approach to the automatic delin-876

eation of individual tree crowns in high spatial resolution aerial images.877

Canadian journal of remote sensing , 21 , 274–284.878

Horler, D., & Ahern, F. (1986). Forestry information content of thematic879

mapper data. International Journal of Remote Sensing , 7 , 405–428.880

42



Jung, J., Pasolli, E., Prasad, S., Tilton, J., & Crawford, M. (2014). A881

framework for land cover classification using discrete return lidar data:882

Adopting pseudo-waveform and hierarchical segmentation. Selected Topics883

in Applied Earth Observations and Remote Sensing, IEEE Journal of , 7 ,884

491–502.885

Ke, Y., & Quackenbush, L. J. (2011). A comparison of three methods for886

automatic tree crown detection and delineation from high spatial resolution887

imagery. International Journal of Remote Sensing , 32 , 3625–3647.888

Leckie, D. G., Gougeon, F. A., Tinis, S., Nelson, T., Burnett, C. N., &889

Paradine, D. (2005). Automated tree recognition in old growth conifer890

stands with high resolution digital imagery. Remote Sensing of Environment ,891

94 , 311–326.892

Leckie, D. G., Gougeon, F. A., Walsworth, N., & Paradine, D. (2003). Stand893

delineation and composition estimation using semi-automated individual894

tree crown analysis. Remote Sensing of Environment , 85 , 355–369.895

Ling, H., & Okada, K. (2006). Diffusion distance for histogram comparison.896

In Computer Vision and Pattern Recognition, 2006 IEEE Computer Society897

Conference on (pp. 246–253). IEEE volume 1.898

Meyer, F., & Beucher, S. (1990). Morphological segmentation. Journal of899

visual communication and image representation, 1 , 21–46.900

Morton, A. (1986). Moorland plant community recognition using landsat mss901

data. Remote sensing of environment , 20 , 291–298.902

43



Noyel, G., Angulo, J., & Jeulin, D. (2007). Morphological segmentation of903

hyperspectral images. Image Anal. Stereol , 26 , 101–109.904

Olofsson, K. (2002). Detection of single trees in aerial images using template905

matching. In ForestSAT Symposium, Heriot Watt University, Edinburgh.906

Papes, M., Tupayachi, R., Martinez, P., Peterson, A., Asner, G., & Powell, G.907

(2013). Seasonal variation in spectral signatures of five genera of rainforest908

trees. Selected Topics in Applied Earth Observations and Remote Sensing,909

IEEE Journal of , 6 , 339–350.910

Perrin, G., Descombes, X., & Zerubia, J. (2005). Point processes in forestry :911

an application to tree crown detection. Technical Report 5544 INRIA.912

Phinn, S., Ticehurst, C., Held, A., Scarth, P., Nightingale, J., & Johansen,913

K. (2008). New tools for monitoring world heritage values. Living in a914

Dynamic Tropical Forest Landscape, (pp. 591–609).915

Pollock, R. (1996). The automatic recognition of individual trees in aerial916

images of forests based on a synthetic tree crown image model . Ph.D. thesis917

The University of British Columbia.918

Pollock, R. (1998). Individual tree recognition based on a synthetic tree919

crown image model. In Proc. of the International Forum on Automated920

Interpretation of High Spatial Resolution Digital Imagery for Forestry (pp.921

25–34). Victoria, British Columbia, Canada.922

Pouliot, D., King, D., Bell, F., & Pitt, D. (2002). Automated tree crown923

detection and delineation in high-resolution digital camera imagery of924

44



coniferous forest regeneration. Remote Sensing of Environment , 82 , 322–925

334.926

Pouteau, R., & Stoll, B. (2012). Svm selective fusion (self) for multi-source927

classification of structurally complex tropical rainforest. Selected Topics928

in Applied Earth Observations and Remote Sensing, IEEE Journal of , 5 ,929

1203–1212.930

Rasi, R., Beuchle, R., Bodart, C., Vollmar, M., Seliger, R., & Achard,931

F. (2013). Automatic updating of an object-based tropical forest cover932

classification and change assessment. Selected Topics in Applied Earth933

Observations and Remote Sensing, IEEE Journal of , 6 , 66–73.934

Reiche, J., Souza Jr, C. M., Hoekman, D. H., Verbesselt, J., Persaud, H.,935

& Herold, M. (2013). Feature level fusion of multi-temporal alos palsar936

and landsat data for mapping and monitoring of tropical deforestation937

and forest degradation. Selected Topics in Applied Earth Observations and938

Remote Sensing, IEEE Journal of , 6 , 2159–2173.939

Salembier, P., & Garrido, L. (2000). Binary partition tree as an efficient940

representation for image processing, segmentation, and information retrieval.941

Image Processing, IEEE Transactions on, 9 , 561–576.942

Shi, J., & Malik, J. (2000). Normalized cuts and image segmentation. Pattern943

Analysis and Machine Intelligence, IEEE Transactions on, 22 , 888–905.944

Somers, B., & Asner, G. P. (2013). Invasive species mapping in hawaiian945

rainforests using multi-temporal hyperion spaceborne imaging spectroscopy.946

45



Selected Topics in Applied Earth Observations and Remote Sensing, IEEE947

Journal of , 6 , 351–359.948

Tarabalka, Y., Chanussot, J., & Benediktsson, J. A. (2010). Segmentation949

and classification of hyperspectral images using watershed transformation.950

Pattern Recognition, 43 , 2367–2379.951

Tarabalka, Y., Tilton, J. C., Benediktsson, J. A., & Chanussot, J. (2012). A952

marker-based approach for the automated selection of a single segmentation953

from a hierarchical set of image segmentations. Selected Topics in Applied954

Earth Observations and Remote Sensing, IEEE Journal of , 5 , 262–272.955

Thenkabail, P. S., Enclona, E. A., Ashton, M. S., & Van Der Meer, B. (2004).956

Accuracy assessments of hyperspectral waveband performance for vegetation957

analysis applications. Remote sensing of environment , 91 , 354–376.958

Thomas, C. D., Cameron, A., Green, R. E., Bakkenes, M., Beaumont, L. J.,959

Collingham, Y. C., Erasmus, B. F., De Siqueira, M. F., Grainger, A.,960

Hannah, L. et al. (2004). Extinction risk from climate change. Nature, 427 ,961

145–148.962

Valero, S. (2011). Hyperspectral image processing and representation using963

Binary Partition Trees. Ph.D. thesis Gipsa-Lab, Department of Images964

and Signals, Grenoble Institute of Technology, Grenoble, France.965

Valero, S., Salembier, P., & Chanussot, J. (2010a). Comparison of merging966

orders and pruning strategies for binary partition tree in hyperspectral data.967

In Image Processing (ICIP), 2010 17th IEEE International Conference on968

(pp. 2565–2568). IEEE.969

46



Valero, S., Salembier, P., & Chanussot, J. (2010b). New hyperspectral data970

representation using binary partition tree. In Geoscience and Remote971

Sensing Symposium (IGARSS), 2010 IEEE International (pp. 80–83).972

IEEE.973

Valero, S., Salembier, P., & Chanussot, J. (2011a). Hyperspectral image974

segmentation using binary partition trees. In Image Processing (ICIP),975

2011 18th IEEE International Conference on (pp. 1273–1276). IEEE.976

Valero, S., Salembier, P., & Chanussot, J. (2013a). Hyperspectral image rep-977

resentation and processing with binary partition trees. IEEE Transactions978

on Image Processing , 22 , 1430–1443.979

Valero, S., Salembier, P., & Chanussot, J. (2013b). Object recognition in980

urban hyperspectral images using binary partition tree representation. In981

IGARSS (pp. 4098–4101).982

Valero, S., Salembier, P., Chanussot, J., & Cuadras, C. M. (2011b). Improved983

binary partition tree construction for hyperspectral images: application to984

object detection. In Geoscience and Remote Sensing Symposium (IGARSS),985

2011 IEEE International (pp. 2515–2518). IEEE.986

Varekamp, C., & Hoekman, D. (2001). Segmentation of high-resolution insar987

data of a tropical forest using fourier parameterized deformable models.988

International Journal of Remote Sensing , 22 , 2339–2350.989

Veganzones, M., Tochon, G., Dalla-Mura, M., Plaza, A., & Chanussot, J.990

(2014). Hyperspectral image segmentation using a new spectral unmixing-991

47



based binary partition tree representation. Image Processing, IEEE Trans-992

actions on, .993

Von Luxburg, U. (2007). A tutorial on spectral clustering. Statistics and994

computing , 17 , 395–416.995

Wang, L., Gong, P., & Biging, G. S. (2004). Individual tree-crown delineation996

and treetop detection in high-spatial-resolution aerial imagery. Photogram-997

metric Engineering & Remote Sensing , 70 , 351–357.998

Warner, T. A., Lee, J. Y., & McGraw, J. B. (1998). Delineation and iden-999

tification of individual trees in the eastern deciduous forest. In Proc.1000

International Forum: Automated Interpretation of High Spatial Resolution1001

Digital Imagery for Forestry, Canadian Forest Service, Pacific Forestry1002

Centre Victoria, British Columbia (p. 8191).1003

Whiteside, T., & Ahmadb, W. (2008). Estimating canopy cover from eucalypt1004

dominant tropical savanna using the extraction of tree crowns from very1005

high resolution imagery. GEOBIA 2008–GEOgraphic Object Based Image1006

Analysis for the 21st century , .1007

Whitmore, T. C. et al. (1990). An introduction to tropical rain forests..1008

Clarendon Press.1009

Wulder, M., Niemann, K. O., & Goodenough, D. G. (2000). Local maximum1010

filtering for the extraction of tree locations and basal area from high spatial1011

resolution imagery. Remote Sensing of environment , 73 , 103–114.1012

Zhou, J., Proisy, C., Descombes, X., Hedhli, I., Barbier, N., Zerubia, J.,1013

Gastellu-Etchegorry, J.-P., & Couteron, P. (2010). Tree crown detection in1014

48



high resolution optical and lidar images of tropical forest. In Remote Sensing1015

(pp. 78240Q–78240Q). International Society for Optics and Photonics.1016

49



BPT construction

BPT pruning

Quality evaluation

Initial
segmentation

segmentation

score

Input
image

HS Image LiDAR CHM

spectral
reduction

spatial
reduction

Pre-processing

Figure 4: Flowchart of the proposed method. Blue, green and yellow rectangles

correspond to input data, global operations that are further described in

section 3, and outputs of those global operations, respectively.

50



Figure 5: (a) sub-image of Hawaii site (same bands and color stretching used

as in Fig. 1 for RGB representation). (b)-(f) corresponding first five principal

components.

(a) (b) (c) (d)

Figure 6: (a) sub-image of Hawaii site and corresponding initial segmentation

using (b) Watershed algorithm applied to LiDAR CHM, (c) hyperspectral

Watershed, and (d) mean shift clustering.

51



(a) (b) (c)

(d)

Figure 7: Evolution of a region (underlined in red) along a branch of the

BPT : (a) initial region/leaf, (b) region after 21 mergings, (c) region after 22

mergings, and (d) plot of the corresponding evolution of the region size along

the branch. The first and second dots correspond to the regions after 21 and

22 mergings, respectively.

52



s

ratio

overlap

ratio

overlap

oversegmentation?

light
oversegmentation

Detected Undersegmented Missed Oversegmented

no

< 1.5 > 1.5

> 0.7 < 0.7

yes

no

> 0.7

yes

< 0.7

> 1.5< 1.5

Figure 8: Flowchart summarizing the quality assessment method

53



Figure 9: Manually delineated ITC (in red borders) and segmentation result

(in yellow borders) for the case: (a) correctly delineated, (b) missed, (c)

under-segmented, (d) over-segmented.

54



(a) (b) (c)

Figure 10: Visual results obtained when using mean shift clustering, PC

selection without PC #1 and size threshold of 1200 for Hawaii (a,b) and 150

for Panama (c).

200 400 600 800 1000 1200 1400 1600 1800 2000
0

10

20

30

40

50

60

70

80

90

100

threshold value

P
e

rc
e

n
ta

g
e

 o
f 
IT

C
s

 

 
correctly segmented
over−segmented
under−segmented
missed

(a)

200 400 600 800 1000 1200 1400
0

10

20

30

40

50

60

70

80

90

100

threshold value

P
e

rc
e

n
ta

g
e

 o
f 

IT
C

s

 

 
correctly segmented
over−segmented
under−segmented
missed

(b)

Figure 11: Percentages of ITCs correctly segmented, over-segmented, under-

segmented and missed with respect to the threshold value. Results are for

(a) Hawaii site and (b) Panama site, PC selection without PC #1 and mean

shift clustering.

55


	Introduction
	Materials
	Proposed segmentation strategy
	Principle of the Binary Partition Tree
	Methodology
	Pre-processing step
	Spectral reduction
	Spatial reduction

	Construction of the binary partition tree
	Pruning of the binary partition tree
	Recursive spectral graph partitioning pruning strategy
	The evolution of the region size pruning strategy

	Assessing the segmentation accuracy

	Results and discussion 
	Results
	Discussion
	About the PCA configuration
	About the initial segmentation map
	About the pruning strategy
	About the threshold value for the proposed pruning strategy
	About the general performances of the proposed method


	Conclusion
	About the diffusion distance as a BPT merging criterion

