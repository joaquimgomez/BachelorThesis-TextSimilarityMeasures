



























































































Vademecum-based approach to multi-scale topological material design


Ferrer et al. Adv. Model. and Simul.
in Eng. Sci. (2016) 3:23 
DOI 10.1186/s40323-016-0078-4

RESEARCH ART ICLE Open Access

Vademecum-based approach to
multi-scale topological material design
A. Ferrer1,2, J. Oliver1,3* , J. C. Cante1,2 and O. Lloberas-Valls1,3

*Correspondence:
oliver@cimne.upc.edu
1CIMNE - Centre Internacional de
Metodes Numerics en
Enginyeria, Campus Nord UPC,
Edifici C-1, c/Jordi Girona 1-3,
08034 Barcelona, Spain
Full list of author information is
available at the end of the article

Abstract

The work deals on computational design of structural materials by resorting to
computational homogenization and topological optimization techniques. The goal is
then to minimize the structural (macro-scale) compliance by appropriately designing
the material distribution (microstructure) at a lower scale (micro-scale), which, in turn,
rules the mechanical properties of the material. The specific features of the proposed
approach are: (1) The cost function to be optimized (structural stiffness) is defined at
the macro-scale, whereas the design variables defining the micro-structural topology
lie on the low scale. Therefore a coupled, two-scale (macro/micro), optimization
problem is solved unlike the classical, single-scale, topological optimization problems.
(2) To overcome the exorbitant computational cost stemming from the multiplicative
character of the aforementioned multiscale approach, a specific strategy, based on the
consultation of a discrete material catalog of micro-scale optimized topologies
(Computational Vademecum) is used. The Computational Vademecum is computed in
an offline process, which is performed only once for every constitutive-material, and it
can be subsequently consulted as many times as desired in the online design process.
This results into a large diminution of the resulting computational costs, which make
affordable the proposed methodology for multiscale computational material design.
Some representative examples assess the performance of the considered approach.

Keywords: Topological optimization, Multiscale material design, Computational
Vademecum, Topological derivative, Finite element modelling

Background
In the last decades, topological structural optimization has gained considerable impor-
tance in theComputationalMechanicsfield. Besides the increasing interest of the scientific
community, practical applications have been accomplished in the aeronautical [1], auto-
motive and civil engineering industry. In fact, topology optimization tools can be found in
more than thirty commercial software packages [2], e.g. Abaqus [3], Altair HyperWorks
[4].
After the groundbreaking contribution in [5], a density-like approach, termed the solid

isotropicmaterial with penalization (SIMP)method, has been successfully developed dur-
ing the last years. Unfortunately, some numerical problems may occur, like checkerboard
and mesh-dependency. Furthermore, artificial parameters must be provided.

© 2016 The Author(s). This article is distributed under the terms of the Creative Commons Attribution 4.0 International License
(http://creativecommons.org/licenses/by/4.0/), which permits unrestricted use, distribution, and reproduction in any medium,
provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and
indicate if changes were made.

0123456789().,–: vol

http://crossmark.crossref.org/dialog/?doi=10.1186/s40323-016-0078-4&domain=pdf
http://orcid.org/0000-0001-8717-1483
http://creativecommons.org/licenses/by/4.0/


Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 2 of 22

Alternatively, other approaches, such as evolutionary structural optimization (ESO/
BESO), have been proposed [6]. Even though a pseudo-density does not need to be defined,
heuristic criteria is used to find possible sub-optimal solutions.
More recently, shape sensitivity has become a successful topological optimization tool.

Initially, in [7], the so-called shape optimization theory was introduced by Allaire. Within
this theory, the topology optimization problem is solved by means of a level set algorithm
and a Hamilton–Jacobi evolution equation. Nevertheless, in order to remove material,
a topology with holes must be provided as an initial guess. Such conditioning leads to
specific optimal topologies. In addition, from the work in [8], the topological derivative
mathematical concept has been recently used for structural topology optimization. Both
shape optimization and asymptotic expansion theories are essential for the closed-form
expression of the topological derivative. Its success is due to the analytical expressions
that measure an specific shape functional sensitivity when an inclusion is introduced
into a fixed domain. Later studies have been consolidated in the reference book [9].
Additionally, in [10], a level set algorithm is proposed taking advantage of the topological
derivative theory as a gradient of steepest descent algorithm. It is worth noting that this
last approach is exempt from artificial parameters.
Bearing this inmind, the samemethodology can be used formaterial design [11] besides

structural optimization. Computational multi-scale approaches provide an appropriate
framework to achieve it. Either asymptotic multi-scale [12] or variational multi-scale
theories [13] have been extensively used in the recent years. Although the former is based
on analytical expansion theories, the latter seems to fit more naturally into the FEM
context, specially due to its variational framework. In practice, they lead to a FE2 problem
where standard FEM discretizations of the elastic equations are considered at both the
macro and micro-scales.
Apart from [11], otherworks (cf. [14–16]) have recently studied topological optimization

in amulti-scale context, themaindrawbackbeing the expensive computationalmulti-scale
problem to be faced. In consequence, and in order to keep bounded the computational
cost, either the micro-structure topology is kept constant over the whole domain or very
coarse discretizations of this microstructure can only be considered.
In this work, an alternate directions algorithm is proposed as in [12]. Then, inspired in

the Computational Vademecum concept [17], the computationally expensive construc-
tion of a catalog of optimal material designs is made of-line, and only a trivial selection
of the optimal micro-structure is done in the on-line process. As in PGD [17], or POD
strategies [18,19], a considerable reduction on the computational cost is obtained. To
validate this approach, some numerical examples are shown.
The paper is organized as follows: first, in “Multi-scale topology optimization frame-

work” section, the variational multi-scale theory is presented and its main features are
summarized. Additionally, the topological derivative concept on the micro-scale is intro-
duced and the useful final expression is shown. A level-set based algorithm is described
and some examples are presented. In “Multi-scale topology optimization problem” sec-
tion, the formulation of the target problem is stated and conveniently reformulated. A
preliminary study of the problem complexity is also presented. In “Vademecum-based
computational cost reduction” section, the Computational Vademecum is computed and
some examples are shown. In addition, the homogenized constitutive tensor distribu-
tion is represented. In “Numerical algorithm” section, an alternate directions algorithm is



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 3 of 22

conceptually described and some numerical examples are solved in “Numerical examples”
section. Conclusions and future perspectives are summarized in “Concluding remarks”
section.

Multi-scale topology optimization framework
Multi-scale problem

In some cases, phenomenological constitutive laws do not suffice to represent the micro-
scale behavior and predict the macroscopic material properties. On one hand, hetero-
geneities could only be captured in the finite element context with unaffordable fine
meshes. On the other hand, highly demanding applications require better accuracy of the
constitutive modeling.
To overcome this difficulty, multi-scale techniques, based on homogenization theories,

aim at representing heterogeneities of the small length scale lμ by taking mean values of
the micro-scale material properties. Each homogeneous region of the continuummacro-
scopic domain, represented by the corresponding integration/sampling point, retrieves
the constitutive law from the average response of a representative microscopic domain,
i.e. the representative volume element (RVE) (cf. Fig. 1).
Different theories have been developed in order to set up the corresponding math-

ematical framework [12,13]. Asymptotic expansion and variational multi-scale may be
nowadays the most successful approaches in the computational mechanics community.
Even though asymptotic expansion is a rigorous mathematical theory and has been used
for a long time, variational multi-scale theory seems to be easier to generalize and extend
to non-linear problems. Furthermore, variational approaches usually fit more naturally in
the context of finite element methods. In our study, this last approach will be used. For
more information, the reader is referred to the works in [13].

Multi-scale variational framework

Firstly, this framework sets that the strain on the micro-scale, �μ(x), is defined by the sum
of the macro-scale strain, �(x), and a fluctuating strain �̃μ(x, y). Secondly, as an axiom, a
zero mean value on the micro-scale is established. That is,

Fig. 1 Macroscopic and microscopic domains



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 4 of 22

�μ(x, y) = �(x) + �̃μ(x, y), (1)∫
�μ

�̃μ(x, y) = 0. (2)

As a consequence of this, the macro-scale strain becomes the volume average of the
micro-scale strain, i.e.

�(x) = 1
�μ

∫
�μ

�μ(x, y). (3)

At this time, the functional spaces of the macroscopic and fluctuation strains can be
defined as

V� = {�(x) ∈ T 2(Rd,R)}, (4)

V�̃μ =
{

�̃μ(x, y) |
∫

�μ

�̃μ(x, y) = 0
}

(5)

being T 2(Rd,R) the symmetric second order tensor space. Thus, the micro-scale strain
space function becomes simply

V�μ = {�μ(x, y) | �μ(x) = �(x) + �̃μ(x, y)}, (6)
with � ∈ V� and �̃μ ∈ V�̃μ . The definition of these spaces plays a key role on the Hill-
Mandel Principle. For more details, see [13].

Hill- Mandel principle

The Hill-Mandel principle postulates that the internal energy of a macroscopic point
should be equal to the volume average of the microscopic internal energy [13], that is

σ : δ� = 1
�μ

∫
�μ

σμ : δ�μ ∀δ�μ ∈ V�μ . (7)

where σ is the macro-scale stress tensor and σμ is the micro-scale stress tensor.
According to (6) a variation of the microscopic strain implies a variation on the macro-

scopic strain and a variation on the microscopic fluctuation, i.e.,

δ�μ = δ� + δ�̃μ. (8)
Since the Hill-Mandel principle holds for all δ�μ ∈V�μ , it also holds for:
• First, δ�̃μ = 0 ⇒ δ�μ = δ� and, as a result, (7) takes the following form,

σ : δ� = 1
�μ

∫
�μ

σμ : δ� ∀δ� ∈V� . (9)

Applying the fundamental lemma of calculus of variations, the first consequence of the
Hill-Mandel principle is that the macroscopic stress tensor is the average of the micro-
scale stress tensor over the whole RVE,

σ (x) = 1
�μ

∫
�μ

σμ(x, y). (10)

• Second, δ� = 0 ⇒ δ�μ = δ�̃μ, therefore (7) becomes

σ : δ� = 1
�μ

∫
�μ

σμ : δ�̃μ = 0 ∀δ�̃μ ∈V�̃μ . (11)



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 5 of 22

Therefore, the second consequence of the Hill-Mandel principle is the equilibrium
equation of the RVE∫

�μ

σμ : δ�̃μ = 0 ∀δ�̃μ ∈ V�̃μ . (12)

This result points out that the fluctuations do not produce work, i.e. they have zero
internal energy.

Equilibrium equation andmicro-cell boundary conditions

For the case of linear elastic behavior in the micro-scale, the constitutive equation takes
the form

σμ(x, y) = Cμ(x, y) : �μ(x, y). (13)
Therefore Eq. (12) is rewritten as∫

�μ

�μ : Cμ : δ�̃μ = 0 ∀δ�̃μ ∈ V�̃μ , (14)

and considering (1) the equilibrium equation results∫
�μ

�̃μ : Cμ : δ�̃μ = −
∫

�μ

� : Cμ : δ�̃μ ∀δ�̃μ ∈ V�̃μ . (15)

After applying the Gauss theorem, (2) can be written as,∫
�μ

�̃μ =
∫

�μ

∇sũμ =
∫

∂�μ

ũμ ⊗s n = 0, (16)

where ũμ is the fluctuation displacement field. In fact, integrating (1) the micro-scale
displacement uμ fulfills

uμ(x, y) = �(x)y + ũμ(x, y). (17)
So that, defining the space function of the fluctuation displacement as

Vũμ =
{
ũμ(x, y) |

∫
∂�μ

ũμ ⊗s n = 0
}
, (18)

the equilibrium Eq. (15) becomes∫
�μ

∇sũμ : Cμ : ∇sδũμ = −
∫

�μ

� : Cμ : ∇sδũμ ∀δũμ ∈ Vũμ . (19)

Therefore, a micro-scale problem involves solving a classical weak formulation of an
equilibrium problem subject to the constraint (18). There are different approaches to
satisfy this boundary condition of the RVE. In literature, see [13], the most frequently
used are Taylor, linear, periodic and minimum condition.
Materials with periodic micro-structures are suitable for periodic conditions. For some

specific micro-scale geometries like square cells (hexagonal cells, and others is similar),
the boundary can be divided in two parts �1 and �2 (see Fig. 2) with outward unit normal
such that,

n+1 = −n−1 ; n+2 = −n−2 . (20)
Thus, condition (18) may be written as∫

∂�μ

ũμ ⊗s n =
∫

�
+
1

ũ(1)
+

μ ⊗s n+1 +
∫

�
+
2

ũ(2)
+

μ ⊗s n+2

+
∫

�
−
1

ũ(1)
−

μ ⊗s n−1 +
∫

�
−
2

ũ(2)
−

μ ⊗s n−2 = 0, (21)



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 6 of 22

Fig. 2 RVE periodic domain, square cell

where ũ(1)
+

μ is the fluctuation on �+1 and ũ
(2)+
μ is the fluctuation on �+2 . Equivalently, for

�
−
1 and �

−
2 .

Taking into account (20),∫
∂�μ

ũμ ⊗s n =
∫

�
+
1

(ũ(1)
+

μ − ũ(2)
+

μ ) ⊗s n+ +
∫

�
−
1

(ũ(1)
−

μ − ũ(2)
−

μ ) ⊗s n− = 0. (22)

Equation (21) is satisfied using periodic boundary conditions imposing that

ũ(1)
+

μ = ũ(2)
+

μ (23)

ũ(1)
−

μ = ũ(2)
−

μ (24)

The homogenized constitutive tensor

Homogenization of the constitutive tensor is an essential part of the computational multi-
scale approach. As in other fields of mechanics, its definition is given by

C
h := ∂σ

∂�
= 1

�μ

∫
�μ

∂σμ

∂�
= 1

�μ

∫
�μ

Cμ :
∂�μ

∂�
, (25)

where Eq. (10) and linear elastic hypothesis have been used.
Taking derivatives of (1) w.r.t. the macroscopic strain,

∂�μ

∂�
= I + ∂∇

sũμ
∂�

= I + A(y) (26)
being I the symmetric fourth-order identity tensor andA(y) the fourth order localization
tensor. From (19), there is a linear dependency between ∇sũμ and �, thus,

∇sũμ = A(y) : �. (27)
Due to linearity, a straightforward calculus of the localization tensor is performed by

computing ∇sũμ from (19) for each canonical base.
Consequently, the homogenized constitutive tensor takes the form

C
h = 1

�μ

∫
�μ

Cμ +
1

�μ

∫
�μ

Cμ : A(y)

= C̄ + C̃ (28)

C̄ and C̃ denoting, respectively, the volume average elastic micro-scale constitutive
tensor and the fluctuation contribution of the homogenized constitutive tensor.



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 7 of 22

Finally, due to linearity, the macroscopic constitutive equation can be written as,

σ = Ch : �. (29)

Topological derivative at the micro-scale

Recently, topological derivative has emerged as a useful tool for structural topology opti-
mization [10,12,20,21] andmaterial design [11,22]. Sokolowski and Zochowski, in [8], set
up the foundation of the topological derivative theory, and some years later, such theory
consolidates in the reference book [9].
In the topological derivative theory context, a closed formula is obtained as the sensitivity

of a shape functionalwhen an inclusion on the domain is introduced. Its derivation is based
primarily on the concepts of shape optimization and topological asymptotic expansion as
follows.

Topological derivative of the homogenized constitutive tensor

First, anunperturbedRVEdomain,�μ is introduced . Fromthe strong formof theproblem
(19), the microscopic equilibrium equations can be written as,

⎧⎪⎨
⎪⎩

∇ · σμ (̃uμ) = 0 in �μ,
σμ (̃uμ) = Cμ : ∇sũμ,

ũ(1)μ = ũ(2)μ on ∂�μ.
(30)

Subsequently, the elastic problem on the perturbed domain is presented. First, a circular
hole B�̂ of radius �̂ and center ŷ is set in the domain�μ, and then an inclusion of the same
shape but with different material properties is introduced, see Fig. 3 . For the case of an
actual void created in the domain �, the reader is referred to the work in [9].
To account for this case the superscript notation (•)�̂ is introduced. Consequently, the

strong form of the equilibrium equation on the perturbed domain ��̂μ reads as follows:
⎧⎪⎪⎪⎪⎪⎪⎪⎪⎨
⎪⎪⎪⎪⎪⎪⎪⎪⎩

∇ · σ �̂μ(ũ�̂μ) = 0 in ��̂μ,
σ �̂μ(ũ

�̂
μ) = γ�̂Cμ : ∇sũ�̂μ,(

ũ�̂μ
)(1) = (ũ�̂μ

)(2) on ∂��̂μ.
�ũ�̂μ� = 0 on ∂B�̂ ,

�σ �̂μ(ũ
�̂
μ)� · n = 0 on ∂B�̂ ,

(31)

where γ�̂ (the contrast parameter) sets thematerial stiffness value at the inclusion, B�̂ , and
at the unperturbed material, �μ\B̄�̂ , as:

Fig. 3 Micro-scale elastic problem on the perturbed domain



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 8 of 22

γ�̂ =
{
1 in �μ\B̄�̂ ,
γ in B�̂ .

(32)

Bearing this in mind, an asymptotic expansion of the homogenized constitutive tensor
C
h is proposed as,

C
h
�̂ = Ch + f (�̂)DTCh + o(f (�̂)) (33)

whereCh andCh
�̂
stand for the homogenized constitutive tensor (25) of problems (30) and

(31) respectively. For the considered case, f (�̂) takes the following value:

f (�̂) = π�̂
2

|�μ|
. (34)

Then, after some mathematical derivations, the topological derivative of the homoge-
nized constitutive tensor, DTCh, yields a fourth-order tensor, whose final expression, see
[9], for plane stress cases reads (in Cartesian coordinates and using indicial notation):(

DTCh
)
ijkl

= σμ (̃uμij ) : H : σμ (̃uμkl ), (35)
whereH is also a fourth-order tensor, depending on thematerial properties, whose expres-
sion is given by:

H = − 1
Eμ

(
1 − γ
1 + αγ

)[
4I − 1 − γ (α − 2β)

1 + βγ (I ⊗ I)
]

(36)

being

α = 1 + νμ
1 − νμ

, β = 3 − νμ
1 + νμ

.

In Eq. (36) Eμ and νμ are the Young modulus and the Poisson ratio of the micro-scale
material. Notice that the topological derivative (35) is a tensor field defined point-wise,
which depends only on the solution of the unperturbed problem, themicro-scale material
parameters and the contrast parameter of the inclusion. For a complete and rigorous
derivation of the expression in (35) the reader is referred to [11].

Level set algorithm

An important implication of the topological derivative concept is that the homogenized
constitutive tensor sensibility to the introduction of an inclusionmay be determined. This
allows using this sensibility as the driving-force in a topological optimization problems
(cf. [10]).
Briefly, the minimization problem is stated as

minimize
χ

J (χ ) (37)

where χ is the characteristic function, stating the distribution of material and voids (or
small-stiffness inclusions), and J (χ ) is the cost function.
Defining a C1(�) nodal level-set field ψ , over the domain, such that,

χ =
⎧⎨
⎩
1 ψ < 0,

0 ψ > 0.
(38)

problem (37) yields

minimize
ψ

J (χ (ψ)) (39)



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 9 of 22

and, consequently, the level-set field ψ becomes the new unknown variable. To solve
Eq. (39) a slerp-type algorithm, see [10], is proposed through the recursive formula:

ψn+1 =
1

sin θn
[sin((1 − κn)θn)ψn + sin(κnθn)

gn
||gn||L2

], (40)

being κn ∈ [0, 1] a line search-like parameter, gn the topological derivative and θn the angle
between ψn and gn which is written as

θn = acos
[

(ψn, gn)
||ψ ||L2 ||gn||L2

]
. (41)

providing the converge criterion when it is smaller than a certain tolerance. The iterative
procedure in equations (40) and (41) can be regarded as an update of the level set, ψn+1,
to match the topological derivative gn in the unit sphere (slerp), along a line-search step of
parameter κn, which, in turn, is chosen to provide the maximum decrease of the objective
function J (χ (ψ)).

Representative examples

To illustrate the methodology proposed above some examples are presented next. The
RVE structural compliance is aimed at being minimized through the following minimiza-
tion problem:

minimize
χμ

σ : C−1h (χμ) : σ

subjected to :
∫

�μ

χμ = Vμ
(42)

where Vμ is the RVE solid-volume, σ stands for the unit norm macroscopic stress ten-
sor, here considered the driving force for the homogenization problem, and Ch is the
homogenized constitutive tensor.
Following the work in [20,23,24] an augmented Lagrangian algorithm is used to solve

the unconstrained problem (42), which can be rewritten as

max.
λ

min.
χμ

σ : C−1h (χμ) : σ + λ
(∫

�μ

χμ

Vμ
− 1

)
+ 1

2
ρ

(∫
�μ

χμ

Vμ
− 1

)2
. (43)

where ρ is the penalty parameter. Straightforwardly, the topological derivative is com-
puted as

g(χμ) = −C−1h (DTCh)C−1h + λ
1
Vμ

+ ρ
(∫

�μ

χμ

Vμ
− 1

)
1
Vμ

. (44)

Finally, problem (43) is solved using algorithm (40) and the augmented Lagrangian-type
update of lambda:

λn+1 = λn + ρ
(∫

�μ

χμ

Vμ
− 1

)
. (45)

As amatter of example, three different cases are computed now. In all of them, the initial
topology is selected as in [11], the initial Lagrange multiplier is λ0 = 0, the final solid-
volume is Vμ = 0.6, the elastic parameters are Eμ = 1, νμ = 0.3, the contrast parameter
is γ = 0.001 and the penalty is chosen ρ = 1. The algorithm stops when θ < 10 and the
volume constraint tolerance Tol < 0.001.
The selection of the macroscopic unit stress σ defines the case of study. That is, in

Voight notation:



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 10 of 22

• Uniaxial horizontal stress-state: σ =
⎡
⎢⎣
1
0
0

⎤
⎥⎦

• Shear stress-state: σ =
⎡
⎢⎣
0
0
1

⎤
⎥⎦

• Bulk stress-state: σ = 1√
2

⎡
⎢⎣
1
1
0

⎤
⎥⎦

The obtained optimal topologies are presented in Fig. 4. All the relevant information is
summarized in Fig. 5. Notice that the objective function oscillates during the iterations,
mimicking the saddle point feature of the problem (43). It should be also remarked that the
algorithm is capable of conveniently adding and subtracting material along the iterations.

Fig. 4 Horizontal, shear and bulk stress-state optimal RVE topologies

Fig. 5 Relevant information evolution along the iterative process



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 11 of 22

In all cases less than 10 min of computation are needed with a standard PC (3.40GHz
processor in a 64-bit architecture) in a vectorized Matlab© environment.

Multi-scale topology optimization problem
Once the computationalmulti-scale homogenization framework has been introduced and
the micro-structure topology optimization method has been described, next step is to use
these ingredients for material design purposes. In other words, to determine the optimal
micro-structure topology at every point of themacro-structure domain in order to achieve
a functional goal at the macro-scale level as it is sketched in Fig. 6.

Formulation

The classical topological optimization problem in structural analysis refers to the mini-
mum compliance (or maximum stiffness) design. Here the classical single-scale problem
of determining the optimum distribution of a certain material mass at the macro-scale
(or structural scale), to achieve the minimum compliance of the resulting structure [5],
is reformulated as a two-scale problem in the following sense: the goal is the optimal
distribution of a given material mass, but now at the micro-scale level for every structural
point (given the shape and topology at the structural scale).
The problem is mathematically stated through:

minimize
χμ

∫
�

σ (χμ) : C−1h (χμ) : σ (χμ)

subjected to:

∫
�μ

χμ

Vμ
− 1 ≤ 0,

(46)

where themacroscopic stresses, σ , fulfill Eq. (29) and are the solution of an standard linear
elasticity problem. From the optimization point of view, problem (46) may be appropiatly
rewritten as,

minimize
σ ,χμ

∫
�

σ : C−1h (χμ) : σ

subjected to:

∫
�μ

χμ

Vμ
− 1 ≤ 0,

∇ · σ = ρb,
+ Boundary conditions.

(47)

In Eq. (47), χμ ∈ {0, 1}, refers to the characteristic function at the RVE, whose optimal
spatial distribution (defining the topology of the RVE) is aimed at being obtained, and Vμ

Fig. 6 Multi-scale topology optimization problem



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 12 of 22

refers to the “measure” (area or volume) of the RVE. In this respect the following aspects,
specific for this multi-scale problem, have to be highlighted:

1. The objective function to beminimized is highly nonlinear and defined at themacro-
scale level.

2. The design variables (the values of the characteristic function χμ) are defined at the
micro-scale

3. The equilibrium equation couples both macro and micro levels since, although the
stresses are definedmacroscopically, the constitutive Eq. (29) depends on themicro-
structural topology.

Algorithmic separability

As pointed-out above, the addressed minimization problem in Eq. (47) entails multi-scale
coupling and non-linearities. Due to its non-linear character different solutions, corre-
sponding to different local minima, might be expected. Due to the multi-scale coupling
character, the computational robustness of the minimization scheme can be seriously
affected.
As a first step, a separation of theminimization problem is introduced here to overcome

those difficulties. The original problem in Eq. (47) is slightly rephrased as:

minimize
σ

⎧⎪⎨
⎪⎩

minimize
χμ

∫
�

σ : C−1h (χμ) : σ

subjected to
∫
�μ

χμ

Vμ
− 1 ≤ 0,

subjected to ∇ · σ = ρb,
+ Boundary conditions.

(48)

This subtle change could be thought as a different notation of the same problem or, even
more stimulating, a way of solving the problem. Once in that stage, and inspired by the
divide and conquer approach, a tentative second step consists of solving theminimization
problem locally, i.e., rewriting Eq. (48) as,

minimize
σ

∫
�

⎧⎪⎨
⎪⎩

minimize
χμ

σ : C−1h (χμ) : σ

subjected to
∫
�μ

χμ

Vμ
− 1 ≤ 0,

subjected to ∇ · σ = ρb,
+ Boundary conditions.

(49)

where the main change is the exchange between the minimization and the integral oper-
ator. Note that the equilibrium equation plus the boundary conditions are solved as a
standard FEM equilibrium problem, that is,

K (χμ)u = F. (50)

Due to the fact that all unknowns and constraints of the minimization subproblem are
defined locally at Eq. (48) and that the cost function (

∫
�

σ : C−1h (χμ) : σ ) is the sumof local
positive-definite cost functions (σ : C−1h (χμ) : σ � 0), the exchange can be done without
altering the global solution. In other words, the micro-scale topologies that provide the
minimum global (structural) compliance. are those micro-structure topologies leading to
minimal local compliances for every local RVE.



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 13 of 22

Algorithmic complexity

Once problem (49) is stated, its algorithmic complexity (here understood as the number
of operations to be performed) is tackled .
Considering a typical FEM discretization involving, say, n finite elements at every scale

(47) o (n2) design variables (o (n) values of the characteristic function,χμ, at the RVE times
o (n) macroscopic sampling points) are involved. Hence, one optimization problem with
a grand total of nT = o (n2) design variables has to be solved.
In contrast, problem (49), may be seen as a o (n) local design-variable optimization

problem, solved o (n) times (one for every macroscopic sampling point). This makes an
enormous difference in terms of the problem complexity and the corresponding compu-
tational cost.
The local optimization problem is then sought, as iteratively solving the global equi-

librium equation, starting with a given initial micro-structure topology distribution, and
modifying it by the algorithm (40) leading to a new RVE topology (in an uncoupled way
from the other RVE’s), until convergence. A similar approach is presented in [14].
In addition, a natural strategy to tackle the problem in (49) consists of solving the local

optimization problem at all the o (n) macroscopic sampling points in an way uncoupled
from each other, which makes the corresponding algorithm highly parallelizable.

Vademecum-based computational cost reduction
Despite resorting to parallel computation, problem (49) still exhibits high complexity and
it becomes computationally unaffordable for real-life problems. In this scenario, a more
efficient approach is proposed here. The main idea consists of optimizing “a priori” a
very large discrete-set of micro-structures, in the set of possible macro-stresses acting on
the RVE, leading to the so-called “Material Catalogue” or “Computational Vademecum”
[17]. Then, when a certain optimal microstructure topology is required in the global
(multi-scale) design problem a certain optimal microstructure topology is requested, for
a given stress-state at the macro-scale sampling point, the Vademecum is consulted and
the closest optimal solution is extracted.
More precisely: given the mechanical properties of the base-material, the expensive

computations requested for the Vademecum construction are done once-for-all, in an
offline process, and the Vademecum outputs (typically the tangent constitutive operator,
Ch, solution of Eq. (42) and the compliance are stored in a data-base for, a sufficiently
large, discrete set of entries σ .
The actual multi-scale material design problem is then performed “on-line”, and it only

involves a recursive equilibrium analysis at the macro-scale combined with consultations
to the Vademecum. This translates into an impressive reduction of the computational
cost of the on-line material design process. It is highlighted that the Vademecum remains
the same for a given base-material, disregard the kind of macro-scale structural problem
aimed at being optimized.

Parametric domain

The success of the proposed Vademecum-based strategy crucially relies on the appro-
priate determination of the Vademecum entries so that a good balance of the
error/computational-cost is achieved. Indeed, since the error is produced by the closest-



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 14 of 22

entry strategy, a higher number of entries lowers the resulting error but increases the
computational cost related to the construction of the Vademecum.
Theparametric domaindefines the rangeof the spaceof all possiblemacroscopic stresses

σ . Inspection of Eq. (49) shows that the modulus of σ does not play any role in the
determination of the optimal RVE topology. In fact, it can be readily proven that

χμ = arg
⎧⎨
⎩
minimize

χμ
σ : C−1h (χμ) : σ

s.t.
∫
�μ

χμ = Vμ

⎫⎬
⎭

= arg
⎧⎨
⎩
minimize

χμ

σ
||σ || : C

−1
h (χμ) :

σ
||σ ||

s.t.
∫
�μ

χμ = Vμ

⎫⎬
⎭ (51)

Therefore, σ||σ || is the actual Vademecum entry. For 2D cases the relevant entry space
is then made of unit-modulus stress vectors, which lie in unit-radius sphere and can be
parametrized in terms of the two Euler angles, φ and θ , and as:

σ =
⎡
⎢⎣

σx
σy
σxy

⎤
⎥⎦ =

⎡
⎢⎣
cos(φ)cos(θ )
sin(φ)cos(θ )

sin(θ )

⎤
⎥⎦ (52)

Hence, the parametric domain is represented by the unit radius sphere. Each point
of the sphere can be seen as a micro-structure optimization case, which returns some
homogenized elastic properties associated to an optimal topology (see Fig. 7).
For the subsequent examples the sphere has been discretized by means of a structured

mesh of 16386 points. However, the bottom half points need not to be computed because
they have an homologous point at the top half of the sphere. This is because σ or −σ ,
plugged in problem (51), result in the same objective function. Besides, only a quarter part

Fig. 7 The unit-radius spherical parametric domain (Computational Vademecum)



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 15 of 22

of the top half of the sphere must be computed due to symmetries and mirroring. Conse-
quently, an eighth of the whole sphere has been actually considered for the computations,
resulting into 2145 points to be actually computed.
As for the involved computational cost: it is remarked that theVademecumcomputation

is fully parallelizable for the different entries (every case is fully uncoupled), and, therefore,
the algorithm is “embarrassingly parallel” in clusters of distributed memory architecture.
In the examples presented in this section, a cluster of 200 workers (Intel Xeon E5) has

been used to compute around 2000 entries of theVademecum, for a given volume fraction.
The resulting computational time was around 3h.
Some examples of this optimal RVE topologies can be seen in Fig. 8. They have been

computed for the solid volume fraction at the RVE Vμ = 0.6. Note that no length scale
control scheme is imposed, thus, thin and non manufacturable topologies might appear.
Perimeter penalization, see [25], or filtering techniques might be applied as potential
remedies.
It is worth mentioning that construction of such Vademecum requires a very robust

methodology for the RVE topological design, so that none of the desired entry points
fails to be computed. In this sense it has to be remarked that the use of the topological
derivative concept and its application in the algorithm (40), as proposed in this work,
fulfills this requirement. All cases converged for a constant value of the penalty, with a
convergence tolerance θ < 1o and a tolerance on the volume constraint TOL < 0.001.
It is also remarkable from Fig. 8, that, for many cases, the obtained optimal topologies

are far from being intuitive.
Associated to the optimal topologies, andbasedonproblem (51), the correspondingRVE

compliances for every point of the parametric space are computed, and they are displayed
in Fig. 9. It has to be emphasized that, from the theoretical point of view, there is no guar-
antee that a localminimumhas been achieved in all cases, although numerical experiences
have evidenced that the obtained compliances are very close to the global minima.
As explained before, the homogenized constitutive operator, Ch, and the compliance

(cost function), constitute the relevant “outputs” of the Vademecum. Indeed, only the
compliance is strictly needed in the iterative algorithm. However, the homogenized con-
stitutive operator is also stored in the Vademecun in order to be used for post-processing
purposes, when requested, at the end of the analysis.
Accordingly, in Fig. 10, the Vademecum outputs for the optimal homogenized compo-

nents of Ch are presented.

Fig. 8 Typical micro-structure topology outputs of the Computational Vademecum



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 16 of 22

Fig. 9 Optimal compliance values over the parametric domain

Fig. 10 Maps of the constitutive tensor components on the unit-radius spherical parametric domain

There, the major symmetries of Ch (symmetric character of the maps of the sym-
metric components) as well as the rotated mirroring C11– C22 and C13– C23 can be
observed.



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 17 of 22

Numerical algorithm
In the following the numerical algorithm, implemented in a Matlab code, for solving the
minimization problem (49) is presented.

The described algorithm stems naturally from Eq. (49). It is based on the alternate
directions scheme, extensively used in the literature (see for example [12]). Since linear
elasticity is considered in themechanical stage, the stresses are obtained by solving a linear
problem, using the topology-updated stiffness-matrix. Then, in the subsequent optimiza-
tion stage, by using the closest entry to the obtained stresses, the optimal mechanical
properties, and the corresponding topology, are obtained by consultation of the material
catalog (Vademecum). Moreover, the non-linear character of the optimization problem
is already accounted for in the Computational Vademecum construction (offline).
As for the global coupled problem, the non-linearity is accounted for by the alter-

nate directions (fixed point) algorithm, and, therefore, only a linear convergence ratio is
expected. In spite of this, “Numerical examples” section, it is shown that only few iterations
are required for solving this non-linearity.

Numerical examples
In order to assess the proposed approach some numerical examples are presented next. In
all cases the solid volume fraction at the RVE is Vμ = 0.6, thus satisfying

∫
�μ

χμ = Vμ =
0.6. As start point in the iterative procedure, a micro-structure with a centered circular
void fulfilling this condition is taken at all RVE’s (see Fig. 11a).

Cantilever beam

The microstructure topological design of the cantilever beam in Fig. 11 is studied. The
dimensions are 2 m length × 1 m height, and plane stress conditions are assumed. The
beam is loaded by a unit vertical point force, at the right end center, and it is clamped at
the left end.
This rectangular macroscopic domain, is discretized into 2618 three-noded triangular

elements. The elastic properties of the basis material are: Young modulus Eμ = 1 and



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 18 of 22

Fig. 11 Cantilever beammicrostructure design: RVE topology distribution along the iterative design process.
a Iteration 1, b Iteration 2, c Iteration 3, d Iteration 4

Poisson ratio νμ = 0.3. In Fig. 11 the evolution of the micro-structure topology, along the
iterative design process are displayed.
In Fig. 12, the evolution of the global cost function (structural compliance) and of the

residue of the alternate directions algorithm is depicted. As it can be observed in Fig. 12,
four iterations suffice to achieve full convergence with a 30 % reduction of the original
compliance. The convergence ratio of the iterative process is linear, as expected from the
used alternate directions algorithm.

Fig. 12 Cantilever beammicrostructure design: compliance and residue evolutions for the alternate
directions algorithm



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 19 of 22

Bending beam

The microstructure topological design of a simply supported bending beam is studied.
The same macroscopic domain as in the previous example, is now discretized in 5056
linear triangular elements. The beam is loaded with a vertical unity force at the mid-span
(see Fig. 13).
The evolvingmicro-structure distribution during the iterative design process is depicted

in Fig. 13. In Fig. 14 it can be observed that a fast convergence is achieved also in this case
(six iterations) leading to almost 40 % reduction of the structural compliance.

Fig. 13 Simply supported bending beam: RVE topology distribution along the iterative process. a Iteration 1,
b Iteration 2, c Iteration 3, d Iteration 4, e Iteration 5, f Iteration 6



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 20 of 22

Fig. 14 Simply supported bending beam: compliance and residue evolutions for the alternate directions
algorithm

Concluding remarks
In this work a new approach to computational material design has been presented and
applied tomulti-scale topological design of structural materials. A computational homog-
enization scheme for two scales (FE2) has been considered to account for the impact of the
lower scale material distribution on the global structural properties. This is done through
the resulting point-wise homogenized elastic properties.
In this context, a through-scale optimization problem has been introduced, where the

cost function (compliance) is defined at the structural scale, whereas the design variables
(the values of the characteristic function at the RVE) are defined at the micro-scale. This
is a challenge which is faced in an innovative way in this work.
To overcome the exorbitant cost typically encountered in brute force FE2 homogeniza-

tion methods, and taking advantage of the macro/micro separability properties of the
stated problem, a Vademecum-based strategy has been devised. It consists of the, off-line,
construction of a discrete material catalog, containing an appropriate large set of optimal
RVE designs, each one corresponding to a singlemacroscopic stress state. The topological
derivative mathematical tool, jointly with a level set algorithm, based on “slerp” interpola-
tions and a specific line searchmethod, have proved robust enough to provide the optimal
RVE designs necessary for the Vademecum construction (more than 2000 for the pre-
sented examples). Once this Vademecum is available, it can be repeatedly consulted for
the optimal material design of any structure made of the same base material.
For the examples presented in this work, a prescribed volume fraction, has been consid-

ered in the construction of the Computational Vademecum. Naturally, the Vademecum
computation could also be extended to account for a range of volume fractions, this not
implying any conceptual change in the computations, other than the extension of the
Vademecum parametric domain with an additional dimension (the volume fraction).
However, the use of this extended Vademecum in a context where the volume frac-

tion may vary from point to point (e.g. when optimizing the weight of the macroscopic
structure) is not trivial and it is left for future works.
In this framework a global optimization algorithm, based on consultation of the Vade-

mecum in combination with the equilibrium solution of themacroscopic structural prob-
lem, results into a highly non-linear problem that, however, can be solved by means of a



Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 21 of 22

fixed point algorithm in remarkably robust fashion. by means of a fixed point (or alternate
directions) algorithm.
The resulting strategy becomes both robust and computationally efficient for tackling

the microstructure computational design problem in structural materials. Some repre-
sentative examples illustrate the proposed methodology, and show that large reductions
of the structural compliance (up to 40 %) can be achieved by using the proposed “local”
topology design strategy, in front of the alternative “homogeneous” material distribution.
It is worth mentioning that, although a smooth transition of material distribution is

often seen by the authors, some incompatibilities could appear. Additional constraints
must be imposed in order to avoid manufacturability limitations. In our current ongoing
work, this issue is addressed and an improved methodology will be proposed.
The issue of the topological continuity/compatibility at micro-scale points has also to

be commented. In fact, it has to be remarked that a point-to-point varying topology, as
considered here, is an idealized situation, which is not manufacturable in practice and,
therefore, it has little industrial interest.
In realistic cases, a piecewise constant topological design, so that the same topology is

kept constant in specific macroscopic parts (or components), has much more interest.
The extension of the here proposed approach to these cases is going to be presented in a
forthcoming work.
Some other important issues remain open in the setting of computational mater-

ial design. Typically: (1) manufacturability issues, related to piece-wise design of the
macrostructure in homogeneous components, and (2) simultaneous topological design,
at the macro and micro scales. They are object of ongoing research, and they will be
presented by the authors in future works.

Authors’ contributions
AF contributed to the theoretical developments and was in charge of the numerical implementation and validation of
the results. JO conceived the work and was in charge of the theoretical formulation JC participated in the design and
coordination of the work and in the assessment of the numerical results OL contributed to the general assessment of the
work and to draft the manuscript. All authors read and approved the final manuscript.

Author details
1CIMNE - Centre Internacional de Metodes Numerics en Enginyeria, Campus Nord UPC, Edifici C-1, c/Jordi Girona 1-3,
08034 Barcelona, Spain , 2Escola Superior d’Enginyeries Industrial, Aeroespacial i Audiovisual de Terrassa, Campus de
Terrassa, Edificio TR45. C. Colom, 11 08222 Terrassa, Spain, 3E.T.S. d’ Enginyers de Camins, Canals i Ports, Technical
University of Catalonia, Campus Nord UPC, Edifici C-1, c/Jordi Girona 1-3, 08034 Barcelona, Spain.

Acknowledgements
The research leading to these results has received funding from the European Research Council under the European
Union’s Seventh Framework Programme (FP/2007-2013) / ERC Grant Agreement n. 320815 (ERC Advanced Grant Project
“Advanced tools for computational design of engineering materials” COMP-DES-MAT). Oriol Lloberas-Valls gratefully
acknowledges the funding received from the Spanish Ministry of Economy and Competitiveness through the “Juan de la
Cierva” Postdoctoral Junior Grant: JCI-2012-13782 and the National Research Plan 2014: MAT2014-60919-R.

Competing interests
The authors declare that they have no competing interests.

Received: 9 April 2016 Accepted: 12 July 2016

References
1. Krog L, Tucker A, Rollema G. Application of topology, sizing and shape optimization methods to optimal design of

aircraft components. Proc 3rd Altair UK hyperWorks users conference. 2002. p. 1–12.
2. Topology optimization guide. http://www.topology-opt.com/software-list/. Accessed 8-Apr 2015.
3. Dassault systemes. Topology and shape optimization with Abaqus; 2011. http://www.simulia.com/download/

rum11/GL/Sandeep-Urankar-ATOM-SGL-RUM-2011.pdf . Accessed 8 Apr 2015.

http://www.topology-opt.com/software-list/
http://www.simulia.com/download/rum11/GL/Sandeep-Urankar-ATOM-SGL-RUM-2011.pdf
http://www.simulia.com/download/rum11/GL/Sandeep-Urankar-ATOM-SGL-RUM-2011.pdf


Ferrer et al. Adv. Model. and Simul. in Eng. Sci. (2016) 3:23 Page 22 of 22

4. Altair Engineering. Altair hyperworks optistruct. http://www.altairhyperworks.com/product/OptiStruct. Accessed 8
Apr 2015.

5. BendsoeMP, Kikuchi N. Generating optimal topologies in structural design using a homogenizationmethod. Comput
Methods Appl Mech Eng. 1988;71(2):197–224.

6. Xie YM, Steven GP. A simple evolutionary procedure for structural optimization. Comput Struct. 1993;49(5):885–96.
7. Allaire G, Jouve F, Toader AM. Structural optimization using sensitivity analysis and a level-set method. J Comput

Phys. 2004;194(1):363–93.
8. Sokolowski J, Zochowski A. The topological derivative method in shape optimization. SIAM J Cont Optim.

1999;37(4):1251–72.
9. Novotny A, Sokolowski J. Topological derivatives in shape optimization. In: Ditzinger T, editor. Interaction ofmechanics

and mathematics. Heidelberg: Springer Berlin; 2013.
10. Amstutz S, Andrä H. A new algorithm for topology optimization using a level-set method. J Comput Phys.

2006;216(2):573–88.
11. Amstutz S, Giusti SM, Novotny AA, De Souza Neto EA. Topological derivative for multi-scale linear elasticity models

applied to the synthesis of microstructures. Int J Numer Methods Engg. 2010;84(6):733–56.
12. Allaire G. Shape optimization by the homogenization method. Heidelberg: Springer Science & Business Media; 2012.
13. De Souza Neto EA, Feijóo RA. Variational foundations of large strain multiscale solid constitutive models: kinematical

formulation. In: Vaz M, Munoz-Rojas PA, de Souza Neto EA, editors. Advanced computational materials modeling:
from classical to multi-scale techniques-scale techniques. Weinheim: John Wiley & Sons; 2010. p. 341–78.

14. Xia L, Breitkopf P. Concurrent topology optimization design of material and structure within FE2 nonlinear multiscale
analysis framework. Comput Methods Appl Mech Engg. 2014;278:524–42.

15. Schury F, Stingl M, Wein F. Efficient Two-Scale Optimization of Manufacturable Graded Structures. SIAM J Sci Comput.
2012;34(6):B711–33.

16. Kato J, Yachi D, Terada K, Kyoya T. Topology optimization of micro-structure for composites applying a decoupling
multi-scale analysis. Struct Multidiscip Optim. 2014;49(4):595–608.

17. Chinesta F, Leygue A, Bordeu F, Aguado JV, Cueto E, Gonzalez D, et al. PGD-based computational Vademecum for
efficient design, optimization and control. Arch Comput Methods Eng. 2013;20(1):31–59.

18. Baiges J, Codina R, Idelsohn S. Reduced-order subscales for POD models. Comput Methods Appl Mech Eng.
2015;291:173–96.

19. Hernandez JA, Oliver J, Huespe AE, Caicedo MA, Cante JC. High-performance model reduction techniques in compu-
tational multiscale homogenization. Comput Methods Appl Mech Eng. 2014;276:149–89.

20. Gomes Lopes C, Batista dos Santos R, Novotny AA. Topological derivative-based topology optimization of structures
subject to multiple load-cases. Latin Am J Solid Struct. 2015;12:834–60.

21. Novotny AA, Feijóo RA, Taroco E, Padra C. Topological sensitivity analysis. Comput Methods Appl Mech Eng.
2003;192(7–8):803–29.

22. De Souza Neto EA, Amstutz S, Giusti SM, Novotny AA. Topological derivative-based optimization of micro-structures
considering different multi-scale models. CMES -. Comput Model Eng Sci. 2010;62(1):23–54.

23. Giusti SM, Mello LAM, Silva ECN. Piezoresistive device optimization using topological derivative concepts. Struct
Multidiscip Optim. 2014;50(3):453–64.

24. Esteves Campeão D, Miguel Giusti S, Antonio Novotny A. Topology design of plates considering different volume
control methods. Eng Comput. 2014;31(5):826–42.

25. Amstutz S. Regularized perimeter for topology optimization. SIAM J Cont Optim. 2013;51(3):2176–99.

http://www.altairhyperworks.com/product/OptiStruct

	Vademecum-based approach to multi-scale topological material design
	Abstract
	Background
	Multi-scale topology optimization framework
	Multi-scale problem
	Multi-scale variational framework
	Hill- Mandel principle
	Equilibrium equation and micro-cell boundary conditions
	The homogenized constitutive tensor

	Topological derivative at the micro-scale
	Topological derivative of the homogenized constitutive tensor
	Level set algorithm

	Representative examples

	Multi-scale topology optimization problem
	Formulation
	Algorithmic separability
	Algorithmic complexity 

	Vademecum-based computational cost reduction
	Parametric domain

	Numerical algorithm
	Numerical examples
	Cantilever beam
	Bending beam

	Concluding remarks
	Acknowledgements
	References




